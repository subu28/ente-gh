"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1263],{88769:function(e,t,r){r.d(t,{$Q:function(){return f},IG:function(){return p},O3:function(){return u},XD:function(){return l},gd:function(){return d},zx:function(){return y}});var n=r(96045),a=r(73873),c=r(95525),i=r(18786),o=r(80613);let s=(0,c.O3)(),u=async e=>{try{return(await a.Z.get("".concat(s,"/users/srp/attributes"),{email:e})).data.attributes}catch(e){return n.ZP.error("failed to get SRP attributes",e),null}},y=async(e,t)=>{try{return(await a.Z.post("".concat(s,"/users/srp/setup"),t,void 0,{"X-Auth-Token":e})).data}catch(e){throw n.ZP.error("failed to post SRP attributes",e),e}},l=async(e,t)=>{try{return(await a.Z.post("".concat(s,"/users/srp/complete"),t,void 0,{"X-Auth-Token":e})).data}catch(e){throw n.ZP.error("failed to complete SRP setup",e),e}},p=async(e,t)=>{try{return(await a.Z.post("".concat(s,"/users/srp/create-session"),{srpUserID:e,srpA:t})).data}catch(e){throw n.ZP.error("createSRPSession failed",e),e}},d=async(e,t,r)=>{try{return(await a.Z.post("".concat(s,"/users/srp/verify-session"),{sessionID:e,srpUserID:t,srpM1:r},void 0)).data}catch(e){if(n.ZP.error("verifySRPSession failed",e),e instanceof i.MS&&e.httpStatusCode===o.WE.Unauthorized)throw Error(i.sH.INCORRECT_PASSWORD);throw e}},f=async(e,t)=>{try{return(await a.Z.post("".concat(s,"/users/srp/update"),t,void 0,{"X-Auth-Token":e})).data}catch(e){throw n.ZP.error("updateSRPAndKeys failed",e),e}}},54196:function(e,t,r){r.d(t,{L:function(){return y}});var n=r(52903),a=r(76228),c=r(49521),i=r(89449),o=r(62197),s=r(24991),u=r(2784);let y=e=>{let{password:t}=e,r=(0,u.useMemo)(()=>(0,c.rp)(t),[t]);return(0,n.tZ)(i.A0,{mt:"8px",mb:"4px",children:(0,n.tZ)(o.Z,{variant:"small",sx:e=>({color:r===a.Y.WEAK?e.colors.danger.A700:r===a.Y.MODERATE?e.colors.warning.A500:e.colors.accent.A500}),textAlign:"left",flex:1,children:t?(0,s.t)("PASSPHRASE_STRENGTH",{context:r}):""})})}},76228:function(e,t,r){var n,a;r.d(t,{Y:function(){return n}}),(a=n||(n={})).WEAK="WEAK",a.MODERATE="MODERATE",a.STRONG="STRONG"},50918:function(e,t,r){var n,a;r.d(t,{q:function(){return n}}),(a=n||(n={})).ROOT="/",a.CHANGE_EMAIL="/change-email",a.CHANGE_PASSWORD="/change-password",a.CREDENTIALS="/credentials",a.GENERATE="/generate",a.LOGIN="/login",a.RECOVER="/recover",a.SIGNUP="/signup",a.TWO_FACTOR_SETUP="/two-factor/setup",a.TWO_FACTOR_VERIFY="/two-factor/verify",a.TWO_FACTOR_RECOVER="/two-factor/recover",a.VERIFY="/verify",a.SHARED_ALBUMS="/shared-albums"},34291:function(e,t,r){r.d(t,{Bs:function(){return f},a4:function(){return w},pL:function(){return S},u1:function(){return E}});var n=r(96045),a=r(88659),c=r(2299),i=r(66546),o=r(94522),s=r(50232),u=r(6364),y=r(88769),l=r(49521),p=r(79644).Buffer;let d=s.SRP.params["4096"],f=async e=>{let{srpSalt:t,srpUserID:r,srpVerifier:a,loginSubKey:c}=e;try{if(i.Z.get(i.i.SRP_CONFIGURE_IN_PROGRESS))throw Error("SRP configure already in progress");i.Z.set(i.i.SRP_CONFIGURE_IN_PROGRESS,!0);let e=await E(t,r,c),s=(0,l.HC)(e.computeA());n.ZP.debug(()=>"srp a: ".concat(s));let u=(0,o.LP)(),{setupID:p,srpB:d}=await (0,y.zx)(u,{srpA:s,srpUserID:r,srpSalt:t,srpVerifier:a});e.setB((0,l.GS)(d));let f=(0,l.HC)(e.computeM1()),{srpM2:w}=await (0,y.XD)(u,{srpM1:f,setupID:p});e.checkM2((0,l.GS)(w))}catch(e){throw n.ZP.error("Failed to configure SRP",e),e}finally{i.Z.set(i.i.SRP_CONFIGURE_IN_PROGRESS,!1)}},w=async e=>{let t=await a.Z.getInstance(),r=await t.generateSaltToDeriveKey(),c=(0,u.Z)(),i=s.SRP.computeVerifier(d,(0,l.GS)(r),p.from(c),(0,l.GS)(e)),o={srpUserID:c,srpSalt:r,srpVerifier:(0,l.HC)(i),loginSubKey:e};return n.ZP.debug(()=>"SRP setup attributes generated: ".concat(JSON.stringify(o))),o},S=async(e,t)=>{try{let r=await (0,c.uA)(t),a=await E(e.srpSalt,e.srpUserID,r),i=a.computeA(),{srpB:o,sessionID:s}=await (0,y.IG)(e.srpUserID,(0,l.HC)(i));a.setB((0,l.GS)(o));let u=a.computeM1();n.ZP.debug(()=>"srp m1: ".concat((0,l.HC)(u)));let{srpM2:p,...d}=await (0,y.gd)(s,e.srpUserID,(0,l.HC)(u));return n.ZP.debug(()=>"srp verify session successful,srpM2: ".concat(p)),a.checkM2((0,l.GS)(p)),n.ZP.debug(()=>"srp server verify successful"),d}catch(e){throw n.ZP.error("srp verify failed",e),e}},E=async(e,t,r)=>new Promise((n,a)=>{s.SRP.genKey(function(c,i){try{if(c&&a(c),!i)throw Error("secret1 gen failed");let o=new s.SrpClient(d,(0,l.GS)(e),p.from(t),(0,l.GS)(r),i,!1);n(o)}catch(e){a(e)}})})},49521:function(e,t,r){r.d(t,{DZ:function(){return y},GS:function(){return s},HC:function(){return o},rp:function(){return u}});var n=r(76228),a=r(16152),c=r.n(a),i=r(79644).Buffer;let o=e=>e.toString("base64"),s=e=>i.from(e,"base64");function u(e){if(!e)return n.Y.WEAK;let t=c()(e);return t.score<2?n.Y.WEAK:t.score<3?n.Y.MODERATE:n.Y.STRONG}let y=e=>u(e)===n.Y.WEAK},58627:function(e,t,r){r.d(t,{j:function(){return i}});var n=r(88659),a=r(2299),c=r(34291);async function i(e){let t=await n.Z.getInstance(),r=await t.generateEncryptionKey(),i=await t.generateEncryptionKey(),o=await t.generateSaltToDeriveKey(),s=await t.deriveSensitiveKey(e,o),u=await t.encryptToB64(r,s.key),y=await t.encryptToB64(r,i),l=await t.encryptToB64(i,r),p=await t.generateKeyPair(),d=await t.encryptToB64(p.privateKey,r),f=await (0,a.uA)(s.key),w=await (0,c.a4)(f);return{keyAttributes:{kekSalt:o,encryptedKey:u.encryptedData,keyDecryptionNonce:u.nonce,publicKey:p.publicKey,encryptedSecretKey:d.encryptedData,secretKeyDecryptionNonce:d.nonce,opsLimit:s.opsLimit,memLimit:s.memLimit,masterKeyEncryptedWithRecoveryKey:y.encryptedData,masterKeyDecryptionNonce:y.nonce,recoveryKeyEncryptedWithMasterKey:l.encryptedData,recoveryKeyDecryptionNonce:l.nonce},masterKey:r,srpSetupAttributes:w}}},16950:function(e,t,r){var n=r(52903),a=r(89449),c=r(56961);r(2784),t.Z=e=>{let{sx:t,style:r,...i}=e;return(0,n.BX)(n.HY,{children:[(0,n.tZ)(c.Z,{}),(0,n.tZ)(a.wx,{style:{flexDirection:"row",...r},sx:{mt:3,...t},...i,children:i.children})]})}},77754:function(e,t,r){var n=r(52903),a=r(62197);r(2784),t.Z=e=>{let{sx:t,...r}=e;return(0,n.tZ)(a.Z,{variant:"h2",sx:{mb:8,...t},...r,children:r.children})}},83422:function(e,t,r){var n=r(52903),a=r(26436),c=r(38203),i=r(35469),o=r(85801);r(2784),t.Z=e=>{let{showPassword:t,handleClickShowPassword:r,handleMouseDownPassword:s}=e;return(0,n.tZ)(i.Z,{position:"end",children:(0,n.tZ)(o.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:r,onMouseDown:s,edge:"end",children:t?(0,n.tZ)(c.Z,{}):(0,n.tZ)(a.Z,{})})})}},95770:function(e,t,r){var n=r(52903),a=r(23119);r(2784),t.Z=e=>{let{children:t,sx:r,color:c,...i}=e;return(0,n.tZ)(a.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(c,".main"),textDecoration:"underline ",textDecorationColor:"".concat(c,".main")},...r},...i,children:t})}},47290:function(e,t,r){var n=r(52903),a=r(711),c=r(8204),i=r(72841);r(2784),t.Z=e=>{let{loading:t,buttonText:r,disabled:o,success:s,sx:u,...y}=e;return(0,n.tZ)(c.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:o||t||s,sx:{my:4,...t?{"&.Mui-disabled":{backgroundColor:e=>e.colors.accent.A500,color:e=>e.colors.text.base}}:{},...u},...y,children:t?(0,n.tZ)(i.Z,{size:20}):s?(0,n.tZ)(a.Z,{sx:{fontSize:20}}):r})}},2299:function(e,t,r){r.d(t,{CP:function(){return d},OT:function(){return f},PN:function(){return y},iv:function(){return l},uA:function(){return p},yr:function(){return w}});var n=r(96045),a=r(92660),c=r(10005),i=r(94522),o=r(24450),s=r(35042),u=r(88659);async function y(e,t){let r=await u.Z.getInstance(),n=(0,c.Yu)(c.Pd.USER),a=null,{encryptedToken:i}=n;if(i&&i.length>0){let o=await r.decryptB64(e.encryptedSecretKey,e.secretKeyDecryptionNonce,t),s=await r.boxSealOpen(i,e.publicKey,o),u=await r.fromB64(s);a=await r.toB64URLSafe(u),(0,c.a_)(c.Pd.USER,{...n,token:a,encryptedToken:null})}}async function l(e,t,r){let n=await u.Z.getInstance(),a=await n.generateSaltToDeriveKey(),i=await n.deriveInteractiveKey(e,a),o=await n.encryptToB64(r,i.key),s=Object.assign(t,{kekSalt:a,encryptedKey:o.encryptedData,keyDecryptionNonce:o.nonce,opsLimit:i.opsLimit,memLimit:i.memLimit});return(0,c.a_)(c.Pd.KEY_ATTRIBUTES,s),s}let p=async e=>{let t=await u.Z.getInstance(),r=await t.generateSubKey(e,32,1,"loginctx"),n=await t.fromB64(r);return await t.toB64(n.slice(0,16))},d=async(e,t,r)=>{let n=await u.Z.getInstance(),a=await n.generateKeyAndEncryptToB64(t);(0,o.Dt)(e,a);let c=globalThis.electron;c&&!r&&e===o.Qm.ENCRYPTION_KEY&&c.saveEncryptionKey(t)};async function f(e){let t=await u.Z.getInstance(),r=await w(),n=await t.fromHex(r);return await t.encryptToB64(e,n)}let w=async()=>{try{let e;let t=await u.Z.getInstance(),{recoveryKeyEncryptedWithMasterKey:r,recoveryKeyDecryptionNonce:n}=(0,c.Yu)(c.Pd.KEY_ATTRIBUTES),a=await (0,s.G)();return e=r?await t.decryptB64(r,n,a):await S(),e=await t.toHex(e)}catch(e){throw console.log(e),n.ZP.error("getRecoveryKey failed",e),e}};async function S(){let e=await (0,s.G)(),t=(0,c.Yu)(c.Pd.KEY_ATTRIBUTES),r=await u.Z.getInstance(),n=await r.generateEncryptionKey(),o=await r.encryptToB64(e,n),y=await r.encryptToB64(n,e),l={masterKeyEncryptedWithRecoveryKey:o.encryptedData,masterKeyDecryptionNonce:o.nonce,recoveryKeyEncryptedWithMasterKey:y.encryptedData,recoveryKeyDecryptionNonce:y.nonce};await (0,a.Jl)((0,i.LP)(),l);let p=Object.assign(t,l);return(0,c.a_)(c.Pd.KEY_ATTRIBUTES,p),n}}}]);