(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3116],{82816:function(t,e,n){"use strict";n.d(e,{a:function(){return c}});var i=n(52903),o=n(89449),a=n(62197),r=n(24862),l=n(24991);function c(t){let{name:e,fileCount:n,endIcon:c}=t;return(0,i.BX)("div",{children:[(0,i.tZ)(a.Z,{variant:"h3",children:e}),(0,i.BX)(o.A0,{children:[(0,i.tZ)(a.Z,{variant:"small",color:"text.muted",children:(0,l.t)("photos_count",{count:n})}),c&&(0,i.tZ)(r.Z,{sx:{svg:{fontSize:"17px",color:"text.muted"}},ml:1.5,children:c})]})]})}n(2784)},83101:function(t,e,n){"use strict";n.d(e,{$Z:function(){return y},Gf:function(){return _},TV:function(){return x},VZ:function(){return I},Zh:function(){return b},gW:function(){return T},v_:function(){return S},vw:function(){return C},wM:function(){return v},xV:function(){return O}});var i=n(73235),o=n(89449),a=n(65992),r=n(24862),l=n(65847);function c(){let t=(0,i._)(["\n    position: relative;\n    overflow: hidden;\n    height: 86px;\n    width: 100%;\n"]);return c=function(){return t},t}function s(){let t=(0,i._)(["\n    padding: 0 24px;\n    @media (max-width: ","px) {\n        padding: 0 4px;\n    }\n    margin-bottom: 16px;\n    border-bottom: 1px solid ",";\n"]);return s=function(){return t},t}function d(){let t=(0,i._)(["\n    width: 100%;\n    margin-bottom: 12px;\n"]);return d=function(){return t},t}function u(){let t=(0,i._)(["\n    width: 100%;\n    height: 120px;\n    overflow: auto;\n    scroll-behavior: smooth;\n    display: flex;\n    gap: 4px;\n"]);return u=function(){return t},t}function p(){let t=(0,i._)(["\n    display: flex;\n    position: relative;\n    border-radius: 4px;\n    overflow: hidden;\n    cursor: pointer;\n    & > img {\n        object-fit: cover;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n    }\n    user-select: none;\n"]);return p=function(){return t},t}function h(){let t=(0,i._)(["\n    height: 3px;\n    background-color: ",";\n    margin-top: 18px;\n    border-radius: 2px;\n"]);return h=function(){return t},t}function Z(){let t=(0,i._)(["\n    width: 90px;\n    height: 64px;\n"]);return Z=function(){return t},t}function f(){let t=(0,i._)(["\n    width: 150px;\n    height: 150px;\n"]);return f=function(){return t},t}function g(){let t=(0,i._)(["\n    width: 48px;\n    height: 48px;\n"]);return g=function(){return t},t}function m(){let t=(0,i._)(["\n    padding: 4px;\n    background: linear-gradient(\n        0deg,\n        rgba(0, 0, 0, 0.1) 0%,\n        rgba(0, 0, 0, 0.5) 86.46%\n    );\n"]);return m=function(){return t},t}function A(){let t=(0,i._)(["\n    padding: 4px;\n    display: flex;\n    justify-content: flex-start;\n    align-items: flex-end;\n    & > .MuiSvgIcon-root {\n        font-size: 20px;\n    }\n"]);return A=function(){return t},t}function E(){let t=(0,i._)(["\n    padding: 8px;\n    background: linear-gradient(\n        0deg,\n        rgba(0, 0, 0, 0.1) 0%,\n        rgba(0, 0, 0, 0.5) 86.46%\n    );\n"]);return E=function(){return t},t}let C=(0,a.ZP)(r.Z)(c()),v=(0,a.ZP)(r.Z)(s(),l.C3*l.yc,t=>{let{theme:e}=t;return e.palette.divider}),I=(0,a.ZP)(r.Z)(d());(0,a.ZP)("div")(u());let w=(0,a.ZP)("div")(p()),y=(0,a.ZP)("div")(h(),t=>{let{theme:e}=t;return e.palette.primary.main}),x=(0,a.ZP)(w)(Z()),S=(0,a.ZP)(w)(f()),T=(0,a.ZP)(w)(g()),b=(0,a.ZP)(o.aV)(m()),_=(0,a.ZP)(o.aV)(A()),O=(0,a.ZP)(o.aV)(E())},65472:function(t,e,n){"use strict";var i=n(52903),o=n(2784),a=n(56392),r=n(89512),l=n(72248);let c=new Date(1800,0,1),s=new Date;e.Z=t=>{let{initialValue:e,disabled:n,onSubmit:d,onClose:u}=t,[p,h]=(0,o.useState)(!0),[Z,f]=(0,o.useState)(null!=e?e:new Date);return(0,i.tZ)(a._,{dateAdapter:l.H,children:(0,i.tZ)(r.W,{value:Z,onChange:f,open:p,onClose:()=>{h(!1),null==u||u()},onOpen:()=>h(!0),maxDateTime:s,minDateTime:c,disabled:n,onAccept:d,DialogProps:{sx:{zIndex:"1502",".MuiPickersToolbar-penIconButton":{display:"none"},".MuiDialog-paper":{width:"320px"},".MuiClockPicker-root":{position:"relative",minHeight:"292px"},".PrivatePickersSlideTransition-root":{minHeight:"200px"}}},renderInput:()=>(0,i.tZ)(i.HY,{})})})}},51475:function(t,e,n){"use strict";n.d(e,{c:function(){return a}});var i=n(65992),o=n(20932);let a=(0,i.ZP)(o.ZP)(t=>{let{theme:e}=t;return{"& .MuiPaper-root":{maxWidth:"375px",width:"100%",scrollbarWidth:"thin",padding:e.spacing(1)}}})},28171:function(t,e,n){"use strict";n.d(e,{ZN:function(){return d},yu:function(){return h},z7:function(){return p}});var i=n(52903),o=n(32383),a=n(24991),r=n(77024),l=n(94746),c=n(2784);let s=t=>t&&t.total>0,d=t=>t&&t.success+t.failed===t.total,u=t=>t&&t.failed>0&&d(t),p=t=>{var e,n;return t&&(null===(n=t.canceller)||void 0===n?void 0:null===(e=n.signal)||void 0===e?void 0:e.aborted)},h=t=>{let{attributesList:e,setAttributesList:n}=t,p=(0,c.useContext)(r.AppContext),h=(0,c.useContext)(l.GalleryContext);if(!e)return(0,i.tZ)(i.HY,{});let Z=t=>{n(e.filter(e=>e.id!==t))},f=t=>{p.setDialogMessage({title:(0,a.t)("STOP_DOWNLOADS_HEADER"),content:(0,a.t)("STOP_ALL_DOWNLOADS_MESSAGE"),proceed:{text:(0,a.t)("YES_STOP_DOWNLOADS"),variant:"critical",action:()=>{null==t||t.canceller.abort(),Z(t.id)}},close:{text:(0,a.t)("NO"),variant:"secondary",action:()=>{}}})},g=t=>()=>{d(t)?Z(t.id):f(t)},m=t=>()=>{let n=e.find(e=>e.id===t),i=globalThis.electron;i?i.openDirectory(n.downloadDirPath):n.isHidden?h.openHiddenSection(()=>{h.setActiveCollectionID(n.collectionID)}):h.setActiveCollectionID(n.collectionID)};return(0,i.tZ)(i.HY,{children:e.map((t,e)=>(0,i.tZ)(o.Z,{horizontal:"left",sx:{"&&":{bottom:"".concat(80*e+20,"px")},zIndex:1600},open:s(t),onClose:g(t),keepOpenOnClick:!0,attributes:{variant:u(t)?"critical":"secondary",title:u(t)?(0,a.t)("DOWNLOAD_FAILED"):d(t)?(0,a.t)("DOWNLOAD_COMPLETE"):(0,a.t)("DOWNLOADING_COLLECTION",{name:t.folderName}),caption:d(t)?t.folderName:(0,a.t)("DOWNLOAD_PROGRESS",{progress:{current:t.success+t.failed,total:t.total}}),onClick:m(t.id)}},t.id))})}},24222:function(t,e,n){"use strict";n.d(e,{Z:function(){return g}});var i=n(73235),o=n(52903),a=n(92679),r=n(65992),l=n(24991),c=n(77024),s=n(2784);function d(){let t=(0,i._)(["\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    cursor: pointer;\n"]);return d=function(){return t},t}function u(){let t=(0,i._)(["\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n"]);return u=function(){return t},t}function p(){let t=(0,i._)(["\n    border-width: 8px;\n    left: 0;\n    top: 0;\n    outline: none;\n    transition: border 0.24s ease-in-out;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #fff;\n    font-size: 24px;\n    font-weight: 900;\n    text-align: center;\n    position: absolute;\n    border-color: #51cd7c;\n    border-style: solid;\n    background: rgba(0, 0, 0, 0.9);\n    z-index: 3000;\n"]);return p=function(){return t},t}let h=(0,r.ZP)("div")(d()),Z=(0,r.ZP)("div")(u()),f=(0,r.ZP)("div")(p());function g(t){let e=(0,s.useContext)(c.AppContext),[n,i]=(0,s.useState)(!1),r=()=>i(!1);return(0,s.useEffect)(()=>{window.addEventListener("keydown",t=>{"Escape"===t.code&&r()})},[]),(0,s.useEffect)(()=>{let t=t=>{if(!e.watchFolderView)return;t.preventDefault(),t.stopPropagation();let n=t.dataTransfer.files;n.length>0&&e.setWatchFolderFiles(n)};return addEventListener("drop",t),()=>{removeEventListener("drop",t)}},[e.watchFolderView]),(0,o.BX)(Z,{...t.getDragAndDropRootProps({onDragEnter:()=>i(!0)}),children:[n&&(0,o.BX)(f,{onDrop:r,onDragLeave:r,children:[(0,o.tZ)(h,{onClick:r,children:(0,o.tZ)(a.Z,{})}),e.watchFolderView?(0,l.t)("WATCH_FOLDER_DROPZONE_MESSAGE"):(0,l.t)("UPLOAD_DROPZONE_MESSAGE")]}),t.children]})}},30295:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var i=n(52903),o=n(2672),a=n(24862),r=n(30845),l=n(2784),c=n(50166);let s=(0,r.Z)((t,e,n)=>({renderListItem:t,getItemTitle:e,items:n})),d=l.memo(t=>{let{index:e,style:n,data:a}=t,{renderListItem:r,items:l,getItemTitle:c}=a;return(0,i.tZ)(o.Z,{PopperProps:{sx:{".MuiTooltip-tooltip.MuiTooltip-tooltip.MuiTooltip-tooltip":{marginTop:0}}},title:c(l[e]),placement:"bottom-start",enterDelay:300,enterNextDelay:100,children:(0,i.tZ)("div",{style:n,children:r(l[e])})})},c.wy);function u(t){let e=s(t.renderListItem,t.getItemTitle,t.items);return(0,i.tZ)(a.Z,{pl:2,children:(0,i.tZ)(c.t7,{itemData:e,height:Math.min(t.itemSize*t.items.length,t.maxHeight),width:"100%",itemSize:t.itemSize,itemCount:t.items.length,itemKey:(e,n)=>{let{items:i}=n;return t.generateItemKey(i[e])},children:d})})}},95347:function(t,e,n){"use strict";n.d(e,{f:function(){return a}});var i=n(73235);function o(){let t=(0,i._)(["\n    left: 0;\n    top: 0;\n    outline: none;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #fff;\n    font-weight: 900;\n    position: absolute;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 9000;\n"]);return o=function(){return t},t}let a=(0,n(65992).ZP)("div")(o())},46458:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var i=n(52903),o=n(56961);function a(t){let{hasIcon:e=!1}=t;return(0,i.tZ)(o.Z,{sx:{"&&&":{my:0,ml:e?"48px":"16px"}}})}},40337:function(t,e,n){"use strict";n.d(e,{G:function(){return i}});let i=(0,n(65992).ZP)("div")(t=>{let{theme:e}=t;return"\n    & > .MuiMenuItem-root{\n        border-radius: 8px;\n        background-color: transparent;\n    }\n    & > .MuiMenuItem-root:not(:last-of-type) {\n        border-bottom-left-radius: 0;\n        border-bottom-right-radius: 0;\n    }\n    & > .MuiMenuItem-root:not(:first-of-type) {\n        border-top-left-radius: 0;\n        border-top-right-radius: 0;\n    }\n    background-color: ".concat(e.colors.fill.faint,";\n    border-radius: 8px;\n")})},51173:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var i=n(52903),o=n(89449),a=n(62197);function r(t){let{title:e,icon:n}=t;return(0,i.BX)(o.zr,{px:"8px",py:"6px",gap:"8px",sx:{"& > svg":{fontSize:"17px",color:t=>t.colors.stroke.muted}},children:[n&&n,(0,i.tZ)(a.Z,{variant:"small",color:"text.muted",children:e})]})}},12492:function(t,e,n){"use strict";n.d(e,{Z:function(){return nf}});var i,o,a=n(73235),r=n(52903),l=n(58178),c=n(96045),s=n(65342),d=n(18786),u=n(29010),p=n(65992),h=n(56910),Z=n.n(h),f=n(70098),g=n.n(f),m=n(2784),A=n(5155),E=n(79541),C=n(38229),v=n(54032),I=n(89449),w=n(46470),y=n(2715),x=n(49001),S=n(28319),T=n(92679),b=n(80162),_=n(6163),O=n(29754),L=n(68890),R=n(67997),P=n(59109),D=n(79627),N=n(75733),k=n(89025),M=n(24648),B=n(9250),U=n(8204),F=n(24862);let H={click:()=>{},hide:()=>{},show:()=>{},loading:!1,visible:!1},X=["beforeChange","afterChange","imageLoadComplete","resize","gettingData","mouseUsed","initialZoomIn","initialZoomInEnd","initialZoomOut","initialZoomOutEnd","parseVerticalMargin","close","unbindEvents","destroy","updateScrollOffset","preventDragEvent","shareLinkClick"];var K=n(24991),G=n(72751),W=n.n(G),V=n(77024),Y=n(94746),z=n(55151),j=n(47371),Q=n(33009),q=n(82797),J=n(41202),$=n(92508),tt=n(48751),te=n(69647),tn=n(65438),ti=n(62594),to=n(37154),ta=n(73460),tr=n(85905),tl=n(64142),tc=n(59636),ts=n(41311),td=n(23119);let tu=(0,p.ZP)(t=>(0,r.tZ)(U.Z,{color:"secondary",...t}))(t=>{let{theme:e}=t;return{...e.typography.small,padding:"8px"}});var tp=n(51475),th=n(9378),tZ=n(99790),tf=n(52202),tg=n(62197);function tm(){let t=(0,a._)(["\n    padding-left: 8px;\n    padding-right: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n"]);return tm=function(){return t},t}let tA=(0,p.ZP)(F.Z)(tm());function tE(t){let{exif:e,open:n,onClose:i,filename:o,onInfoClose:a}=t;return e?(0,r.BX)(tz,{open:n,onClose:i,children:[(0,r.tZ)(th.Z,{onClose:i,title:(0,K.t)("EXIF"),caption:o,onRootClose:()=>{i(),a()},actionButton:(0,r.tZ)(tn.Z,{code:JSON.stringify(e),color:"secondary"})}),(0,r.tZ)(ts.Z,{py:3,px:1,spacing:2,children:[...Object.entries(e)].sort((t,e)=>t[0].localeCompare(e[0])).map(t=>{let[e,n]=t;return n?(0,r.BX)(tA,{children:[(0,r.tZ)(tg.Z,{variant:"small",color:"text.muted",children:e}),(0,r.tZ)(tg.Z,{sx:{width:"100%",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:function(t){switch(typeof t){case"string":case"number":return t;default:if(t instanceof Date)return(0,ti.HI)(t);try{return JSON.stringify(Array.from(t))}catch(t){return null}}}(n)})]},e):(0,r.tZ)(r.HY,{})})})]}):(0,r.tZ)(r.HY,{})}var tC=n(85801);let tv=()=>(0,r.tZ)(w.Z,{style:{width:"20px",height:"20px"}});function tI(t){let{icon:e,title:n,caption:i,openEditor:o,loading:a,hideEditOption:l,customEndButton:c,children:s}=t;return(0,r.BX)(I.A0,{justifyContent:"space-between",children:[(0,r.BX)(F.Z,{display:"flex",alignItems:"flex-start",gap:.5,pr:1,children:[(0,r.tZ)(tC.Z,{color:"secondary",sx:{"&&":{cursor:"default",m:.5}},disableRipple:!0,children:e}),(0,r.tZ)(F.Z,{py:.5,children:s||(0,r.BX)(r.HY,{children:[(0,r.tZ)(tg.Z,{sx:{wordBreak:"break-all"},children:n}),(0,r.tZ)(tg.Z,{variant:"small",color:"text.muted",children:i})]})})]}),c||!l&&(0,r.tZ)(tC.Z,{onClick:o,color:"secondary",children:a?(0,r.tZ)(tv,{}):(0,r.tZ)(O.Z,{})})]})}var tw=n(77033);let ty=(0,p.ZP)(t=>(0,r.tZ)(U.Z,{color:"secondary",...t}))(t=>{let{theme:e}=t;return{...e.typography.small,padding:"8px"}});function tx(){let t=(0,a._)(["\n    height: 200px;\n    width: 100%;\n"]);return tx=function(){return t},t}function tS(){let t=(0,a._)(["\n    position: relative;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: rgba(255, 255, 255, 0.09);\n"]);return tS=function(){return t},t}n(79197),n(35095),(0,tw.ly)()&&n(18006);let tT=(0,tw.ly)()?n(85062):null,tb=(0,p.ZP)("div")(tx()),t_=(0,p.ZP)(tb)(tS());var tO=t=>{let{location:e,mapEnabled:n,openUpdateMapConfirmationDialog:i}=t,o=(0,m.useRef)(null);return(0,m.useEffect)(()=>{let t=o.current;if(n){let n=[e.latitude,e.longitude];if(t&&!t.hasChildNodes()){let e=tT.map(t).setView(n,16);tT.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" rel="noopener" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(e),tT.marker(n).addTo(e).openPopup()}}else t&&t.hasChildNodes()&&t.firstChild&&t.removeChild(t.firstChild)},[n]),n?(0,r.tZ)(tb,{ref:o}):(0,r.tZ)(t_,{children:(0,r.BX)(ty,{onClick:i,children:[" ",(0,K.t)("ENABLE_MAP")]})})},tL=n(711),tR=n(51464),tP=n(63602),tD=n(48601);function tN(t){var e;let{file:n,scheduleUpdate:i,refreshPhotoswipe:o,shouldDisableEdits:a}=t,[l,s]=(0,m.useState)(null==n?void 0:null===(e=n.pubMagicMetadata)||void 0===e?void 0:e.data.caption),[d,u]=(0,m.useState)(!1),p=async t=>{try{if(n){if(l===t)return;s(t);let e=await (0,E.gq)(n,t);(0,E.Vz)(n,e),n.title=n.pubMagicMetadata.data.caption,o(),i()}}catch(t){c.ZP.error("failed to update caption",t)}},h=async t=>{try{u(!0),await p(t.caption)}finally{u(!1)}};return(null==l?void 0:l.length)||!a?(0,r.tZ)(F.Z,{p:1,children:(0,r.tZ)(tP.J9,{initialValues:{caption:l},validationSchema:tD.Ry().shape({caption:tD.Z_().max(5e3,(0,K.t)("CAPTION_CHARACTER_LIMIT"))}),validateOnBlur:!1,onSubmit:h,children:t=>{let{values:e,errors:n,handleChange:i,handleSubmit:o,resetForm:c}=t;return(0,r.BX)("form",{noValidate:!0,onSubmit:o,children:[(0,r.tZ)(tR.Z,{hiddenLabel:!0,fullWidth:!0,id:"caption",name:"caption",type:"text",multiline:!0,placeholder:(0,K.t)("CAPTION_PLACEHOLDER"),value:e.caption,onChange:i("caption"),error:!!n.caption,helperText:n.caption,disabled:d||a}),e.caption!==l&&(0,r.BX)(I.A0,{justifyContent:"flex-end",children:[(0,r.tZ)(tC.Z,{type:"submit",disabled:d,children:d?(0,r.tZ)(tv,{}):(0,r.tZ)(tL.Z,{})}),(0,r.tZ)(tC.Z,{onClick:()=>c({values:{caption:null!=l?l:""},touched:{caption:!1}}),disabled:d,children:(0,r.tZ)(T.Z,{})})]})]})}})}):(0,r.tZ)(r.HY,{})}var tk=n(4237),tM=n(65472);function tB(t){let{shouldDisableEdits:e,file:n,scheduleUpdate:i}=t,[o,a]=(0,m.useState)(!1),l=new Date((null==n?void 0:n.metadata.creationTime)/1e3),[s,d]=(0,m.useState)(!1),u=()=>d(!1),p=async t=>{try{if(a(!0),s&&n){let e=1e3*t.getTime();if(e===(null==n?void 0:n.metadata.creationTime)){u();return}let o=await (0,E.rx)(n,e);(0,E.Vz)(n,o),i()}}catch(t){c.ZP.error("failed to update creationTime",t)}finally{u(),a(!1)}};return(0,r.tZ)(r.HY,{children:(0,r.BX)(I.A0,{children:[(0,r.tZ)(tI,{icon:(0,r.tZ)(tk.Z,{}),title:(0,ti.p6)(l),caption:(0,ti.mr)(l),openEditor:()=>d(!0),loading:o,hideEditOption:e||s}),s&&(0,r.tZ)(tM.Z,{initialValue:l,disabled:o,onSubmit:p,onClose:u})]})})}var tU=n(58936),tF=n(99612),tH=n(80427),tX=n(30794),tK=n(69669);let tG=t=>{let{isInEditMode:e,closeEditMode:n,filename:i,extension:o,saveEdits:a}=t,l=async(t,e)=>{try{await a(t),n()}catch(t){e((0,K.t)("UNKNOWN_ERROR"))}};return(0,r.tZ)(tX.Z,{sx:{zIndex:1600},open:e,onClose:n,attributes:{title:(0,K.t)("RENAME_FILE")},children:(0,r.tZ)(tK.Z,{initialValue:i,callback:l,placeholder:(0,K.t)("ENTER_FILE_NAME"),buttonText:(0,K.t)("RENAME"),fieldType:"text",caption:o,secondaryButtonAction:n,submitButtonProps:{sx:{mt:1,mb:2}}})})},tW=(t,e)=>e?t+"."+e:t,tV=(t,e)=>{var n;let i=null==e?void 0:e.megaPixels,o=null==e?void 0:e.resolution,a=null===(n=t.info)||void 0===n?void 0:n.fileSize,l=[];return i&&l.push(i),o&&l.push(o),a&&l.push((0,tH.O5)(a)),(0,r.tZ)(I.A0,{gap:1,children:l.map(t=>(0,r.BX)(F.Z,{children:[" ",t]},t))})};function tY(t){let{parsedExifData:e,shouldDisableEdits:n,file:i,scheduleUpdate:o}=t,[a,s]=(0,m.useState)(!1),d=()=>s(!1),[u,p]=(0,m.useState)(),[h,Z]=(0,m.useState)();(0,m.useEffect)(()=>{let[t,e]=(0,v.YA)(i.metadata.title);p(t),Z(e)},[i]);let f=async t=>{try{if(i){if(u===t){d();return}p(t);let e=tW(t,h),n=await (0,E.tc)(i,e);(0,E.Vz)(i,n),o()}}catch(t){throw c.ZP.error("failed to update file name",t),t}};return(0,r.BX)(r.HY,{children:[(0,r.tZ)(tI,{icon:i.metadata.fileType===l.Gk.VIDEO?(0,r.tZ)(tF.Z,{}):(0,r.tZ)(tU.Z,{}),title:tW(u,h),caption:tV(i,e),openEditor:()=>s(!0),hideEditOption:n||a}),(0,r.tZ)(tG,{isInEditMode:a,closeEditMode:d,filename:u,extension:h,saveEdits:f})]})}let tz=(0,p.ZP)(t=>(0,r.tZ)(tp.c,{...t,anchor:"right"}))({zIndex:1501,"& .MuiPaper-root":{padding:8}});function tj(t){let{parsedExifData:e}=t;return(0,r.BX)(I.A0,{gap:1,children:[(0,r.tZ)(F.Z,{children:e.fNumber}),(0,r.tZ)(F.Z,{children:e.exposureTime}),(0,r.tZ)(F.Z,{children:e.ISO})]})}function tQ(t){return"https://www.openstreetmap.org/?mlat=".concat(t.latitude,"&mlon=").concat(t.longitude,"#map=15/").concat(t.latitude,"/").concat(t.longitude)}function tq(t){var e,n;let{shouldDisableEdits:i,showInfo:o,handleCloseInfo:a,file:l,exif:c,scheduleUpdate:s,refreshPhotoswipe:d,fileToCollectionsMap:u,collectionNameMap:p,showCollectionChips:h,closePhotoViewer:Z}=t,f=(0,m.useContext)(V.AppContext),g=(0,m.useContext)(Y.GalleryContext),A=(0,m.useContext)(tt.H),[E,C]=(0,m.useState)(),[v,I]=(0,m.useState)(!1),y=(0,m.useMemo)(()=>{if(l&&l.metadata&&(l.metadata.latitude||0===l.metadata.latitude)&&!(0===l.metadata.longitude&&0===l.metadata.latitude))return{latitude:l.metadata.latitude,longitude:l.metadata.longitude};if(c){let t=(0,Q.Yr)(c);if((t.latitude||0===t.latitude)&&!(0===t.longitude&&0===t.latitude))return t}return null},[l,c]);if((0,m.useEffect)(()=>{var t,e;if(!c){C({});return}let n={};c.fNumber?n.fNumber="f/".concat(Math.ceil(c.FNumber)):c.ApertureValue&&c.FocalLength&&(n.fNumber="f/".concat(Math.ceil(c.FocalLength/c.ApertureValue)));let i=null!==(t=c.ImageWidth)&&void 0!==t?t:c.ExifImageWidth,o=null!==(e=c.ImageHeight)&&void 0!==e?e:c.ExifImageHeight;i&&o&&(n.resolution="".concat(i," x ").concat(o),Math.round(i*o/1e6)&&(n.megaPixels="".concat(Math.round(i*o/1e6),"MP"))),c.Make&&c.Model&&(n.takenOnDevice="".concat(c.Make," ").concat(c.Model)),c.ExposureTime&&(n.exposureTime="1/".concat(1/parseFloat(c.ExposureTime))),c.ISO&&(n.ISO="ISO".concat(c.ISO)),C(n)},[c]),!l)return(0,r.tZ)(r.HY,{});let x=t=>{g.setActiveCollectionID(t),g.setIsInSearchMode(!1),Z()};return(0,r.BX)(tz,{open:o,onClose:a,children:[(0,r.tZ)(th.Z,{onClose:a,title:(0,K.t)("INFO"),backIsClose:!0}),(0,r.BX)(ts.Z,{pt:1,pb:3,spacing:"20px",children:[(0,r.tZ)(tN,{shouldDisableEdits:i,file:l,scheduleUpdate:s,refreshPhotoswipe:d}),(0,r.tZ)(tB,{shouldDisableEdits:i,file:l,scheduleUpdate:s}),(0,r.tZ)(tY,{parsedExifData:E,shouldDisableEdits:i,file:l,scheduleUpdate:s}),E&&E.takenOnDevice&&(0,r.tZ)(tI,{icon:(0,r.tZ)(ta.Z,{}),title:E.takenOnDevice,caption:(0,r.tZ)(tj,{parsedExifData:E}),hideEditOption:!0}),y&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(tI,{icon:(0,r.tZ)(tl.Z,{}),title:(0,K.t)("LOCATION"),caption:!f.mapEnabled||A.accessedThroughSharedURL?(0,r.tZ)(td.Z,{href:tQ(y),target:"_blank",sx:{fontWeight:"bold"},children:(0,K.t)("SHOW_ON_MAP")}):(0,r.tZ)(tf.Z,{onClick:()=>f.setDialogBoxAttributesV2((0,te.QU)(()=>f.updateMapEnabled(!1))),sx:{textDecoration:"none",color:"text.muted",fontWeight:"bold"},children:(0,K.t)("DISABLE_MAP")}),customEndButton:(0,r.tZ)(tn.Z,{code:tQ(y),color:"secondary",size:"medium"})}),!A.accessedThroughSharedURL&&(0,r.tZ)(tO,{location:y,mapEnabled:f.mapEnabled,openUpdateMapConfirmationDialog:()=>f.setDialogBoxAttributesV2((0,te.tJ)(()=>f.updateMapEnabled(!0)))})]}),(0,r.tZ)(tI,{icon:(0,r.tZ)(tc.Z,{}),title:(0,K.t)("DETAILS"),caption:void 0===c?(0,r.tZ)(w.Z,{size:11.33}):null!==c?(0,r.tZ)(tf.Z,{onClick:()=>I(!0),sx:{textDecoration:"none",color:"text.muted",fontWeight:"bold"},children:(0,K.t)("VIEW_EXIF")}):(0,K.t)("NO_EXIF"),hideEditOption:!0}),(0,r.tZ)(tI,{icon:(0,r.tZ)(to.Z,{}),title:(0,ti.p6)(l.metadata.modificationTime/1e3),caption:(0,ti.mr)(l.metadata.modificationTime/1e3),hideEditOption:!0}),h&&(0,r.tZ)(tI,{icon:(0,r.tZ)(tr.Z,{}),hideEditOption:!0,children:(0,r.tZ)(F.Z,{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",children:null==u?void 0:null===(n=u.get(l.id))||void 0===n?void 0:null===(e=n.filter(t=>p.has(t)))||void 0===e?void 0:e.map(t=>(0,r.tZ)(tu,{onClick:()=>x(t),children:p.get(t)},t))})}),f.mlSearchEnabled&&(0,r.tZ)(r.HY,{children:(0,r.tZ)(tZ.oY,{file:l})})]}),(0,r.tZ)(tE,{exif:c,open:v,onClose:()=>I(!1),onInfoClose:a,filename:l.metadata.title})]})}var tJ=n(17973),t$=n(44973),t0=n(48588),t1=n(86345),t2=n(18169),t5=n(41521),t4=n(87054),t3=n(76475),t9=n(42603),t6=n(38388),t8=n(72841),t7=n(69732),et=n(78287),ee=n(46458),en=n(40337),ei=n(51173);let eo={brightness:100,contrast:100,blur:0,saturation:100,invert:!1};var ea=n(40994),er=n(41424),el=t=>(0,r.BX)(r.HY,{children:[(0,r.BX)(F.Z,{px:"8px",children:[(0,r.tZ)(ei.Z,{title:(0,K.t)("BRIGHTNESS")}),(0,r.tZ)(er.ZP,{min:0,max:200,defaultValue:100,step:10,valueLabelDisplay:"auto",value:t.brightness,marks:[{value:100,label:"100%"}],onChange:(e,n)=>{t.setBrightness(n)}}),(0,r.tZ)(ei.Z,{title:(0,K.t)("CONTRAST")}),(0,r.tZ)(er.ZP,{min:0,max:200,defaultValue:100,step:10,valueLabelDisplay:"auto",value:t.contrast,onChange:(e,n)=>{t.setContrast(n)},marks:[{value:100,label:"100%"}]}),(0,r.tZ)(ei.Z,{title:(0,K.t)("BLUR")}),(0,r.tZ)(er.ZP,{min:0,max:10,defaultValue:0,step:1,valueLabelDisplay:"auto",value:t.blur,onChange:(e,n)=>{t.setBlur(n)}}),(0,r.tZ)(ei.Z,{title:(0,K.t)("SATURATION")}),(0,r.tZ)(er.ZP,{min:0,max:200,defaultValue:100,step:10,valueLabelDisplay:"auto",value:t.saturation,onChange:(e,n)=>{t.setSaturation(n)},marks:[{value:100,label:"100%"}]})]}),(0,r.tZ)(en.G,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(t0.v,{variant:"toggle",checked:t.invert,label:(0,K.t)("INVERT_COLORS"),onClick:()=>{t.setInvert(!t.invert)}})})]});let ec=function(t,e,n,i,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=t.getContext("2d");if(!r||!t)return;r.imageSmoothingEnabled=!1;let l=(i-e)*a,c=(o-n)*a,s=new Image;s.src=t.toDataURL(),s.onload=()=>{r.clearRect(0,0,t.width,t.height),t.width=l,t.height=c,r.drawImage(s,e,n,l,c,0,0,l,c)}},es=(t,e)=>{let n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=e.width/i.width,a=(n.left-i.left+window.scrollX)*o,r=(n.top-i.top+window.scrollY)*o,l=a+n.width*o,c=r+n.height*o;return{x1:a,x2:l,y1:r,y2:c}};var ed=t=>{let{canvasRef:e,originalSizeCanvasRef:n,canvasLoading:i,setCanvasLoading:o,setTransformationPerformed:a,setCurrentTab:l}=(0,m.useContext)(ev);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(ei.Z,{title:(0,K.t)("FREEHAND")}),(0,r.tZ)(en.G,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(t0.v,{disabled:i,startIcon:(0,r.tZ)(t5.Z,{}),onClick:()=>{if(!t.cropBoxRef.current||!e.current)return;let{x1:i,x2:r,y1:c,y2:s}=es(t.cropBoxRef.current,e.current);o(!0),a(!0),ec(e.current,i,c,r,s),ec(n.current,i/t.previewScale,c/t.previewScale,r/t.previewScale,s/t.previewScale),t.resetCropBox(),o(!1),l("transform")},label:(0,K.t)("APPLY_CROP")})})]})};let eu={position:"absolute",height:"10px",width:"10px",backgroundColor:"white",border:"1px solid black",right:"-5px",bottom:"-5px",cursor:"se-resize"},ep=(0,m.forwardRef)((t,e)=>(0,r.BX)(r.HY,{children:[(0,r.tZ)("div",{style:{position:"absolute",top:0,left:0,right:0,height:t.cropBox.y+"px",backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.tZ)("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"calc(100% - ".concat(t.cropBox.y+t.cropBox.height,"px)"),backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.tZ)("div",{style:{position:"absolute",top:t.cropBox.y+"px",left:0,width:t.cropBox.x+"px",height:t.cropBox.height+"px",backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.tZ)("div",{style:{position:"absolute",top:t.cropBox.y+"px",right:0,width:"calc(100% - ".concat(t.cropBox.x+t.cropBox.width,"px)"),height:t.cropBox.height+"px",backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.BX)("div",{style:{display:"grid",position:"absolute",left:t.cropBox.x+"px",top:t.cropBox.y+"px",width:t.cropBox.width+"px",height:t.cropBox.height+"px",border:"1px solid white",gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"0px",zIndex:30},ref:e,children:[Array.from({length:9}).map((t,e)=>(0,r.tZ)("div",{style:{border:"1px solid white",boxSizing:"border-box",pointerEvents:"none"}},e)),(0,r.tZ)("div",{style:eu,onMouseDown:e=>{e.preventDefault(),t.setIsDragging(!0)}})]})]}));var eh=n(23555),eZ=n(80275),ef=n(38119),eg=n(28541),em=n(83747),eA=n(56524);let eE=[{width:16,height:9,icon:(0,r.tZ)(ef.Z,{})},{width:3,height:2,icon:(0,r.tZ)(eZ.Z,{})},{width:16,height:10,icon:(0,r.tZ)(eh.Z,{})}];var eC=()=>{let{canvasRef:t,originalSizeCanvasRef:e,canvasLoading:n,setCanvasLoading:i,setTransformationPerformed:o}=(0,m.useContext)(ev),a=(t,e,n)=>{let i=t.getContext("2d"),o=e/n;if(!i||!t)return;i.imageSmoothingEnabled=!1;let a=new Image;a.src=t.toDataURL(),a.onload=()=>{let e=a.width,n=a.height,r=0,l=0;e/n>o?r=(e-n*o)/2:l=(n-e/o)/2;let c=e-2*r,s=n-2*l;i.clearRect(0,0,t.width,t.height),t.width=c,t.height=s,i.drawImage(a,r,l,c,s,0,0,c,s)}},l=(t,e)=>{let n=t.getContext("2d");if(!n||!t)return;n.resetTransform(),n.imageSmoothingEnabled=!1;let i=new Image;i.src=t.toDataURL(),i.onload=()=>{n.clearRect(0,0,t.width,t.height),n.save(),"horizontal"===e?(n.translate(t.width,0),n.scale(-1,1)):(n.translate(0,t.height),n.scale(1,-1)),n.drawImage(i,0,0,t.width,t.height),n.restore()}},s=(t,e)=>{let n=null==t?void 0:t.getContext("2d");if(!n||!t)return;n.imageSmoothingEnabled=!1;let i=new Image;i.src=t.toDataURL(),i.onload=()=>{n.clearRect(0,0,t.width,t.height),n.save();let o=e*Math.PI/180,a=Math.sin(o),r=Math.cos(o),l=Math.abs(i.width*r)+Math.abs(i.height*a),c=Math.abs(i.width*a)+Math.abs(i.height*r);t.width=l,t.height=c,n.translate(t.width/2,t.height/2),n.rotate(o),n.drawImage(i,-i.width/2,-i.height/2,i.width,i.height),n.restore()}},d=(n,r)=>()=>{try{i(!0),a(t.current,n,r),a(e.current,n,r),i(!1),o(!0)}catch(t){c.ZP.error("crop handler failed - ".concat(JSON.stringify({widthRatio:n,heightRatio:r})),t)}},u=n=>()=>{try{i(!0),s(t.current,"left"===n?-90:90),s(e.current,"left"===n?-90:90),i(!1),o(!0)}catch(t){c.ZP.error("rotation handler (".concat(n,") failed"),t)}},p=n=>()=>{try{i(!0),l(t.current,n),l(e.current,n),i(!1),o(!0)}catch(t){c.ZP.error("flip handler ".concat(n," failed"),t)}};return(0,r.BX)(r.HY,{children:[(0,r.tZ)(ei.Z,{title:(0,K.t)("ASPECT_RATIO")}),(0,r.tZ)(en.G,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(t0.v,{disabled:n,startIcon:(0,r.tZ)(ef.Z,{}),onClick:d(1,1),label:(0,K.t)("SQUARE")+" (1:1)"})}),(0,r.tZ)(en.G,{style:{marginBottom:"1rem"},children:eE.map((t,e)=>(0,r.BX)(m.Fragment,{children:[(0,r.tZ)(t0.v,{disabled:n,startIcon:t.icon,onClick:d(t.width,t.height),label:"".concat(t.width,":").concat(t.height)}),e!==eE.length-1&&(0,r.tZ)(ee.Z,{})]},e))}),(0,r.tZ)(en.G,{style:{marginBottom:"1rem"},children:eE.map((t,e)=>(0,r.BX)(m.Fragment,{children:[(0,r.tZ)(t0.v,{disabled:n,startIcon:t.icon,onClick:d(t.height,t.width),label:"".concat(t.height,":").concat(t.width)},e),e!==eE.length-1&&(0,r.tZ)(ee.Z,{})]},e))}),(0,r.tZ)(ei.Z,{title:(0,K.t)("ROTATION")}),(0,r.BX)(en.G,{style:{marginBottom:"1rem"},children:[(0,r.tZ)(t0.v,{disabled:n,startIcon:(0,r.tZ)(em.Z,{}),onClick:u("left"),label:(0,K.t)("ROTATE_LEFT")+" 90˚"}),(0,r.tZ)(ee.Z,{}),(0,r.tZ)(t0.v,{disabled:n,startIcon:(0,r.tZ)(eA.Z,{}),onClick:u("right"),label:(0,K.t)("ROTATE_RIGHT")+" 90˚"})]}),(0,r.tZ)(ei.Z,{title:(0,K.t)("FLIP")}),(0,r.BX)(en.G,{style:{marginBottom:"1rem"},children:[(0,r.tZ)(t0.v,{disabled:n,startIcon:(0,r.tZ)(eg.Z,{}),onClick:p("vertical"),label:(0,K.t)("FLIP_VERTICALLY")}),(0,r.tZ)(ee.Z,{}),(0,r.tZ)(t0.v,{disabled:n,startIcon:(0,r.tZ)(eg.Z,{}),onClick:p("horizontal"),label:(0,K.t)("FLIP_HORIZONTALLY")})]})]})};let ev=(0,m.createContext)({});var eI=t=>{let e=(0,m.useContext)(V.AppContext),n=(0,m.useRef)(null),i=(0,m.useRef)(null),o=(0,m.useRef)(null),[a,l]=(0,m.useState)(""),[s,d]=(0,m.useState)(),[u,p]=(0,m.useState)(0),[h,Z]=(0,m.useState)("transform"),[f,g]=(0,m.useState)(eo.brightness),[E,C]=(0,m.useState)(eo.contrast),[v,w]=(0,m.useState)(eo.blur),[y,x]=(0,m.useState)(eo.saturation),[b,_]=(0,m.useState)(eo.invert),[O,L]=(0,m.useState)(!1),[R,P]=(0,m.useState)(!1),[D,N]=(0,m.useState)(!1),[k,M]=(0,m.useState)(!0),[B,U]=(0,m.useState)(0),[H,X]=(0,m.useState)({x:0,y:0,width:100,height:100}),[G,W]=(0,m.useState)(0),[Y,z]=(0,m.useState)(0),[Q,q]=(0,m.useState)(0),[J,$]=(0,m.useState)(0),[tt,tn]=(0,m.useState)(!1),[ti,to]=(0,m.useState)(!1),ta=(0,m.useRef)(null),tr=()=>{let t={height:n.current.height,width:n.current.width},e=o.current.getBoundingClientRect(),i=(e.width-t.width)/2;return{offsetY:(e.height-t.height)/2,offsetX:i,canvasBounds:t,parentBounds:e}},tl=()=>{X(t=>{let{offsetX:e,offsetY:n,canvasBounds:i}=tr();return{...t,x:e,y:n,height:i.height,width:i.width}})};(0,m.useEffect)(()=>{if(n.current)try{tc([n.current,i.current]),P(f!==eo.brightness||E!==eo.contrast||v!==eo.blur||y!==eo.saturation||b!==eo.invert)}catch(t){c.ZP.error("Error applying filters",t)}},[f,E,v,y,b,n,a]),(0,m.useEffect)(()=>{"crop"===h&&(tl(),M(!1))},[h]);let tc=async t=>{try{for(let e of t){let t=Math.min(e.width,e.height)/Math.min(n.current.width,n.current.height)*v,i="brightness(".concat(f,"%) contrast(").concat(E,"%) blur(").concat(t,"px) saturate(").concat(y,"%) invert(").concat(b?1:0,")"),o=e.getContext("2d");o.imageSmoothingEnabled=!1,o.filter=i;let r=new Image;r.src=a,await new Promise((t,n)=>{r.onload=()=>{try{o.clearRect(0,0,e.width,e.height),o.save(),o.drawImage(r,0,0,e.width,e.height),o.restore(),t(!0)}catch(t){n(t)}}})}}catch(t){throw c.ZP.error("Error applying filters",t),t}};(0,m.useEffect)(()=>{(u>=360||u<=-360)&&p(0)},[u]);let ts=()=>{g(100),C(100),w(0),x(100),_(!1)},td=async()=>{try{if(!n.current||!o.current||!i.current)return;N(!0),ts(),p(0);let e=new Image,r=n.current.getContext("2d");if(r.imageSmoothingEnabled=!1,a)e.src=a;else{let n=await j.Z.getFileForPreview(t.file);e.src=n.url,l(n.url),d(n.mimeType)}await new Promise((t,a)=>{e.onload=()=>{try{let a=Math.min(o.current.clientWidth/e.width,o.current.clientHeight/e.height);U(a);let l=e.width*a,c=e.height*a;n.current.width=l,n.current.height=c,null==r||r.drawImage(e,0,0,l,c),i.current.width=e.width,i.current.height=e.height;let s=i.current.getContext("2d");null==s||s.drawImage(e,0,0,e.width,e.height),L(!1),P(!1),N(!1),tl(),W(0),z(0),tn(!1),to(!1),t(!0)}catch(t){a(t)}},e.onerror=t=>{a(t)}})}catch(t){c.ZP.error("Error loading canvas",t)}};(0,m.useEffect)(()=>{t.show&&t.file&&td()},[t.show,t.file]);let tu=()=>{l(null),t.onClose()},th=()=>{O||R?e.setDialogBoxAttributesV2((0,te.Et)(tu)):tu()};if(!t.show)return(0,r.tZ)(r.HY,{});let tZ=async()=>ew((0,tJ.z)(i.current),t.file.metadata.title,s),tf=async()=>{if(!n.current)return;let t=await tZ();(0,t1.Et)(URL.createObjectURL(t),t.name)},tm=async()=>{if(n.current)try{let e=(await (0,A.zr)()).find(e=>e.id===t.file.collectionID),n={uploadItem:await tZ(),localID:1,collectionID:t.file.collectionID};ea.Z.prepareForNewUpload(),ea.Z.showUploadProgressDialog(),ea.Z.uploadItems([n],[e]),l(null),t.onClose(),t.closePhotoViewer()}catch(t){c.ZP.error("Error saving copy to ente",t)}};return(0,r.tZ)(r.HY,{children:(0,r.BX)(t6.Z,{sx:{background:"#000",zIndex:1600,width:"100%"},open:!0,children:[(0,r.BX)(F.Z,{padding:"1rem",width:"100%",height:"100%",children:[(0,r.BX)(I.cD,{justifyContent:"space-between",alignItems:"center",children:[(0,r.tZ)(tg.Z,{variant:"h2",fontWeight:"bold",children:(0,K.t)("PHOTO_EDITOR")}),(0,r.tZ)(tC.Z,{onClick:()=>{M(!0)},children:(0,r.tZ)(t9.Z,{})})]}),(0,r.tZ)(F.Z,{width:"100%",height:"100%",overflow:"hidden",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",onMouseUp:()=>{W(0),z(0),to(!1),tn(!1)},onMouseMove:tt?t=>{if(!tt&&!ti)return;let e=t.pageX-G,n=t.pageY-Y,{offsetX:i,offsetY:o,canvasBounds:a}=tr();ti?X(t=>{let r=Math.min(J+e,a.width-t.x+i),l=Math.min(Q+n,a.height-t.y+o);return{...t,width:r,height:l}}):(X(t=>{let r=t.x+e,l=t.y+n;return r=Math.max(i,Math.min(r,i+a.width-t.width)),l=Math.max(o,Math.min(l,o+a.height-t.height)),{...t,x:r,y:l}}),W(t.pageX),z(t.pageY))}:null,onMouseDown:t=>{if("crop"!==h)return;let e=ta.current.getBoundingClientRect(),n=t.pageX-e.left-e.width/2,i=t.pageY-e.top-e.height/2,o=t.pageX<e.left+20||t.pageX>e.right-20,a=t.pageY<e.top+20||t.pageY>e.bottom-20;if(o&&a){to(!0),W(t.pageX),z(t.pageY),$(H.width),q(H.height);return}tn(!0),W(t.pageX-n),z(t.pageY-i)},children:(0,r.BX)(F.Z,{style:{position:"relative",width:"100%",height:"100%"},children:[(0,r.BX)(F.Z,{height:"90%",width:"100%",ref:o,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",children:[(null===a||D)&&(0,r.tZ)(t8.Z,{}),(0,r.tZ)("canvas",{ref:n,style:{objectFit:"contain",display:null===a||D?"none":"block",position:"absolute"}}),(0,r.tZ)("canvas",{ref:i,style:{display:"none"}}),"crop"===h&&(0,r.tZ)(ep,{cropBox:H,ref:ta,setIsDragging:tn})]}),"crop"===h&&(0,r.tZ)(I.Tn,{marginTop:"1rem",children:(0,r.tZ)(t$.Z,{color:"accent",startIcon:(0,r.tZ)(t5.Z,{}),onClick:()=>{if(!ta.current||!n.current)return;let{x1:t,x2:e,y1:o,y2:a}=es(ta.current,n.current);N(!0),L(!0),ec(n.current,t,o,e,a),ec(i.current,t/B,o/B,e/B,a/B),tl(),N(!1),Z("transform")},children:(0,K.t)("APPLY_CROP")})})]})})]}),(0,r.BX)(tp.c,{variant:"persistent",anchor:"right",open:k,onClose:th,children:[(0,r.BX)(I.cD,{justifyContent:"space-between",children:[(0,r.tZ)(tC.Z,{onClick:()=>{M(!1)},children:(0,r.tZ)(S.Z,{})}),(0,r.tZ)(tC.Z,{onClick:th,children:(0,r.tZ)(T.Z,{})})]}),(0,r.tZ)(I.cD,{gap:"0.5rem",marginBottom:"1rem",children:(0,r.BX)(t7.Z,{value:h,onChange:(t,e)=>{Z(e)},children:[(0,r.tZ)(et.Z,{label:(0,K.t)("editor.crop"),value:"crop"}),(0,r.tZ)(et.Z,{label:(0,K.t)("TRANSFORM"),value:"transform"}),(0,r.tZ)(et.Z,{label:(0,K.t)("COLORS"),value:"colours",disabled:O})]})}),(0,r.tZ)(ei.Z,{title:(0,K.t)("RESET")}),(0,r.tZ)(en.G,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(t0.v,{disabled:D,startIcon:(0,r.tZ)(t4.Z,{}),onClick:()=>{td()},label:(0,K.t)("RESTORE_ORIGINAL")})}),(0,r.BX)(ev.Provider,{value:{originalSizeCanvasRef:i,canvasRef:n,setCanvasLoading:N,canvasLoading:D,setTransformationPerformed:L,setCurrentTab:Z},children:["crop"===h&&(0,r.tZ)(ed,{previewScale:B,cropBoxProps:H,cropBoxRef:ta,resetCropBox:tl}),"transform"===h&&(0,r.tZ)(eC,{})]}),"colours"===h&&(0,r.tZ)(el,{brightness:f,contrast:E,saturation:y,blur:v,invert:b,setBrightness:g,setContrast:C,setSaturation:x,setBlur:w,setInvert:_}),(0,r.tZ)(ei.Z,{title:(0,K.t)("EXPORT")}),(0,r.BX)(en.G,{children:[(0,r.tZ)(t0.v,{startIcon:(0,r.tZ)(t3.Z,{}),onClick:tf,label:(0,K.t)("DOWNLOAD_EDITED"),disabled:!O&&!R}),(0,r.tZ)(ee.Z,{}),(0,r.tZ)(t0.v,{startIcon:(0,r.tZ)(t2.Z,{}),onClick:tm,label:(0,K.t)("SAVE_A_COPY_TO_ENTE"),disabled:!O&&!R})]}),!O&&!R&&(0,r.tZ)(ei.Z,{title:(0,K.t)("PHOTO_EDIT_REQUIRED_TO_SAVE")})]})]})})};let ew=async(t,e,n)=>{new Image().src=t.toDataURL();let[i,o]=["image/png","png"];switch(n){case"image/jpeg":i=n,o="jpeg";break;case"image/webp":i=n,o="webp"}let a=(0,tJ.z)(await new Promise(e=>t.toBlob(e,i))),[r]=(0,v.YA)(e),l="".concat(r,"-edited.").concat(o);return c.ZP.debug(()=>({a:"canvas => file",blob:a,type:a.type,mimeType:i})),new File([a],l)};var ey=function(t){return(0,r.BX)(r.HY,{children:[(0,r.tZ)(t8.Z,{variant:"determinate",...t,color:"accent"}),(0,r.tZ)(I.aV,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"40px"},children:(0,r.tZ)(tg.Z,{variant:"mini",component:"div",color:"text.secondary",children:"".concat(Math.round(t.value),"%")})})]})},ex=n(32383);let eS=t=>{let{open:e,onClose:n,onClick:i}=t;return(0,r.tZ)(ex.Z,{open:e,onClose:n,attributes:{variant:"secondary",subtext:(0,K.t)("CONVERSION_FAILED_NOTIFICATION_MESSAGE"),onClick:i},horizontal:"right",vertical:"bottom",sx:{zIndex:4e3}})};var eT=n(17377);function eb(){let t=(0,a._)(["\n    border-radius: 4px;\n    position: absolute;\n    bottom: 10vh;\n    right: 6vh;\n    z-index: 10;\n"]);return eb=function(){return t},t}let e_=(0,p.ZP)(eT.Z)(eb()),eO=(0,p.ZP)("div")(t=>{let{theme:e}=t;return{padding:e.spacing(2),wordBreak:"break-word",textAlign:"right",maxWidth:"375px",fontSize:"14px",lineHeight:"17px",backgroundColor:e.colors.backdrop.faint,backdropFilter:"blur(".concat(e.colors.blur.base,")")}});var eL=function(t){var e,n;let i=(0,m.useContext)(Y.GalleryContext),o=(0,m.useContext)(V.AppContext),a=(0,m.useContext)(tt.H),{isOpen:s,items:d}=t,u=(0,m.useRef)(),[p,h]=(0,m.useState)(),[f,G]=(0,m.useState)(!1),[tn,ti]=(0,m.useState)(!1),[to,ta]=(0,m.useState)(),tr=(0,m.useRef)(null),[tl,tc]=(0,m.useState)(H),[ts,td]=(0,m.useState)(!1),[tu,tp]=(0,m.useState)(!1),[th,tZ]=(0,m.useState)(!1),[tf,tg]=(0,m.useState)(!1),tm=(0,m.useRef)(!1),tA=(0,m.useRef)(null),tE=(0,m.useMemo)(()=>(0,J.qn)(),[]),[tC,tv]=(0,m.useState)(!1),[tI,tw]=(0,m.useState)(!1),[ty,tx]=(0,m.useState)(new Map),[tS,tT]=(0,m.useState)(!1),[tb,t_]=(0,m.useState)(!1);function tO(t){var e,n;if(t.metadata.fileType===l.Gk.VIDEO){ta({key:t.src,value:null});return}if(!t.isSourceLoaded||t.conversionFailed||!t||(null==tr||null===(e=tr.current)||void 0===e||e.value,0))return;let i=t.metadata.fileType===l.Gk.IMAGE?t.src:t.srcURLs.url.image;(null==tr?void 0:null===(n=tr.current)||void 0===n?void 0:n.key)!==i&&(ta({key:i,value:void 0}),tK(t))}function tL(t){tp(W()()&&(t.metadata.fileType===l.Gk.VIDEO||t.metadata.fileType===l.Gk.LIVE_PHOTO)&&!t.isConverted&&t.isSourceLoaded&&!t.conversionFailed)}function tR(t){tw(t.conversionFailed)}function tP(t){tZ(t.isSourceLoaded)}(0,m.useEffect)(()=>{j.Z.setProgressUpdater(tx)},[]),(0,m.useEffect)(()=>{if(u)return s&&tD(),s||tN(),()=>{tN()}},[s]),(0,m.useEffect)(()=>{if(p)return window.addEventListener("keyup",e),tE&&window.addEventListener("copy",t),()=>{window.removeEventListener("keyup",e),tE&&window.removeEventListener("copy",t)};function t(){s&&!tn&&tY(p.currItem)}function e(t){if(s&&!tn)switch(c.ZP.debug(()=>"Event: "+t.key),t.key){case"i":case"I":ti(!0);break;case"Backspace":case"Delete":tF(null==p?void 0:p.currItem);break;case"d":case"D":tV(null==p?void 0:p.currItem);break;case"f":case"F":tz(p);break;case"l":case"L":tB(null==p?void 0:p.currItem);break;case"ArrowLeft":tH(t,"left");break;case"ArrowRight":tH(t,"right")}}},[s,p,tn]),(0,m.useEffect)(()=>{p&&(p.options.escKey=!tn)},[tn]),(0,m.useEffect)(()=>{if(!s)return;let t=d[null==p?void 0:p.getCurrentIndex()];if(!t)return;if(t.metadata.fileType===l.Gk.LIVE_PHOTO){let{video:e,image:n}={video:document.getElementById("live-photo-video-".concat(t.id)),image:document.getElementById("live-photo-image-".concat(t.id))};e&&n?tc({click:async()=>{await (0,$.Kz)(e,n)},hide:async()=>{await (0,$.r)(e,n)},show:async()=>{await (0,$.Kz)(e,n)},visible:!0,loading:!1}):tc({...H,visible:!0,loading:!0})}let e=document.getElementById("download-btn-".concat(t.id)),n=()=>{tV(p.currItem)};return e&&e.addEventListener("click",n),()=>{e&&e.removeEventListener("click",n),tc(H)}},[null==p?void 0:p.currItem,s,th]),(0,m.useEffect)(()=>{tr.current=to},[to]);let tD=()=>{let{items:e,currentIndex:n}=t,o=new(Z())(u.current,g(),e,{history:!1,maxSpreadZoom:5,index:n,showHideOpacity:!0,arrowKeys:!1,getDoubleTapZoom:(t,e)=>t?2.5:e.initialZoomLevel<.7?1:1.5,getThumbBoundsFn:t=>{try{let n=e[t],i=document.getElementById("thumb-".concat(n.id));if(i){let t=i.getBoundingClientRect(),e=window.pageYOffset||document.documentElement.scrollTop;return{x:t.left,y:t.top+e,w:t.width}}return null}catch(t){return null}}});X.forEach(e=>{let n=t[e];(n||"destroy"===e)&&o.listen(e,function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];n&&(i.unshift(o),n(...i)),"destroy"===e&&tk(),"close"===e&&tk()})}),o.listen("beforeChange",()=>{var t;if(!(null==o?void 0:o.currItem))return;let e=o.currItem;for(let t of document.getElementsByTagName("video"))t.pause();G(tM(e)),td(!a.accessedThroughSharedURL&&(null===(t=i.user)||void 0===t?void 0:t.id)===e.ownerID),tR(e),tO(e),tL(e),tP(e),function(t){let e=(0,v.qN)(t.metadata.title),n=!(0,C.y)(e)||(0,E.ki)(e);tT(t.metadata.fileType===l.Gk.IMAGE&&n)}(e),t_(e.metadata.fileType===l.Gk.IMAGE)}),o.listen("resize",()=>{if(!(null==o?void 0:o.currItem))return;let t=o.currItem;tO(t),tR(t),tL(t),tP(t)}),o.init(),tm.current=!1,tg(!1),h(o)},tN=()=>{p&&p.close()},tk=()=>{let{onClose:e}=t;for(let t of("function"==typeof e&&e(tm.current),document.getElementsByTagName("video")))t.pause();tG()},tM=e=>{let{favItemIds:n}=t;return!!n&&!!e&&n.has(e.id)},tB=async e=>{try{if(!e||t.isTrashCollection||!ts||t.isInHiddenSection)return;let{favItemIds:n}=t;tM(e)?(n.delete(e.id),(0,A.zm)(e),G(!1)):(n.add(e.id),(0,A._p)(e),G(!0)),tm.current=!0}catch(t){c.ZP.error("onFavClick failed",t)}},tU=async e=>{let{tempDeletedFileIds:n,setTempDeletedFileIds:i}=t;try{o.startLoading(),await (0,q.N5)([e]),o.finishLoading(),n.add(e.id),i(new Set(n)),tX(t.items.filter(t=>t.id!==e.id)),tm.current=!0}catch(t){c.ZP.error("trashFile failed",t)}},tF=e=>{e&&ts&&!t.isTrashCollection&&o.setDialogMessage((0,te.Db)(()=>tU(e)))},tH=(t,e)=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||("left"===e?p.prev():p.next())},tX=t=>{try{p&&(0===t.length&&p.close(),p.items.length=0,t.forEach(t=>{p.items.push(t)}),p.invalidateCurrItems(),s&&(p.updateSize(!0),p.getCurrentIndex()>=p.items.length&&p.goTo(0)))}catch(t){c.ZP.error("updateItems failed",t)}},tK=async t=>{try{if(tA.current===t.src)return;try{let e;if(tA.current=t.src,t.metadata.fileType===l.Gk.IMAGE)e=await (0,E.G5)(t.src,t.metadata.title);else{let n=t.srcURLs.url.image;e=await (0,E.G5)(n,t.metadata.title)}let n=await (0,z.S)(e),i=await (0,Q.PC)(e,n);tA.current===t.src&&(i?ta({key:t.src,value:i}):ta({key:t.src,value:null}))}finally{tA.current=null}}catch(e){ta({key:t.src,value:null}),c.ZP.error("checkExifAvailable failed for file ".concat(t.metadata.title),e)}},tG=()=>{ti(!1)},tW=t=>{if(tf){var e;let n=null==t?void 0:null===(e=t.ui)||void 0===e?void 0:e.getFullscreenAPI();n&&n.isFullscreen()&&(n.exit(),tg(!1))}ti(!0)},tV=async e=>{if(e&&t.enableDownload&&t.setFilesDownloadProgressAttributesCreator)try{let n=t.setFilesDownloadProgressAttributesCreator(e.metadata.title);await (0,E.ae)(e,n)}catch(t){}},tY=async e=>{e&&t.enableDownload&&tE&&(o.startLoading(),await (0,E.C2)(e.src),o.finishLoading())},tz=t=>{var e;let n=null==t?void 0:null===(e=t.ui)||void 0===e?void 0:e.getFullscreenAPI();n&&(n.isFullscreen()?(n.exit(),tg(!1)):(n.enter(),tg(!0)))},{id:tj}=t;return(0,r.BX)(r.HY,{children:[(0,r.BX)("div",{id:tj,className:"pswp",tabIndex:Number("-1"),role:"dialog","aria-hidden":"true",ref:u,children:[(0,r.tZ)("div",{className:"pswp__bg"}),(0,r.BX)("div",{className:"pswp__scroll-wrap",children:[tl.visible&&(0,r.tZ)(e_,{children:(0,r.tZ)(U.Z,{color:"secondary",onClick:tl.click,onMouseEnter:tl.show,onMouseLeave:tl.hide,disabled:tl.loading,children:(0,r.BX)(I.A0,{gap:"4px",children:[(0,r.tZ)(y.Z,{})," ",(0,K.t)("LIVE")]})})}),(0,r.tZ)(eS,{open:tI,onClose:()=>tw(!1),onClick:()=>tV(p.currItem)}),(0,r.tZ)(F.Z,{sx:{position:"absolute",top:"10vh",right:"2vh",zIndex:10},children:ty.has(null==p?void 0:null===(e=p.currItem)||void 0===e?void 0:e.id)?(0,r.tZ)(ey,{value:ty.get(null===(n=p.currItem)||void 0===n?void 0:n.id)}):!th&&(0,r.tZ)(w.Z,{})}),(0,r.BX)("div",{className:"pswp__container",children:[(0,r.tZ)("div",{className:"pswp__item"}),(0,r.tZ)("div",{className:"pswp__item"}),(0,r.tZ)("div",{className:"pswp__item"})]}),(0,r.BX)("div",{className:"pswp__ui pswp__ui--hidden",children:[(0,r.BX)("div",{className:"pswp__top-bar",children:[(0,r.tZ)("div",{className:"pswp__counter"}),(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,K.t)("CLOSE_OPTION"),onClick:tk,children:(0,r.tZ)(T.Z,{})}),t.enableDownload&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,K.t)("DOWNLOAD_OPTION"),onClick:()=>tV(p.currItem),children:(0,r.tZ)(P.Z,{})}),t.enableDownload&&tE&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,K.t)("COPY_OPTION"),onClick:()=>tY(p.currItem),children:(0,r.tZ)(b.Z,{fontSize:"small"})}),ts&&!t.isTrashCollection&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,K.t)("DELETE_OPTION"),onClick:()=>{tF(null==p?void 0:p.currItem)},children:(0,r.tZ)(_.Z,{})}),tb&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",onClick:()=>{if(!p)return;let t=p.currItem.initialZoomLevel;p.getZoomLevel()!==t?p.zoomTo(t,{x:p.viewportSize.x/2,y:p.viewportSize.y/2},333):p.zoomTo(p.options.getDoubleTapZoom(!0,p.currItem),{x:p.viewportSize.x/2,y:p.viewportSize.y/2},333)},title:(0,K.t)("ZOOM_IN_OUT"),children:(0,r.tZ)(B.Z,{})}),(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",onClick:()=>{tz(p)},title:(0,K.t)("TOGGLE_FULLSCREEN"),children:tf?(0,r.tZ)(D.Z,{sx:{fontSize:32}}):(0,r.tZ)(N.Z,{sx:{fontSize:32}})}),(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,K.t)("INFO_OPTION"),onClick:()=>tW(p),children:(0,r.tZ)(k.Z,{})}),ts&&!t.isTrashCollection&&!t.isInHiddenSection&&(0,r.BX)(r.HY,{children:[tS&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",onClick:()=>{tv(!0)},children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)("button",{title:f?(0,K.t)("UNFAVORITE_OPTION"):(0,K.t)("FAVORITE_OPTION"),className:"pswp__button pswp__button--custom",onClick:()=>{tB(null==p?void 0:p.currItem)},children:f?(0,r.tZ)(R.Z,{}):(0,r.tZ)(L.Z,{})})]}),tu&&(0,r.tZ)("button",{title:(0,K.t)("CONVERT"),className:"pswp__button pswp__button--custom",onClick:()=>{t.getConvertedItem(p,p.getCurrentIndex(),p.currItem)},children:(0,r.tZ)(M.Z,{fontSize:"small"})}),(0,r.tZ)("div",{className:"pswp__preloader"})]}),(0,r.tZ)("button",{className:"pswp__button pswp__button--arrow--left",title:(0,K.t)("PREVIOUS"),children:(0,r.tZ)(x.Z,{sx:{pointerEvents:"none"}})}),(0,r.tZ)("button",{className:"pswp__button pswp__button--arrow--right",title:(0,K.t)("NEXT"),children:(0,r.tZ)(S.Z,{sx:{pointerEvents:"none"}})}),(0,r.tZ)("div",{className:"pswp__caption pswp-custom-caption-container",children:(0,r.tZ)(eO,{})})]})]})]}),(0,r.tZ)(tq,{shouldDisableEdits:!ts,showCollectionChips:!t.isTrashCollection&&ts&&!t.isInHiddenSection,showInfo:tn,handleCloseInfo:tG,file:null==p?void 0:p.currItem,exif:null==to?void 0:to.value,scheduleUpdate:()=>tm.current=!0,refreshPhotoswipe:()=>{try{p.invalidateCurrItems(),s&&p.updateSize(!0)}catch(t){c.ZP.error("refreshPhotoswipe failed",t)}},fileToCollectionsMap:t.fileToCollectionsMap,collectionNameMap:t.collectionNameMap,closePhotoViewer:tk}),(0,r.tZ)(eI,{show:tC,file:null==p?void 0:p.currItem,onClose:()=>{tv(!1)},closePhotoViewer:tk})]})},eR=n(22216),eP=n(5632),eD=n(6738),eN=n(93850),ek=n(65847),eM=n(30845),eB=n(50166);function eU(){let t=(0,a._)(["\n    display: flex;\n    justify-content: center;\n"]);return eU=function(){return t},t}function eF(){let t=(0,a._)(["\n    display: grid;\n    grid-template-columns: ",";\n    grid-column-gap: ","px;\n    width: 100%;\n    color: #fff;\n    padding: 0 24px;\n    @media (max-width: ","px) {\n        padding: 0 4px;\n    }\n"]);return eF=function(){return t},t}function eH(){let t=(0,a._)(["\n    grid-column: span ",";\n"]);return eH=function(){return t},t}function eX(){let t=(0,a._)(["\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    height: ","px;\n    color: ",";\n"]);return eX=function(){return t},t}function eK(){let t=(0,a._)(["\n    margin-top: 1rem;\n    height: ","px;\n"]);return eK=function(){return t},t}(i=o||(o={})).TIME="TIME",i.FILE="FILE",i.SIZE_AND_COUNT="SIZE_AND_COUNT",i.HEADER="HEADER",i.FOOTER="FOOTER",i.MARKETING_FOOTER="MARKETING_FOOTER",i.OTHER="OTHER";let eG=(0,p.ZP)("div")(eU()),eW=(t,e,n)=>n?n.map(t=>"repeat(".concat(t,", ").concat(ek.C3*e,"px)")).join(" ".concat(ek.BV,"px ")):"repeat(".concat(t,",").concat(ek.C3*e,"px)");function eV(t){return t>ek.yc*ek.C3?24:4}let eY=(0,p.ZP)(F.Z)(eF(),t=>{let{columns:e,shrinkRatio:n,groups:i}=t;return eW(e,n,i)},ek.dP,ek.C3*ek.yc),ez=(0,p.ZP)(I.A0)(eH(),t=>t.span),ej=(0,p.ZP)(ez)(eX(),ek.xU,t=>{let{theme:e}=t;return e.colors.text.muted}),eQ=(0,p.ZP)(ej)(eK(),ek.ve),eq=(0,eM.Z)((t,e,n,i)=>({timeStampList:t,columns:e,shrinkRatio:n,renderListItem:i})),eJ=m.memo(t=>{let{index:e,style:n,isScrolling:i,data:o}=t,{timeStampList:a,columns:l,shrinkRatio:c,renderListItem:s}=o;return(0,r.tZ)(eG,{style:n,children:(0,r.tZ)(eY,{columns:l,shrinkRatio:c,groups:a[e].groups,children:s(a[e],i)})})},eB.wy),e$=(t,e)=>{let n=[];for(let i=0;i<t.length;i++){let o=t[i];n.push({itemType:"SIZE_AND_COUNT",fileSize:o.size,fileCount:o.files.length});let a=0;for(;a<o.files.length;)n.push({itemType:"FILE",items:o.files.slice(a,a+e),itemStartIndex:i}),a+=e}return n};function e0(t){let{height:e,width:n,duplicates:i,getThumbnail:o,activeCollectionID:a}=t,[l,c]=(0,m.useState)([]),s=(0,m.useRef)(!1),d=(0,m.useRef)(!1),u=(0,m.useRef)(null),p=(0,m.useMemo)(()=>{let t=Math.floor((n-2*eV(n)+ek.dP)/(ek.C3+ek.dP));return t<ek.yc&&(t=ek.yc),t},[n]),h=(n-2*eV(n)-(p-1)*ek.dP)/(p*ek.C3),Z=ek.Ho*h+ek.dP,f=()=>{var t;null===(t=u.current)||void 0===t||t.resetAfterIndex(0)};if((0,m.useEffect)(()=>{let t=()=>{if(s.current){d.current=!0;return}s.current=!0,c(e$(i,p)),s.current=!1,d.current&&(d.current=!1,setTimeout(t,0))};t()},[p,i]),(0,m.useEffect)(()=>{f()},[l]),!(null==l?void 0:l.length))return(0,r.tZ)(r.HY,{});let g=eq(l,p,h,(t,e)=>{switch(t.itemType){case"SIZE_AND_COUNT":return(0,r.BX)(eQ,{span:p,children:[t.fileCount," ",(0,K.t)("FILES"),","," ",(0,tH.O5)(t.fileSize||0)," ",(0,K.t)("EACH")]});case"FILE":{let n=t.items.map((n,i)=>o(n,t.itemStartIndex+i,e));if(t.groups){let e=0;for(let i=0;i<t.groups.length-1;i++)e+=t.groups[i],n.splice(e,0,(0,r.tZ)("div",{},"".concat(t.items[0].id,"-gap-").concat(i))),e+=1}return n}default:return t.item}});return(0,r.tZ)(eB.S_,{itemData:g,ref:u,itemSize:t=>{switch(l[t].itemType){case"TIME":return ek.xU;case"SIZE_AND_COUNT":return ek.ve;case"FILE":return Z;default:return l[t].height}},height:e,width:n,itemCount:l.length,itemKey:t=>"FILE"===l[t].itemType?"".concat(l[t].items[0].id,"-").concat(l[t].items.slice(-1)[0].id):"".concat(l[t].id,"-").concat(t),overscanCount:3,useIsScrolling:!0,children:eJ},"".concat(a))}var e1=n(72606),e2=n(2672),e5=n(64482),e4=n(69686),e3=n(60824);function e9(){let t=(0,a._)(['\n    appearance: none;\n    position: absolute;\n    z-index: 10;\n    left: 0;\n    opacity: 0;\n    outline: none;\n    cursor: pointer;\n    @media (pointer: coarse) {\n        pointer-events: none;\n    }\n\n    &::before {\n        content: "";\n        width: 16px;\n        height: 16px;\n        border: 2px solid #fff;\n        background-color: #ddd;\n        display: inline-block;\n        border-radius: 50%;\n        vertical-align: bottom;\n        margin: 8px 8px;\n        text-align: center;\n        line-height: 16px;\n        transition: background-color 0.3s ease;\n        pointer-events: inherit;\n        color: #aaa;\n    }\n    &::after {\n        content: "";\n        width: 5px;\n        height: 10px;\n        border-right: 2px solid #333;\n        border-bottom: 2px solid #333;\n        transform: translate(-18px, 8px);\n        transition: transform 0.3s ease;\n        position: absolute;\n        pointer-events: inherit;\n        transform: translate(-18px, 10px) rotate(45deg);\n    }\n\n    /** checked */\n    &:checked::before {\n        content: "";\n        background-color: #51cd7c;\n        border-color: #51cd7c;\n        color: #fff;\n    }\n    &:checked::after {\n        content: "";\n        border-right: 2px solid #ddd;\n        border-bottom: 2px solid #ddd;\n    }\n    ',";\n    &:checked {\n        opacity: 1 !important;\n    }\n"]);return e9=function(){return t},t}function e6(){let t=(0,a._)(["\n    opacity: 0;\n    left: 0;\n    top: 0;\n    outline: none;\n    height: 40%;\n    width: 100%;\n    position: absolute;\n    ",";\n"]);return e6=function(){return t},t}function e8(){let t=(0,a._)(["\n    display: flex;\n    justify-content: flex-end;\n    align-items: flex-start;\n    padding-right: 5px;\n    padding-top: 5px;\n"]);return e8=function(){return t},t}function e7(){let t=(0,a._)(["\n    opacity: ",";\n    left: 0;\n    top: 0;\n    outline: none;\n    height: 100%;\n    width: 100%;\n    position: absolute;\n    ",";\n"]);return e7=function(){return t},t}function nt(){let t=(0,a._)(["\n    width: 100%;\n    bottom: 0;\n    left: 0;\n    max-height: 40%;\n    width: 100%;\n    background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 2));\n    & > p {\n        max-width: calc(","px - 10px);\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        margin: 2px;\n        text-align: center;\n    }\n    padding: 7px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    color: #fff;\n    position: absolute;\n"]);return nt=function(){return t},t}function ne(){let t=(0,a._)(["\n    z-index: 5;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n    ","\n    border-radius: 4px;\n"]);return ne=function(){return t},t}function nn(){let t=(0,a._)(["\n    display: flex;\n    width: fit-content;\n    margin-bottom: ","px;\n    min-width: 100%;\n    overflow: hidden;\n    position: relative;\n    flex: 1;\n    cursor: ",';\n    user-select: none;\n    & > img {\n        object-fit: cover;\n        max-width: 100%;\n        min-height: 100%;\n        flex: 1;\n        pointer-events: none;\n    }\n\n    &:hover {\n        input[type="checkbox"] {\n            opacity: 0.5;\n        }\n\n        .preview-card-hover-overlay {\n            opacity: 1;\n        }\n    }\n\n    border-radius: 4px;\n']);return nn=function(){return t},t}let ni=(0,p.ZP)("input")(e9(),t=>t.$active&&"opacity: 0.5 "),no=(0,p.ZP)("div")(e6(),t=>!t.checked&&"background:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0))"),na=(0,p.ZP)(I.aV)(e8()),nr=(0,p.ZP)("div")(e7(),t=>t.$active?1:0,t=>t.$active&&"background:rgba(81, 205, 124, 0.25)"),nl=(0,p.ZP)("div")(nt(),ek.C3),nc=(0,p.ZP)("div")(ne(),t=>t.selected&&"border: 5px solid #51cd7c;"),ns=(0,p.ZP)(I.aV)(t=>{let{theme:e}=t;return"\n    display: flex;\n    justify-content: flex-end;\n    align-items: flex-end;\n    background:".concat("dark"===e.palette.mode?"linear-gradient(\n        315deg,\n        rgba(0, 0, 0, 0.14) 0%,\n        rgba(0, 0, 0, 0.05) 29.61%,\n        rgba(0, 0, 0, 0) 49.86%\n    )":"linear-gradient(\n        315deg,\n        rgba(255, 255, 255, 0.14) 0%,\n        rgba(255, 255, 255, 0.05) 29.61%,\n        rgba(255, 255, 255, 0) 49.86%\n    ",";\n    padding: 8px;\n")}),nd=(0,p.ZP)("div")(nn(),ek.dP,t=>t.disabled?"not-allowed":"pointer");function nu(t){let e=(0,m.useContext)(Y.GalleryContext),n=(0,m.useContext)(e4.DeduplicateContext),i=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,[n,i]=(0,m.useState)(!1);return(0,m.useEffect)(()=>{let i;return n?i=setTimeout(t,e):clearTimeout(i),()=>{clearTimeout(i)}},[t,e,n]),{onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:()=>i(!0),onTouchEnd:()=>i(!1)}}(()=>{h(!p)},500),{file:o,onClick:a,updateURL:s,selectable:u,selected:p,onSelect:h,selectOnClick:Z,onHover:f,onRangeSelect:g,isRangeSelectActive:A,isInsSelectRange:C}=t,[v,I]=(0,m.useState)(o.msrc),w=(0,m.useRef)(!0);(0,m.useEffect)(()=>()=>{w.current=!1},[]),(0,m.useEffect)(()=>{(async()=>{try{if(o.msrc)return;let e=await j.Z.getThumbnailForPreview(o,t.showPlaceholder);if(!w.current||!e)return;I(e),s(o.id,e)}catch(t){t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("preview card useEffect failed",t)}})()},[t.showPlaceholder]);let x=()=>{Z?A?g():h(!p):((null==o?void 0:o.msrc)||v)&&(null==a||a())},S=t=>{A?null==g||g():h(t.target.checked)},T=()=>{A&&f()},b=()=>(0,r.BX)(nd,{onClick:x,onMouseEnter:T,disabled:!(null==o?void 0:o.msrc)&&!v,...u?i:{},children:[u&&(0,r.tZ)(ni,{type:"checkbox",checked:p,onChange:S,$active:A&&C,onClick:t=>t.stopPropagation()}),o.metadata.hasStaticThumbnail?(0,r.tZ)(e5.T,{fileType:o.metadata.fileType}):v?(0,r.tZ)("img",{src:v}):(0,r.tZ)(e5.f,{}),o.metadata.fileType===l.Gk.LIVE_PHOTO?(0,r.tZ)(ns,{children:(0,r.tZ)(y.Z,{})}):o.metadata.fileType===l.Gk.VIDEO&&(0,r.tZ)(ns,{children:(0,r.tZ)(e1.Z,{})}),(0,r.tZ)(nc,{selected:p}),(0,E.r6)(o,e.user)&&(0,r.tZ)(na,{children:(0,r.tZ)(e3.Z,{file:o})}),(0,r.tZ)(no,{className:"preview-card-hover-overlay",checked:p}),(0,r.tZ)(nr,{$active:A&&C}),n.isOnDeduplicatePage&&(0,r.BX)(nl,{children:[(0,r.tZ)("p",{children:o.metadata.title}),(0,r.tZ)("p",{children:n.collectionNameMap.get(o.collectionID)})]}),(null==t?void 0:t.activeCollectionID)===eR.jn&&o.isTrashed&&(0,r.tZ)(nl,{children:(0,r.tZ)("p",{children:function(t){let e={year:31536e6,month:2628e6,day:864e5,hour:36e5,minute:6e4,second:1e3},n=new Intl.RelativeTimeFormat(K.ZP.language,{localeMatcher:"best fit",numeric:"always",style:"long"}),i=t-Date.now();for(let t in e)if(Math.abs(i)>e[t]||"second"===t)return n.format(Math.round(i/e[t]),t)}(o.deleteBy/1e3)})})]},"thumb-".concat(o.id,"}"));return n.isOnDeduplicatePage?(0,r.tZ)(e2.Z,{placement:"bottom-start",enterDelay:300,enterNextDelay:100,title:"".concat(o.metadata.title," - ").concat(n.collectionNameMap.get(o.collectionID)),children:b()}):b()}function np(){let t=(0,a._)(["\n    display: block;\n    flex: 1;\n    width: 100%;\n    flex-wrap: wrap;\n    margin: 0 auto;\n    overflow: hidden;\n    .pswp-thumbnail {\n        display: inline-block;\n        cursor: pointer;\n    }\n"]);return np=function(){return t},t}let nh=(0,p.ZP)("div")(np()),nZ="&opened";var nf=t=>{let{page:e,duplicates:n,files:i,syncWithRemote:o,favItemIds:a,setSelected:p,selected:h,tempDeletedFileIds:Z,setTempDeletedFileIds:f,activeCollectionID:g,enableDownload:A,fileToCollectionsMap:E,collectionNameMap:C,showAppDownloadBanner:v,setIsPhotoSwipeOpen:I,isInHiddenSection:w,setFilesDownloadProgressAttributesCreator:y}=t,[x,S]=(0,m.useState)(!1),[T,b]=(0,m.useState)(0),[_,O]=(0,m.useState)({}),[L,R]=(0,m.useState)({}),P=(0,m.useContext)(Y.GalleryContext),[D,N]=(0,m.useState)(null),[k,M]=(0,m.useState)(null),[B,U]=(0,m.useState)(!1),F=(0,eP.useRouter)(),H=(0,u.Z)(()=>i.map(t=>{var e;return{...t,w:window.innerWidth,h:window.innerHeight,title:null===(e=t.pubMagicMetadata)||void 0===e?void 0:e.data.caption}}),[i]);if((0,m.useEffect)(()=>{O({}),R({})},[H]),(0,m.useEffect)(()=>{let t=new URL(window.location.href),e=t.hash.lastIndexOf("&"),n=t.hash.slice(1,-1!==e?e:void 0);x?F.push({hash:n+nZ}):F.push({hash:n})},[x]),(0,m.useEffect)(()=>{let t=t=>{"Shift"===t.key&&U(!0)},e=t=>{"Shift"===t.key&&U(!1)};return document.addEventListener("keydown",t,!1),document.addEventListener("keyup",e,!1),F.events.on("hashChangeComplete",t=>{let e=t.indexOf("#");t.slice(-1!==e?e:t.length).endsWith(nZ)?(null==I||I(!0),S(!0)):(null==I||I(!1),S(!1))}),()=>{document.removeEventListener("keydown",t,!1),document.removeEventListener("keyup",e,!1)}},[]),(0,m.useEffect)(()=>{0===h.count&&N(null)},[h]),!H)return(0,r.tZ)("div",{});let X=t=>(e,n,i)=>{let o=H[t];if(o.id!==e)throw c.ZP.info("[".concat(e,"]PhotoSwipe: updateURL: file id mismatch: ").concat(o.id," !== ").concat(e)),Error(d.sH.UPDATE_URL_FILE_ID_MISMATCH);if(o.msrc&&!i)throw Error(d.sH.URL_ALREADY_SET);(0,$.al)(o,n)},K=async(t,e,n,i)=>{let o=H[t];if(o.id!==e)throw c.ZP.info("[".concat(e,"]PhotoSwipe: updateSrcURL: file id mismatch: ").concat(o.id)),Error(d.sH.UPDATE_URL_FILE_ID_MISMATCH);if(o.isSourceLoaded&&!i)throw Error(d.sH.URL_ALREADY_SET);if(o.conversionFailed)throw c.ZP.info("[".concat(e,"]PhotoSwipe: updateSrcURL: conversion failed")),Error(d.sH.FILE_CONVERSION_FAILED);await (0,$.Rw)(o,n,A)},G=t=>()=>{b(t),S(!0),null==I||I(!0)},W=(0,$.Po)(p,g,N),V=t=>()=>{M(t)},z=t=>()=>{if(void 0!==D&&D!==t){var e,n;let i=(t-D)/Math.abs(t-D),o=!0;for(let e=D;(t-e)*i>=0;e+=i)o=o&&!!h[H[e].id];for(let e=D;(t-e)*i>0;e+=i)W(H[e].id,H[e].ownerID===(null===(n=P.user)||void 0===n?void 0:n.id))(!o);W(H[t].id,H[t].ownerID===(null===(e=P.user)||void 0===e?void 0:e.id),t)(!o)}},Q=(t,e,n)=>{var i,o;return(0,r.tZ)(nu,{file:t,updateURL:X(e),onClick:G(e),selectable:A,onSelect:W(t.id,t.ownerID===(null===(i=P.user)||void 0===i?void 0:i.id),e),selected:h.collectionID===g&&h[t.id],selectOnClick:h.count>0,onHover:V(e),onRangeSelect:z(e),isRangeSelectActive:B&&h.count>0,isInsSelectRange:e>=D&&e<=k||e>=k&&e<=D,activeCollectionID:g,showPlaceholder:n},"tile-".concat(t.id,"-selected-").concat(null!==(o=h[t.id])&&void 0!==o&&o))},q=async(t,e,n)=>{if(c.ZP.info("[".concat(n.id,"] getSlideData called for thumbnail: ").concat(!!n.msrc," sourceLoaded: ").concat(!!n.isSourceLoaded," fetching: ").concat(!!_[n.id])),!n.msrc)try{if(L[n.id]){c.ZP.info("[".concat(n.id,"] thumb download already in progress"));return}c.ZP.info("[".concat(n.id,"] doesn't have thumbnail")),L[n.id]=!0;let i=await j.Z.getThumbnailForPreview(n);try{X(e)(n.id,i),c.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for thumbnail msrc: ").concat(!!n.msrc)),t.invalidateCurrItems(),t.isOpen()&&t.updateSize(!0)}catch(t){t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("updating photoswipe after msrc url update failed",t)}}catch(t){c.ZP.error("getSlideData failed get msrc url failed",t),L[n.id]=!1}if(n.isSourceLoaded||n.conversionFailed){n.isSourceLoaded&&c.ZP.info("[".concat(n.id,"] source already loaded")),n.conversionFailed&&c.ZP.info("[".concat(n.id,"] conversion failed"));return}if(_[n.id]){c.ZP.info("[".concat(n.id,"] file download already in progress"));return}try{c.ZP.info("[".concat(n.id,"] new file src request")),_[n.id]=!0;let i=await j.Z.getFileForPreview(n);if(n.metadata.fileType===l.Gk.LIVE_PHOTO){let o=i.url,a=await o.image();try{await K(e,n.id,{url:a,isOriginal:!1,isRenderable:!!a,type:"normal"}),c.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for live photo imgSrc, source loaded: ").concat(n.isSourceLoaded)),t.invalidateCurrItems(),t.isOpen()&&t.updateSize(!0)}catch(t){t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("updating photoswipe after for live photo imgSrc update failed",t)}if(!a)return;let r=await o.video();try{await K(e,n.id,{url:{video:r,image:a},isOriginal:!1,isRenderable:!!r,type:"livePhoto"},!0),c.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for live photo complete, source loaded: ").concat(n.isSourceLoaded)),t.invalidateCurrItems(),t.isOpen()&&t.updateSize(!0)}catch(t){t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("updating photoswipe for live photo complete update failed",t)}}else try{await K(e,n.id,i),c.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for src, source loaded: ").concat(n.isSourceLoaded)),t.invalidateCurrItems(),t.isOpen()&&t.updateSize(!0)}catch(t){t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("updating photoswipe after src url update failed",t)}}catch(t){c.ZP.error("getSlideData failed get src url failed",t),_[n.id]=!1}},J=async(t,e,n)=>{if(n.metadata.fileType!==l.Gk.VIDEO&&n.metadata.fileType!==l.Gk.LIVE_PHOTO){c.ZP.error("getConvertedVideo called for non video file");return}if(n.conversionFailed){c.ZP.error("getConvertedVideo called for file that conversion failed");return}try{X(e)(n.id,n.msrc,!0),c.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for thumbnail msrc: ").concat(!!n.msrc)),t.invalidateCurrItems(),t.isOpen()&&t.updateSize(!0)}catch(t){t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("updating photoswipe after msrc url update failed",t)}try{c.ZP.info("[".concat(n.id,"] new file getConvertedVideo request ").concat(n.metadata.title,"}")),_[n.id]=!0;let i=await j.Z.getFileForPreview(n,!0);try{await K(e,n.id,i,!0),c.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for src, source loaded: ").concat(n.isSourceLoaded)),t.invalidateCurrItems(),t.isOpen()&&t.updateSize(!0)}catch(t){throw t.message!==d.sH.URL_ALREADY_SET&&c.ZP.error("updating photoswipe after src url update failed",t),t}}catch(t){c.ZP.error("getConvertedVideo failed get src url failed",t),_[n.id]=!1}};return(0,r.BX)(nh,{children:[(0,r.tZ)(eD.ZP,{children:t=>{let{height:i,width:o}=t;return e===s.Wu.DEDUPLICATE?(0,r.tZ)(e0,{width:o,height:i,getThumbnail:Q,duplicates:n,activeCollectionID:g,showAppDownloadBanner:v}):(0,r.tZ)(eN.P,{width:o,height:i,getThumbnail:Q,displayFiles:H,activeCollectionID:g,showAppDownloadBanner:v})}}),(0,r.tZ)(eL,{isOpen:x,items:H,currentIndex:T,onClose:t=>{S(!1),t&&o(),null==I||I(!1)},gettingData:q,getConvertedItem:J,favItemIds:a,tempDeletedFileIds:Z,setTempDeletedFileIds:f,isTrashCollection:g===eR.jn,isInHiddenSection:w,enableDownload:A,fileToCollectionsMap:E,collectionNameMap:C,setFilesDownloadProgressAttributesCreator:y})]})}},93850:function(t,e,n){"use strict";n.d(e,{P:function(){return V},Z:function(){return o}});var i,o,a=n(73235),r=n(52903),l=n(89449),c=n(62594),s=n(65992),d=n(24862),u=n(62197),p=n(23119),h=n(61035),Z=n(65847),f=n(24991),g=n(30845),m=n(94746),A=n(2784),E=n(98614),C=n(50166),v=n(92508),I=n(48751),w=n(80427);function y(){let t=(0,a._)(["\n    display: flex;\n    justify-content: center;\n"]);return y=function(){return t},t}function x(){let t=(0,a._)(["\n    display: grid;\n    grid-template-columns: ",";\n    grid-column-gap: ","px;\n    width: 100%;\n    color: #fff;\n    padding: 0 24px;\n    @media (max-width: ","px) {\n        padding: 0 4px;\n    }\n"]);return x=function(){return t},t}function S(){let t=(0,a._)(["\n    grid-column: span ",";\n"]);return S=function(){return t},t}function T(){let t=(0,a._)(["\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    height: ","px;\n    color: ",";\n"]);return T=function(){return t},t}function b(){let t=(0,a._)(["\n    margin-top: 1rem;\n    height: ","px;\n"]);return b=function(){return t},t}function _(){let t=(0,a._)(["\n    margin-bottom: 0.75rem;\n    @media (max-width: 540px) {\n        font-size: 12px;\n        margin-bottom: 0.5rem;\n    }\n    color: #979797;\n    text-align: center;\n    justify-content: center;\n    align-items: flex-end;\n    margin-top: calc(2rem + 20px);\n"]);return _=function(){return t},t}function O(){let t=(0,a._)(["\n    margin-top: 48px;\n    margin-bottom: ",";\n    text-align: center;\n    justify-content: center;\n"]);return O=function(){return t},t}function L(){let t=(0,a._)(["\n    margin: 0 -24px;\n    width: calc(100% + 46px);\n    left: -24px;\n    @media (max-width: ","px) {\n        margin: 0 -4px;\n        width: calc(100% + 6px);\n        left: -4px;\n    }\n    background-color: ",";\n"]);return L=function(){return t},t}function R(){let t=(0,a._)(["\n    color: #979797;\n    text-align: center;\n    justify-content: center;\n"]);return R=function(){return t},t}(i=o||(o={})).TIME="TIME",i.FILE="FILE",i.SIZE_AND_COUNT="SIZE_AND_COUNT",i.HEADER="HEADER",i.FOOTER="FOOTER",i.MARKETING_FOOTER="MARKETING_FOOTER",i.OTHER="OTHER";let P=(0,s.ZP)("div")(y()),D=(t,e,n)=>n?n.map(t=>"repeat(".concat(t,", ").concat(Z.C3*e,"px)")).join(" ".concat(Z.BV,"px ")):"repeat(".concat(t,",").concat(Z.C3*e,"px)");function N(t){return t>Z.yc*Z.C3?24:4}let k=(0,s.ZP)(d.Z,{shouldForwardProp:t=>"gridTemplateColumns"!=t})(x(),t=>t.gridTemplateColumns,Z.dP,Z.C3*Z.yc),M=(0,s.ZP)(l.A0)(S(),t=>t.span),B=(0,s.ZP)(M)(T(),Z.xU,t=>{let{theme:e}=t;return e.colors.text.muted}),U=(0,s.ZP)(B)(b(),Z.ve),F=(0,s.ZP)(M)(_()),H=(0,s.ZP)(M)(O(),t=>{let{hasReferral:e}=t;return e?"0px":"10px"}),X=(0,s.ZP)(d.Z)(L(),Z.C3*Z.yc,t=>{let{theme:e}=t;return e.colors.accent.A500}),K=(0,s.ZP)(M)(R()),G=(0,g.Z)((t,e,n,i)=>({timeStampList:t,columns:e,shrinkRatio:n,renderListItem:i})),W=A.memo(t=>{let{index:e,style:n,isScrolling:i,data:o}=t,{timeStampList:a,columns:l,shrinkRatio:c,renderListItem:s}=o;return(0,r.tZ)(P,{style:n,children:(0,r.tZ)(k,{gridTemplateColumns:D(l,c,a[e].groups),children:s(a[e],i)})})},C.wy);function V(t){var e;let{height:n,width:i,displayFiles:o,showAppDownloadBanner:a,getThumbnail:l,activeCollectionID:s}=t,g=(0,A.useContext)(m.GalleryContext),y=(0,A.useContext)(I.H),[x,S]=(0,A.useState)([]),T=(0,A.useRef)(!1),b=(0,A.useRef)(!1),_=(0,A.useRef)(null),[O,L]=(0,A.useState)({}),R=Math.floor((i-2*N(i)+Z.dP)/(Z.C3+Z.dP)),P=!1;R<Z.yc&&(R=Z.yc,P=!0);let D=(e=R,(i-2*N(i)-(e-1)*Z.dP)/(e*Z.C3)),k=Z.Ho*D+Z.dP,V=()=>{var t;null===(t=_.current)||void 0===t||t.resetAfterIndex(0)};(0,A.useEffect)(()=>{let t=()=>{if(T.current){b.current=!0;return}T.current=!0;let e=[];g.photoListHeader?e.push(J(g.photoListHeader)):y.photoListHeader&&e.push(J(y.photoListHeader)),g.isClipSearchResult?q(e):Q(e),P||(e=to(e,R)),1===e.length&&e.push(tt()),e.push(te(e)),y.accessedThroughSharedURL?(y.photoListFooter&&e.push($(y.photoListFooter)),e.push(ti())):a&&e.push(tn()),S(e),T.current=!1,b.current&&(b.current=!1,setTimeout(t,0))};t()},[i,n,o,g.photoListHeader,y.photoListHeader,g.isClipSearchResult]),(0,A.useEffect)(()=>{S(t=>(t=null!=t?t:[]).length>0&&"HEADER"===t[0].itemType?t:g.photoListHeader?[J(g.photoListHeader),...t]:y.photoListHeader?[J(y.photoListHeader),...t]:t)},[g.photoListHeader,y.photoListHeader]),(0,A.useEffect)(()=>{S(t=>{if((t=null!=t?t:[]).length>0&&"MARKETING_FOOTER"===t[t.length-1].itemType)return t;if(y.accessedThroughSharedURL){if(y.photoListFooter)return[...t,$(y.photoListFooter),ti()]}else if(a)return[...t,tn()];else return t})},[y.accessedThroughSharedURL,a,y.photoListFooter]),(0,A.useEffect)(()=>{V()},[x]);let Q=t=>{let e,n=0;o.forEach((i,o)=>{e&&j(new Date(i.metadata.creationTime/1e3),new Date(e))?n<R?(t[t.length-1].items.push(i),n++):(n=1,t.push({itemType:"FILE",items:[i],itemStartIndex:o})):(e=i.metadata.creationTime/1e3,t.push({itemType:"TIME",date:j(new Date(e),new Date)?(0,f.t)("TODAY"):j(new Date(e),new Date(Date.now()-Y))?(0,f.t)("YESTERDAY"):(0,c.p6)(e),id:e.toString()}),t.push({itemType:"FILE",items:[i],itemStartIndex:o}),n=1)})},q=t=>{let e=R;o.forEach((n,i)=>{e<R?(t[t.length-1].items.push(n),e++):(e=1,t.push({itemType:"FILE",items:[n],itemStartIndex:i}))})},J=t=>({...t,item:(0,r.tZ)(M,{span:R,children:t.item})}),$=t=>({...t,item:(0,r.tZ)(M,{span:R,children:t.item})}),tt=()=>({itemType:"OTHER",item:(0,r.tZ)(K,{span:R,children:(0,r.tZ)("div",{children:(0,f.t)("NOTHING_HERE")})}),id:"empty-list-banner",height:n-48}),te=t=>{let e;e=y.accessedThroughSharedURL?y.referralCode?113:75:90;let i=(()=>{let i=0,o=ta(t);for(let a=0;a<t.length&&!(n-(i+=o(a))<=e);a++);return i})();return{itemType:"OTHER",item:(0,r.tZ)(r.HY,{}),height:Math.max(n-i-e,0)}},tn=()=>({itemType:"MARKETING_FOOTER",height:90,item:(0,r.tZ)(F,{span:R,children:(0,r.tZ)(u.Z,{variant:"small",children:(0,r.tZ)(E.cC,{i18nKey:"INSTALL_MOBILE_APP",components:{a:(0,r.tZ)(p.Z,{href:"https://play.google.com/store/apps/details?id=io.ente.photos",target:"_blank",rel:"noreferrer"}),b:(0,r.tZ)(p.Z,{href:"https://apps.apple.com/in/app/ente-photos/id1542026904",target:"_blank",rel:"noreferrer"})}})})})}),ti=()=>({itemType:"MARKETING_FOOTER",height:y.referralCode?113:75,item:(0,r.tZ)(H,{span:R,hasReferral:!!y.referralCode,children:(0,r.BX)(d.Z,{width:"100%",children:[(0,r.BX)(u.Z,{variant:"small",display:"block",children:[(0,f.t)("SHARED_USING")," ",(0,r.tZ)(p.Z,{target:"_blank",href:"https://ente.io",children:"ente.io"})]}),y.referralCode?(0,r.tZ)(X,{children:(0,r.tZ)(u.Z,{sx:{marginTop:"12px",padding:"8px"},children:(0,r.tZ)(E.cC,{i18nKey:"SHARING_REFERRAL_CODE",values:{referralCode:y.referralCode}})})}):null]})})}),to=(t,e)=>{let n=[],i=0,o=0;for(;i<t.length;){let a=t[i];"TIME"===a.itemType?n[o]?n[o+1].items.length+t[i+1].items.length+Math.ceil(n[o].dates.length*Z.r$)<=e?(n[o].dates.push({date:a.date,span:t[i+1].items.length}),n[o+1].items=[...n[o+1].items,...t[i+1].items],i+=2):o+=2:(n.push({...a,date:null,dates:[{date:a.date,span:t[i+1].items.length}]}),n.push(t[i+1]),i+=2):(n.push(a),i++,o=n.length)}for(let t=0;t<n.length;t++){let e=n[t],i=n[t+1];"TIME"===e.itemType&&e.dates.length>1&&(e.groups=e.dates.map(t=>t.span),i.groups=e.groups)}return n},ta=t=>e=>{switch(t[e].itemType){case"TIME":return Z.xU;case"SIZE_AND_COUNT":return Z.ve;case"FILE":return k;default:return t[e].height}};(0,A.useEffect)(()=>{if(!g.selectedFile)return;let t=null==o?void 0:o.filter(t=>!g.selectedFile[t.id]),e=[...new Set(null==t?void 0:t.map(t=>z(t)))],n=o.filter(t=>!e.includes(z(t))),i=[...new Set(null==n?void 0:n.map(t=>z(t)))];e.forEach(t=>{L(e=>({...e,[t]:!1}))}),i.map(t=>{L(e=>({...e,[t]:!0}))})},[g.selectedFile]);let tr=(0,v.Po)(g.setSelectedFiles,s),tl=t=>{let e={...O,[t]:!O[t]},n=!O[t];L(e),(null==o?void 0:o.filter(e=>z(e)===t)).forEach(t=>{var e;tr(t.id,t.ownerID===(null==g?void 0:null===(e=g.user)||void 0===e?void 0:e.id))(n)})};if(!(null==x?void 0:x.length))return(0,r.tZ)(r.HY,{});let tc=G(x,R,D,(t,e)=>{var n,i;let o=(null!==(i=null===(n=g.selectedFile)||void 0===n?void 0:n.count)&&void 0!==i?i:0)>0;switch(t.itemType){case"TIME":return t.dates?t.dates.map(t=>[(0,r.BX)(B,{span:t.span,children:[o&&(0,r.tZ)(h.Z,{name:t.date,checked:!!O[t.date],onChange:()=>tl(t.date),size:"small",sx:{pl:0},disableRipple:!0},t.date),t.date]},t.date),(0,r.tZ)("div",{},"".concat(t.date,"-gap"))]).flat():(0,r.BX)(B,{span:R,children:[o&&(0,r.tZ)(h.Z,{name:t.date,checked:!!O[t.date],onChange:()=>tl(t.date),size:"small",sx:{pl:0},disableRipple:!0},t.date),t.date]});case"SIZE_AND_COUNT":return(0,r.BX)(U,{span:R,children:[t.fileCount," ",(0,f.t)("FILES"),","," ",(0,w.O5)(t.fileSize||0)," ",(0,f.t)("EACH")]});case"FILE":{let n=t.items.map((n,i)=>l(n,t.itemStartIndex+i,e));if(t.groups){let e=0;for(let i=0;i<t.groups.length-1;i++)e+=t.groups[i],n.splice(e,0,(0,r.tZ)("div",{},"".concat(t.items[0].id,"-gap-").concat(i))),e+=1}return n}default:return t.item}});return(0,r.tZ)(C.S_,{itemData:tc,ref:_,itemSize:ta(x),height:n,width:i,itemCount:x.length,itemKey:t=>"FILE"===x[t].itemType?"".concat(x[t].items[0].id,"-").concat(x[t].items.slice(-1)[0].id):"".concat(x[t].id,"-").concat(t),overscanCount:3,useIsScrolling:!0,children:W},"".concat(s))}let Y=864e5,z=t=>{let e=t.metadata.creationTime/1e3;return j(new Date(e),new Date)?(0,f.t)("TODAY"):j(new Date(e),new Date(Date.now()-Y))?(0,f.t)("YESTERDAY"):(0,c.p6)(e)},j=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()},64482:function(t,e,n){"use strict";n.d(e,{T:function(){return u},f:function(){return p}});var i=n(73235),o=n(52903),a=n(58178),r=n(89449),l=n(58936),c=n(72606);function s(){let t=(0,i._)(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n"]);return s=function(){return t},t}let d=(0,n(65992).ZP)(r.aV)(s()),u=t=>(0,o.tZ)(d,{sx:t=>({backgroundColor:t.colors.fill.faint,borderWidth:"1px",borderStyle:"solid",borderColor:t.colors.stroke.faint,borderRadius:"4px","& > svg":{color:t.colors.stroke.muted,fontSize:"50px"}}),children:t.fileType!==a.Gk.VIDEO?(0,o.tZ)(l.Z,{}):(0,o.tZ)(c.Z,{})}),p=()=>(0,o.tZ)(r.aV,{sx:t=>({backgroundColor:t.colors.fill.faint,borderRadius:"4px"})})},9378:function(t,e,n){"use strict";n.d(e,{Z:function(){return d}});var i=n(52903),o=n(89449),a=n(28504),r=n(92679),l=n(85801),c=n(24862),s=n(62197);function d(t){let{title:e,caption:n,onClose:d,backIsClose:u,actionButton:p,onRootClose:h}=t;return(0,i.BX)(i.HY,{children:[(0,i.BX)(o.A0,{height:48,alignItems:"center",justifyContent:"space-between",children:[(0,i.tZ)(l.Z,{onClick:d,color:u?"secondary":"primary",children:u?(0,i.tZ)(r.Z,{}):(0,i.tZ)(a.Z,{})}),(0,i.BX)(c.Z,{display:"flex",gap:"4px",children:[p&&p,!u&&(0,i.tZ)(l.Z,{onClick:h,color:"secondary",children:(0,i.tZ)(r.Z,{})})]})]}),(0,i.BX)(c.Z,{py:.5,px:2,children:[(0,i.tZ)(s.Z,{variant:"h3",fontWeight:"bold",children:e}),(0,i.tZ)(s.Z,{variant:"small",color:"text.muted",sx:{wordBreak:"break-all",minHeight:"17px"},children:n})]})]})}},93932:function(t,e,n){"use strict";n.d(e,{C:function(){return u}});var i=n(52903),o=n(89449),a=n(11460),r=n(69089),l=n(6060),c=n(62197),s=n(8204),d=n(24991);let u=t=>{let{open:e,onClose:n,didSelect:u}=t,p=(0,a.l)({onClose:n});return(0,i.BX)(r.Z,{open:e,onClose:p,children:[(0,i.tZ)(a.Z,{onClose:n,children:(0,d.t)("MULTI_FOLDER_UPLOAD")}),(0,i.BX)(l.Z,{children:[(0,i.tZ)(o.Tn,{mb:1,children:(0,i.tZ)(c.Z,{color:"text.muted",children:(0,d.t)("UPLOAD_STRATEGY_CHOICE")})}),(0,i.BX)(o.Gm,{px:2,children:[(0,i.tZ)(s.Z,{size:"medium",color:"accent",onClick:()=>{n(),u("root")},children:(0,d.t)("UPLOAD_STRATEGY_SINGLE_COLLECTION")}),(0,i.tZ)("strong",{children:(0,d.t)("OR")}),(0,i.tZ)(s.Z,{size:"medium",color:"accent",onClick:()=>{n(),u("parent")},children:(0,d.t)("UPLOAD_STRATEGY_COLLECTION_PER_FOLDER")})]})]})]})}},54825:function(t,e,n){"use strict";var i=n(73235),o=n(52903),a=n(19214),r=n(65992),l=n(8204),c=n(85801),s=n(24991),d=n(40994);function u(){let t=(0,i._)(["\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: opacity 1s ease;\n    cursor: pointer;\n    & .mobile-button {\n        display: none;\n    }\n    ","\n"]);return u=function(){return t},t}let p=(0,r.ZP)("div")(u(),t=>{let{$disableShrink:e}=t;return!e&&"@media (max-width: 624px) {\n        & .mobile-button {\n            display: block;\n        }\n        & .desktop-button {\n            display: none;\n        }\n    }"});e.Z=function(t){let{openUploader:e,text:n,color:i,disableShrink:r,icon:u}=t,h=()=>e();return(0,o.BX)(p,{$disableShrink:r,style:{cursor:!d.Z.shouldAllowNewUpload()&&"not-allowed"},children:[(0,o.tZ)(l.Z,{sx:{whiteSpace:"nowrap"},onClick:h,disabled:!d.Z.shouldAllowNewUpload(),className:"desktop-button",color:null!=i?i:"secondary",startIcon:null!=u?u:(0,o.tZ)(a.Z,{}),children:null!=n?n:(0,s.t)("UPLOAD")}),(0,o.tZ)(c.Z,{onClick:h,disabled:!d.Z.shouldAllowNewUpload(),className:"mobile-button",children:null!=u?u:(0,o.tZ)(a.Z,{})})]})}},8854:function(t,e,n){"use strict";n.d(e,{Z:function(){return tM}});var i,o,a=n(52903),r=n(54032),l=n(96045);let c=t=>{for(let e of t)if(e&&e.length>0)return e};var s=n(17973),d=n(18786),u=n(86345),p=n(4862),h=n(48025),Z=n(69669),f=n(5053),g=n(62197),m=n(24991);function A(t){let{open:e,onClose:n,onNameSubmit:i,toUploadFilesCount:o,uploaderName:r}=t,l=async t=>{n(),await i(t)};return(0,a.BX)(h.Z,{size:"xs",open:e,onClose:n,attributes:{title:(0,m.t)("ENTER_NAME"),icon:(0,a.tZ)(f.Z,{})},children:[(0,a.tZ)(g.Z,{color:"text.muted",pb:1,children:(0,m.t)("PUBLIC_UPLOADER_NAME_MESSAGE")}),(0,a.tZ)(Z.Z,{hiddenLabel:!0,initialValue:r,callback:l,placeholder:(0,m.t)("NAME_PLACEHOLDER"),buttonText:(0,m.t)("add_photos",{count:null!=o?o:0}),fieldType:"text",blockButton:!0,secondaryButtonAction:n})]})}var E=n(6114),C=n(72751),v=n.n(C),I=n(77024),w=n(94746),y=n(2784),x=n(22404),S=n(5155),T=n(32522),b=n(26930),_=n(40994),O=n(96741),L=n(67335),R=n(16414),P=n(48751),D=n(69647),N=n(93932);let k=(0,y.createContext)({open:null,onClose:()=>null,uploadCounter:null,uploadStage:null,percentComplete:null,retryFailed:()=>null,inProgressUploads:null,uploadFileNames:null,finishedUploads:null,hasLivePhotos:null,expanded:null,setExpanded:()=>null});var M=n(69089),B=n(6060),U=n(23119),F=n(11460),H=n(98614),X=n(5971),K=n(8204);function G(){var t,e;let{uploadStage:n,finishedUploads:i,retryFailed:o,onClose:r}=(0,y.useContext)(k);return(0,a.tZ)(X.Z,{children:n===E.ps.FINISH&&((null==i?void 0:null===(t=i.get(E.Le.FAILED))||void 0===t?void 0:t.length)>0||(null==i?void 0:null===(e=i.get(E.Le.BLOCKED))||void 0===e?void 0:e.length)>0?(0,a.tZ)(K.Z,{variant:"contained",fullWidth:!0,onClick:o,children:(0,m.t)("RETRY_FAILED")}):(0,a.tZ)(K.Z,{variant:"contained",fullWidth:!0,onClick:r,children:(0,m.t)("CLOSE")}))})}var W=n(24862),V=n(38162),Y=n(56961);function z(){let{uploadStage:t,percentComplete:e}=(0,y.useContext)(k);return(0,a.tZ)(W.Z,{children:(t===E.ps.READING_GOOGLE_METADATA_FILES||t===E.ps.EXTRACTING_METADATA||t===E.ps.UPLOADING)&&(0,a.BX)(a.HY,{children:[(0,a.tZ)(V.Z,{sx:{height:"2px",backgroundColor:"transparent"},variant:"determinate",value:e}),(0,a.tZ)(Y.Z,{})]})})}var j=n(89449),Q=n(92679),q=n(35936),J=n(41311),$=n(26029),tt=n(6377);let te=t=>{let{expanded:e}=t;return(0,a.tZ)(g.Z,{variant:e?"h2":"h3",children:(0,m.t)("FILE_UPLOAD")})};function tn(){let{uploadStage:t,uploadCounter:e}=(0,y.useContext)(k);return(0,a.tZ)(g.Z,{color:"text.muted",marginTop:"4px",children:t===E.ps.UPLOADING?(0,m.t)("UPLOAD_STAGE_MESSAGE.".concat(t),{uploadCounter:e}):t===E.ps.EXTRACTING_METADATA?(0,m.t)("UPLOAD_STAGE_MESSAGE.".concat(t),{uploadCounter:e}):(0,m.t)("UPLOAD_STAGE_MESSAGE.".concat(t))})}function ti(){let{setExpanded:t,onClose:e,expanded:n}=(0,y.useContext)(k);return(0,a.tZ)(q.Z,{children:(0,a.BX)(j.Gm,{children:[(0,a.BX)(W.Z,{children:[(0,a.tZ)(te,{expanded:n}),(0,a.tZ)(tn,{})]}),(0,a.tZ)(W.Z,{children:(0,a.BX)(J.Z,{direction:"row",spacing:1,children:[(0,a.tZ)(j.Vd,{onClick:()=>t(t=>!t),children:n?(0,a.tZ)($.Z,{}):(0,a.tZ)(tt.Z,{})}),(0,a.tZ)(j.Vd,{onClick:e,children:(0,a.tZ)(Q.Z,{})})]})})]})})}function to(){return(0,a.BX)(a.HY,{children:[(0,a.tZ)(ti,{}),(0,a.tZ)(z,{})]})}var ta=n(63655),tr=n(30295),tl=n(65992),tc=n(20597),ts=n(35322),td=n(2995);let tu=(0,tl.ZP)(t=>(0,a.tZ)(tc.Z,{disableGutters:!0,elevation:0,square:!0,...t}))(t=>{let{theme:e}=t;return{borderTop:"1px solid ".concat(e.palette.divider),"&:last-child":{borderBottom:"1px solid ".concat(e.palette.divider)},"&:before":{display:"none"}}}),tp=(0,tl.ZP)(td.Z)(()=>({backgroundColor:"rgba(255, 255, 255, .05)"})),th=(0,tl.ZP)(ts.Z)(t=>{let{theme:e}=t;return{padding:e.spacing(2)}}),tZ=t=>(0,a.tZ)(g.Z,{color:"text.muted",variant:"small",...t,sx:{mb:1}});var tf=n(73235);function tg(){let t=(0,tf._)(["\n    display: inline-block;\n    & > span {\n        display: inline-block;\n    }\n    & > span:first-of-type {\n        position: relative;\n        top: 5px;\n        max-width: 340px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n    }\n    & > .separator {\n        margin: 0 5px;\n    }\n"]);return tg=function(){return t},t}function tm(){let t=(0,tf._)(["\n    position: relative;\n    top: 5px;\n    display: inline-block;\n    max-width: 394px;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n"]);return tm=function(){return t},t}let tA=(0,tl.ZP)("div")(t=>{let{theme:e}=t;return"\n    text-align: center;\n    color: ".concat(e.colors.danger.A700,";\n    border-bottom: 1px solid ").concat(e.colors.danger.A700,";\n    margin:").concat(e.spacing(3,2,1),"\n")}),tE=(0,tl.ZP)("div")(tg()),tC=(0,tl.ZP)("div")(tm()),tv=t=>"critical"===t?"critical.main":"text.faint",tI=t=>(0,a.BX)(j.zr,{gap:"4px",children:[(0,a.BX)(g.Z,{children:[" ",t.mainText]}),(0,a.tZ)(g.Z,{variant:"small",color:tv(t.color),children:"•"}),t.subText?(0,a.tZ)(g.Z,{variant:"small",color:tv(t.color),children:t.subText}):(0,a.tZ)(g.Z,{variant:"small",color:tv(t.color),children:t.subIcon})]}),tw=()=>{var t;let{inProgressUploads:e,hasLivePhotos:n,uploadFileNames:i,uploadStage:o}=(0,y.useContext)(k);return(0,a.BX)(tu,{children:[(0,a.tZ)(tp,{expandIcon:(0,a.tZ)(ta.Z,{}),children:(0,a.tZ)(tI,{mainText:o===E.ps.EXTRACTING_METADATA?(0,m.t)("INPROGRESS_METADATA_EXTRACTION"):(0,m.t)("INPROGRESS_UPLOADS"),subText:String(null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0)})}),(0,a.BX)(th,{children:[n&&(0,a.tZ)(tZ,{children:(0,m.t)("LIVE_PHOTOS_DETECTED")}),(0,a.tZ)(tr.Z,{items:null!=e?e:[],generateItemKey:t=>{let{localFileID:e,progress:n}=t;return"".concat(e,"-").concat(n)},getItemTitle:t=>{let{localFileID:e,progress:n}=t;return"".concat(i.get(e)," - ").concat(n,"%")},renderListItem:t=>{let{localFileID:e,progress:n}=t;return(0,a.BX)(tE,{children:[(0,a.tZ)("span",{children:i.get(e)}),o===E.ps.UPLOADING&&(0,a.BX)(a.HY,{children:[" ",(0,a.tZ)("span",{className:"separator",children:"-"}),(0,a.tZ)("span",{children:"".concat(n,"%")})]})]},e)},maxHeight:160,itemSize:35})]})]})},ty=t=>{var e;let{finishedUploads:n,uploadFileNames:i}=(0,y.useContext)(k),o=n.get(t.uploadResult);return(null==o?void 0:o.length)?(0,a.BX)(tu,{children:[(0,a.tZ)(tp,{expandIcon:(0,a.tZ)(ta.Z,{}),children:(0,a.tZ)(tI,{mainText:t.sectionTitle,subText:String(null!==(e=null==o?void 0:o.length)&&void 0!==e?e:0)})}),(0,a.BX)(th,{children:[t.sectionInfo&&(0,a.tZ)(tZ,{children:t.sectionInfo}),(0,a.tZ)(tr.Z,{items:o,generateItemKey:t=>t,getItemTitle:t=>i.get(t),renderListItem:t=>(0,a.tZ)(tC,{children:i.get(t)},t),maxHeight:160,itemSize:35})]})]}):(0,a.tZ)(a.HY,{})};function tx(){let{open:t,onClose:e,uploadStage:n,finishedUploads:i}=(0,y.useContext)(k),[o,r]=(0,y.useState)(!1);(0,y.useEffect)(()=>{var t,e,n,o,a,l;(null===(t=i.get(E.Le.ALREADY_UPLOADED))||void 0===t?void 0:t.length)>0||(null===(e=i.get(E.Le.BLOCKED))||void 0===e?void 0:e.length)>0||(null===(n=i.get(E.Le.FAILED))||void 0===n?void 0:n.length)>0||(null===(o=i.get(E.Le.LARGER_THAN_AVAILABLE_STORAGE))||void 0===o?void 0:o.length)>0||(null===(a=i.get(E.Le.TOO_LARGE))||void 0===a?void 0:a.length)>0||(null===(l=i.get(E.Le.UNSUPPORTED))||void 0===l?void 0:l.length)>0?r(!0):r(!1)},[i]);let l=(0,F.l)({staticBackdrop:!0,onClose:e});return(0,a.BX)(M.Z,{maxWidth:"xs",open:t,onClose:l,children:[(0,a.tZ)(to,{}),(n===E.ps.UPLOADING||n===E.ps.FINISH||n===E.ps.EXTRACTING_METADATA)&&(0,a.BX)(B.Z,{sx:{"&&&":{px:0}},children:[(n===E.ps.UPLOADING||n===E.ps.EXTRACTING_METADATA)&&(0,a.tZ)(tw,{}),(n===E.ps.UPLOADING||n===E.ps.FINISH)&&(0,a.BX)(a.HY,{children:[(0,a.tZ)(ty,{uploadResult:E.Le.UPLOADED,sectionTitle:(0,m.t)("SUCCESSFUL_UPLOADS")}),(0,a.tZ)(ty,{uploadResult:E.Le.UPLOADED_WITH_STATIC_THUMBNAIL,sectionTitle:(0,m.t)("THUMBNAIL_GENERATION_FAILED_UPLOADS"),sectionInfo:(0,m.t)("THUMBNAIL_GENERATION_FAILED_INFO")}),n===E.ps.FINISH&&o&&(0,a.tZ)(tA,{children:(0,m.t)("FILE_NOT_UPLOADED_LIST")}),(0,a.tZ)(ty,{uploadResult:E.Le.BLOCKED,sectionTitle:(0,m.t)("BLOCKED_UPLOADS"),sectionInfo:(0,a.tZ)(H.cC,{i18nKey:"ETAGS_BLOCKED",components:{a:(0,a.tZ)(U.Z,{href:"https://ente.io/download/desktop",target:"_blank"})}})}),(0,a.tZ)(ty,{uploadResult:E.Le.FAILED,sectionTitle:(0,m.t)("FAILED_UPLOADS")}),(0,a.tZ)(ty,{uploadResult:E.Le.ALREADY_UPLOADED,sectionTitle:(0,m.t)("SKIPPED_FILES"),sectionInfo:(0,m.t)("SKIPPED_INFO")}),(0,a.tZ)(ty,{uploadResult:E.Le.LARGER_THAN_AVAILABLE_STORAGE,sectionTitle:(0,m.t)("LARGER_THAN_AVAILABLE_STORAGE_UPLOADS"),sectionInfo:(0,m.t)("LARGER_THAN_AVAILABLE_STORAGE_INFO")}),(0,a.tZ)(ty,{uploadResult:E.Le.UNSUPPORTED,sectionTitle:(0,m.t)("UNSUPPORTED_FILES"),sectionInfo:(0,m.t)("UNSUPPORTED_INFO")}),(0,a.tZ)(ty,{uploadResult:E.Le.TOO_LARGE,sectionTitle:(0,m.t)("TOO_LARGE_UPLOADS"),sectionInfo:(0,m.t)("TOO_LARGE_INFO")})]})]}),n===E.ps.FINISH&&(0,a.tZ)(G,{})]})}var tS=n(8909),tT=n(17377);function tb(){return(0,a.tZ)(tS.Z,{open:!0,anchorOrigin:{horizontal:"right",vertical:"bottom"},children:(0,a.tZ)(tT.Z,{sx:{width:"360px"},children:(0,a.tZ)(to,{})})})}function t_(t){let{open:e,uploadCounter:n,uploadStage:i,percentComplete:o,retryFailed:r,uploadFileNames:l,hasLivePhotos:c,inProgressUploads:s,finishedUploads:d,...u}=t,p=(0,y.useContext)(I.AppContext),[h,Z]=(0,y.useState)(!1);return((0,y.useEffect)(()=>{e&&Z(!1)},[e]),e)?(0,a.tZ)(k.Provider,{value:{open:e,onClose:function(){i!==E.ps.FINISH?p.setDialogMessage({title:(0,m.t)("STOP_UPLOADS_HEADER"),content:(0,m.t)("STOP_ALL_UPLOADS_MESSAGE"),proceed:{text:(0,m.t)("YES_STOP_UPLOADS"),variant:"critical",action:u.cancelUploads},close:{text:(0,m.t)("NO"),variant:"secondary",action:()=>{}}}):u.onClose()},uploadCounter:n,uploadStage:i,percentComplete:o,retryFailed:r,inProgressUploads:s,uploadFileNames:l,finishedUploads:d,hasLivePhotos:c,expanded:h,setExpanded:Z},children:h?(0,a.tZ)(tx,{}):(0,a.tZ)(tb,{})}):(0,a.tZ)(a.HY,{})}var tO=n(48588),tL=n(28319),tR=n(13363),tP=n(33041),tD=n(89178),tN=n(62798);function tk(t){let{onClose:e,show:n,uploadFiles:i,uploadFolders:o,uploadGoogleTakeoutZips:r,uploadTypeSelectorIntent:l}=t,c=(0,y.useContext)(P.H),s=(0,y.useRef)((0,tN.X)());return(0,y.useEffect)(()=>{n&&s.current&&c.accessedThroughSharedURL&&(i(),e())},[n]),(0,a.BX)(M.Z,{open:n,PaperProps:{sx:t=>({maxWidth:"375px",p:1,[t.breakpoints.down(360)]:{p:0}})},onClose:(0,F.l)({onClose:e}),children:[(0,a.tZ)(F.Z,{onClose:e,children:l===L.M.collectPhotos?(0,m.t)("SELECT_PHOTOS"):l===L.M.import?(0,m.t)("IMPORT"):(0,m.t)("UPLOAD")}),(0,a.BX)(W.Z,{p:1.5,pt:.5,children:[(0,a.BX)(J.Z,{spacing:.5,children:[l!==L.M.import&&(0,a.tZ)(tO.v,{onClick:i,startIcon:(0,a.tZ)(tP.Z,{}),endIcon:(0,a.tZ)(tL.Z,{}),label:(0,m.t)("UPLOAD_FILES")}),(0,a.tZ)(tO.v,{onClick:o,startIcon:(0,a.tZ)(tD.Z,{}),endIcon:(0,a.tZ)(tL.Z,{}),label:(0,m.t)("UPLOAD_DIRS")}),l!==L.M.collectPhotos&&(0,a.tZ)(tO.v,{onClick:r,startIcon:(0,a.tZ)(tR.Z,{}),endIcon:(0,a.tZ)(tL.Z,{}),label:(0,m.t)("UPLOAD_GOOGLE_TAKEOUT")})]}),(0,a.tZ)(g.Z,{p:1.5,pt:4,color:"text.muted",children:(0,m.t)("DRAG_AND_DROP_HINT")})]})]})}function tM(t){var e;let{isFirstUpload:n,dragAndDropFiles:i,openFileSelector:o,fileSelectorFiles:c,openFolderSelector:s,folderSelectorFiles:u,openZipFileSelector:h,fileSelectorZipFiles:Z,...f}=t,g=(0,y.useContext)(I.AppContext),C=(0,y.useContext)(w.GalleryContext),T=(0,y.useContext)(P.H),[k,M]=(0,y.useState)(!1),[B,U]=(0,y.useState)(E.ps.START),[F,H]=(0,y.useState)(),[X,K]=(0,y.useState)({finished:0,total:0}),[G,W]=(0,y.useState)([]),[V,Y]=(0,y.useState)(new Map),[z,j]=(0,y.useState)(0),[Q,q]=(0,y.useState)(!1),[J,$]=(0,y.useState)(!1),[tt,te]=(0,y.useState)(!1),[tn,ti]=(0,y.useState)(tH),[to,ta]=(0,y.useState)([]),[tr,tl]=(0,y.useState)([]),[tc,ts]=(0,y.useState)([]),[td,tu]=(0,y.useState)([]),tp=(0,y.useRef)([]),th=(0,y.useRef)(!1),tZ=(0,y.useRef)(""),tf=(0,y.useRef)(null),tg=(0,y.useRef)(null),tm=(0,y.useRef)(!1),tA=(0,y.useRef)(null),tE=(0,y.useRef)(!1),tC=globalThis.electron,tv=()=>M(!1),tI=()=>te(!0),tw=()=>{tm.current=!1};(0,y.useEffect)(()=>{_.Z.init({setPercentComplete:j,setUploadCounter:K,setInProgressUploads:W,setFinishedUploads:Y,setUploadStage:U,setUploadFilenames:H,setHasLivePhotos:q,setUploadProgressView:M},f.setFiles,T,g.isCFProxyDisabled),_.Z.isUploadRunning()&&M(!0),tC&&(O.Z.init((t,e)=>{th.current=!0,tZ.current=t,ts(e)},()=>{f.syncWithRemote().catch(t=>{l.ZP.error("Ignoring error when syncing trash changes with remote",t)})}),tC.pendingUploads().then(t=>{if(!t)return;let{collectionName:e,filePaths:n,zipItems:i}=t;l.ZP.info("Resuming pending of upload of ".concat(n.length+i.length," items").concat(e?" to collection "+e:"")),th.current=!0,tZ.current=e,ts(n),tu(i)}))},[T.accessedThroughSharedURL,T.token,T.passwordToken,g.isCFProxyDisabled]),(0,y.useEffect)(()=>{let t;if(!g.watchFolderView){switch(tf.current){case"files":t=c;break;case"folders":t=u;break;case"zips":t=Z;break;default:t=i}tC?tU(tC,t).then(t=>{let{fileAndPaths:e,zipItems:n}=t;tl(e),tu(n)}):ta(t)}},[i,c,u,Z]),(0,y.useEffect)(()=>{let t=[to.map(t=>[t,tF(t)]),tr.map(t=>[t,t.path]),tc.map(t=>[t,t]),td.map(t=>[t,t[1]])].flat();if(0==t.length)return;if(_.Z.isUploadRunning()){if(O.Z.isUploadRunning())l.ZP.info("Pausing watch folder sync to prioritize user upload"),O.Z.pauseRunningSync();else{l.ZP.info("Ignoring new upload request when upload is already running");return}}tm.current=!0,f.closeUploadTypeSelector(),f.setLoading(!0),ta([]),tl([]),ts([]),tu([]);let e=t.filter(t=>{let[e,n]=t;return!(0,r.EZ)(n).startsWith(".")});if(tp.current=e,0===tp.current.length){f.setLoading(!1);return}let i=function(t,e){if(v()()&&"files"===t)return tH;let n=t=>{var e;return(null!==(e=t.match(/\//g))&&void 0!==e?e:[]).length};e.sort((t,e)=>n(t)-n(e));let i=e[0],o=e[e.length-1],a=i.length,r=0,l=i.substring(0,i.lastIndexOf("/")),c=o.substring(0,o.lastIndexOf("/"));for(;r<a&&i.charAt(r)===o.charAt(r);)r++;let s=i.substring(0,r);return s&&(s=s.substring(0,s.lastIndexOf("/")))&&(s=s.substring(s.lastIndexOf("/")+1)),{rootFolderName:s||null,hasNestedFolders:l!==c,hasRootLevelFileWithFolder:""===l}}(tf.current,e.map(t=>{let[e,n]=t;return n}));ti(i),l.ZP.debug(()=>"Uploader invoked:"),l.ZP.debug(()=>tp.current),l.ZP.debug(()=>i);let o=tf.current;tf.current=null,f.setLoading(!1),(async()=>{if(T.accessedThroughSharedURL){let t=await (0,b.SP)((0,b.yB)(T.token));tA.current=t,tI();return}if(th.current){th.current=!1,tZ.current?(tS("root",tZ.current),tZ.current=null):tS("parent");return}if(tC&&"zips"===o){tS("parent");return}if(n&&!i.rootFolderName&&(i.rootFolderName=(0,m.t)("autogenerated_first_album_name")),tE.current){var t;if(tE.current=!1,f.activeCollection&&f.activeCollection.owner.id===(null===(t=C.user)||void 0===t?void 0:t.id)){tx(f.activeCollection);return}}let e=()=>{};e=i.hasNestedFolders?()=>$(!0):()=>tN(i.rootFolderName),f.setCollectionSelectorAttributes({callback:tx,onCancel:tw,showNextModal:e,intent:L.r.upload})})()},[to,tr,tc,td]);let ty=async()=>{var t;null===(t=f.closeCollectionSelector)||void 0===t||t.call(f),f.setShouldDisableDropzone(!_.Z.shouldAllowNewUpload()),U(E.ps.START),M(!0)},tx=async(t,e)=>{await ty();let n=tp.current.map((e,n)=>{let[i]=e;return{uploadItem:i,localID:n,collectionID:t.id}});await tT(n,[t],e),tp.current=null},tS=async(t,e)=>{await ty();let n=[],i=[],o=new Map;"root"==t?o.set(e,tp.current.map(t=>{let[e]=t;return e})):o=tX(tp.current);try{let t=await (0,S.of)(),e=0;for(let[a,r]of o){let o=await (0,R.Xv)(a,t);i.push(o),f.setCollections([...t,...i]),n=[...n,...r.map(t=>({localID:e++,collectionID:o.id,uploadItem:t}))]}}catch(t){throw tv(),l.ZP.error("Failed to create album",t),g.setDialogMessage({title:(0,m.t)("ERROR"),close:{variant:"critical"},content:(0,m.t)("CREATE_ALBUM_FAILED")}),t}await tT(n,i),tp.current=null},tT=async(t,e,n)=>{let i=tg.current;tg.current=tB(i,async()=>await tL(t,e,n)),await tg.current},tb=async()=>{_.Z.prepareForNewUpload(),M(!0),await f.syncWithRemote(!0,!0)};function tO(){f.setShouldDisableDropzone(!1),tm.current=!1,f.syncWithRemote()}let tL=async(t,e,n)=>{try{tb(),!tC||th.current||O.Z.isUploadRunning()||tK(tC,e,t.map(t=>{let{uploadItem:e}=t;return e}).filter(t=>t)),await _.Z.uploadItems(t,e,n)||tv(),v()()&&(O.Z.isUploadRunning()?await O.Z.allFileUploadsDone(t,e):O.Z.isSyncPaused()&&O.Z.resumePausedSync())}catch(t){l.ZP.error("Failed to upload files",t),tP(t.message),tv()}finally{tO()}},tR=async()=>{try{l.ZP.info("Retrying failed uploads");let{items:t,collections:e}=_.Z.getFailedItemsWithCollections(),n=_.Z.getUploaderName();await tb(),await _.Z.uploadItems(t,e,n)}catch(t){l.ZP.error("Retrying failed uploads failed",t),tP(t.message),tv()}finally{tO()}};function tP(t){let e;switch(t){case d.sH.SESSION_EXPIRED:return f.showSessionExpiredMessage();case d.sH.SUBSCRIPTION_EXPIRED:e={variant:"critical",subtext:(0,m.t)("SUBSCRIPTION_EXPIRED"),message:(0,m.t)("RENEW_NOW"),onClick:()=>x.Z.redirectToCustomerPortal()};break;case d.sH.STORAGE_QUOTA_EXCEEDED:e={variant:"critical",subtext:(0,m.t)("STORAGE_QUOTA_EXCEEDED"),message:(0,m.t)("UPGRADE_NOW"),onClick:()=>C.showPlanSelectorModal(),startIcon:(0,a.tZ)(p.Z,{})};break;default:e={variant:"critical",message:(0,m.t)("UNKNOWN_ERROR"),onClick:()=>null}}g.setNotificationAttributes(e)}let tD=t=>{tS("root",t)},tN=t=>{f.setCollectionNamerAttributes({title:(0,m.t)("CREATE_COLLECTION"),buttonText:(0,m.t)("CREATE"),autoFilledName:t,callback:tD})},tM=t=>{tf.current=t,"files"===t?o():"folders"===t?s():h&&tC?h():g.setDialogMessage((0,D.nf)())},tG=async(t,e)=>{try{e||(0,b.e4)((0,b.yB)(T.token),t),await tx(f.uploadCollection,t)}catch(t){l.ZP.error("public upload failed ",t)}};return(0,a.BX)(a.HY,{children:[(0,a.tZ)(N.C,{open:J,onClose:()=>{$(!1),tm.current=!1},didSelect:t=>{switch(t){case"root":var e;tD(null!==(e=tn.rootFolderName)&&void 0!==e?e:(0,m.t)("autogenerated_default_album_name"));break;case"parent":tn.hasRootLevelFileWithFolder?g.setDialogMessage((0,D.KV)()):tS("parent")}}}),(0,a.tZ)(tk,{show:f.uploadTypeSelectorView,onClose:f.closeUploadTypeSelector,uploadFiles:()=>tM("files"),uploadFolders:()=>tM("folders"),uploadGoogleTakeoutZips:()=>tM("zips"),uploadTypeSelectorIntent:f.uploadTypeSelectorIntent}),(0,a.tZ)(t_,{open:k,onClose:tv,percentComplete:z,uploadFileNames:F,uploadCounter:X,uploadStage:B,inProgressUploads:G,hasLivePhotos:Q,retryFailed:tR,finishedUploads:V,cancelUploads:()=>{_.Z.cancelRunningUpload()}}),(0,a.tZ)(A,{open:tt,onClose:()=>{te(!1),tm.current=!1},onNameSubmit:tG,toUploadFilesCount:null===(e=tp.current)||void 0===e?void 0:e.length,uploaderName:tA.current})]})}async function tB(t,e){t&&(0,u.tI)(t)&&await t,await e()}(i=o||(o={})).FILES="files",i.FOLDERS="folders",i.ZIPS="zips";let tU=async(t,e)=>{let n=[],i=[];for(let o of e){let e=t.pathForFile(o);o.name.endsWith(".zip")?i=i.concat(await t.listZipItems(e)):n.push({file:o,path:e})}return{fileAndPaths:n,zipItems:i}},tF=t=>(0,s.z)(c(["path"in t&&"string"==typeof t.path?t.path:void 0,t.webkitRelativePath,t.name])),tH={rootFolderName:"",hasNestedFolders:!1,hasRootLevelFileWithFolder:!1},tX=t=>{let e=new Map;for(let[n,i]of t){let t=i.substring(0,i.lastIndexOf("/"));t.endsWith(T.ob)&&(t=t.substring(0,t.lastIndexOf("/")));let o=t.substring(t.lastIndexOf("/")+1);if(!o)throw Error("Unexpected empty folder name");e.has(o)||e.set(o,[]),e.get(o).push(n)}return e},tK=async(t,e,n)=>{let i;1==e.length&&(i=e[0].name);let o=[],a=[];for(let t of n){if(t instanceof File)throw Error("Unexpected web file for a desktop pending upload");"string"==typeof t?o.push(t):Array.isArray(t)?a.push(t):o.push(t.path)}await t.setPendingUploads({collectionName:i,filePaths:o,zipItems:a})}},4367:function(t,e,n){"use strict";n.d(e,{l:function(){return o}});var i=n(52903);let o=t=>{let{getDragAndDropInputProps:e,getFileSelectorInputProps:n,getFolderSelectorInputProps:o,getZipFileSelectorInputProps:a}=t;return(0,i.BX)(i.HY,{children:[(0,i.tZ)("input",{...e()}),(0,i.tZ)("input",{...n()}),(0,i.tZ)("input",{...o()}),a&&(0,i.tZ)("input",{...a()})]})}},99790:function(t,e,n){"use strict";n.d(e,{sG:function(){return m},oY:function(){return A}});var i=n(73235),o=n(52903),a=n(57532),r=n(65992),l=n(79906);function c(){let t=(0,i._)(["\n    font-size: 20px;\n    color: #ddd;\n    display: inline;\n"]);return c=function(){return t},t}let s=(0,r.ZP)("span")(c());var d=n(24991),u=n(2784),p=n(11026);function h(){let t=(0,i._)(["\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n    align-items: center;\n    margin-top: 5px;\n    margin-bottom: 5px;\n    overflow: auto;\n"]);return h=function(){return t},t}function Z(){let t=(0,i._)(["\n    width: 112px;\n    height: 112px;\n    margin: 5px;\n    border-radius: 50%;\n    overflow: hidden;\n    position: relative;\n    cursor: ",";\n    & > img {\n        width: 100%;\n        height: 100%;\n    }\n"]);return Z=function(){return t},t}let f=(0,r.ZP)("div")(h()),g=(0,r.ZP)("div")(Z(),t=>{let{clickable:e}=t;return e?"pointer":"normal"}),m=u.memo(t=>(0,o.tZ)(f,{style:t.maxRows&&{maxHeight:122*t.maxRows+28},children:t.people.map((e,n)=>(0,o.tZ)(g,{clickable:!!t.onSelect,onClick:()=>t.onSelect&&t.onSelect(e,n),children:(0,o.tZ)(E,{faceID:e.displayFaceId})},e.id))}));function A(t){let{file:e}=t,[n,i]=(0,u.useState)([]);return((0,u.useEffect)(()=>{let t=!1;return(async()=>{let n=await (0,p.H1)(e);t||i(n)})(),()=>{t=!0}},[e]),0==n.length)?(0,o.tZ)(o.HY,{}):(0,o.BX)(o.HY,{children:[(0,o.tZ)("div",{children:(0,o.tZ)(s,{children:(0,d.t)("UNIDENTIFIED_FACES")})}),(0,o.tZ)(f,{children:n.map(t=>(0,o.tZ)(g,{children:(0,o.tZ)(E,{faceID:t})},t))})]})}let E=t=>{let{faceID:e}=t,[n,i]=(0,u.useState)();return(0,u.useEffect)(()=>{let t=!1;return e?(0,a.Pr)("face-crops").then(t=>t.get(e)).then(e=>{if(e){let n=new Blob([e]);t||i(URL.createObjectURL(n))}}):i(void 0),()=>{t=!0,n&&URL.revokeObjectURL(n)}},[e]),n?(0,o.tZ)("img",{src:n}):(0,o.tZ)(l.Z,{variant:"circular",height:120,width:120})}},60824:function(t,e,n){"use strict";var i=n(73235),o=n(52903),a=n(96045),r=n(65992),l=n(47746),c=n(94746),s=n(2784);function d(){let t=(0,i._)(["\n    width: ",";\n    height: ",";\n    background-color: ",";\n    border-radius: 50%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #fff;\n    font-weight: bold;\n    font-size: ",";\n"]);return d=function(){return t},t}let u="#000000",p=(0,r.ZP)("div")(d(),t=>{let{size:e}=t;return"".concat(e,"px")},t=>{let{size:e}=t;return"".concat(e,"px")},t=>{let{colorCode:e,opacity:n}=t;return"".concat(e).concat(100===n?"":null!=n?n:95)},t=>{let{size:e}=t;return"".concat(Math.floor(e/2),"px")});e.Z=t=>{let{file:e,email:n,opacity:i}=t,{userIDToEmailMap:r,user:d}=(0,s.useContext)(c.GalleryContext),h=(0,l.Z)(),[Z,f]=(0,s.useState)(""),[g,m]=(0,s.useState)("");return((0,s.useLayoutEffect)(()=>{try{if(!e)return;if(e.ownerID!==d.id){let t=r.get(e.ownerID);if(!t){a.ZP.error("email not found in userIDToEmailMap");return}let n=e.ownerID%h.colors.avatarColors.length,i=h.colors.avatarColors[n];m(t[0].toUpperCase()),f(i)}else if(e.ownerID===d.id){let t=e.pubMagicMetadata.data.uploaderName;if(!t){a.ZP.error("uploaderName not found in file.pubMagicMetadata.data");return}m(t[0].toUpperCase()),f(u)}}catch(t){a.ZP.error("AvatarIcon.tsx - useLayoutEffect file failed",t)}},[e]),(0,s.useLayoutEffect)(()=>{try{if(!n)return;if(d.email===n){m(n[0].toUpperCase()),f(u);return}let t=Array.from(r.keys()).find(t=>r.get(t)===n);if(!t){a.ZP.error("ID not found for email: ".concat(n));return}let e=t%h.colors.avatarColors.length,i=h.colors.avatarColors[e];m(n[0].toUpperCase()),f(i)}catch(t){a.ZP.error("AvatarIcon.tsx - useLayoutEffect email failed",t)}},[n]),Z&&g)?(0,o.tZ)(p,{size:18,colorCode:Z,opacity:i,children:g}):(0,o.tZ)(o.HY,{})}},52202:function(t,e,n){"use strict";var i=n(52903),o=n(23119);n(2784),e.Z=t=>{let{children:e,sx:n,color:a,...r}=t;return(0,i.tZ)(o.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(a,".main"),textDecoration:"underline ",textDecorationColor:"".concat(a,".main")},...n},...r,children:e})}},96820:function(t,e,n){"use strict";n.d(e,{F:function(){return p}});var i=n(73235),o=n(52903),a=n(72176),r=n(65992),l=n(8204),c=n(24991),s=n(2784),d=n(62798);function u(){let t=(0,i._)(["\n    color: inherit;\n    text-decoration: none !important;\n    &:hover {\n        color: #fff !important;\n    }\n"]);return u=function(){return t},t}let p=(0,r.ZP)("a")(u());e.Z=function(){let[t,e]=(0,s.useState)(d.OS.UNKNOWN);return(0,s.useEffect)(()=>{e((0,d.f)())},[]),(0,o.tZ)(l.Z,{color:"accent",LinkComponent:p,href:a.FN,children:t===d.OS.ANDROID||t===d.OS.IOS?(0,c.t)("INSTALL"):(0,c.t)("SIGN_UP")})}},65847:function(t,e,n){"use strict";var i,o;n.d(e,{BV:function(){return u},C3:function(){return s},DA:function(){return h},Ho:function(){return c},dP:function(){return a},r$:function(){return p},ve:function(){return l},xU:function(){return r},xt:function(){return i},yc:function(){return d}});let a=4,r=48,l=72,c=180,s=180,d=4,u=44,p=.244;(o=i||(i={})).MONTH="month",o.YEAR="year";let h=3e5},69686:function(t,e,n){"use strict";n.r(e),n.d(e,{DeduplicateContext:function(){return z},Info:function(){return j},default:function(){return Q}});var i=n(73235),o=n(52903),a=n(24991),r=n(12492),l=n(22216),c=n(77024),s=n(2784),d=n(49264),u=n(58178),p=n(96045),h=n(73873),Z=n(95525),f=n(94522);let g=(0,Z.O3)();async function m(t,e){try{let n=(await A()).sort((t,e)=>e.size-t.size),i=new Map;for(let e of t)i.set(e.id,e);let o=[];for(let t of n){let n=[];for(let e of t.fileIDs)i.has(e)&&n.push(i.get(e));(n=await E(n,e)).length>1&&(o=[...o,...function(t){let e=[],n=[],i=[];for(let e of t.files)(0,d.L)(e.metadata)?n.push(e):i.push(e);return n.length>1&&e.push(...function(t){let e=[],n=t.files.map(t=>{var e;return{file:t,hash:null!==(e=t.metadata.hash)&&void 0!==e?e:"".concat(t.metadata.imageHash,"_").concat(t.metadata.videoHash)}}).sort((t,e)=>t.hash.localeCompare(e.hash)),i=[];i.push(n[0].file);for(let r=1;r<n.length;r++){var o,a;(o=n[r-1].file.metadata,a=n[r].file.metadata,o.fileType===u.Gk.LIVE_PHOTO?o.imageHash===a.imageHash&&o.videoHash===a.videoHash:o.hash===a.hash)?i.push(n[r].file):(i.length>1&&e.push({files:[...i],size:t.size}),i=[n[r].file])}return i.length>1&&e.push({files:i,size:t.size}),e}({files:n,size:t.size})),i.length>1&&e.push({files:i,size:t.size}),e}({files:n,size:t.size})])}return o}catch(t){p.ZP.error("failed to get duplicate files",t)}}async function A(){try{return(await h.Z.get("".concat(g,"/files/duplicates"),null,{"X-Auth-Token":(0,f.LP)()})).data.duplicates}catch(t){p.ZP.error("failed to fetch duplicate file IDs",t)}}async function E(t,e){return t.sort((t,n)=>{let i=e.get(t.collectionID).toLocaleLowerCase(),o=e.get(n.collectionID).toLocaleLowerCase();return i.localeCompare(o)})}var C=n(82797),v=n(89449),I=n(46470),w=n(65342),y=n(18786),x=n(29010),S=n(66546),T=n(24450),b=n(65992),_=n(62197),O=n(80613),L=n(42399),R=n(77508),P=n(92679),D=n(6163),N=n(85801),k=n(24862),M=n(2672),B=n(68372),U=n(69647);function F(t){let{deleteFileHelper:e,close:n,count:i,clearSelection:r}=t,{setDialogMessage:l,isMobile:d}=(0,s.useContext)(c.AppContext);return(0,o.BX)(L.X,{isMobile:d,children:[(0,o.BX)(v.G5,{children:[i?(0,o.tZ)(N.Z,{onClick:r,children:(0,o.tZ)(P.Z,{})}):(0,o.tZ)(N.Z,{onClick:n,children:(0,o.tZ)(R.Z,{})}),(0,o.BX)(k.Z,{ml:1.5,children:[(0,B.u)(i)," ",(0,a.t)("SELECTED")]})]}),(0,o.tZ)(M.Z,{title:(0,a.t)("DELETE"),children:(0,o.tZ)(N.Z,{onClick:()=>l((0,U.BN)(e)),children:(0,o.tZ)(D.Z,{})})})]})}var H=n(5632),X=n.n(H),K=n(5155),G=n(55071);let W={clubSameTimeFilesOnly:!1,setClubSameTimeFilesOnly:()=>null,fileSizeMap:new Map,isOnDeduplicatePage:!1,collectionNameMap:new Map};var V=n(79541);function Y(){let t=(0,i._)(["\n    padding: 24px;\n    font-size: 18px;\n"]);return Y=function(){return t},t}let z=(0,s.createContext)(W),j=(0,b.ZP)("div")(Y());function Q(){let{setDialogMessage:t,startLoading:e,finishLoading:n,showNavBar:i}=(0,s.useContext)(c.AppContext),[d,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(new Map),[Z,f]=(0,s.useState)({count:0,collectionID:0,ownCount:0});(0,s.useEffect)(()=>{if(!(0,T.km)(T.Qm.ENCRYPTION_KEY)){S.Z.set(S.i.REDIRECT_URL,w.Wu.DEDUPLICATE),X().push(w.Wu.ROOT);return}i(!0)},[]),(0,s.useEffect)(()=>{g()},[]);let g=async()=>{e();let t=await (0,K.zr)(),i=new Map;for(let e of t)i.set(e.id,e.name);h(i);let o=await (0,C.dm)(),a=await m(o,i),r=new Map,c=[],s=0;for(let t of a)for(let e of(c=[...c,...t.files.slice(1).map(t=>t.id)],s+=t.files.length-1,t.files))r.set(e.id,t.size);u(a);let d={count:s,ownCount:s,collectionID:l.Ug};for(let t of c)d[t]=!0;f(d),n()},A=(0,x.Z)(()=>(null!=d?d:[]).reduce((t,e)=>[...t,...e.files],[]),[d]),E=(0,x.Z)(()=>(0,V.W2)(A),[A]),b=async()=>{try{e();let t=(0,V.Rb)(Z,A);await (0,C.N5)(t);let n=await (0,K.sU)();await (0,C.Z0)("normal",n,()=>{}),await (0,G.Rr)(n,()=>{})}catch(e){e instanceof y.MS&&e.httpStatusCode===O.WE.Forbidden?t({title:(0,a.t)("ERROR"),close:{variant:"critical"},content:(0,a.t)("NOT_FILE_OWNER")}):t({title:(0,a.t)("ERROR"),close:{variant:"critical"},content:(0,a.t)("UNKNOWN_ERROR")})}finally{await g(),n()}};return d?(0,o.BX)(z.Provider,{value:{...W,collectionNameMap:p,isOnDeduplicatePage:!0},children:[A.length>0&&(0,o.tZ)(j,{children:(0,a.t)("DEDUPLICATE_BASED_ON_SIZE")}),0===A.length?(0,o.tZ)(v.wx,{children:(0,o.tZ)(_.Z,{variant:"large",color:"text.muted",children:(0,a.t)("NO_DUPLICATES_FOUND")})}):(0,o.tZ)(r.Z,{page:w.Wu.DEDUPLICATE,files:A,duplicates:d,syncWithRemote:g,setSelected:f,selected:Z,activeCollectionID:l.Ug,fileToCollectionsMap:E,collectionNameMap:p}),(0,o.tZ)(F,{deleteFileHelper:b,count:Z.count,close:function(){X().push(w.Wu.GALLERY)},clearSelection:function(){f({count:0,collectionID:0,ownCount:0})}})]}):(0,o.tZ)(v.wx,{children:(0,o.tZ)(I.Z,{})})}},94746:function(t,e,n){"use strict";let i;n.r(e),n.d(e,{DeadCenter:function(){return lN},GalleryContext:function(){return lM},default:function(){return lB}});var o,a,r,l,c,s,d,u,p,h,Z,f,g,m,A=n(73235),E=n(52903),C=n(1518),v=n(96045),I=n(89449),w=n(46470),y=n(65342),x=n(2299),S=n(18786),T=n(30713),b=n(29010),_=n(66546),O=n(10005),L=n(94522),R=n(24450),P=n(86345),D=n(65992),N=n(62197),k=n(30794),M=n(2185),B=n(24991),U=n(77024),F=n(2784);function H(t){let{open:e,onClose:n,onAuthenticate:i}=t,{setDialogMessage:o}=(0,F.useContext)(U.AppContext),[a,r]=(0,F.useState)(),[l,c]=(0,F.useState)(),s=()=>o({title:(0,B.t)("ERROR"),close:{variant:"critical"},content:(0,B.t)("UNKNOWN_ERROR")});(0,F.useEffect)(()=>{(async()=>{try{let t=(0,O.Yu)(O.Pd.USER);if(!t)throw Error("User not found");r(t);let e=(0,O.Yu)(O.Pd.KEY_ATTRIBUTES);if(((null==t?void 0:t.token)||(null==t?void 0:t.encryptedToken))&&(!e||e.memLimit)){if(e)c(e);else throw Error("Key attributes not found")}else throw Error("User not logged in")}catch(t){v.ZP.error("AuthenticateUserModal initialization failed",t),n(),s()}})()},[]);let d=async()=>{n(),i()};return(0,E.tZ)(k.Z,{open:e,onClose:n,sx:{position:"absolute"},attributes:{title:(0,B.t)("password")},children:(0,E.tZ)(M.Z,{buttonText:(0,B.t)("AUTHENTICATE"),callback:d,user:a,keyAttributes:l,submitButtonProps:{sx:{mb:0}}})})}var X=n(43036),K=n(56961),G=n(69089),W=n(83415),V=n(13980),Y=n.n(V);let z=(0,D.ZP)(G.Z)(t=>{let{theme:e,position:n}=t;return{"& .MuiDialog-container":{justifyContent:n},"& .MuiPaper-root":{maxWidth:"494px"},"& .MuiDialogTitle-root":{padding:e.spacing(2),paddingRight:e.spacing(1)},"& .MuiDialogContent-root":{padding:e.spacing(2)},[e.breakpoints.down(559)]:{"& .MuiPaper-root":{width:"324px"},"& .MuiDialogContent-root":{padding:6}}}});function j(){let[t,e]=(0,F.useState)({width:void 0,height:void 0});return(0,F.useEffect)(()=>{function t(){e({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)},[]),t}z.propTypes={children:Y().node,onClose:Y().func.isRequired};var Q=n(6060),q=n(30845),J=n(50166),$=n(64482),tt=n(47371);function te(t){let{coverFile:e,onClick:n,children:i,collectionTile:o,isScrolling:a}=t,[r,l]=(0,F.useState)(null);return(0,F.useEffect)(()=>{(async()=>{if(!e)return;let t=await tt.Z.getThumbnailForPreview(e,a);t&&l(t)})()},[e,a]),(0,E.BX)(o,{onClick:n,children:[(null==e?void 0:e.metadata.hasStaticThumbnail)?(0,E.tZ)($.T,{fileType:null==e?void 0:e.metadata.fileType}):r?(0,E.tZ)("img",{src:r}):(0,E.tZ)($.f,{}),i]})}var tn=n(83101);function ti(t){let{onCollectionClick:e,collectionSummary:n,isScrolling:i}=t;return(0,E.tZ)(te,{collectionTile:tn.v_,coverFile:n.coverFile,onClick:()=>e(n.id),isScrolling:i,children:(0,E.BX)(tn.xV,{children:[(0,E.tZ)(N.Z,{children:n.name}),(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",children:(0,B.t)("photos_count",{count:n.fileCount})})]})})}let to=(t,e)=>Math.min(154*t.length+32,(null==e?void 0:e.height)-177)||0,ta=(0,q.Z)((t,e)=>({collectionRowList:t,onCollectionClick:e})),tr=F.memo(t=>{let{data:e,index:n,style:i,isScrolling:o}=t,{collectionRowList:a,onCollectionClick:r}=e,l=a[n];return(0,E.tZ)("div",{style:i,children:(0,E.tZ)(I.A0,{gap:"4px",padding:"16px",children:l.map(t=>(0,E.tZ)(ti,{isScrolling:o,onCollectionClick:r,collectionSummary:t},t.id))})})},J.wy);function tl(t){let{collectionSummaries:e,onCollectionClick:n}=t,i=(0,F.useRef)(!1),o=(0,F.useRef)(!1),[a,r]=(0,F.useState)([]),l=j();(0,F.useEffect)(()=>{if(!l.width||!e)return;let t=async()=>{if(i.current){o.current=!0;return}i.current=!0;let n=[],a=0,c=l.width>559?3:2;for(;a<e.length;){let t=[];for(let n=0;n<c&&a<e.length;n++)t.push(e[a++]);n.push(t)}r(n),i.current=!1,o.current&&(o.current=!1,setTimeout(t,0))};t()},[e,l]);let c=ta(a,n);return(0,E.tZ)(Q.Z,{sx:{"&&":{padding:0}},children:(0,E.tZ)(J.t7,{height:to(a,l),width:"100%",itemCount:a.length,itemSize:154,itemData:c,children:tr})})}var tc=n(92679),ts=n(35936),td=n(24862),tu=n(41311),tp=n(93710),th=n(33500),tZ=n(711),tf=n(97053),tg=n(5007),tm=n(22216);let tA=t=>{let{setSortBy:e,activeSortBy:n}=t;return t=>(0,E.tZ)(th.x,{onClick:()=>{e(t.sortBy)},endIcon:n===t.sortBy?(0,E.tZ)(tZ.Z,{}):(0,E.tZ)(tg.Z,{}),children:t.children})};function tE(t){let e=tA(t);return(0,E.BX)(tp.Z,{ariaControls:"collection-sort",triggerButtonIcon:(0,E.tZ)(tf.Z,{}),menuPaperProps:{sx:{backgroundColor:e=>t.nestedInDialog&&e.colors.background.elevated2}},triggerButtonProps:{sx:{background:e=>!t.disableBG&&e.colors.fill.faint}},children:[(0,E.tZ)(e,{sortBy:tm.AU.NAME,children:(0,B.t)("SORT_BY_NAME")}),(0,E.tZ)(e,{sortBy:tm.AU.CREATION_TIME_ASCENDING,children:(0,B.t)("SORT_BY_CREATION_TIME_ASCENDING")}),(0,E.tZ)(e,{sortBy:tm.AU.UPDATION_TIME_DESCENDING,children:(0,B.t)("SORT_BY_UPDATION_TIME_DESCENDING")})]})}function tC(t){let{onClose:e,collectionCount:n,collectionSortBy:i,setCollectionSortBy:o,isInHiddenSection:a}=t;return(0,E.tZ)(ts.Z,{children:(0,E.BX)(I.A0,{children:[(0,E.tZ)(I.G5,{mr:1.5,children:(0,E.BX)(td.Z,{children:[(0,E.tZ)(N.Z,{variant:"h3",children:a?(0,B.t)("ALL_HIDDEN_ALBUMS"):(0,B.t)("ALL_ALBUMS")}),(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",children:(0,B.t)("albums",{count:n})})]})}),(0,E.BX)(tu.Z,{direction:"row",spacing:1.5,children:[(0,E.tZ)(tE,{activeSortBy:i,setSortBy:o,nestedInDialog:!0}),(0,E.tZ)(I.Vd,{onClick:e,children:(0,E.tZ)(tc.Z,{})})]})]})})}let tv=F.forwardRef((t,e)=>(0,E.tZ)(W.Z,{direction:"up",ref:e,...t}));function tI(t){let{collectionSummaries:e,open:n,onClose:i,setActiveCollectionID:o,collectionListSortBy:a,setCollectionListSortBy:r,isInHiddenSection:l}=t,{isMobile:c}=(0,F.useContext)(U.AppContext);return(0,E.BX)(z,{position:"flex-end",TransitionComponent:tv,onClose:i,open:n,fullScreen:c,children:[(0,E.tZ)(tC,{isInHiddenSection:l,onClose:i,collectionCount:t.collectionSummaries.length,collectionSortBy:a,setCollectionSortBy:r}),(0,E.tZ)(K.Z,{}),(0,E.tZ)(tl,{collectionSummaries:e,onCollectionClick:t=>{o(t),i()}})]})}var tw=n(69743),ty=n(67997),tx=n(34506),tS=n(94536),tT=n(73906),tb=n(98614),t_=n(5155),tO=n(55071),tL=n(40795),tR=n(16414),tP=n(71583),tD=n(14680),tN=n(29754),tk=n(5381),tM=n(8981),tB=n(53787),tU=n(34730),tF=n(4729);let tH=t=>(0,E.BX)(tg.Z,{id:"eNi9tomYy271",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960","shape-rendering":"geometricPrecision","text-rendering":"geometricPrecision",...t,children:[(0,E.tZ)("defs",{children:(0,E.BX)("linearGradient",{id:"eNi9tomYy273-fill",x1:"0",y1:"0.5",x2:"1",y2:"0.5",spreadMethod:"pad",gradientUnits:"objectBoundingBox",gradientTransform:"translate(0 0)",children:[(0,E.tZ)("stop",{id:"eNi9tomYy273-fill-0",offset:"100%","stop-color":"#fff"}),(0,E.tZ)("stop",{id:"eNi9tomYy273-fill-1",offset:"100%","stop-color":"#fff"})]})}),(0,E.tZ)("path",{d:"M634,-448l86,77v60h-210v241l-30,30-30-30v-241h-210v-60l80-77v-332h-50v-60h414v60h-50v332Zm-313,77h312l-59-55v-354h-194v354l-59,55Zm156,0"}),(0,E.tZ)("rect",{width:"26.347306",height:"26.347306",rx:"0",ry:"0",transform:"matrix(29.14543 20.40785-1.147153 1.638304 147.37857-852.859017)",fill:"url(#eNi9tomYy273-fill)","stroke-width":"0"}),(0,E.tZ)("rect",{width:"65.868264",height:"8.383234",rx:"0",ry:"0",transform:"matrix(.961684 0.648664-.559193 0.829038 575.09991-562.860814)",fill:"#f8eeee","stroke-width":"0"}),(0,E.tZ)("rect",{width:"65.868264",height:"8.383234",rx:"0",ry:"0",transform:"matrix(.961684 0.648664-.559193 0.829038 322.549012-741.890754)",fill:"#fff","stroke-width":"0"}),(0,E.tZ)("rect",{width:"96",height:"96",rx:"0",ry:"0",transform:"translate(1379.418154-389.125449)",fill:"#d2dbed","stroke-width":"0"})]});function tX(t){let{isArchived:e,isPinned:n,isHidden:i,handleCollectionAction:o}=t;return(0,E.BX)(E.HY,{children:[(0,E.tZ)(th.x,{onClick:o(d.SHOW_RENAME_DIALOG,!1),startIcon:(0,E.tZ)(tN.Z,{}),children:(0,B.t)("RENAME_COLLECTION")}),(0,E.tZ)(th.x,{onClick:o(d.SHOW_SORT_ORDER_MENU,!1),startIcon:(0,E.tZ)(tf.Z,{}),children:(0,B.t)("SORT_BY")}),n?(0,E.tZ)(th.x,{onClick:o(d.UNPIN,!1),startIcon:(0,E.tZ)(tH,{}),children:(0,B.t)("UNPIN_ALBUM")}):(0,E.tZ)(th.x,{onClick:o(d.PIN,!1),startIcon:(0,E.tZ)(tk.Z,{}),children:(0,B.t)("PIN_ALBUM")}),!i&&(0,E.tZ)(E.HY,{children:e?(0,E.tZ)(th.x,{onClick:o(d.UNARCHIVE),startIcon:(0,E.tZ)(tB.Z,{}),children:(0,B.t)("UNARCHIVE_COLLECTION")}):(0,E.tZ)(th.x,{onClick:o(d.ARCHIVE),startIcon:(0,E.tZ)(tw.Z,{}),children:(0,B.t)("ARCHIVE_COLLECTION")})}),i?(0,E.tZ)(th.x,{onClick:o(d.UNHIDE,!1),startIcon:(0,E.tZ)(tF.Z,{}),children:(0,B.t)("UNHIDE_COLLECTION")}):(0,E.tZ)(th.x,{onClick:o(d.HIDE,!1),startIcon:(0,E.tZ)(tU.Z,{}),children:(0,B.t)("HIDE_COLLECTION")}),(0,E.tZ)(th.x,{startIcon:(0,E.tZ)(tD.Z,{}),onClick:o(d.CONFIRM_DELETE,!1),children:(0,B.t)("DELETE_COLLECTION")}),(0,E.tZ)(th.x,{onClick:o(d.SHOW_SHARE_DIALOG,!1),startIcon:(0,E.tZ)(tS.Z,{}),children:(0,B.t)("SHARE_COLLECTION")}),(0,E.tZ)(th.x,{startIcon:(0,E.tZ)(tM.Z,{}),onClick:o(d.SHOW_ALBUM_CAST_DIALOG,!1),children:(0,B.t)("CAST_ALBUM_TO_TV")})]})}tH.defaultProps={height:20,width:20};var tK=t=>{let{handleCollectionAction:e,collectionSortOrderMenuView:n,closeCollectionSortOrderMenu:i,overFlowMenuIconRef:o}=t;return(0,E.BX)(tp.l,{id:"collection-files-sort",anchorEl:o.current,open:n,onClose:i,MenuListProps:{disablePadding:!0,"aria-labelledby":"collection-files-sort"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,E.tZ)(th.x,{onClick:()=>{i(),e(d.UPDATE_COLLECTION_SORT_ORDER)({asc:!1})},children:(0,B.t)("NEWEST_FIRST")}),(0,E.tZ)(th.x,{onClick:()=>{i(),e(d.UPDATE_COLLECTION_SORT_ORDER)({asc:!0})},children:(0,B.t)("OLDEST_FIRST")})]})},tG=n(59109);function tW(t){let{handleCollectionAction:e,downloadOptionText:n=(0,B.t)("DOWNLOAD"),isDownloadInProgress:i}=t;return(0,E.tZ)(th.x,{startIcon:i?(0,E.tZ)(w.Z,{size:"20px",sx:{cursor:"not-allowed"}}):(0,E.tZ)(tG.Z,{}),onClick:e(d.DOWNLOAD,!1),children:n})}var tV=n(2672),tY=n(85801);function tz(t){let{handleCollectionAction:e,collectionSummaryType:n}=t;return(0,E.tZ)(tV.Z,{title:n===tm.j.favorites?(0,B.t)("DOWNLOAD_FAVORITES"):n===tm.j.uncategorized?(0,B.t)("DOWNLOAD_UNCATEGORIZED"):n===tm.j.hiddenItems?(0,B.t)("DOWNLOAD_HIDDEN_ITEMS"):(0,B.t)("DOWNLOAD_COLLECTION"),children:(0,E.tZ)(tY.Z,{onClick:e(d.DOWNLOAD,!1),children:(0,E.tZ)(tG.Z,{})})})}function tj(t){let{handleCollectionAction:e}=t;return(0,E.tZ)(tV.Z,{title:(0,B.t)("EMPTY_TRASH"),children:(0,E.tZ)(tY.Z,{onClick:e(d.CONFIRM_EMPTY_TRASH,!1),children:(0,E.tZ)(tD.Z,{})})})}function tQ(t){let{handleCollectionAction:e,collectionSummaryType:n}=t;return(0,E.tZ)(tV.Z,{title:n===tm.j.incomingShareViewer||n===tm.j.incomingShareCollaborator?(0,B.t)("SHARING_DETAILS"):n===tm.j.outgoingShare||n===tm.j.sharedOnlyViaLink?(0,B.t)("MODIFY_SHARING"):(0,B.t)("SHARE_COLLECTION"),children:(0,E.tZ)(tY.Z,{onClick:e(d.SHOW_SHARE_DIALOG,!1),children:(0,E.tZ)(tS.Z,{})})})}function tq(t){let{handleCollectionAction:e,collectionSummaryType:n,isDownloadInProgress:i}=t;return(0,E.BX)(I.A0,{sx:{gap:"16px"},children:[(0,tR.bw)(n)&&(0,E.tZ)(tj,{handleCollectionAction:e}),(0,tR.Ay)(n)&&(i?(0,E.tZ)(w.Z,{size:"20px",sx:{cursor:"not-allowed"}}):(0,E.tZ)(tz,{handleCollectionAction:e,collectionSummaryType:n})),(0,tR.tq)(n)&&(0,E.tZ)(tQ,{handleCollectionAction:e,collectionSummaryType:n})]})}var tJ=n(91131);function t$(t){let{isArchived:e,handleCollectionAction:n}=t;return(0,E.BX)(E.HY,{children:[e?(0,E.tZ)(th.x,{onClick:n(d.UNARCHIVE),startIcon:(0,E.tZ)(tB.Z,{}),children:(0,B.t)("UNARCHIVE_COLLECTION")}):(0,E.tZ)(th.x,{onClick:n(d.ARCHIVE),startIcon:(0,E.tZ)(tw.Z,{}),children:(0,B.t)("ARCHIVE_COLLECTION")}),(0,E.tZ)(th.x,{startIcon:(0,E.tZ)(tJ.Z,{}),onClick:n(d.CONFIRM_LEAVE_SHARED_ALBUM,!1),children:(0,B.t)("LEAVE_ALBUM")}),(0,E.tZ)(th.x,{startIcon:(0,E.tZ)(tM.Z,{}),onClick:n(d.SHOW_ALBUM_CAST_DIALOG,!1),children:(0,B.t)("CAST_ALBUM_TO_TV")})]})}function t0(t){let{handleCollectionAction:e}=t;return(0,E.tZ)(th.x,{color:"critical",startIcon:(0,E.tZ)(tD.Z,{}),onClick:e(d.CONFIRM_EMPTY_TRASH,!1),children:(0,B.t)("EMPTY_TRASH")})}(o=d||(d={}))[o.SHOW_RENAME_DIALOG=0]="SHOW_RENAME_DIALOG",o[o.RENAME=1]="RENAME",o[o.DOWNLOAD=2]="DOWNLOAD",o[o.ARCHIVE=3]="ARCHIVE",o[o.UNARCHIVE=4]="UNARCHIVE",o[o.CONFIRM_DELETE=5]="CONFIRM_DELETE",o[o.DELETE_WITH_FILES=6]="DELETE_WITH_FILES",o[o.DELETE_BUT_KEEP_FILES=7]="DELETE_BUT_KEEP_FILES",o[o.SHOW_SHARE_DIALOG=8]="SHOW_SHARE_DIALOG",o[o.CONFIRM_EMPTY_TRASH=9]="CONFIRM_EMPTY_TRASH",o[o.EMPTY_TRASH=10]="EMPTY_TRASH",o[o.CONFIRM_LEAVE_SHARED_ALBUM=11]="CONFIRM_LEAVE_SHARED_ALBUM",o[o.LEAVE_SHARED_ALBUM=12]="LEAVE_SHARED_ALBUM",o[o.SHOW_SORT_ORDER_MENU=13]="SHOW_SORT_ORDER_MENU",o[o.UPDATE_COLLECTION_SORT_ORDER=14]="UPDATE_COLLECTION_SORT_ORDER",o[o.PIN=15]="PIN",o[o.UNPIN=16]="UNPIN",o[o.HIDE=17]="HIDE",o[o.UNHIDE=18]="UNHIDE",o[o.SHOW_ALBUM_CAST_DIALOG=19]="SHOW_ALBUM_CAST_DIALOG";var t1=t=>{let{activeCollection:e,collectionSummaryType:n,setActiveCollectionID:i,setCollectionNamerAttributes:o,showCollectionShareModal:a,setFilesDownloadProgressAttributesCreator:r,isActiveCollectionDownloadInProgress:l,setShowAlbumCastDialog:c}=t,{startLoading:s,finishLoading:d,setDialogMessage:u}=(0,F.useContext)(U.AppContext),{syncWithRemote:p}=(0,F.useContext)(lM),h=(0,F.useRef)(null),[Z,f]=(0,F.useState)(!1),g=()=>{f(!0)},m=function(t){let e,n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];switch(t){case 0:e=O;break;case 1:e=C;break;case 2:e=b;break;case 3:e=S;break;case 4:e=T;break;case 5:e=L;break;case 6:e=w;break;case 7:e=y;break;case 8:e=a;break;case 9:e=R;break;case 10:e=_;break;case 11:e=P;break;case 12:e=x;break;case 13:e=g;break;case 14:e=D;break;case 15:e=N;break;case 16:e=k;break;case 17:e=M;break;case 18:e=H;break;case 19:e=A;break;default:v.ZP.error("invalid collection action ".concat(t))}return async function(){for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];try{n&&s(),await e(...o)}catch(e){v.ZP.error("collection action ".concat(t," failed"),e),u({title:(0,B.t)("ERROR"),content:(0,B.t)("UNKNOWN_ERROR"),close:{variant:"critical"}})}finally{p(!1,!0),n&&d()}}},A=()=>{c(!0)},C=async t=>{e.name!==t&&await t_.LU(e,t)},w=async()=>{await t_.P4(e.id,!1),i(tm.Ug)},y=async()=>{await t_.P4(e.id,!0),i(tm.Ug)},x=async()=>{await t_.jV(e.id),i(tm.Ug)},S=()=>{(0,tR.gf)(e,tL.Y.ARCHIVED)},T=()=>{(0,tR.gf)(e,tL.Y.VISIBLE)},b=()=>{if(!l()){if(n===tm.j.hiddenItems){let t=r(e.name,tm.zA,!0);(0,tR.gC)(t)}else{let t=r(e.name,e.id,(0,tR._K)(e));(0,tR.LP)(e.id,t)}}},_=async()=>{await tO.uo(),await tO.lM(),i(tm.Ug)},O=()=>{o({title:(0,B.t)("RENAME_COLLECTION"),buttonText:(0,B.t)("RENAME"),autoFilledName:e.name,callback:m(1)})},L=()=>{u({title:(0,B.t)("DELETE_COLLECTION_TITLE"),content:(0,E.tZ)(tb.cC,{i18nKey:"DELETE_COLLECTION_MESSAGE",components:{a:(0,E.tZ)(td.Z,{component:"span",color:"text.base"})}}),proceed:{text:(0,B.t)("DELETE_PHOTOS"),action:m(6),variant:"critical"},secondary:{text:(0,B.t)("KEEP_PHOTOS"),action:m(7),variant:"primary"},close:{text:(0,B.t)("CANCEL")}})},R=()=>u({title:(0,B.t)("EMPTY_TRASH_TITLE"),content:(0,B.t)("EMPTY_TRASH_MESSAGE"),proceed:{action:m(10),text:(0,B.t)("EMPTY_TRASH"),variant:"critical"},close:{text:(0,B.t)("CANCEL")}}),P=()=>{u({title:(0,B.t)("LEAVE_SHARED_ALBUM_TITLE"),content:(0,B.t)("LEAVE_SHARED_ALBUM_MESSAGE"),proceed:{text:(0,B.t)("LEAVE_SHARED_ALBUM"),action:m(12),variant:"critical"},close:{text:(0,B.t)("CANCEL")}})},D=async t=>{let{asc:n}=t;await (0,tR.Ql)(e,n)},N=async()=>{await (0,tR.pd)(e,1)},k=async()=>{await (0,tR.pd)(e,0)},M=async()=>{await (0,tR.gf)(e,tL.Y.HIDDEN),i(tm.Ug)},H=async()=>{await (0,tR.gf)(e,tL.Y.VISIBLE),i(tm.zA)};return(0,E.BX)(I.cD,{sx:{display:"inline-flex",gap:"16px"},children:[(0,E.tZ)(tq,{handleCollectionAction:m,collectionSummaryType:n,isDownloadInProgress:l()}),(0,E.tZ)(tp.Z,{ariaControls:"collection-options",triggerButtonIcon:(0,E.tZ)(tT.Z,{ref:h}),children:n===tm.j.trash?(0,E.tZ)(t0,{handleCollectionAction:m}):n===tm.j.favorites?(0,E.tZ)(tW,{isDownloadInProgress:l(),handleCollectionAction:m,downloadOptionText:(0,B.t)("DOWNLOAD_FAVORITES")}):n===tm.j.uncategorized?(0,E.tZ)(tW,{handleCollectionAction:m,downloadOptionText:(0,B.t)("DOWNLOAD_UNCATEGORIZED")}):n===tm.j.hiddenItems?(0,E.tZ)(tW,{handleCollectionAction:m,downloadOptionText:(0,B.t)("DOWNLOAD_HIDDEN_ITEMS")}):n===tm.j.incomingShareViewer||n===tm.j.incomingShareCollaborator?(0,E.tZ)(t$,{isArchived:(0,tP.v)(e),handleCollectionAction:m}):(0,E.tZ)(tX,{isArchived:(0,tP.v)(e),isHidden:(0,tR._K)(e),isPinned:(0,tP.ED)(e),handleCollectionAction:m})}),(0,E.tZ)(tK,{handleCollectionAction:m,overFlowMenuIconRef:h,collectionSortOrderMenuView:Z,closeCollectionSortOrderMenu:()=>{f(!1)}})]})},t2=n(82816);function t5(t){let{collectionSummary:e,...n}=t;if(!e)return(0,E.tZ)(E.HY,{});let{name:i,type:o,fileCount:a}=e;return(0,E.tZ)(tn.VZ,{children:(0,E.BX)(I.Gm,{children:[(0,E.tZ)(t2.a,{name:i,fileCount:a,endIcon:(0,E.tZ)(t=>{let{type:e}=t;switch(e){case tm.j.favorites:return(0,E.tZ)(ty.Z,{});case tm.j.archived:return(0,E.tZ)(tw.Z,{});case tm.j.incomingShareViewer:case tm.j.incomingShareCollaborator:case tm.j.outgoingShare:return(0,E.tZ)(tS.Z,{});case tm.j.sharedOnlyViaLink:return(0,E.tZ)(tx.Z,{});default:return(0,E.tZ)(E.HY,{})}},{type:o})}),(0,tR.T_)(o)&&(0,E.tZ)(t1,{...n,collectionSummaryType:o})]})})}(a=u||(u={}))[a.LEFT=-1]="LEFT",a[a.RIGHT=1]="RIGHT";var t4=n(63655),t3=n(79338),t9=n(9771);function t6(){let t=(0,A._)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2; //number of lines to show\n    line-clamp: 2;\n    -webkit-box-orient: vertical;\n"]);return t6=function(){return t},t}let t8=(0,D.ZP)(N.Z)(t6());function t7(t){let{text:e}=t;return(0,E.tZ)(tV.Z,{title:e,children:(0,E.tZ)(td.Z,{height:"2.1em",overflow:"hidden",children:(0,E.tZ)(t8,{variant:"small",sx:{wordBreak:"break-word"},children:e})})})}function et(t){let{collectionName:e}=t;return(0,E.tZ)(tn.Zh,{children:(0,E.tZ)(t7,{text:e})})}function ee(t){let{collectionType:e}=t;return(0,E.BX)(tn.Gf,{children:[e===tm.j.favorites&&(0,E.tZ)(ty.Z,{}),e===tm.j.archived&&(0,E.tZ)(t3.Z,{sx:t=>({color:t.colors.white.muted})}),e===tm.j.outgoingShare&&(0,E.tZ)(tS.Z,{}),(e===tm.j.incomingShareViewer||e===tm.j.incomingShareCollaborator)&&(0,E.tZ)(tS.Z,{}),e===tm.j.sharedOnlyViaLink&&(0,E.tZ)(tx.Z,{}),e===tm.j.pinned&&(0,E.tZ)(t9.Z,{})]})}var en=t=>{let{activeCollectionID:e,collectionSummary:n,onCollectionClick:i}=t;return(0,E.BX)(td.Z,{children:[(0,E.BX)(te,{collectionTile:tn.TV,coverFile:n.coverFile,onClick:()=>{i(n.id)},children:[(0,E.tZ)(et,{collectionName:n.name}),(0,E.tZ)(ee,{collectionType:n.type})]}),e===n.id&&(0,E.tZ)(tn.$Z,{})]})},ei=n(6738),eo=n(78781),ea=n(28165);function er(){let t=(0,A._)(["\n                  left: 0;\n                  text-align: right;\n                  transform: translate(-50%, 0%);\n              "]);return er=function(){return t},t}function el(){let t=(0,A._)(["\n                  right: 0;\n                  text-align: left;\n                  transform: translate(50%, 0%);\n              "]);return el=function(){return t},t}function ec(){let t=(0,A._)(["\n    position: absolute;\n    z-index: 2;\n    top: 7px;\n    height: 50px;\n    width: 50px;\n    border: none;\n    padding: 0;\n    margin: 0;\n\n    border-radius: 50%;\n    background-color: ",";\n    color: ",";\n\n    ","\n\n    & > svg {\n        ","\n        border-radius: 50%;\n        height: 30px;\n        width: 30px;\n    }\n"]);return ec=function(){return t},t}let es=(0,D.ZP)("button")(ec(),t=>{let{theme:e}=t;return e.colors.backdrop.muted},t=>{let{theme:e}=t;return e.colors.stroke.base},t=>t.direction===u.LEFT?(0,ea.iv)(er()):(0,ea.iv)(el()),t=>t.direction===u.LEFT&&"transform:rotate(180deg);");var ed=t=>{let{scrollDirection:e,...n}=t;return(0,E.tZ)(es,{direction:e,...n,children:(0,E.tZ)(eo.Z,{})})};let eu=(0,q.Z)((t,e,n)=>({collectionSummaries:t,activeCollectionID:e,onCollectionClick:n})),ep=F.memo(t=>{let{data:e,index:n,style:i,isScrolling:o}=t,{collectionSummaries:a,activeCollectionID:r,onCollectionClick:l}=e,c=a[n];return(0,E.tZ)("div",{style:i,children:(0,E.tZ)(en,{activeCollectionID:r,isScrolling:o,collectionSummary:c,onCollectionClick:l},c.id)})},J.wy),eh=(t,e)=>{var n;return"".concat(e.collectionSummaries[t].id,"-").concat(null===(n=e.collectionSummaries[t].coverFile)||void 0===n?void 0:n.id)};var eZ=t=>{let{activeCollectionID:e,setActiveCollectionID:n,collectionSummaries:i,showAllCollections:o,isInHiddenSection:a}=t,r=(0,F.useContext)(U.AppContext),{componentRef:l,scrollComponent:c,onFarLeft:s,onFarRight:d}=function(t){let{dependencies:e}=t,n=(0,F.useRef)(null),[i,o]=(0,F.useState)({}),a=()=>{if(!n.current)return;let{scrollLeft:t,scrollWidth:e,clientWidth:i}=n.current;o({scrollLeft:t,scrollWidth:e,clientWidth:i})};return(0,F.useEffect)(()=>{var t;if(n.current)return null===(t=n.current)||void 0===t||t.addEventListener("scroll",a),a(),()=>{var t;return null===(t=n.current)||void 0===t?void 0:t.removeEventListener("resize",a)}},[n.current]),(0,F.useEffect)(()=>{a()},[...e]),{hasScrollBar:i.scrollWidth>i.clientWidth,onFarLeft:0===i.scrollLeft,onFarRight:i.scrollLeft+i.clientWidth===i.scrollWidth,scrollComponent:t=>()=>{n.current.scrollBy(250*t,0)},componentRef:n}}({dependencies:[j(),i]}),p=F.useRef(null);(0,F.useEffect)(()=>{if(!p.current)return;let t=i.findIndex(t=>t.id===e);p.current.scrollToItem(t,"smart")},[e]);let h=eu(i,e,t=>{n(null!=t?t:tm.Ug)});return(0,E.BX)(tn.wM,{children:[(0,E.BX)(I.Gm,{mb:1,children:[(0,E.tZ)(N.Z,{children:a?(0,B.t)("HIDDEN_ALBUMS"):(0,B.t)("ALBUMS")}),r.isMobile&&(0,E.BX)(td.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,E.tZ)(tE,{setSortBy:t.setCollectionListSortBy,activeSortBy:t.collectionListSortBy,disableBG:!0}),(0,E.tZ)(tY.Z,{onClick:o,children:(0,E.tZ)(t4.Z,{})})]})]}),(0,E.BX)(td.Z,{display:"flex",alignItems:"flex-start",gap:2,children:[(0,E.BX)(tn.vw,{children:[!s&&(0,E.tZ)(ed,{scrollDirection:u.LEFT,onClick:c(u.LEFT)}),(0,E.tZ)(ei.ZP,{disableHeight:!0,children:t=>{let{width:e}=t;return(0,E.tZ)(J.t7,{ref:p,outerRef:l,itemData:h,layout:"horizontal",width:e,height:110,itemKey:eh,itemCount:i.length,itemSize:94,useIsScrolling:!0,children:ep})}}),!d&&(0,E.tZ)(ed,{scrollDirection:u.RIGHT,onClick:c(u.RIGHT)})]}),!r.isMobile&&(0,E.BX)(td.Z,{display:"flex",alignItems:"center",gap:1,height:"64px",children:[(0,E.tZ)(tE,{setSortBy:t.setCollectionListSortBy,activeSortBy:t.collectionListSortBy}),(0,E.tZ)(I.Vd,{onClick:o,children:(0,E.tZ)(t4.Z,{})})]})]})]})},ef=n(51475),eg=n(9378),em=n(76420),eA=n(48588),eE=n(93553),eC=n(28319),ev=n(17271),eI=n(46458),ew=n(40337),ey=n(51173),ex=n(92725),eS=n(60824);let eT=(0,D.ZP)("div")({position:"relative",display:"flex",alignItems:"center",marginLeft:-5}),eb=(0,D.ZP)("div")({position:"relative",display:"flex",alignItems:"center",marginLeft:8}),e_=(0,D.ZP)(ex.Z)({height:20,width:20,fontSize:10,color:"#fff"});var eO=t=>{let{sharees:e}=t,n=(null==e?void 0:e.length)>6,i=(null==e?void 0:e.length)-6;return(0,E.BX)(eb,{children:[null==e?void 0:e.slice(0,6).map(t=>(0,E.tZ)(eT,{children:(0,E.tZ)(eS.Z,{email:t.email,opacity:100},t.email)},t.email)),n&&(0,E.tZ)(eT,{children:(0,E.BX)(e_,{children:["+",i]})},"extra-count")]})};let eL=t=>{let e=(0,S.a3)(t),n="";switch(e.message){case S.sH.BAD_REQUEST:n=(0,B.t)("SHARING_BAD_REQUEST_ERROR");break;case S.sH.SUBSCRIPTION_NEEDED:n=(0,B.t)("SHARING_DISABLED_FOR_FREE_ACCOUNTS");break;case S.sH.NOT_FOUND:n=(0,B.t)("USER_DOES_NOT_EXIST");break;default:n="".concat((0,B.t)("UNKNOWN_ERROR")," ").concat(e.message)}return n};var eR=n(47290),eP=n(80982),eD=n(8204),eN=n(51464),ek=n(63602),eM=n(48601);function eB(t){var e;let{submitButtonProps:n}=t,{sx:i,...o}=null!=n?n:{},[a,r]=(0,F.useState)(!1),l=async(e,n)=>{let{setFieldError:i,resetForm:o}=n;try{r(!0),""!==e.inputValue?await t.callback({email:e.inputValue}):0!==e.selectedOptions.length&&await t.callback({emails:e.selectedOptions}),r(!1),t.onClose(),o()}catch(t){i("inputValue",null==t?void 0:t.message),r(!1)}},c=(0,F.useMemo)(()=>{switch(t.fieldType){case"text":return eM.Ry().shape({inputValue:eM.Z_().required((0,B.t)("REQUIRED"))});case"email":return eM.Ry().shape({inputValue:eM.Z_().email((0,B.t)("EMAIL_ERROR"))})}},[t.fieldType]),s=t=>{t("selectedOptions",[])};return(0,E.tZ)(ek.J9,{initialValues:{inputValue:null!==(e=t.initialValue)&&void 0!==e?e:"",selectedOptions:[]},onSubmit:l,validationSchema:c,validateOnChange:!1,validateOnBlur:!1,children:e=>{let{values:n,errors:r,handleChange:l,handleSubmit:c,setFieldValue:d}=e;return(0,E.BX)("form",{noValidate:!0,onSubmit:c,children:[(0,E.BX)(tu.Z,{spacing:"24px",py:"20px",px:"12px",children:[t.hiddenPreInput,(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("ADD_NEW_EMAIL")}),(0,E.tZ)(eN.Z,{sx:{marginTop:0},hiddenLabel:t.hiddenLabel,fullWidth:!0,type:t.fieldType,id:t.fieldType,onChange:l("inputValue"),onClick:()=>s(d),name:t.fieldType,...t.hiddenLabel?{placeholder:t.placeholder}:{label:t.placeholder},error:!!r.inputValue,helperText:r.inputValue,value:n.inputValue,disabled:a,autoFocus:!t.disableAutoFocus,autoComplete:t.autoComplete})]}),t.optionsList.length>0&&(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("OR_ADD_EXISTING")}),(0,E.tZ)(ew.G,{children:t.optionsList.map((e,i)=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>{n.selectedOptions.includes(e)?d("selectedOptions",n.selectedOptions.filter(t=>t!==e)):d("selectedOptions",[...n.selectedOptions,e])},label:e,startIcon:(0,E.tZ)(eS.Z,{email:e}),endIcon:n.selectedOptions.includes(e)?(0,E.tZ)(tZ.Z,{}):null},e),i!==t.optionsList.length-1&&(0,E.tZ)(eI.Z,{})]}))})]}),(0,E.tZ)(eP.Z,{sx:{position:"relative",top:r.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:t.caption}),t.hiddenPostInput]}),(0,E.tZ)(I.A0,{px:"8px",justifyContent:"center",flexWrap:t.blockButton?"wrap-reverse":"nowrap",children:(0,E.BX)(tu.Z,{direction:"column",px:"8px",width:"100%",children:[t.secondaryButtonAction&&(0,E.tZ)(eD.Z,{onClick:t.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:t.blockButton?.5:2,mb:t.blockButton?0:4,mr:t.blockButton?0:1,...i}},...o,children:(0,B.t)("CANCEL")}),(0,E.tZ)(eR.Z,{sx:{"&&&":{mt:2,...i}},buttonText:t.buttonText,loading:a,...o})]})})]})}})}function eU(t){let{open:e,collection:n,onClose:i,onRootClose:o,type:a}=t,{user:r,syncWithRemote:l,emailList:c}=(0,F.useContext)(lM),s=(0,F.useMemo)(()=>c.filter(t=>{var e;return!(null===(e=n.sharees)||void 0===e?void 0:e.find(e=>e.email===t))}),[c,n.sharees]),d=async t=>{var e,i;let{email:o,emails:c}=t;if(o){if(o===r.email)throw Error((0,B.t)("SHARE_WITH_SELF"));if(null==n?void 0:null===(e=n.sharees)||void 0===e?void 0:e.find(t=>t.email===o))throw Error((0,B.t)("ALREADY_SHARED",{email:o}));c=[o]}for(let t of c)if(!(t===r.email||(null==n?void 0:null===(i=n.sharees)||void 0===i?void 0:i.find(e=>e.email===t))))try{await (0,t_.XC)(n,t,a),await l(!1,!0)}catch(t){throw Error(eL(t))}},u=()=>{i(),o()};return(0,E.tZ)(E.HY,{children:(0,E.tZ)(ef.c,{anchor:"right",open:e,onClose:(t,e)=>{"backdropClick"===e?u():i()},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:i,title:a===em.M.VIEWER?(0,B.t)("ADD_VIEWERS"):(0,B.t)("ADD_COLLABORATORS"),onRootClose:u,caption:n.name}),(0,E.tZ)(eB,{onClose:i,callback:d,optionsList:s,placeholder:(0,B.t)("ENTER_EMAIL"),fieldType:"email",buttonText:a===em.M.VIEWER?(0,B.t)("ADD_VIEWERS"):(0,B.t)("ADD_COLLABORATORS"),submitButtonProps:{size:"large",sx:{mt:1,mb:2}},disableAutoFocus:!0})]})})})}var eF=n(99400),eH=n(35568),eX=n(16635),eK=n(38114);function eG(t){let{collection:e,open:n,onClose:i,onRootClose:o,selectedParticipant:a,collectionUnshare:r}=t,l=(0,F.useContext)(lM),c=(0,F.useContext)(U.AppContext),s=()=>{r(a.email),i()},d=t=>()=>{t!==a.role&&p(a.email,t)},u=async(t,n)=>{try{await (0,t_.XC)(e,t,n),a.role=n,await l.syncWithRemote(!1,!0)}catch(t){v.ZP.error(eL(t),t)}},p=(t,e)=>{let n,i;"VIEWER"===e?(n=(0,E.tZ)(tb.cC,{i18nKey:"CHANGE_PERMISSIONS_TO_VIEWER",values:{selectedEmail:"".concat(t)}}),i=(0,B.t)("CONVERT_TO_VIEWER")):"COLLABORATOR"===e&&(n=(0,B.t)("CHANGE_PERMISSIONS_TO_COLLABORATOR",{selectedEmail:t}),i=(0,B.t)("CONVERT_TO_COLLABORATOR")),c.setDialogMessage({title:(0,B.t)("CHANGE_PERMISSION"),content:n,close:{text:(0,B.t)("CANCEL")},proceed:{text:i,action:()=>{u(t,e)},variant:"critical"}})};return a?(0,E.tZ)(E.HY,{children:(0,E.tZ)(ef.c,{anchor:"right",open:n,onClose:(t,e)=>{"backdropClick"===e?o():i()},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:i,title:(0,B.t)("MANAGE"),onRootClose:o,caption:a.email}),(0,E.tZ)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:(0,E.BX)(tu.Z,{children:[(0,E.tZ)(N.Z,{color:"text.muted",variant:"small",padding:1,children:(0,B.t)("ADDED_AS")}),(0,E.BX)(ew.G,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:d("COLLABORATOR"),label:"Collaborator",startIcon:(0,E.tZ)(eH.Z,{}),endIcon:"COLLABORATOR"===a.role&&(0,E.tZ)(tZ.Z,{})}),(0,E.tZ)(eI.Z,{hasIcon:!0}),(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:d("VIEWER"),label:"Viewer",startIcon:(0,E.tZ)(eX.Z,{}),endIcon:"VIEWER"===a.role&&(0,E.tZ)(tZ.Z,{})})]}),(0,E.tZ)(N.Z,{color:"text.muted",variant:"small",padding:1,children:(0,B.t)("COLLABORATOR_RIGHTS")}),(0,E.BX)(tu.Z,{py:"30px",children:[(0,E.tZ)(N.Z,{color:"text.muted",variant:"small",padding:1,children:(0,B.t)("REMOVE_PARTICIPANT_HEAD")}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{color:"critical",fontWeight:"normal",onClick:()=>{c.setDialogMessage({title:(0,B.t)("REMOVE_PARTICIPANT"),content:(0,E.tZ)(tb.cC,{i18nKey:"REMOVE_PARTICIPANT_MESSAGE",values:{selectedEmail:"".concat(a.email)}}),close:{text:(0,B.t)("CANCEL")},proceed:{text:(0,B.t)("CONFIRM_REMOVE"),action:()=>{s()},variant:"critical"}})},label:"Remove",startIcon:(0,E.tZ)(eK.Z,{})})})]})]})})]})})}):(0,E.tZ)(E.HY,{})}function eW(t){var e,n,i,o,a;let{open:r,collection:l,onClose:c,onRootClose:s,peopleCount:d}=t,u=(0,F.useContext)(U.AppContext),p=(0,F.useContext)(lM),[h,Z]=(0,F.useState)(!1),[f,g]=(0,F.useState)(!1),m=()=>Z(!0),A=(0,F.useRef)(),C=(0,F.useRef)(),v=()=>{c(),s()},I=async t=>{try{u.startLoading(),await (0,t_.os)(l,t),await p.syncWithRemote(!1,!0)}finally{u.finishLoading()}},w=p.user.id===(null===(e=l.owner)||void 0===e?void 0:e.id)?p.user.email:null===(n=l.owner)||void 0===n?void 0:n.email,y=p.user.id===(null===(i=l.owner)||void 0===i?void 0:i.id),x=null===(o=l.sharees)||void 0===o?void 0:o.filter(t=>t.role===em.M.COLLABORATOR).map(t=>t.email),S=(null===(a=l.sharees)||void 0===a?void 0:a.filter(t=>t.role===em.M.VIEWER).map(t=>t.email))||[],T=t=>{C.current=l.sharees.find(e=>e.email===t),g(!0)};return(0,E.BX)(E.HY,{children:[(0,E.tZ)(ef.c,{anchor:"right",open:r,onClose:(t,e)=>{"backdropClick"===e?v():c()},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:c,title:l.name,onRootClose:v,caption:(0,B.t)("participants",{count:d})}),(0,E.BX)(tu.Z,{py:"20px",px:"12px",spacing:"24px",children:[(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("OWNER"),icon:(0,E.tZ)(eF.Z,{})}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>{},label:y?(0,B.t)("YOU"):w,startIcon:(0,E.tZ)(eS.Z,{email:w})})})]}),(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("COLLABORATORS"),icon:(0,E.tZ)(eH.Z,{})}),(0,E.BX)(ew.G,{children:[x.map(t=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>T(t),label:t,startIcon:(0,E.tZ)(eS.Z,{email:t}),endIcon:(0,E.tZ)(eC.Z,{})},t),(0,E.tZ)(eI.Z,{hasIcon:!0})]})),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(eE.Z,{}),onClick:()=>{A.current=em.M.COLLABORATOR,m()},label:(null==x?void 0:x.length)?(0,B.t)("ADD_MORE"):(0,B.t)("ADD_COLLABORATORS")})]})]}),(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("VIEWERS"),icon:(0,E.tZ)(eX.Z,{})}),(0,E.BX)(ew.G,{children:[S.map(t=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>T(t),label:t,startIcon:(0,E.tZ)(eS.Z,{email:t}),endIcon:(0,E.tZ)(eC.Z,{})},t),(0,E.tZ)(eI.Z,{hasIcon:!0})]})),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(eE.Z,{}),fontWeight:"bold",onClick:()=>{A.current=em.M.VIEWER,m()},label:(null==S?void 0:S.length)?(0,B.t)("ADD_MORE"):(0,B.t)("ADD_VIEWERS")})]})]})]})]})}),(0,E.tZ)(eG,{collectionUnshare:I,open:f,collection:l,onRootClose:s,onClose:()=>{g(!1)},selectedParticipant:C.current}),(0,E.tZ)(eU,{open:h,onClose:()=>Z(!1),onRootClose:s,collection:l,type:A.current})]})}function eV(t){var e,n,i;let{collection:o,onRootClose:a}=t,[r,l]=(0,F.useState)(!1),[c,s]=(0,F.useState)(!1),d=()=>l(!0),u=(0,F.useRef)();return(0,E.BX)(E.HY,{children:[(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("shared_with_people",{count:null!==(i=null===(e=o.sharees)||void 0===e?void 0:e.length)&&void 0!==i?i:0}),icon:(0,E.tZ)(ev.Z,{})}),(0,E.BX)(ew.G,{children:[o.sharees.length>0?(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",startIcon:(0,E.tZ)(eO,{sharees:o.sharees}),onClick:()=>s(!0),label:1===o.sharees.length?(0,B.t)(null===(n=o.sharees[0])||void 0===n?void 0:n.email):null,endIcon:(0,E.tZ)(eC.Z,{})}),(0,E.tZ)(eI.Z,{hasIcon:!0})]}):null,(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(eE.Z,{}),onClick:()=>{u.current=em.M.VIEWER,d()},label:(0,B.t)("ADD_VIEWERS")}),(0,E.tZ)(eI.Z,{hasIcon:!0}),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(eE.Z,{}),onClick:()=>{u.current=em.M.COLLABORATOR,d()},label:(0,B.t)("ADD_COLLABORATORS")})]})]}),(0,E.tZ)(eU,{open:r,onClose:()=>l(!1),onRootClose:a,collection:o,type:u.current}),(0,E.tZ)(eW,{peopleCount:o.sharees.length,open:c,onClose:()=>s(!1),onRootClose:a,collection:o})]})}var eY=n(41036),ez=n(99666);function ej(t){let{collection:e,setPublicShareProp:n,setCopyLinkModalView:i}=t,o=(0,F.useContext)(lM),[a,r]=(0,F.useState)(null),l=async()=>{try{r(null),o.setBlockingLoad(!0);let t=await (0,t_.Q8)(e);n(t),i(!0),o.syncWithRemote(!1,!0)}catch(t){r(eL(t))}finally{o.setBlockingLoad(!1)}},c=async()=>{try{r(null),o.setBlockingLoad(!0);let t=await (0,t_.Q8)(e);await (0,t_.lb)({collectionID:e.id,enableCollect:!0}),n(t),i(!0),o.syncWithRemote(!1,!0)}catch(t){r(eL(t))}finally{o.setBlockingLoad(!1)}};return(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("LINK_SHARE_TITLE"),icon:(0,E.tZ)(ez.Z,{})}),(0,E.BX)(ew.G,{children:[(0,E.tZ)(eA.v,{label:(0,B.t)("CREATE_PUBLIC_SHARING"),startIcon:(0,E.tZ)(tx.Z,{}),onClick:l}),(0,E.tZ)(eI.Z,{hasIcon:!0}),(0,E.tZ)(eA.v,{label:(0,B.t)("COLLECT_PHOTOS"),startIcon:(0,E.tZ)(eY.Z,{}),onClick:c})]}),a&&(0,E.tZ)(N.Z,{textAlign:"center",variant:"small",sx:{color:t=>t.colors.danger.A700,mt:.5},children:a})]})}var eQ=n(70387),eq=n(42713),eJ=n(5971);function e$(t){let{open:e,onClose:n,handleCancel:i,copyToClipboardHelper:o}=t;return(0,E.BX)(eQ.Z,{open:e,onClose:n,disablePortal:!0,BackdropProps:{sx:{position:"absolute"}},sx:{position:"absolute"},PaperProps:{sx:{p:1}},children:[(0,E.tZ)(Q.Z,{children:(0,E.BX)(I.wx,{children:[(0,E.tZ)(N.Z,{fontWeight:"bold",children:(0,B.t)("PUBLIC_LINK_CREATED")}),(0,E.tZ)(td.Z,{pt:2,children:(0,E.tZ)(eq.Z,{sx:{fontSize:"48px"}})})]})}),(0,E.BX)(eJ.Z,{children:[(0,E.tZ)(eD.Z,{onClick:i,color:"secondary",size:"large",children:(0,B.t)("DONE")}),(0,E.tZ)(eD.Z,{onClick:o,size:"large",color:"primary",autoFocus:!0,children:(0,B.t)("COPY_LINK")})]})]})}var e0=n(61723),e1=n(72458),e2=n(80162),e5=n(46263);function e4(t){let{collection:e,publicShareProp:n,updatePublicShareURLHelper:i,onRootClose:o}=t,a=async t=>i({collectionID:e.id,deviceLimit:t}),[r,l]=(0,F.useState)(!1),c=(0,F.useMemo)(()=>(0,tR.XA)(),[]),s=()=>l(!1),d=t=>async()=>{await a(t),l(!1)};return(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{label:(0,B.t)("LINK_DEVICE_LIMIT"),variant:"captioned",subText:0===n.deviceLimit?(0,B.t)("NO_DEVICE_LIMIT"):n.deviceLimit.toString(),onClick:()=>l(!0),endIcon:(0,E.tZ)(eC.Z,{})}),(0,E.tZ)(ef.c,{anchor:"right",open:r,onClose:(t,e)=>{"backdropClick"===e?o():s()},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:s,title:(0,B.t)("LINK_DEVICE_LIMIT"),onRootClose:o}),(0,E.tZ)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:(0,E.tZ)(ew.G,{children:c.map((t,e)=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:d(t.value),label:t.label},t.label),e!==c.length-1&&(0,E.tZ)(eI.Z,{})]}))})})]})})]})}function e3(t){var e;let{publicShareProp:n,updatePublicShareURLHelper:i,collection:o}=t,a=(0,F.useContext)(U.AppContext),r=()=>{a.setDialogMessage({title:(0,B.t)("DISABLE_FILE_DOWNLOAD"),content:(0,E.tZ)(tb.cC,{i18nKey:"DISABLE_FILE_DOWNLOAD_MESSAGE"}),close:{text:(0,B.t)("CANCEL")},proceed:{text:(0,B.t)("DISABLE"),action:()=>i({collectionID:o.id,enableDownload:!1}),variant:"critical"}})};return(0,E.tZ)(eA.v,{checked:null===(e=null==n?void 0:n.enableDownload)||void 0===e||e,onClick:()=>{n.enableDownload?r():i({collectionID:o.id,enableDownload:!0})},variant:"toggle",label:(0,B.t)("FILE_DOWNLOAD")})}var e9=n(62594);function e6(t){let{publicShareProp:e,collection:n,updatePublicShareURLHelper:i,onRootClose:o}=t,a=async t=>i({collectionID:n.id,validTill:t}),[r,l]=(0,F.useState)(!1),c=(0,F.useMemo)(()=>(0,tR.Jk)(),[]),s=()=>l(!1),d=t=>async()=>{await a(t),e.validTill=t,l(!1)};return(0,E.BX)(E.HY,{children:[(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{onClick:()=>l(!0),endIcon:(0,E.tZ)(eC.Z,{}),variant:"captioned",label:(0,B.t)("LINK_EXPIRY"),color:no(null==e?void 0:e.validTill)?"critical":"primary",subText:no(null==e?void 0:e.validTill)?(0,B.t)("LINK_EXPIRED"):(null==e?void 0:e.validTill)?(0,e9.o0)((null==e?void 0:e.validTill)/1e3):(0,B.t)("NEVER")})}),(0,E.tZ)(ef.c,{anchor:"right",open:r,onClose:(t,e)=>{"backdropClick"===e?o():s()},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:s,title:(0,B.t)("LINK_EXPIRY"),onRootClose:o}),(0,E.tZ)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:(0,E.tZ)(ew.G,{children:c.map((t,e)=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:d(t.value()),label:t.label},t.value()),e!==c.length-1&&(0,E.tZ)(eI.Z,{})]}))})})]})})]})}var e8=n(69669),e7=n(88659);function nt(t){let{open:e,onClose:n,collection:i,publicShareProp:o,updatePublicShareURLHelper:a,setChangePasswordView:r}=t,l=async(t,e)=>{t&&t.trim().length>=1?(await c(t),r(!1),o.passwordEnabled=!0):e("can not be empty")},c=async t=>{let e=await e7.Z.getInstance(),n=await e.generateSaltToDeriveKey(),o=await e.deriveInteractiveKey(t,n);return a({collectionID:i.id,passHash:o.key,nonce:n,opsLimit:o.opsLimit,memLimit:o.memLimit})};return(0,E.tZ)(G.Z,{open:e,onClose:n,disablePortal:!0,BackdropProps:{sx:{position:"absolute"}},sx:{position:"absolute"},PaperProps:{sx:{p:1}},children:(0,E.BX)(tu.Z,{spacing:3,p:1.5,children:[(0,E.tZ)(N.Z,{variant:"h3",px:1,py:.5,fontWeight:"bold",children:(0,B.t)("PASSWORD_LOCK")}),(0,E.tZ)(e8.Z,{callback:l,placeholder:(0,B.t)("password"),buttonText:(0,B.t)("LOCK"),fieldType:"password",secondaryButtonAction:n,submitButtonProps:{sx:{mt:1,mb:2}}})]})})}function ne(t){let{collection:e,publicShareProp:n,updatePublicShareURLHelper:i}=t,o=(0,F.useContext)(U.AppContext),[a,r]=(0,F.useState)(!1),l=async()=>{n.passwordEnabled?await c():r(!0)},c=async()=>{o.setDialogMessage({title:(0,B.t)("DISABLE_PASSWORD"),content:(0,B.t)("DISABLE_PASSWORD_MESSAGE"),close:{text:(0,B.t)("CANCEL")},proceed:{text:(0,B.t)("DISABLE"),action:()=>i({collectionID:e.id,disablePassword:!0}),variant:"critical"}})};return(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{label:(0,B.t)("link_password_lock"),onClick:l,checked:!!(null==n?void 0:n.passwordEnabled),variant:"toggle"}),(0,E.tZ)(nt,{open:a,onClose:()=>r(!1),collection:e,publicShareProp:n,updatePublicShareURLHelper:i,setChangePasswordView:r})]})}function nn(t){let{publicShareProp:e,updatePublicShareURLHelper:n,collection:i}=t;return(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{onClick:()=>{n({collectionID:i.id,enableCollect:!e.enableCollect})},variant:"toggle",checked:null==e?void 0:e.enableCollect,label:(0,B.t)("PUBLIC_COLLECT")})}),(0,E.tZ)(ey.Z,{title:(0,B.t)("PUBLIC_COLLECT_SUBTEXT")})]})}function ni(t){let{publicShareProp:e,collection:n,setPublicShareProp:i,open:o,onClose:a,onRootClose:r,publicShareUrl:l}=t,c=(0,F.useContext)(lM),[s,d]=(0,F.useState)(null),u=async t=>{try{c.setBlockingLoad(!0);let e=await (0,t_.lb)(t);i(e),c.syncWithRemote(!1,!0)}catch(t){d(eL(t))}finally{c.setBlockingLoad(!1)}},p=async()=>{try{c.setBlockingLoad(!0),await (0,t_.a0)(n),i(null),c.syncWithRemote(!1,!0),a()}catch(t){d(eL(t))}finally{c.setBlockingLoad(!1)}};return(0,E.tZ)(E.HY,{children:(0,E.tZ)(ef.c,{anchor:"right",open:o,onClose:(t,e)=>{"backdropClick"===e?r():a()},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:a,title:(0,B.t)("SHARE_COLLECTION"),onRootClose:r}),(0,E.BX)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,E.BX)(tu.Z,{spacing:3,children:[(0,E.tZ)(nn,{collection:n,publicShareProp:e,updatePublicShareURLHelper:u}),(0,E.tZ)(e6,{collection:n,publicShareProp:e,updatePublicShareURLHelper:u,onRootClose:r}),(0,E.BX)(ew.G,{children:[(0,E.tZ)(e4,{collection:n,publicShareProp:e,updatePublicShareURLHelper:u,onRootClose:r}),(0,E.tZ)(eI.Z,{}),(0,E.tZ)(e3,{collection:n,publicShareProp:e,updatePublicShareURLHelper:u}),(0,E.tZ)(eI.Z,{}),(0,E.tZ)(ne,{collection:n,publicShareProp:e,updatePublicShareURLHelper:u})]}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(e2.Z,{}),onClick:()=>{navigator.clipboard.writeText(l)},label:(0,B.t)("COPY_LINK")})}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{color:"critical",startIcon:(0,E.tZ)(e5.Z,{}),onClick:p,label:(0,B.t)("REMOVE_LINK")})})]}),s&&(0,E.tZ)(N.Z,{textAlign:"center",variant:"small",sx:{color:t=>t.colors.danger.A700,mt:.5},children:s})]})]})})})}let no=t=>t&&t<1e3*Date.now();function na(t){let{publicShareProp:e,setPublicShareProp:n,collection:i,onRootClose:o,publicShareUrl:a,copyToClipboardHelper:r}=t,[l,c]=(0,F.useState)(!1),s=()=>c(!0);return(0,E.BX)(E.HY,{children:[(0,E.BX)(tu.Z,{children:[(0,E.BX)(N.Z,{color:"text.muted",variant:"small",padding:1,children:[(0,E.tZ)(ez.Z,{style:{fontSize:17,marginRight:8}}),(0,B.t)("PUBLIC_LINK_ENABLED")]}),(0,E.BX)(ew.G,{children:[no(e.validTill)?(0,E.tZ)(eA.v,{disabled:!0,startIcon:(0,E.tZ)(e1.Z,{}),color:"critical",onClick:s,label:(0,B.t)("LINK_EXPIRED")}):(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(e0.Z,{}),onClick:r,disabled:no(e.validTill),label:(0,B.t)("COPY_LINK")}),(0,E.tZ)(eI.Z,{hasIcon:!0}),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(tx.Z,{}),endIcon:(0,E.tZ)(eC.Z,{}),onClick:s,label:(0,B.t)("MANAGE_LINK")})]})]}),(0,E.tZ)(ni,{open:l,onClose:()=>c(!1),onRootClose:o,publicShareProp:e,collection:i,setPublicShareProp:n,publicShareUrl:a})]})}function nr(t){let{collection:e,onRootClose:n}=t,[i,o]=(0,F.useState)(null),[a,r]=(0,F.useState)(null),[l,c]=(0,F.useState)(!1);(0,F.useEffect)(()=>{var t;(null===(t=e.publicURLs)||void 0===t?void 0:t.length)&&r(e.publicURLs[0])},[e]),(0,F.useEffect)(()=>{a?o((0,tR.mG)(a.url,e.key)):o(null)},[a]);let s=()=>{navigator.clipboard.writeText(i),d()},d=()=>{c(!1)};return(0,E.BX)(E.HY,{children:[a?(0,E.tZ)(na,{publicShareProp:a,setPublicShareProp:r,collection:e,publicShareUrl:i,onRootClose:n,copyToClipboardHelper:s}):(0,E.tZ)(ej,{setPublicShareProp:r,collection:e,setCopyLinkModalView:c}),(0,E.tZ)(e$,{open:l,onClose:d,handleCancel:d,copyToClipboardHelper:s})]})}function nl(t){var e,n,i,o,a,r,l;let{collection:c,type:s}=t,d=(0,F.useContext)(lM),u=d.user.id===(null===(e=c.owner)||void 0===e?void 0:e.id)?null===(n=d.user)||void 0===n?void 0:n.email:null===(i=c.owner)||void 0===i?void 0:i.email,p=null===(o=c.sharees)||void 0===o?void 0:o.filter(t=>t.role===em.M.COLLABORATOR).map(t=>t.email),h=(null===(a=c.sharees)||void 0===a?void 0:a.filter(t=>t.role===em.M.VIEWER).map(t=>t.email))||[],Z=(null===(r=d.user)||void 0===r?void 0:r.id)===(null===(l=c.owner)||void 0===l?void 0:l.id),f=t=>{var e;return t===(null===(e=d.user)||void 0===e?void 0:e.email)};return(0,E.BX)(E.HY,{children:[(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("OWNER"),icon:(0,E.tZ)(eF.Z,{})}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>{},label:Z?(0,B.t)("YOU"):u,startIcon:(0,E.tZ)(eS.Z,{email:u})})})]}),s===tm.j.incomingShareCollaborator&&(null==p?void 0:p.length)>0&&(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("COLLABORATORS"),icon:(0,E.tZ)(eH.Z,{})}),(0,E.tZ)(ew.G,{children:p.map((t,e)=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>{},label:f(t)?(0,B.t)("YOU"):t,startIcon:(0,E.tZ)(eS.Z,{email:t})},t),e!==p.length-1&&(0,E.tZ)(eI.Z,{})]}))})]}),(null==h?void 0:h.length)>0&&(0,E.BX)(tu.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("VIEWERS"),icon:(0,E.tZ)(eX.Z,{})}),(0,E.tZ)(ew.G,{children:h.map((t,e)=>(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{fontWeight:"normal",onClick:()=>{},label:f(t)?(0,B.t)("YOU"):t,startIcon:(0,E.tZ)(eS.Z,{email:t})},t),e!==h.length-1&&(0,E.tZ)(eI.Z,{})]}))})]})]})}var nc=function(t){let{collectionSummary:e,...n}=t,i=()=>{n.onClose()};if(!n.collection||!e)return(0,E.tZ)(E.HY,{});let{type:o}=e;return(0,E.tZ)(ef.c,{anchor:"right",open:n.open,onClose:(t,e)=>{"backdropClick"===e?i():n.onClose()},slotProps:{backdrop:{sx:{"&&&":{backgroundColor:"transparent"}}}},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:n.onClose,title:o===tm.j.incomingShareCollaborator||o===tm.j.incomingShareViewer?(0,B.t)("SHARING_DETAILS"):(0,B.t)("SHARE_COLLECTION"),onRootClose:i,caption:n.collection.name}),(0,E.tZ)(tu.Z,{py:"20px",px:"8px",gap:"24px",children:o===tm.j.incomingShareCollaborator||o===tm.j.incomingShareViewer?(0,E.tZ)(nl,{collection:n.collection,type:o}):(0,E.BX)(E.HY,{children:[(0,E.tZ)(eV,{collection:n.collection,onRootClose:i}),(0,E.tZ)(nr,{collection:n.collection,onRootClose:i})]})})]})})},ns=n(93850),nd=n(28171),nu=n(44973),np=n(39925),nh=n.n(np);async function nZ(t,e){await nh().ready;let n=await nf(await nA(t),await nA(e));return{encryptedData:await nE(n.encryptedData),key:await nE(n.key),nonce:await nE(n.nonce)}}async function nf(t,e){await nh().ready;let n=nh().randombytes_buf(nh().crypto_secretbox_NONCEBYTES);return{encryptedData:nh().crypto_secretbox_easy(t,n,e),key:e,nonce:n}}async function ng(){return await nh().ready,await nE(nh().crypto_kdf_keygen())}async function nm(t,e){return await nh().ready,await nE(nh().crypto_box_seal(await nA(t),await nA(e)))}async function nA(t){return await nh().ready,nh().from_base64(t,nh().base64_variants.ORIGINAL)}async function nE(t){return await nh().ready,nh().to_base64(t,nh().base64_variants.ORIGINAL)}var nC=n(73873),nv=n(95525);class nI{async getCastData(t){let e;try{e=await nC.Z.get("".concat((0,nv.O3)(),"/cast/cast-data/").concat(t))}catch(t){throw v.ZP.error("failed to getCastData",t),t}return e.data.encCastData}async revokeAllTokens(){try{let t=(0,L.LP)();await nC.Z.delete((0,nv.O3)()+"/cast/revoke-all-tokens/",void 0,void 0,{"X-Auth-Token":t})}catch(t){v.ZP.error("removeAllTokens failed",t)}}async getPublicKey(t){let e;try{let n=(0,L.LP)();e=await nC.Z.get("".concat((0,nv.O3)(),"/cast/device-info/").concat(t),void 0,{"X-Auth-Token":n})}catch(t){if(t instanceof S.MS&&404===t.httpStatusCode)return"";throw v.ZP.error("failed to getPublicKey",t),t}return e.data.publicKey}async registerDevice(t){return(await nC.Z.post((0,nv.O3)()+"/cast/device-info/",{publicKey:t})).data.deviceCode}async publishCastPayload(t,e,n,i){let o=(0,L.LP)();await nC.Z.post((0,nv.O3)()+"/cast/cast-data/",{deviceCode:"".concat(t),encPayload:e,collectionID:n,castToken:i},void 0,{"X-Auth-Token":o})}constructor(){}}var nw=new nI,ny=n(23119),nx=n(6364);let nS=(i=null,()=>(null===i&&(i=new Promise(t=>{let e=document.createElement("script");e.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",window.__onGCastApiAvailable=e=>{e&&(cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:"F5BCEC64",autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),t({chrome,cast}))},document.body.appendChild(e)})),i));function nT(t){let{show:e,onHide:n,currentCollection:i}=t,[o,a]=(0,F.useState)("choose"),[r,l]=(0,F.useState)(!1);(0,F.useEffect)(()=>{nw.revokeAllTokens(),l(!!window.chrome)},[]);let c=async(t,e)=>{try{await s(t.trim()),n()}catch(n){let t;e("TV_NOT_FOUND"===n.message?(0,B.t)("TV_NOT_FOUND"):(0,B.t)("UNKNOWN_ERROR"))}},s=async t=>{let e=await nw.getPublicKey(t);if(!e)throw Error("TV_NOT_FOUND");let n=(0,nx.Z)(),o=JSON.stringify({castToken:n,collectionID:i.id,collectionKey:i.key}),a=await nm(btoa(o),e);await nw.publishCastPayload(t,a,i.id,n)};return(0,F.useEffect)(()=>{"auto"===o&&nS().then(async t=>{let{cast:e}=t,o=await e.framework.CastContext.getInstance();try{await o.requestSession()}catch(t){a("auto-cast-error"),v.ZP.error("Error requesting session",t);return}let r=o.getCurrentSession();r.addMessageListener("urn:x-cast:pair-request",(t,e)=>{let i=JSON.parse(e).code;i&&s(i).then(()=>{a("choose"),n()}).catch(t=>{a("auto-cast-error"),v.ZP.error("Error casting to TV",t)})});let l=i.id;r.sendMessage("urn:x-cast:pair-request",{collectionID:l}).then(()=>{v.ZP.debug(()=>"Message sent successfully")}).catch(t=>{v.ZP.error("Error sending message",t)})})},[o]),(0,F.useEffect)(()=>{e&&nw.revokeAllTokens()},[e]),(0,E.BX)(k.Z,{sx:{zIndex:1600},open:e,onClose:n,attributes:{title:(0,B.t)("CAST_ALBUM_TO_TV")},children:["choose"===o&&(0,E.BX)(E.HY,{children:[r&&(0,E.BX)(E.HY,{children:[(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("AUTO_CAST_PAIR_DESC")}),(0,E.tZ)(nu.Z,{style:{marginBottom:"1rem"},onClick:()=>{a("auto")},children:(0,B.t)("AUTO_CAST_PAIR")})]}),(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("PAIR_WITH_PIN_DESC")}),(0,E.tZ)(nu.Z,{onClick:()=>{a("pin")},children:(0,B.t)("PAIR_WITH_PIN")})]}),"auto"===o&&(0,E.BX)(I.wx,{gap:"1rem",children:[(0,E.tZ)(w.Z,{}),(0,E.tZ)(N.Z,{children:(0,B.t)("CHOOSE_DEVICE_FROM_BROWSER")}),(0,E.tZ)(nu.Z,{variant:"text",onClick:()=>{a("choose")},children:(0,B.t)("GO_BACK")})]}),"auto-cast-error"===o&&(0,E.BX)(I.wx,{gap:"1rem",children:[(0,E.tZ)(N.Z,{children:(0,B.t)("CAST_AUTO_PAIR_FAILED")}),(0,E.tZ)(nu.Z,{variant:"text",onClick:()=>{a("choose")},children:(0,B.t)("GO_BACK")})]}),"pin"===o&&(0,E.BX)(E.HY,{children:[(0,E.tZ)(N.Z,{children:(0,E.tZ)(tb.cC,{i18nKey:"VISIT_CAST_ENTE_IO",components:{a:(0,E.tZ)(ny.Z,{target:"_blank",href:"https://cast.ente.io"})},values:{url:"cast.ente.io"}})}),(0,E.tZ)(N.Z,{children:(0,B.t)("ENTER_CAST_PIN_CODE")}),(0,E.tZ)(e8.Z,{callback:c,fieldType:"text",realLabel:"Code",realPlaceholder:"123456",buttonText:(0,B.t)("PAIR_DEVICE_TO_TV"),submitButtonProps:{sx:{mt:1,mb:2}}}),(0,E.tZ)(nu.Z,{variant:"text",onClick:()=>{a("choose")},children:(0,B.t)("GO_BACK")})]})]})}function nb(t){let{activeCollection:e,isInSearchMode:n,isInHiddenSection:i,activeCollectionID:o,setActiveCollectionID:a,collectionSummaries:r,hiddenCollectionSummaries:l,setCollectionNamerAttributes:c,setPhotoListHeader:s,filesDownloadProgressAttributesList:d,setFilesDownloadProgressAttributesCreator:u}=t,[p,h]=(0,F.useState)(!1),[Z,f]=(0,F.useState)(!1),[g,m]=(0,F.useState)(!1),[A,C]=(0,X.T)(O.Pd.COLLECTION_SORT_BY,tm.AU.UPDATION_TIME_DESCENDING),v=(0,F.useMemo)(()=>i?l:r,[i,l,r]),I=(0,F.useMemo)(()=>n||!(0,tR.Hl)(v)&&o===tm.Ug,[n,v,o]),w=(0,F.useMemo)(()=>(0,t_.pF)([...v.values()],A),[A,v]),y=(0,F.useCallback)(()=>{let t=d.find(t=>t.collectionID===o);return t&&!(0,nd.z7)(t)&&!(0,nd.ZN)(t)},[o,d]);return((0,F.useEffect)(()=>{n||s({item:(0,E.tZ)(t5,{collectionSummary:v.get(o),activeCollection:e,setCollectionNamerAttributes:c,showCollectionShareModal:()=>f(!0),setFilesDownloadProgressAttributesCreator:u,isActiveCollectionDownloadInProgress:y,setActiveCollectionID:a,setShowAlbumCastDialog:m}),itemType:ns.Z.HEADER,height:68})},[v,o,n,y]),I)?(0,E.tZ)(E.HY,{}):(0,E.BX)(E.HY,{children:[(0,E.tZ)(eZ,{isInHiddenSection:i,activeCollectionID:o,setActiveCollectionID:a,collectionSummaries:w.filter(t=>(0,tR.Nf)(t.type)),showAllCollections:()=>h(!0),setCollectionListSortBy:C,collectionListSortBy:A}),(0,E.tZ)(tI,{open:p,onClose:()=>h(!1),collectionSummaries:w.filter(t=>!(0,tR.K7)(t.type)),setActiveCollectionID:a,setCollectionListSortBy:C,collectionListSortBy:A,isInHiddenSection:i}),(0,E.tZ)(nc,{collectionSummary:v.get(o),open:Z,onClose:()=>f(!1),collection:e}),(0,E.tZ)(nT,{currentCollection:e,show:g,onHide:()=>m(!1)})]})}function n_(t){let{attributes:e,...n}=t;if(!e)return(0,E.tZ)(E.HY,{});let i=async(t,i)=>{try{e.callback(t),n.onHide()}catch(t){i((0,B.t)("UNKNOWN_ERROR"))}};return(0,E.tZ)(k.Z,{open:n.show,onClose:n.onHide,attributes:{title:e.title},children:(0,E.tZ)(e8.Z,{callback:i,fieldType:"text",buttonText:e.buttonText,placeholder:(0,B.t)("ENTER_ALBUM_NAME"),initialValue:e.autoFilledName,submitButtonProps:{sx:{mt:1,mb:2}},secondaryButtonAction:n.onHide})})}(p||(p={})).TV_NOT_FOUND="TV_NOT_FOUND";var nO=n(11460),nL=n(67335);function nR(){let t=(0,A._)(["\n    display: flex;\n    font-size: 42px;\n"]);return nR=function(){return t},t}let nP=(0,D.ZP)(I.aV)(nR());function nD(t){let{showNextModal:e}=t;return(0,E.BX)(te,{collectionTile:tn.v_,onClick:()=>e(),coverFile:null,children:[(0,E.tZ)(tn.xV,{children:(0,B.t)("CREATE_COLLECTION")}),(0,E.tZ)(nP,{children:(0,E.tZ)(I.Tn,{children:"+"})})]})}function nN(t){let{onCollectionClick:e,collectionSummary:n}=t;return(0,E.tZ)(te,{collectionTile:tn.v_,coverFile:n.coverFile,onClick:()=>e(n.id),children:(0,E.tZ)(tn.xV,{children:(0,E.tZ)(N.Z,{children:n.name})})})}var nk=function(t){let{attributes:e,collectionSummaries:n,collections:i,...o}=t,a=(0,F.useContext)(U.AppContext),[r,l]=(0,F.useState)([]);if((0,F.useEffect)(()=>{e&&o.open&&(async()=>{let t=[...n.values()].filter(t=>{let{id:n,type:i}=t;return n!==e.fromCollection&&(e.intent===nL.r.add?(0,tR.E5)(i):e.intent===nL.r.upload?(0,tR.G0)(i)||i===tm.j.uncategorized:e.intent===nL.r.restore?(0,tR.G0)(i)||i===tm.j.uncategorized:(0,tR.G0)(i))}).sort((t,e)=>t.name.localeCompare(e.name)).sort((t,e)=>tm.BY.get(t.type)-tm.BY.get(e.type));0===t.length&&(o.onClose(),e.showNextModal()),l(t)})()},[n,e,o.open]),!(null==r?void 0:r.length))return(0,E.tZ)(E.HY,{});let c=async t=>{let n;n=t===tm.Ei?await (0,t_.CV)():i.find(e=>e.id===t),e.callback(n),o.onClose()},s=()=>{var t;null===(t=e.onCancel)||void 0===t||t.call(e),o.onClose()};return(0,E.BX)(z,{onClose:s,open:o.open,position:"center",fullScreen:a.isMobile,children:[(0,E.tZ)(nO.Z,{onClose:s,children:e.intent===nL.r.upload?(0,B.t)("UPLOAD_TO_COLLECTION"):e.intent===nL.r.add?(0,B.t)("ADD_TO_COLLECTION"):e.intent===nL.r.move?(0,B.t)("MOVE_TO_COLLECTION"):e.intent===nL.r.restore?(0,B.t)("RESTORE_TO_COLLECTION"):e.intent===nL.r.unhide?(0,B.t)("UNHIDE_TO_COLLECTION"):(0,B.t)("SELECT_COLLECTION")}),(0,E.tZ)(Q.Z,{sx:{"&&&":{padding:0}},children:(0,E.BX)(I.A0,{flexWrap:"wrap",gap:"4px",padding:"16px",children:[(0,E.tZ)(nD,{showNextModal:e.showNextModal}),r.map(t=>(0,E.tZ)(nN,{onCollectionClick:c,collectionSummary:t},t.id))]})})]})},nM=n(89330),nB=n(38738),nU=n(72751),nF=n.n(nU),nH=n(32522),nX=n(69647),nK=n(82155),nG=n(95770);let nW=(0,D.ZP)(nG.Z)(t=>{let{width:e}=t;return"\n    width: ".concat(e,"px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    /* Beginning of string */\n    direction: rtl;\n    text-align: left;\n")}),nV=t=>{let{width:e,path:n}=t,i=async()=>{try{await (0,nK.M)().openDirectory(n)}catch(t){v.ZP.error("openDirectory failed",t)}};return(0,E.tZ)(nW,{width:e,onClick:i,children:(0,E.tZ)(tV.Z,{title:n,children:(0,E.tZ)("span",{children:n})})})};var nY=n(68372),nz=n(30295);function nj(){let t=(0,A._)(["\n    position: relative;\n    top: 5px;\n    display: inline-block;\n    max-width: 394px;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n"]);return nj=function(){return t},t}let nQ=(0,D.ZP)("div")(nj());var nq=t=>(0,E.tZ)(k.Z,{open:t.isOpen,onClose:t.onClose,PaperProps:{sx:{maxWidth:"444px"}},attributes:{title:(0,B.t)("PENDING_ITEMS"),close:{action:t.onClose,text:(0,B.t)("CLOSE")}},children:(0,E.tZ)(nz.Z,{maxHeight:240,itemSize:50,items:t.pendingExports,renderListItem:e=>(0,E.BX)(I.A0,{children:[(0,E.tZ)(td.Z,{sx:{marginRight:"8px"},children:(0,E.tZ)(te,{coverFile:e,onClick:()=>null,collectionTile:tn.gW},e.id)}),(0,E.tZ)(nQ,{children:"".concat(t.collectionNameMap.get(e.collectionID)," / ").concat(e.metadata.title)})]}),getItemTitle:e=>"".concat(t.collectionNameMap.get(e.collectionID)," / ").concat(e.metadata.title),generateItemKey:t=>"".concat(t.collectionID,"-").concat(t.id)})}),nJ=n(52202);function n$(t){let[e,n]=(0,F.useState)(!1);return(0,E.BX)(E.HY,{children:[(0,E.tZ)(Q.Z,{children:(0,E.BX)(tu.Z,{pr:2,children:[(0,E.BX)(I.Gm,{minHeight:"48px",children:[(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("PENDING_ITEMS")}),t.pendingExports.length?(0,E.tZ)(nJ.Z,{onClick:()=>{n(!0)},children:(0,nY.u)(t.pendingExports.length)}):(0,E.tZ)(N.Z,{children:(0,nY.u)(t.pendingExports.length)})]}),(0,E.BX)(I.Gm,{minHeight:"48px",children:[(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("LAST_EXPORT_TIME")}),(0,E.tZ)(N.Z,{children:t.lastExportTime?(0,e9.o0)(t.lastExportTime):(0,B.t)("NEVER")})]})]})}),(0,E.BX)(eJ.Z,{children:[(0,E.tZ)(eD.Z,{color:"secondary",size:"large",onClick:t.onHide,children:(0,B.t)("CLOSE")}),(0,E.tZ)(eD.Z,{size:"large",color:"primary",onClick:t.startExport,children:(0,B.t)("EXPORT_AGAIN")})]}),(0,E.tZ)(nq,{pendingExports:t.pendingExports,collectionNameMap:t.collectionNameMap,isOpen:e,onClose:()=>{n(!1)}})]})}var n0=n(38162);function n1(){let t=(0,A._)(["\n    padding: 0 0.5rem;\n    word-spacing: 1rem;\n    color: #ddd;\n"]);return n1=function(){return t},t}let n2=(0,D.ZP)("span")(n1());function n5(t){return(0,E.BX)(E.HY,{children:[(0,E.tZ)(Q.Z,{children:(0,E.BX)(I.wx,{children:[(0,E.tZ)(td.Z,{mb:1.5,children:t.exportStage===nH.OQ.STARTING?(0,B.t)("EXPORT_STARTING"):t.exportStage===nH.OQ.MIGRATION?(0,B.t)("MIGRATING_EXPORT"):t.exportStage===nH.OQ.RENAMING_COLLECTION_FOLDERS?(0,B.t)("RENAMING_COLLECTION_FOLDERS"):t.exportStage===nH.OQ.TRASHING_DELETED_FILES?(0,B.t)("TRASHING_DELETED_FILES"):t.exportStage===nH.OQ.TRASHING_DELETED_COLLECTIONS?(0,B.t)("TRASHING_DELETED_COLLECTIONS"):(0,E.tZ)(tb.cC,{i18nKey:"EXPORT_PROGRESS",components:{a:(0,E.tZ)(n2,{})},values:{progress:t.exportProgress}})}),(0,E.tZ)(I.A0,{px:1,children:t.exportStage===nH.OQ.STARTING||t.exportStage===nH.OQ.MIGRATION||t.exportStage===nH.OQ.RENAMING_COLLECTION_FOLDERS||t.exportStage===nH.OQ.TRASHING_DELETED_FILES||t.exportStage===nH.OQ.TRASHING_DELETED_COLLECTIONS?(0,E.tZ)(n0.Z,{}):(0,E.tZ)(n0.Z,{variant:"determinate",value:Math.round((t.exportProgress.success+t.exportProgress.failed)*100/t.exportProgress.total)})})]})}),(0,E.BX)(eJ.Z,{children:[(0,E.tZ)(eD.Z,{color:"secondary",size:"large",onClick:t.closeExportDialog,children:(0,B.t)("CLOSE")}),(0,E.tZ)(eD.Z,{size:"large",color:"critical",onClick:t.stopExport,children:(0,B.t)("STOP_EXPORT")})]})]})}function n4(t){let{startExport:e}=t;return(0,E.tZ)(Q.Z,{children:(0,E.tZ)(eJ.Z,{children:(0,E.tZ)(eD.Z,{size:"large",color:"accent",onClick:e,children:(0,B.t)("START")})})})}function n3(t){let e=(0,F.useContext)(U.AppContext),[n,i]=(0,F.useState)(nH.OQ.INIT),[o,a]=(0,F.useState)(""),[r,l]=(0,F.useState)(!1),[c,s]=(0,F.useState)({success:0,failed:0,total:0}),[d,u]=(0,F.useState)([]),[p,h]=(0,F.useState)(0);(0,F.useEffect)(()=>{if(nF()())try{var t,e;nH.ZP.setUIUpdaters({setExportStage:i,setExportProgress:s,setLastExportTime:h,setPendingExports:u});let n=nH.ZP.getExportSettings();a(null!==(t=null==n?void 0:n.folder)&&void 0!==t?t:null),l(null!==(e=null==n?void 0:n.continuousExport)&&void 0!==e&&e),f(null==n?void 0:n.folder)}catch(t){v.ZP.error("export on mount useEffect failed",t)}},[]),(0,F.useEffect)(()=>{t.show&&f(o)},[t.show]);let Z=async()=>!!await nH.ZP.exportFolderExists(o)||(e.setDialogMessage((0,nX.j8)()),!1),f=async t=>{try{if(!await nH.ZP.exportFolderExists(t)){let t=await nH.ZP.getPendingExports(null);u(t)}let e=await nH.ZP.getExportRecord(t);i(e.stage),h(e.lastAttemptTimestamp);let n=await nH.ZP.getPendingExports(e);u(n)}catch(t){t.message!==S.sH.EXPORT_FOLDER_DOES_NOT_EXIST&&v.ZP.error("syncExportRecord failed",t)}},g=async()=>{let t=await (0,nH.M9)();t&&(v.ZP.info("Export folder changed to ".concat(t)),nH.ZP.updateExportSettings({folder:t}),a(t),await f(t))},m=async()=>{if(!await Z())return;let t=!r;t?nH.ZP.enableContinuousExport():nH.ZP.disableContinuousExport(),nH.ZP.updateExportSettings({continuousExport:t}),l(t)},A=async()=>{await Z()&&await nH.ZP.scheduleExport()};return(0,E.BX)(G.Z,{open:t.show,onClose:t.onHide,maxWidth:"xs",children:[(0,E.tZ)(nO.Z,{onClose:t.onHide,children:(0,B.t)("EXPORT_DATA")}),(0,E.BX)(Q.Z,{children:[(0,E.tZ)(n9,{exportFolder:o,changeExportDirectory:g,exportStage:n}),(0,E.tZ)(n6,{continuousExport:r,toggleContinuousExport:m})]}),(0,E.tZ)(K.Z,{}),(0,E.tZ)(n8,{exportStage:n,startExport:A,stopExport:()=>{nH.ZP.stopRunningExport()},onHide:t.onHide,lastExportTime:p,exportProgress:c,pendingExports:d,collectionNameMap:t.collectionNameMap})]})}function n9(t){let{exportFolder:e,changeExportDirectory:n,exportStage:i}=t;return(0,E.BX)(I.Gm,{minHeight:"48px",children:[(0,E.tZ)(N.Z,{color:"text.muted",mr:"16px",children:(0,B.t)("DESTINATION")}),(0,E.tZ)(E.HY,{children:e?(0,E.BX)(I.zr,{children:[(0,E.tZ)(nV,{width:262,path:e}),i===nH.OQ.FINISHED||i===nH.OQ.INIT?(0,E.tZ)(nM.Z,{onClick:n}):(0,E.tZ)(td.Z,{sx:{width:"16px"}})]}):(0,E.tZ)(eD.Z,{color:"accent",onClick:n,children:(0,B.t)("SELECT_FOLDER")})})]})}function n6(t){let{continuousExport:e,toggleContinuousExport:n}=t;return(0,E.BX)(I.Gm,{minHeight:"48px",children:[(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("CONTINUOUS_EXPORT")}),(0,E.tZ)(td.Z,{children:(0,E.tZ)(nB.Z,{color:"accent",checked:e,onChange:n})})]})}let n8=t=>{let{exportStage:e,startExport:n,stopExport:i,onHide:o,lastExportTime:a,exportProgress:r,pendingExports:l,collectionNameMap:c}=t;switch(e){case nH.OQ.INIT:return(0,E.tZ)(n4,{startExport:n});case nH.OQ.MIGRATION:case nH.OQ.STARTING:case nH.OQ.EXPORTING_FILES:case nH.OQ.RENAMING_COLLECTION_FOLDERS:case nH.OQ.TRASHING_DELETED_FILES:case nH.OQ.TRASHING_DELETED_COLLECTIONS:return(0,E.tZ)(n5,{exportStage:e,exportProgress:r,stopExport:i,closeExportDialog:o});case nH.OQ.FINISHED:return(0,E.tZ)(n$,{onHide:o,lastExportTime:a,pendingExports:l,collectionNameMap:c,startExport:n});default:return(0,E.tZ)(E.HY,{})}};var n7=n(48025),it=n(69506),ie=n(50553),ii=n(96758),io=n(52616),ia=n(61640),ir=n(58178),il=n(28988),ic=n(55151),is=n(79541),id=n(33009);let iu=["DateTimeOriginal","CreateDate","ModifyDate","DateCreated","MetadataDate"];async function ip(t,e,n,i){let o=!1;try{if(0===t.length)return o;for(let[r,l]of(i({current:0,total:t.length}),t.entries()))try{let t;if("custom-time"===e)t=1e3*n.getTime();else{if(l.metadata.fileType!==ir.Gk.IMAGE)continue;let n=await tt.Z.getFile(l),i=await new Response(n).blob(),o=new File([i],l.metadata.title),r=await (0,ic.S)(o),c=await (0,id.PC)(o,r,iu);if("date-time-original"===e){var a;t=(0,il.B)(null!==(a=null==c?void 0:c.DateTimeOriginal)&&void 0!==a?a:null==c?void 0:c.DateCreated)}else"date-time-digitized"===e?t=(0,il.B)(null==c?void 0:c.CreateDate):"metadata-date"===e&&(t=(0,il.B)(null==c?void 0:c.MetadataDate))}if(t&&t!==l.metadata.creationTime){let e=await (0,is.rx)(l,t);(0,is.Vz)(l,e)}}catch(t){v.ZP.error("failed to updated a CreationTime With Exif",t),o=!0}finally{i({current:r+1,total:t.length})}}catch(t){v.ZP.error("update CreationTime With Exif failed",t),o=!0}return o}var ih=n(65472),iZ=t=>{let[e,n]=(0,F.useState)(),[i,o]=(0,F.useState)({current:0,total:0}),a=(0,F.useContext)(lM);(0,F.useEffect)(()=>{t.attributes&&t.isOpen&&"running"!==e&&n(void 0)},[t.isOpen]);let r=async e=>{console.log({values:e}),n("running"),n(await ip(t.attributes.files,e.option,new Date(e.customTimeString),o)?"completed-with-errors":"completed"),await a.syncWithRemote()},l="running"===e?(0,B.t)("FIX_CREATION_TIME_IN_PROGRESS"):(0,B.t)("FIX_CREATION_TIME"),c=ig(e);return t.attributes?(0,E.tZ)(n7.Z,{open:t.isOpen,onClose:t.hide,attributes:{title:l,nonClosable:!0},children:(0,E.BX)("div",{style:{marginBottom:"10px",display:"flex",flexDirection:"column",..."running"===e?{alignItems:"center"}:{}},children:[c&&(0,E.tZ)("div",{children:c}),"running"===e&&(0,E.tZ)(iE,{progressTracker:i}),(0,E.tZ)(im,{step:e,onSubmit:r,hide:t.hide})]})}):(0,E.tZ)(E.HY,{})};let ig=t=>{switch(t){case void 0:case"running":return;case"completed":return(0,B.t)("UPDATE_CREATION_TIME_COMPLETED");case"completed-with-errors":return(0,B.t)("UPDATE_CREATION_TIME_COMPLETED_WITH_ERROR")}},im=t=>{let{step:e,onSubmit:n,hide:i}=t,{values:o,handleChange:a,handleSubmit:r}=(0,ek.TA)({initialValues:{option:"date-time-original",customTimeString:new Date().toISOString()},validateOnBlur:!1,onSubmit:n});return(0,E.BX)(E.HY,{children:[(void 0===e||"completed-with-errors"===e)&&(0,E.tZ)("div",{style:{marginTop:"10px"},children:(0,E.BX)("form",{onSubmit:r,children:[(0,E.tZ)(it.Z,{children:(0,E.tZ)(ie.Z,{children:(0,B.t)("UPDATE_CREATION_TIME_NOT_STARTED")})}),(0,E.BX)(ii.Z,{name:"option",onChange:a,children:[(0,E.tZ)(io.Z,{value:"date-time-original",control:(0,E.tZ)(ia.Z,{size:"small"}),label:(0,B.t)("DATE_TIME_ORIGINAL")}),(0,E.tZ)(io.Z,{value:"date-time-digitized",control:(0,E.tZ)(ia.Z,{size:"small"}),label:(0,B.t)("DATE_TIME_DIGITIZED")}),(0,E.tZ)(io.Z,{value:"metadata-date",control:(0,E.tZ)(ia.Z,{size:"small"}),label:(0,B.t)("METADATA_DATE")}),(0,E.tZ)(io.Z,{value:"custom-time",control:(0,E.tZ)(ia.Z,{size:"small"}),label:(0,B.t)("CUSTOM_TIME")})]}),"custom-time"===o.option&&(0,E.tZ)(ih.Z,{onSubmit:t=>a("customTimeString")(t.toISOString())})]})}),(0,E.tZ)(iA,{step:e,startFix:r,hide:i})]})},iA=t=>{let{step:e,startFix:n,...i}=t;return"running"!==e&&(0,E.BX)("div",{style:{width:"100%",display:"flex",marginTop:"30px",justifyContent:"space-around"},children:[(void 0===e||"completed-with-errors"===e)&&(0,E.tZ)(eD.Z,{color:"secondary",size:"large",onClick:()=>{i.hide()},children:(0,B.t)("CANCEL")}),"completed"===e&&(0,E.tZ)(eD.Z,{color:"primary",size:"large",onClick:i.hide,children:(0,B.t)("CLOSE")}),(void 0===e||"completed-with-errors"===e)&&(0,E.BX)(E.HY,{children:[(0,E.tZ)("div",{style:{width:"30px"}}),(0,E.tZ)(eD.Z,{color:"accent",size:"large",onClick:n,children:(0,B.t)("FIX_CREATION_TIME")})]})]})},iE=t=>{let{progressTracker:e}=t,n=Math.round(100*e.current/e.total);return(0,E.BX)(E.HY,{children:[(0,E.BX)("div",{style:{marginBottom:"10px"},children:[(0,E.BX)(n2,{children:[" ",e.current," / ",e.total," "]})," ",(0,E.BX)("span",{style:{marginLeft:"10px"},children:[" ",(0,B.t)("CREATION_TIME_UPDATED")]})]}),(0,E.tZ)("div",{style:{width:"100%",marginTop:"10px",marginBottom:"20px"},children:(0,E.tZ)(n0.Z,{variant:"determinate",value:n})})]})};var iC=n(24222),iv=n(73370),iI=n(63190),iw=n(85905),iy=n(40994);function ix(){let t=(0,A._)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n"]);return ix=function(){return t},t}function iS(){let t=(0,A._)(["\n    pointer-events: none;\n"]);return iS=function(){return t},t}let iT=(0,D.ZP)(td.Z)(ix()),ib=(0,D.ZP)("img")(iS());function i_(t){let{openUploader:e}=t;return(0,E.BX)(iT,{children:[(0,E.BX)(tu.Z,{sx:{flex:"none",pt:1.5,pb:1.5},children:[(0,E.BX)(I.wx,{sx:{flex:"none"},children:[(0,E.tZ)(N.Z,{variant:"h3",color:"text.muted",mb:1,children:(0,E.tZ)(tb.cC,{i18nKey:"WELCOME_TO_ENTE_HEADING",components:{a:(0,E.tZ)(iv.W,{})}})}),(0,E.tZ)(N.Z,{variant:"h2",children:(0,B.t)("WELCOME_TO_ENTE_SUBHEADING")})]}),(0,E.tZ)(N.Z,{mt:3.5,color:"text.muted",children:(0,B.t)("WHERE_YOUR_BEST_PHOTOS_LIVE")})]}),(0,E.tZ)(ib,{height:287.57,src:"/images/empty-state/ente_duck.png",srcSet:"/images/empty-state/ente_duck@2x.png, /images/empty-state/ente_duck@3x.png"}),(0,E.BX)(I.wx,{paddingTop:1.5,paddingBottom:1.5,children:[(0,E.tZ)(eD.Z,{style:{cursor:!iy.Z.shouldAllowNewUpload()&&"not-allowed"},color:"accent",onClick:()=>e(nL.M.normalUpload),disabled:!iy.Z.shouldAllowNewUpload(),sx:{mt:1.5,p:1,width:320,borderRadius:.5},children:(0,E.BX)(I.A0,{sx:{gap:1},justifyContent:"center",children:[(0,E.tZ)(iI.Z,{}),(0,B.t)("UPLOAD_FIRST_PHOTO")]})}),(0,E.tZ)(eD.Z,{style:{cursor:!iy.Z.shouldAllowNewUpload()&&"not-allowed"},onClick:()=>e(nL.M.import),disabled:!iy.Z.shouldAllowNewUpload(),sx:{mt:1.5,p:1,width:320,borderRadius:.5},children:(0,E.BX)(I.A0,{sx:{gap:1},justifyContent:"center",children:[(0,E.tZ)(iw.Z,{}),(0,B.t)("IMPORT_YOUR_FOLDERS")]})})]})]})}var iO=n(95347),iL=n(12492);function iR(t){let{searchResultSummary:e}=t;if(!e)return(0,E.tZ)(E.HY,{});let{optionName:n,fileCount:i}=e;return(0,E.BX)(tn.VZ,{children:[(0,E.tZ)(N.Z,{color:"text.muted",variant:"large",children:(0,B.t)("SEARCH_RESULTS")}),(0,E.tZ)(t2.a,{name:n,fileCount:i})]})}var iP=n(14871),iD=n(1141);let iN=async()=>{try{let t=(0,L.LP)(),e=await nC.Z.get("".concat((0,nv.O3)(),"/users/two-factor/recovery-status"),{},{"X-Auth-Token":t});if(void 0===e.data)throw Error(S.sH.REQUEST_FAILED);return e.data.isPasskeyRecoveryEnabled}catch(t){throw v.ZP.error("failed to get passkey recovery status",t),t}},ik=async(t,e,n)=>{try{let i=(0,L.LP)(),o=await nC.Z.post("".concat((0,nv.O3)(),"/users/two-factor/passkeys/configure-recovery"),{secret:t,userSecretCipher:e,userSecretNonce:n},void 0,{"X-Auth-Token":i});if(void 0===o.data)throw Error(S.sH.REQUEST_FAILED)}catch(t){throw v.ZP.error("failed to configure passkey recovery",t),t}};var iM=n(30920),iB=n(3449),iU=n(10222),iF=n(80955),iH=n(97482),iX=n(46253);function iK(t){let{themeColor:e,setThemeColor:n}=t;return(0,E.BX)(iH.Z,{size:"small",value:e,exclusive:!0,onChange:(t,e)=>{null!==e&&n(e)},children:[(0,E.tZ)(iX.Z,{value:iB.l.LIGHT,children:(0,E.tZ)(iF.Z,{})}),(0,E.tZ)(iX.Z,{value:iB.l.DARK,children:(0,E.tZ)(iU.Z,{})})]})}var iG=n(3451),iW=n(50334),iV=n(56033),iY=n(38203),iz=n(79906),ij=n(72176),iQ=n(59372),iq=n(41202),iJ=n(35042);async function i$(t){let e=await e7.Z.getInstance(),n=await (0,iJ.G)(),i=(0,O.Yu)(O.Pd.KEY_ATTRIBUTES),o=await e.decryptB64(i.encryptedSecretKey,i.secretKeyDecryptionNonce,n);return atob(await e.boxSealOpen(t,i.publicKey,o))}var i0=n(93506),i1=n(61035);function i2(t){let{disabled:e,checked:n,onChange:i,label:o,labelProps:a}=t;return(0,E.tZ)(i0.Z,{sx:{width:"100%"},children:(0,E.tZ)(io.Z,{control:(0,E.tZ)(i1.Z,{size:"small",disabled:e,checked:n,onChange:t=>i(t.target.checked),color:"accent"}),label:(0,E.tZ)(N.Z,{color:"text.secondary",...a,children:o})})})}var i5=n(38493),i4=n(425);function i3(t){let{label:e,labelProps:n,options:i,message:o,selected:a,placeholder:r,setSelected:l,messageProps:c}=t;return(0,E.BX)(tu.Z,{spacing:"4px",children:[(0,E.tZ)(N.Z,{...n,children:e}),(0,E.tZ)(i5.Z,{IconComponent:t4.Z,displayEmpty:!0,variant:"standard",MenuProps:{PaperProps:{sx:{maxWidth:0}},MenuListProps:{sx:t=>({backgroundColor:t.colors.background.elevated2,".MuiMenuItem-root ":{color:t.colors.text.faint,whiteSpace:"normal"},"&&& > .Mui-selected":{background:t.colors.background.elevated2,color:t.colors.text.base}})}},sx:t=>({"::before , ::after":{borderBottom:"none !important"},".MuiInput-root":{background:t.colors.fill.faint,borderRadius:"8px"},".MuiSelect-select":{background:t.colors.fill.faint,borderRadius:"8px"},"&&& .MuiSelect-select":{p:"12px 36px 12px 16px"},".MuiSelect-icon":{mr:"12px",color:t.colors.stroke.muted}}),renderValue:t=>(null==t?void 0:t.length)?i.find(e=>e.value===t).label:(0,E.tZ)(td.Z,{color:"text.muted",children:null!=r?r:""}),value:a,onChange:t=>{l(t.target.value)},children:i.map((t,e)=>(0,E.tZ)(i4.Z,{divider:e!==i.length-1,value:t.value,sx:{px:"16px",py:"14px",color:t=>t.palette.primary.main},children:t.label},t.label))}),o&&(0,E.tZ)(N.Z,{variant:"small",px:"8px",color:"text.muted",...c,children:o})]})}function i9(t){let{label:e,labelProps:n,message:i,messageProps:o,placeholder:a,value:r,rowCount:l,onChange:c}=t;return(0,E.BX)(tu.Z,{spacing:"4px",children:[(0,E.tZ)(N.Z,{...n,children:e}),(0,E.tZ)(eN.Z,{variant:"standard",multiline:!0,rows:l,value:r,onChange:t=>c(t.target.value),placeholder:a,sx:t=>({border:"1px solid",borderColor:t.colors.stroke.faint,borderRadius:"8px",padding:"12px",".MuiInputBase-formControl":{"::before, ::after":{borderBottom:"none !important"}}})}),(0,E.tZ)(N.Z,{px:"8px",variant:"small",color:"text.secondary",...o,children:i})]})}(r=h||(h={})).MISSING_FEATURE="It's missing a key feature that I need",r.BROKEN_BEHAVIOR="The app or a certain feature does not behave as I think it should",r.FOUND_ANOTHER_SERVICE="I found another service that I like better",r.NOT_LISTED="My reason isn't listed";let i6=()=>Object.keys(h).map(t=>({label:(0,B.t)("DELETE_REASON.".concat(t)),value:h[t]}));var i8=t=>{let{open:e,onClose:n}=t,{setDialogBoxAttributesV2:i,isMobile:o,logout:a}=(0,F.useContext)(U.AppContext),{authenticateUser:r}=(0,F.useContext)(lM),[l,c]=(0,F.useState)(!1),s=(0,F.useRef)(),[d,u]=(0,F.useState)(!1),p=(0,F.useRef)();(0,F.useEffect)(()=>{(0,iq.pt)("/images/delete-account")},[]);let h=()=>i({title:(0,B.t)("ERROR"),close:{variant:"critical"},content:(0,B.t)("UNKNOWN_ERROR")}),Z=async(t,e)=>{let{reason:n,feedback:i}=t,{setFieldError:o}=e;try{if(i=i.trim(),0===i.length){o("feedback","I found another service that I like better"===n?(0,B.t)("FEEDBACK_REQUIRED_FOUND_ANOTHER_SERVICE"):(0,B.t)("FEEDBACK_REQUIRED"));return}c(!0),p.current={reason:n,feedback:i};let t=await (0,iQ.JU)();s.current=t.encryptedChallenge,t.allowDelete?r(f):g()}catch(t){v.ZP.error("Error while initiating account deletion",t),h()}finally{c(!1)}},f=()=>{i({title:(0,B.t)("DELETE_ACCOUNT"),content:(0,E.tZ)(tb.cC,{i18nKey:"CONFIRM_ACCOUNT_DELETION_MESSAGE"}),proceed:{text:(0,B.t)("DELETE"),action:m,variant:"critical"},close:{text:(0,B.t)("CANCEL")}})},g=()=>{i({title:(0,B.t)("DELETE_ACCOUNT"),content:(0,E.tZ)(tb.cC,{i18nKey:"DELETE_ACCOUNT_MESSAGE",components:{a:(0,E.tZ)(ny.Z,{href:"mailto:".concat(ij.f1)})},values:{emailID:ij.f1}}),proceed:{text:(0,B.t)("DELETE"),action:()=>{(0,iq.ec)("account-deletion@ente.io")},variant:"critical"},close:{text:(0,B.t)("CANCEL")}})},m=async t=>{try{t(!0);let e=await i$(s.current),{reason:n,feedback:i}=p.current;await (0,iQ.tm)(e,n,i),a()}catch(t){v.ZP.error("solveChallengeAndDeleteAccount failed",t),h()}finally{t(!1)}};return(0,E.tZ)(E.HY,{children:(0,E.tZ)(k.Z,{fullWidth:!0,open:e,onClose:n,fullScreen:o,attributes:{title:(0,B.t)("DELETE_ACCOUNT"),secondary:{action:n,text:(0,B.t)("CANCEL")}},children:(0,E.tZ)(ek.J9,{initialValues:{reason:"",feedback:""},validationSchema:eM.Ry().shape({reason:eM.Z_().required((0,B.t)("REQUIRED"))}),validateOnChange:!1,validateOnBlur:!1,onSubmit:Z,children:t=>{let{values:e,errors:i,handleChange:o,handleSubmit:a}=t;return(0,E.tZ)("form",{noValidate:!0,onSubmit:a,children:(0,E.BX)(tu.Z,{spacing:"24px",children:[(0,E.tZ)(i3,{options:i6(),label:(0,B.t)("DELETE_ACCOUNT_REASON_LABEL"),placeholder:(0,B.t)("DELETE_ACCOUNT_REASON_PLACEHOLDER"),selected:e.reason,setSelected:o("reason"),messageProps:{color:"critical.main"},message:i.reason}),(0,E.tZ)(i9,{label:(0,B.t)("DELETE_ACCOUNT_FEEDBACK_LABEL"),placeholder:(0,B.t)("DELETE_ACCOUNT_FEEDBACK_PLACEHOLDER"),value:e.feedback,onChange:o("feedback"),message:i.feedback,messageProps:{color:"critical.main"},rowCount:3}),(0,E.tZ)(i2,{checked:d,onChange:u,label:(0,B.t)("CONFIRM_DELETE_ACCOUNT_CHECKBOX_LABEL")}),(0,E.BX)(tu.Z,{spacing:"8px",children:[(0,E.tZ)(nu.Z,{type:"submit",size:"large",color:"critical",disabled:!d,loading:l,children:(0,B.t)("CONFIRM_DELETE_ACCOUNT")}),(0,E.tZ)(eD.Z,{size:"large",color:"secondary",onClick:n,children:(0,B.t)("CANCEL")})]})]})})}})})})},i7=n(92660),ot=n(41075),oe=n(5632),on=n.n(oe);function oi(t){let{closeDialog:e}=t,{setDialogMessage:n}=(0,F.useContext)(U.AppContext),i=async()=>{n({title:(0,B.t)("DISABLE_TWO_FACTOR"),content:(0,B.t)("DISABLE_TWO_FACTOR_MESSAGE"),close:{text:(0,B.t)("CANCEL")},proceed:{variant:"critical",text:(0,B.t)("DISABLE"),action:o}})},o=async()=>{try{await (0,i7.XB)(),(0,O.a_)(O.Pd.USER,{...(0,O.Yu)(O.Pd.USER),isTwoFactorEnabled:!1}),e()}catch(t){n({title:(0,B.t)("TWO_FACTOR_DISABLE_FAILED"),close:{}})}},a=async()=>{n({title:(0,B.t)("UPDATE_TWO_FACTOR"),content:(0,B.t)("UPDATE_TWO_FACTOR_MESSAGE"),close:{text:(0,B.t)("CANCEL")},proceed:{variant:"accent",text:(0,B.t)("UPDATE"),action:r}})},r=async()=>{e(),on().push(y.Wu.TWO_FACTOR_SETUP)};return(0,E.BX)(E.HY,{children:[(0,E.BX)(ot.ZP,{mb:1.5,rowSpacing:1,container:!0,alignItems:"center",justifyContent:"center",children:[(0,E.tZ)(ot.ZP,{item:!0,sm:9,xs:12,children:(0,B.t)("UPDATE_TWO_FACTOR_LABEL")}),(0,E.tZ)(ot.ZP,{item:!0,sm:3,xs:12,children:(0,E.tZ)(eD.Z,{color:"accent",onClick:a,size:"large",children:(0,B.t)("RECONFIGURE")})})]}),(0,E.BX)(ot.ZP,{rowSpacing:1,container:!0,alignItems:"center",justifyContent:"center",children:[(0,E.BX)(ot.ZP,{item:!0,sm:9,xs:12,children:[(0,B.t)("DISABLE_TWO_FACTOR_LABEL")," "]}),(0,E.tZ)(ot.ZP,{item:!0,sm:3,xs:12,children:(0,E.tZ)(eD.Z,{color:"critical",onClick:i,size:"large",children:(0,B.t)("DISABLE")})})]})]})}var oo=n(75927);function oa(t){let{closeDialog:e}=t,n=(0,oe.useRouter)();return(0,E.BX)(I.wx,{sx:{mb:2},children:[(0,E.tZ)(oo.Z,{sx:{fontSize:t=>t.spacing(5),mb:2}}),(0,E.tZ)(N.Z,{mb:4,children:(0,B.t)("TWO_FACTOR_INFO")}),(0,E.tZ)(eD.Z,{variant:"contained",color:"accent",size:"large",onClick:()=>{e(),n.push(y.Wu.TWO_FACTOR_SETUP)},children:(0,B.t)("ENABLE_TWO_FACTOR")})]})}let or=(0,D.ZP)(G.Z)(t=>{let{theme:e}=t;return{"& .MuiDialogContent-root":{padding:e.spacing(2,4)}}});var ol=function(t){let[e,n]=(0,F.useState)(!1);(0,F.useEffect)(()=>{var t;n(null!==(t=(0,O.Yu)(O.Pd.USER).isTwoFactorEnabled)&&void 0!==t&&t)},[]),(0,F.useEffect)(()=>{t.show&&(async()=>{let t=await (0,iQ.bW)();n(t),(0,O.a_)(O.Pd.USER,{...(0,O.Yu)(O.Pd.USER),isTwoFactorEnabled:t})})()},[t.show]);let i=()=>{t.onHide(),t.closeSidebar()};return(0,E.BX)(or,{maxWidth:"xs",open:t.show,onClose:t.onHide,children:[(0,E.tZ)(nO.Z,{onClose:t.onHide,children:(0,B.t)("TWO_FACTOR_AUTHENTICATION")}),(0,E.tZ)(Q.Z,{sx:{px:4},children:e?(0,E.tZ)(oi,{closeDialog:i}):(0,E.tZ)(oa,{closeDialog:i})})]})},oc=n(54032),os=n(17973),od=n(70584),ou=n(29411),op=n(3602),oh=n(72841),oZ=n(93932),of=n(96741);function og(){let t=(0,A._)(["\n    padding: 32px 16px 16px 24px;\n"]);return og=function(){return t},t}let om=t=>{let{open:e,onClose:n}=t,[i,o]=(0,F.useState)(),[a,r]=(0,F.useState)(),[l,c]=(0,F.useState)(!1),s=(0,F.useContext)(U.AppContext);(0,F.useEffect)(()=>{of.Z.getWatches().then(t=>o(t))},[]),(0,F.useEffect)(()=>{s.watchFolderFiles&&s.watchFolderFiles.length>0&&(d(s.watchFolderFiles),s.setWatchFolderFiles(null))},[s.watchFolderFiles]);let d=async t=>{for(let e=0;e<t.length;e++){let n=t[e].path.replace(/\\/g,"/");await (0,nK.M)().fs.isDir(n)&&await u(n)}},u=async t=>{ob(await (0,nK.M)().watch.findFiles(t))?p(t,"root"):(r(t),c(!0))},p=(t,e)=>of.Z.addWatch(t,e).then(t=>o(t)),h=async()=>{let t=await (0,nK.M)().selectDirectory();t&&await u(t)},Z=async t=>of.Z.removeWatch(t.folderPath).then(t=>o(t)),f=()=>c(!1);return(0,E.BX)(E.HY,{children:[(0,E.BX)(G.Z,{open:e,onClose:n,PaperProps:{sx:{height:"448px",maxWidth:"414px"}},children:[(0,E.tZ)(oA,{children:(0,E.tZ)(nO.Z,{onClose:n,children:(0,B.t)("WATCHED_FOLDERS")})}),(0,E.tZ)(Q.Z,{sx:{flex:1},children:(0,E.BX)(tu.Z,{spacing:1,p:1.5,height:"100%",children:[(0,E.tZ)(oE,{watches:i,removeWatch:Z}),(0,E.BX)(eD.Z,{fullWidth:!0,color:"accent",onClick:h,children:[(0,E.tZ)("span",{children:"+"}),(0,E.tZ)("span",{style:{marginLeft:"8px"}}),(0,B.t)("ADD_FOLDER")]})]})})]}),(0,E.tZ)(oZ.C,{open:l,onClose:f,didSelect:t=>{f(),r(void 0),p((0,os.z)(a),t)}})]})},oA=(0,D.ZP)("div")(og()),oE=t=>{let{watches:e,removeWatch:n}=t;return 0===(null!=e?e:[]).length?(0,E.tZ)(ov,{}):(0,E.tZ)(oC,{children:e.map(t=>(0,E.tZ)(oy,{watch:t,removeWatch:n},t.folderPath))})},oC=(0,D.ZP)(td.Z)(()=>({height:"278px",overflow:"auto","&::-webkit-scrollbar":{width:"4px"}})),ov=()=>(0,E.tZ)(oI,{children:(0,E.BX)(tu.Z,{spacing:1,children:[(0,E.tZ)(N.Z,{variant:"large",fontWeight:"bold",children:(0,B.t)("NO_FOLDERS_ADDED")}),(0,E.tZ)(N.Z,{py:.5,variant:"small",color:"text.muted",children:(0,B.t)("FOLDERS_AUTOMATICALLY_MONITORED")}),(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",children:(0,E.BX)(I.A0,{gap:1,children:[(0,E.tZ)(ow,{}),(0,B.t)("UPLOAD_NEW_FILES_TO_ENTE")]})}),(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",children:(0,E.BX)(I.A0,{gap:1,children:[(0,E.tZ)(ow,{}),(0,B.t)("REMOVE_DELETED_FILES_FROM_ENTE")]})})]})}),oI=(0,D.ZP)(I.wx)({textAlign:"left",alignItems:"flex-start",marginBottom:"32px"}),ow=()=>(0,E.tZ)(eq.Z,{fontSize:"small",sx:{display:"inline",fontSize:"15px",color:t=>t.palette.secondary.main}}),oy=t=>{let{watch:e,removeWatch:n}=t,i=F.useContext(U.AppContext);return(0,E.BX)(I.Gm,{children:[(0,E.BX)(I.cD,{children:["root"===e.collectionMapping?(0,E.tZ)(tV.Z,{title:(0,B.t)("UPLOADED_TO_SINGLE_COLLECTION"),children:(0,E.tZ)(op.Z,{})}):(0,E.tZ)(tV.Z,{title:(0,B.t)("UPLOADED_TO_SEPARATE_COLLECTIONS"),children:(0,E.tZ)(ou.Z,{})}),(0,E.BX)(ox,{children:[(0,E.tZ)(oS,{watch:e}),(0,E.tZ)(N.Z,{color:"text.muted",variant:"small",children:e.folderPath})]})]}),(0,E.tZ)(oT,{confirmStopWatching:()=>{i.setDialogMessage({title:(0,B.t)("STOP_WATCHING_FOLDER"),content:(0,B.t)("STOP_WATCHING_DIALOG_MESSAGE"),close:{text:(0,B.t)("CANCEL"),variant:"secondary"},proceed:{action:()=>n(e),text:(0,B.t)("YES_STOP"),variant:"critical"}})}})]})},ox=(0,D.ZP)(td.Z)({marginLeft:"12px",marginRight:"6px",marginBottom:"12px"}),oS=t=>{let{watch:e}=t,n=e.folderPath;return(0,E.BX)(I.A0,{gap:1,children:[(0,E.tZ)(N.Z,{children:(0,oc.EZ)(n)}),of.Z.isSyncingFolder(n)&&(0,E.tZ)(oh.Z,{size:12})]})},oT=t=>{let{confirmStopWatching:e}=t;return(0,E.tZ)(tp.Z,{menuPaperProps:{sx:{backgroundColor:t=>t.colors.background.elevated2}},ariaControls:"watch-mapping-option",triggerButtonIcon:(0,E.tZ)(tT.Z,{}),children:(0,E.tZ)(th.x,{color:"critical",onClick:e,startIcon:(0,E.tZ)(od.Z,{}),children:(0,B.t)("STOP_WATCHING")})})},ob=t=>1==new Set(t.map(oc.XX)).size;var o_=n(96820),oO=n(22404),oL=n(84914),oR=n(78806);let oP="free";function oD(t){return t&&oN(t)&&t.productID!==oP}function oN(t){return t&&t.expiryTime>1e3*Date.now()}function ok(t){return t&&oN(t)&&t.productID===oP}function oM(t){return t&&t.storageBonuses&&t.storageBonuses.length>0&&t.storageBonuses.some(t=>t.type.startsWith("ADD_ON"))}function oB(t){return t&&t.attributes.isCancelled}function oU(t,e){return oN(e)&&(t.stripeID===e.productID||t.iosID===e.productID||t.androidID===e.productID)}function oF(t){return t.paymentProvider.length>0&&"stripe"===t.paymentProvider}function oH(t){var e;let n=null!==(e=t.storageBonus)&&void 0!==e?e:0;return(0,oR.uD)(t.familyData)?(0,oR.mw)(t.familyData)>t.familyData.storage+n:t.usage>t.subscription.storage+n}function oX(t){let e=1e3*Date.now();return!oB(t)&&t.expiryTime<e&&t.expiryTime>=e-2592e9}(l=Z||(Z={})).AUTHENTICATION_FAILED="authentication_failed",l.REQUIRE_PAYMENT_METHOD="requires_payment_method",l.STRIPE_ERROR="stripe_error",l.CANCELED="canceled",l.SERVER_ERROR="server_error",(c=f||(f={})).success="success",c.fail="fail";let oK=t=>107374182400===t.storage;async function oG(t,e,n,i){try{n(!0),await oO.Z.updateSubscription(t.stripeID)}catch(t){e({title:(0,B.t)("ERROR"),content:(0,B.t)("SUBSCRIPTION_UPDATE_FAILED"),close:{variant:"critical"}})}finally{n(!1),i()}}async function oW(t,e,n){try{n(!0),await oO.Z.cancelSubscription(),t({title:(0,B.t)("SUCCESS"),content:(0,B.t)("SUBSCRIPTION_CANCEL_SUCCESS"),close:{variant:"accent"}})}catch(e){t({title:(0,B.t)("ERROR"),content:(0,B.t)("SUBSCRIPTION_CANCEL_FAILED"),close:{variant:"critical"}})}finally{e(),n(!1)}}async function oV(t,e,n){try{n(!0),await oO.Z.activateSubscription(),t({title:(0,B.t)("SUCCESS"),content:(0,B.t)("SUBSCRIPTION_ACTIVATE_SUCCESS"),close:{variant:"accent"}})}catch(e){t({title:(0,B.t)("ERROR"),content:(0,B.t)("SUBSCRIPTION_ACTIVATE_FAILED"),close:{variant:"critical"}})}finally{e(),n(!1)}}async function oY(t,e){try{e(!0),await oO.Z.redirectToCustomerPortal()}catch(n){e(!1),t({title:(0,B.t)("ERROR"),content:(0,B.t)("UNKNOWN_ERROR"),close:{variant:"critical"}})}}async function oz(t,e){try{e(!0);let t=(0,oL.r)(oL.q.FAMILIES);(0,iq.nG)(t,!0)}catch(e){v.ZP.error("failed to redirect to family portal",e),t({title:(0,B.t)("ERROR"),content:(0,B.t)("UNKNOWN_ERROR"),close:{variant:"critical"}})}finally{e(!1)}}async function oj(t,e,n){var i;let{session_id:o,status:a,reason:r}=null!==(i=e.query)&&void 0!==i?i:{};try{if("fail"===a)!function(t,e,n){switch(v.ZP.error("subscription purchase failed: ".concat(t)),t){case"canceled":e({title:(0,B.t)("MESSAGE"),content:(0,B.t)("SUBSCRIPTION_PURCHASE_CANCELLED"),close:{variant:"critical"}});break;case"requires_payment_method":e({title:(0,B.t)("UPDATE_PAYMENT_METHOD"),content:(0,B.t)("UPDATE_PAYMENT_METHOD_MESSAGE"),proceed:{text:(0,B.t)("UPDATE_PAYMENT_METHOD"),variant:"accent",action:oY.bind(null,e,n)},close:{text:(0,B.t)("CANCEL")}});break;case"authentication_failed":e({title:(0,B.t)("UPDATE_PAYMENT_METHOD"),content:(0,B.t)("STRIPE_AUTHENTICATION_FAILED"),proceed:{text:(0,B.t)("UPDATE_PAYMENT_METHOD"),variant:"accent",action:oY.bind(null,e,n)},close:{text:(0,B.t)("CANCEL")}});break;default:e({title:(0,B.t)("ERROR"),content:(0,B.t)("SUBSCRIPTION_PURCHASE_FAILED"),close:{variant:"critical"}})}}(r,t,n);else if("success"===a)try{let e=await oO.Z.verifySubscription(o);t((0,nX.Ui)(e))}catch(e){t({title:(0,B.t)("ERROR"),content:(0,B.t)("SUBSCRIPTION_VERIFICATION_ERROR"),close:{}})}}catch(t){}}var oQ=n(82797),oq=n(16748),oJ=n(66965),o$=n(93542);let o0=[{fileName:"Screenshot_20220807-195908_Firefox",expectedDateTime:"2022-08-07 19:59:08"},{fileName:"Screenshot_20220507-195908",expectedDateTime:"2022-05-07 19:59:08"},{fileName:"2022-02-18 16.00.12-DCMX.png",expectedDateTime:"2022-02-18 16:00:12"},{fileName:"20221107_231730",expectedDateTime:"2022-11-07 23:17:30"},{fileName:"2020-11-01 02.31.02",expectedDateTime:"2020-11-01 02:31:02"},{fileName:"IMG_20210921_144423",expectedDateTime:"2021-09-21 14:44:23"},{fileName:"2019-10-31 155703",expectedDateTime:"2019-10-31 00:00:00",correctExpectedDateTime:"2019-10-31 15:57:03"},{fileName:"IMG_20210921_144423_783",expectedDateTime:"2021-09-21 14:44:23"},{fileName:"Screenshot_2022-06-21-16-51-29-164_newFormat.heic",expectedDateTime:"2022-06-21 16:51:29"},{fileName:"Screenshot 20221106 211633.com.google.android.apps.nbu.paisa.user.jpg",expectedDateTime:"2022-11-06 21:16:33"},{fileName:"signal-2022-12-17-15-16-04-718.jpg",expectedDateTime:"2022-12-17 15:16:04"}],o1=["Snapchat-431959199.mp4.","Snapchat-400000000.mp4","Snapchat-900000000.mp4","Snapchat-100-10-20-19-15-12"],o2=[{filename:"IMG20210211125718-edited.jpg",jsonFilename:"IMG20210211125718.jpg.json"},{filename:"IMG20210211174722.jpg",jsonFilename:"IMG20210211174722.jpg.json"},{filename:"21345678901234567890123456789012345678901234567.png",jsonFilename:"2134567890123456789012345678901234567890123456.json"},{filename:"IMG20210211174722(1).jpg",jsonFilename:"IMG20210211174722.jpg(1).json"},{filename:"IMG2021021(4455)74722(1).jpg",jsonFilename:"IMG2021021(4455)74722.jpg(1).json"},{filename:"IMG2021021.json74722(1).jpg",jsonFilename:"IMG2021021.json74722.jpg(1).json"},{filename:"IMG2021021(1)74722(1).jpg",jsonFilename:"IMG2021021(1)74722.jpg(1).json"}];async function o5(){let t=o$.env.NEXT_PUBLIC_ENTE_TEST_EXPECTED_JSON;if(!t)throw Error("Please specify the NEXT_PUBLIC_ENTE_TEST_EXPECTED_JSON to run the upload tests");let e=JSON.parse(t);if(!e)throw Error("upload test failed expectedState missing");try{await o3(e),await o9(e),await o6(e),await o8(e),await o7(e),await at(e),await ae(e),await o4(e),o0.forEach(t=>{let{fileName:e,expectedDateTime:n}=t,i=function(t){let e=t.getFullYear(),n=an(t.getMonth()+1),i=an(t.getDate()),o=an(t.getHours()),a=an(t.getMinutes()),r=an(t.getSeconds());return"".concat(e,"-").concat(n,"-").concat(i," ").concat(o,":").concat(a,":").concat(r)}((0,oq.S)(e));if(i!==n)throw Error("parseDateTimeFromFileNameTest failed ❌ ,\n                    for ".concat(e,"\n                    expected: ").concat(n," got: ").concat(i))}),o1.forEach(t=>{let e=(0,oq.S)(t);if(e)throw Error("parseDateTimeFromFileNameTest failed ❌ ,\n                for ".concat(t,"\n                expected: null got: ").concat(e))}),console.log("parseDateTimeFromFileNameTest passed ✅"),o2.forEach(t=>{let{filename:e,jsonFilename:n}=t,i=(0,oJ.RJ)(0,n),o=(0,oJ.qg)(0,e);if(o!==i&&e.length>oJ.Gz&&(o=(0,oJ.Ob)(0,e)),o!==i)throw Error("mappingFileAndJSONFileCheck failed ❌ ,\n                    for ".concat(e,"\n                    expected: ").concat(i," got: ").concat(o))}),console.log("mappingFileAndJSONFileCheck passed ✅")}catch(t){console.log(t)}}async function o4(t){let e=await (0,iQ.C7)();if(t.total_file_count===e.fileCount)console.log("file count check passed ✅");else throw Error("total file count check failed ❌, expected: ".concat(t.total_file_count,",  got: ").concat(e.fileCount))}async function o3(t){let e=await (0,t_.zr)(),n=await (0,oQ.dm)(),i=new Set(n.map(t=>t.collectionID)),o=e.filter(t=>i.has(t.id));if(t.collection_count===o.length)console.log("collection count check passed ✅");else throw Error("total Collection count check failed ❌\n                expected : ".concat(t.collection_count,",  got: ").concat(o.length))}async function o9(t){let e=await (0,oQ.dm)(),n=await (0,t_.zr)(),i=(0,is.qF)(e),o=new Map(n.map(t=>[t.id,t.name])),a=new Map([...i.entries()].map(t=>{let[e,n]=t;return[o.get(e),n.length]}));Object.entries(t.collection_files_count).forEach(t=>{let[e,n]=t;if(n!==a.get(e))throw Error("collectionWiseFileCount check failed ❌\n                        for collection ".concat(e,"\n                        expected File count : ").concat(n," ,  got: ").concat(a.get(e)))}),console.log("collection wise file count check passed ✅")}async function o6(t){let e=(await (0,oQ.dm)()).filter(t=>t.metadata.hasStaticThumbnail),n=new Set,i=e.filter(t=>!n.has(t.id)&&(n.add(t.id),!0)),o=i.map(t=>t.metadata.title);if(t.thumbnail_generation_failure.count<i.length)throw Error("thumbnailGenerationFailedFiles Count Check failed ❌\n                expected: ".concat(t.thumbnail_generation_failure.count,",  got: ").concat(i.length));o.forEach(e=>{if(!t.thumbnail_generation_failure.files.includes(e))throw Error("thumbnailGenerationFailedFiles Check failed ❌\n                    expected: ".concat(t.thumbnail_generation_failure.files,",  got: ").concat(o))}),console.log("thumbnail generation failure check passed ✅")}async function o8(t){let e=(await (0,oQ.dm)()).filter(t=>t.metadata.fileType===ir.Gk.LIVE_PHOTO),n=new Set,i=e.filter(t=>!n.has(t.id)&&(n.add(t.id),!0)).map(t=>t.metadata.title);if(t.live_photo.count!==i.length)throw Error("livePhotoClubbing Check failed ❌\n                expected: ".concat(t.live_photo.count,",  got: ").concat(i.length));t.live_photo.files.forEach(e=>{if(!i.includes(e))throw Error("livePhotoClubbing Check failed ❌\n                        expected: ".concat(t.live_photo.files,",  got: ").concat(i))}),console.log("live-photo clubbing check passed ✅")}async function o7(t){let e=await (0,oQ.dm)();Object.entries(t.exif).map(t=>{let[n,i]=t,o=e.find(t=>t.metadata.title===n);if(!o)throw Error("exifDataParsingCheck failed , ".concat(n," missing"));if(i.creation_time&&i.creation_time!==o.metadata.creationTime)throw Error("exifDataParsingCheck failed ❌ ,\n                            for ".concat(n,"\n                            expected: ").concat(i.creation_time," got: ").concat(o.metadata.creationTime));if(i.location&&(Math.abs(i.location.latitude-o.metadata.latitude)>1||Math.abs(i.location.longitude-o.metadata.longitude)>1))throw Error("exifDataParsingCheck failed ❌  ,\n                            for ".concat(n,"\n                            expected: ").concat(JSON.stringify(i.location),"\n                            got: [").concat(o.metadata.latitude,",").concat(o.metadata.longitude,"]"))}),console.log("exif data parsing check passed ✅")}async function at(t){let e=await (0,oQ.dm)();Object.entries(t.file_dimensions).map(t=>{let[n,i]=t,o=e.find(t=>t.metadata.title===n);if(!o)throw Error("fileDimensionExtractionCheck failed , ".concat(n," missing"));if(i.width&&i.width!==o.pubMagicMetadata.data.w&&i.height&&i.height!==o.pubMagicMetadata.data.h)throw Error("fileDimensionExtractionCheck failed ❌ ,\n                                for ".concat(n,"\n                                expected: ").concat(i.width," x ").concat(i.height," got: ").concat(o.pubMagicMetadata.data.w," x ").concat(o.pubMagicMetadata.data.h))}),console.log("file dimension extraction check passed ✅")}async function ae(t){let e=await (0,oQ.dm)();Object.entries(t.google_import).map(t=>{let[n,i]=t,o=e.find(t=>t.metadata.title===n);if(!o)throw Error("exifDataParsingCheck failed , ".concat(n," missing"));if(i.creation_time&&i.creation_time!==o.metadata.creationTime)throw Error("googleMetadataJSON reading check failed ❌ ,\n                for ".concat(n,"\n                expected: ").concat(i.creation_time," got: ").concat(o.metadata.creationTime));if(i.location&&(Math.abs(i.location.latitude-o.metadata.latitude)>1||Math.abs(i.location.longitude-o.metadata.longitude)>1))throw Error("googleMetadataJSON reading check failed ❌  ,\n                                for ".concat(n,"\n                                expected: ").concat(JSON.stringify(i.location),"\n                                got: [").concat(o.metadata.latitude,",").concat(o.metadata.longitude,"]"))}),console.log("googleMetadataJSON reading check passed ✅")}function an(t){return t<10?"0".concat(t):t}function ai(t){var e;let{open:n,userDetails:i,onClose:o}=t,{setDialogMessage:a,isMobile:r}=(0,F.useContext)(U.AppContext);async function l(){try{await oO.Z.leaveFamily()}catch(t){a({title:(0,B.t)("ERROR"),close:{variant:"critical"},content:(0,B.t)("UNKNOWN_ERROR")})}}return((0,F.useEffect)(()=>{(0,iq.pt)("/images/family-plan")},[]),i)?(0,E.BX)(G.Z,{fullWidth:!0,open:n,onClose:o,maxWidth:"xs",fullScreen:r,children:[(0,E.BX)(nO.Z,{onClose:o,children:[(0,E.tZ)(N.Z,{variant:"h3",fontWeight:"bold",children:(0,B.t)("SUBSCRIPTION")}),(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("FAMILY_PLAN")})]}),(0,E.tZ)(Q.Z,{children:(0,E.BX)(I.wx,{children:[(0,E.BX)(td.Z,{mb:4,children:[(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("FAMILY_SUBSCRIPTION_INFO")}),(0,E.tZ)(N.Z,{children:null===(e=(0,oR.yS)(i.familyData))||void 0===e?void 0:e.email})]}),(0,E.tZ)("img",{height:256,src:"/images/family-plan/1x.png",srcSet:"/images/family-plan/2x.png 2x, /images/family-plan/3x.png 3x"}),(0,E.tZ)(I.A0,{px:2,children:(0,E.tZ)(eD.Z,{size:"large",variant:"outlined",color:"critical",onClick:()=>a({title:(0,B.t)("LEAVE_FAMILY_PLAN}"),content:(0,B.t)("LEAVE_FAMILY_CONFIRM"),proceed:{text:(0,B.t)("LEAVE"),action:l,variant:"critical"},close:{text:(0,B.t)("CANCEL")}}),children:(0,B.t)("LEAVE_FAMILY_PLAN")})})]})})]}):(0,E.tZ)(E.HY,{})}var ao=n(8656),aa=n(47508),ar=n(11026);let al=t=>{let{open:e,onClose:n,onRootClose:i}=t,{updateMlSearchEnabled:o,mlSearchEnabled:a,setDialogMessage:r,somethingWentWrong:l,startLoading:c,finishLoading:s}=(0,F.useContext)(U.AppContext),[d,u]=(0,F.useState)(!1),p=()=>{u(!0)},h=()=>{u(!1)},Z=async()=>{try{await (0,iQ.XY)()?o(!0):p()}catch(t){v.ZP.error("Enable ML search failed",t),l()}},f=async()=>{try{c(),await (0,iQ.Ee)(!0),o(!0),h(),s()}catch(t){v.ZP.error("Enable face search failed",t),l()}},g=async()=>{try{await o(!1),n()}catch(t){v.ZP.error("Disable ML search failed",t),l()}},m=async()=>{try{c(),await g(),s()}catch(t){v.ZP.error("Disable face search failed",t),l()}},A=()=>{n(),i()};return(0,E.BX)(td.Z,{children:[(0,E.tZ)(ef.c,{anchor:"left",transitionDuration:0,open:e,onClose:(t,e)=>{"backdropClick"===e?A():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:a?(0,E.tZ)(ad,{onClose:n,disableMlSearch:g,handleDisableFaceSearch:()=>{r({title:(0,B.t)("DISABLE_FACE_SEARCH_TITLE"),content:(0,E.tZ)(N.Z,{children:(0,E.tZ)(tb.cC,{i18nKey:"DISABLE_FACE_SEARCH_DESCRIPTION"})}),close:{text:(0,B.t)("CANCEL")},proceed:{variant:"primary",text:(0,B.t)("DISABLE_FACE_SEARCH"),action:m}})},onRootClose:A}):(0,E.tZ)(as,{onClose:n,enableMlSearch:Z,onRootClose:A})}),(0,E.tZ)(ac,{open:d,onClose:h,enableFaceSearch:f,onRootClose:A})]})};function ac(t){let{open:e,onClose:n,enableFaceSearch:i,onRootClose:o}=t,[a,r]=(0,F.useState)(!1);(0,F.useEffect)(()=>{r(!1)},[e]);let l=()=>{n(),o()};return(0,E.tZ)(ef.c,{transitionDuration:0,open:e,onClose:(t,e)=>{"backdropClick"===e?l():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:n,title:(0,B.t)("ENABLE_FACE_SEARCH_TITLE"),onRootClose:l}),(0,E.BX)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,E.tZ)(N.Z,{color:"text.muted",px:"8px",children:(0,E.tZ)(tb.cC,{i18nKey:"ENABLE_FACE_SEARCH_DESCRIPTION",components:{a:(0,E.tZ)(ny.Z,{target:"_blank",href:"https://ente.io/privacy#8-biometric-information-privacy-policy",underline:"always",sx:{color:"inherit",textDecorationColor:"inherit"}})}})}),(0,E.tZ)(i0.Z,{sx:{width:"100%"},children:(0,E.tZ)(io.Z,{sx:{color:"text.muted",ml:0,mt:2},control:(0,E.tZ)(i1.Z,{size:"small",checked:a,onChange:t=>r(t.target.checked)}),label:(0,B.t)("FACE_SEARCH_CONFIRMATION")})}),(0,E.BX)(tu.Z,{px:"8px",spacing:"8px",children:[(0,E.tZ)(eD.Z,{color:"accent",size:"large",disabled:!a,onClick:i,children:(0,B.t)("ENABLE_FACE_SEARCH")}),(0,E.tZ)(eD.Z,{color:"secondary",size:"large",onClick:n,children:(0,B.t)("CANCEL")})]})]})]})})}function as(t){let{onClose:e,enableMlSearch:n,onRootClose:i}=t,[o,a]=(0,F.useState)(!1);return(0,F.useEffect)(()=>{(0,ar.tS)().then(t=>a(t))},[]),(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:e,title:(0,B.t)("ML_SEARCH"),onRootClose:i}),(0,E.tZ)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:o?(0,E.tZ)(tu.Z,{px:"8px",spacing:"8px",children:(0,E.tZ)(eD.Z,{color:"accent",size:"large",onClick:n,children:(0,B.t)("ENABLE")})}):(0,E.BX)(td.Z,{px:"8px",children:[" ",(0,E.tZ)(N.Z,{color:"text.muted",children:"We're putting finishing touches, coming back soon!"})]})})]})}function ad(t){let{onClose:e,disableMlSearch:n,handleDisableFaceSearch:i,onRootClose:o}=t;return(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:e,title:(0,B.t)("ML_SEARCH"),onRootClose:o}),(0,E.tZ)(td.Z,{px:"16px",children:(0,E.BX)(tu.Z,{py:"20px",spacing:"24px",children:[(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{onClick:n,label:(0,B.t)("DISABLE_BETA")})}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{onClick:i,label:(0,B.t)("DISABLE_FACE_SEARCH")})})]})})]})}var au=n(69394);function ap(t){let{open:e,onClose:n,onRootClose:i}=t,o=(0,F.useContext)(U.AppContext),[a,r]=(0,F.useState)(!1),l=()=>{n(),i()},[c,s]=(0,F.useState)({indexed:0,pending:0});return(0,F.useEffect)(()=>(au.s.setOnUpdateHandler(s),au.s.getIndexingStatus().then(t=>s(t)),()=>au.s.setOnUpdateHandler(void 0)),[]),(0,E.BX)(ef.c,{transitionDuration:0,open:e,onClose:(t,e)=>{"backdropClick"===e?l():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:[(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:n,title:(0,B.t)("ADVANCED"),onRootClose:l}),(0,E.tZ)(td.Z,{px:"8px",children:(0,E.BX)(tu.Z,{py:"20px",spacing:"24px",children:[nF()()&&(0,E.BX)(td.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("LABS"),icon:(0,E.tZ)(aa.Z,{})}),(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{endIcon:(0,E.tZ)(eC.Z,{}),onClick:()=>r(!0),label:(0,B.t)("ML_SEARCH")})})]}),(0,E.BX)(td.Z,{children:[(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{variant:"toggle",checked:!o.isCFProxyDisabled,onClick:()=>{o.setIsCFProxyDisabled(!o.isCFProxyDisabled)},label:(0,B.t)("FASTER_UPLOAD")})}),(0,E.tZ)(ey.Z,{title:(0,B.t)("FASTER_UPLOAD_DESCRIPTION")})]}),nF()()&&(0,E.BX)(td.Z,{children:[(0,E.tZ)(ey.Z,{title:(0,B.t)("MAGIC_SEARCH_STATUS")}),(0,E.BX)(tu.Z,{py:"12px",px:"12px",spacing:"24px",children:[(0,E.BX)(I.zr,{justifyContent:"space-between",alignItems:"center",children:[(0,E.tZ)(N.Z,{children:(0,B.t)("INDEXED_ITEMS")}),(0,E.tZ)(N.Z,{children:(0,nY.u)(c.indexed)})]}),(0,E.BX)(I.zr,{justifyContent:"space-between",alignItems:"center",children:[(0,E.tZ)(N.Z,{children:(0,B.t)("PENDING_ITEMS")}),(0,E.tZ)(N.Z,{children:(0,nY.u)(c.pending)})]})]})]})]})})]}),(0,E.tZ)(al,{open:a,onClose:()=>r(!1),onRootClose:l})]})}function ah(t){let{open:e,onClose:n,onRootClose:i}=t,{mapEnabled:o,updateMapEnabled:a}=(0,F.useContext)(U.AppContext),[r,l]=(0,F.useState)(!1);(0,F.useEffect)(()=>{e&&(async()=>{a(await (0,iQ.KV)())})()},[e]);let c=()=>{n(),i()};return(0,E.BX)(ef.c,{transitionDuration:0,open:e,onClose:(t,e)=>{"backdropClick"===e?c():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:[(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:n,title:(0,B.t)("MAP"),onRootClose:c}),(0,E.tZ)(td.Z,{px:"8px",children:(0,E.tZ)(tu.Z,{py:"20px",spacing:"24px",children:(0,E.tZ)(td.Z,{children:(0,E.tZ)(ew.G,{children:(0,E.tZ)(eA.v,{onClick:()=>l(!0),variant:"toggle",checked:o,label:(0,B.t)("MAP_SETTINGS")})})})})})]}),(0,E.tZ)(aZ,{open:r,mapEnabled:o,onClose:()=>l(!1),onRootClose:c})]})}let aZ=t=>{let{open:e,onClose:n,onRootClose:i,mapEnabled:o}=t,{somethingWentWrong:a,updateMapEnabled:r}=(0,F.useContext)(U.AppContext),l=async()=>{try{await r(!1),n()}catch(t){v.ZP.error("Disable Map failed",t),a()}},c=async()=>{try{await r(!0),n()}catch(t){v.ZP.error("Enable Map failed",t),a()}},s=()=>{n(),i()};return(0,E.tZ)(td.Z,{children:(0,E.tZ)(ef.c,{anchor:"left",transitionDuration:0,open:e,onClose:(t,e)=>{"backdropClick"===e?s():n()},slotProps:{backdrop:{sx:{"&&&":{backgroundColor:"transparent"}}}},children:o?(0,E.tZ)(ag,{onClose:n,disableMap:l,onRootClose:s}):(0,E.tZ)(af,{onClose:n,enableMap:c,onRootClose:s})})})};function af(t){let{onClose:e,enableMap:n,onRootClose:i}=t;return(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:e,title:(0,B.t)("ENABLE_MAPS"),onRootClose:i}),(0,E.BX)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,E.BX)(td.Z,{px:"8px",children:[" ",(0,E.tZ)(N.Z,{color:"text.muted",children:(0,E.tZ)(tb.cC,{i18nKey:"ENABLE_MAP_DESCRIPTION",components:{a:(0,E.tZ)(ny.Z,{target:"_blank",href:"https://www.openstreetmap.org/"})}})})]}),(0,E.BX)(tu.Z,{px:"8px",spacing:"8px",children:[(0,E.tZ)(eD.Z,{color:"accent",size:"large",onClick:n,children:(0,B.t)("ENABLE")}),(0,E.tZ)(eD.Z,{color:"secondary",size:"large",onClick:e,children:(0,B.t)("CANCEL")})]})]})]})}function ag(t){let{onClose:e,disableMap:n,onRootClose:i}=t;return(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:e,title:(0,B.t)("DISABLE_MAPS"),onRootClose:i}),(0,E.BX)(tu.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,E.tZ)(td.Z,{px:"8px",children:(0,E.tZ)(N.Z,{color:"text.muted",children:(0,E.tZ)(tb.cC,{i18nKey:"DISABLE_MAP_DESCRIPTION"})})}),(0,E.BX)(tu.Z,{px:"8px",spacing:"8px",children:[(0,E.tZ)(eD.Z,{color:"critical",size:"large",onClick:n,children:(0,B.t)("DISABLE")}),(0,E.tZ)(eD.Z,{color:"secondary",size:"large",onClick:e,children:(0,B.t)("CANCEL")})]})]})]})}function am(t){let{open:e,onClose:n,onRootClose:i}=t,[o,a]=(0,F.useState)(!1),[r,l]=(0,F.useState)(!1),c=()=>{n(),i()};return(0,E.BX)(ef.c,{transitionDuration:0,open:e,onClose:(t,e)=>{"backdropClick"===e?c():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:[(0,E.BX)(tu.Z,{spacing:"4px",py:"12px",children:[(0,E.tZ)(eg.Z,{onClose:n,title:(0,B.t)("PREFERENCES"),onRootClose:c}),(0,E.tZ)(td.Z,{px:"8px",children:(0,E.BX)(tu.Z,{py:"20px",spacing:"24px",children:[(0,E.tZ)(aA,{}),(0,E.tZ)(eA.v,{onClick:()=>l(!0),endIcon:(0,E.tZ)(eC.Z,{}),label:(0,B.t)("MAP")}),(0,E.tZ)(eA.v,{onClick:()=>a(!0),endIcon:(0,E.tZ)(eC.Z,{}),label:(0,B.t)("ADVANCED")})]})})]}),(0,E.tZ)(ap,{open:o,onClose:()=>a(!1),onRootClose:i}),(0,E.tZ)(ah,{open:r,onClose:()=>l(!1),onRootClose:i})]})}let aA=()=>{let t=(0,ao.F2)(),e=(0,oe.useRouter)(),n=ao.nD.map(t=>({label:aE(t),value:t}));return(0,E.tZ)(i3,{options:n,label:(0,B.t)("LANGUAGE"),labelProps:{color:"text.muted"},selected:t,setSelected:t=>{(0,ao.oj)(t),e.reload()}})},aE=t=>{switch(t){case"en-US":return"English";case"fr-FR":return"Fran\xe7ais";case"de-DE":return"Deutsch";case"zh-CN":return"中文";case"nl-NL":return"Nederlands";case"es-ES":return"Espa\xf1ol";case"pt-BR":return"Brazilian Portuguese";case"ru-RU":return"Russian"}};var aC=n(80427);function av(){let t=(0,A._)(["\n    display: none;\n    @media (max-width: 359px) {\n        display: block;\n    }\n"]);return av=function(){return t},t}function aI(){let t=(0,A._)(["\n    display: none;\n    @media (min-width: 360px) {\n        display: block;\n    }\n"]);return aI=function(){return t},t}let aw=(0,D.ZP)(td.Z)(av()),ay=(0,D.ZP)(td.Z)(aI());function ax(t){let{usage:e,storage:n}=t;return(0,E.BX)(td.Z,{width:"100%",children:[(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",children:(0,B.t)("STORAGE")}),(0,E.tZ)(ay,{children:(0,E.tZ)(N.Z,{fontWeight:"bold",sx:{fontSize:"24px",lineHeight:"30px"},children:"".concat((0,aC.nS)(e,{round:!0})," ").concat((0,B.t)("OF")," ").concat((0,aC.nS)(n)," ").concat((0,B.t)("USED"))})}),(0,E.tZ)(aw,{children:(0,E.tZ)(N.Z,{fontWeight:"bold",sx:{fontSize:"24px",lineHeight:"30px"},children:"".concat((0,aC.e8)(e)," /  ").concat((0,aC.e8)(n)," ").concat((0,B.t)("storage_unit.gb")," ").concat((0,B.t)("USED"))})})]})}var aS=n(66177);function aT(){let t=(0,A._)(["\n    font-size: 4px;\n    margin: 0 ",";\n    color: inherit;\n"]);return aT=function(){return t},t}function ab(){let t=(0,A._)(["\n    font-size: 8.71px;\n    margin: 0;\n    margin-right: 4px;\n    color: inherit;\n"]);return ab=function(){return t},t}let a_=(0,D.ZP)(n0.Z)(()=>({".MuiLinearProgress-bar":{borderRadius:"2px"},borderRadius:"2px",backgroundColor:"rgba(255, 255, 255, 0.2)"}));a_.defaultProps={variant:"determinate"};let aO=(0,D.ZP)(aS.Z)(aT(),t=>{let{theme:e}=t;return e.spacing(1)}),aL=(0,D.ZP)(aO)(ab());function aR(t){let{label:e,color:n}=t;return(0,E.BX)(I.A0,{children:[(0,E.tZ)(aL,{sx:{color:n}}),(0,E.tZ)(N.Z,{variant:"mini",fontWeight:"bold",children:e})]})}function aP(t){let{userUsage:e,totalUsage:n,totalStorage:i}=t;return(0,E.BX)(td.Z,{position:"relative",width:"100%",children:[(0,E.tZ)(a_,{sx:{backgroundColor:"transparent"},value:Math.min(100*e/i,100)}),(0,E.tZ)(a_,{sx:{position:"absolute",top:0,zIndex:1,".MuiLinearProgress-bar ":{backgroundColor:"text.muted"},width:"100%"},value:Math.min(100*n/i,100)})]})}function aD(t){let{userUsage:e,totalUsage:n,fileCount:i,totalStorage:o}=t;return(0,E.BX)(td.Z,{width:"100%",children:[(0,E.tZ)(aP,{totalUsage:n,userUsage:e,totalStorage:o}),(0,E.BX)(I.Gm,{sx:{marginTop:1.5},children:[(0,E.BX)(tu.Z,{direction:"row",spacing:1.5,children:[(0,E.tZ)(aR,{label:(0,B.t)("YOU"),color:"text.base"}),(0,E.tZ)(aR,{label:(0,B.t)("FAMILY"),color:"text.muted"})]}),(0,E.tZ)(N.Z,{variant:"mini",fontWeight:"bold",children:(0,B.t)("photos_count",{count:null!=i?i:0})})]})]})}function aN(t){var e;let{userDetails:n}=t,i=(0,F.useMemo)(()=>(0,oR.uD)(n.familyData)?n.familyData.members.reduce((t,e)=>t+e.usage,0):n.usage,[n]),o=n.familyData.storage+(null!==(e=n.storageBonus)&&void 0!==e?e:0);return(0,E.BX)(E.HY,{children:[(0,E.tZ)(ax,{storage:o,usage:i}),(0,E.tZ)(aD,{userUsage:n.usage,fileCount:n.fileCount,totalUsage:i,totalStorage:o})]})}function ak(t){let{usage:e,storage:n,fileCount:i}=t;return(0,E.BX)(td.Z,{width:"100%",children:[(0,E.tZ)(a_,{value:Math.min(100*e/n,100)}),(0,E.BX)(I.Gm,{sx:{marginTop:1.5},children:[(0,E.tZ)(N.Z,{variant:"mini",children:"".concat((0,aC.nS)(n-e)," ").concat((0,B.t)("FREE"))}),(0,E.tZ)(N.Z,{variant:"mini",fontWeight:"bold",children:(0,B.t)("photos_count",{count:null!=i?i:0})})]})]})}function aM(t){var e;let{userDetails:n}=t,i=n.subscription.storage+(null!==(e=n.storageBonus)&&void 0!==e?e:0);return(0,E.BX)(E.HY,{children:[(0,E.tZ)(ax,{storage:i,usage:n.usage}),(0,E.tZ)(ak,{usage:n.usage,fileCount:n.fileCount,storage:i})]})}function aB(t){let{userDetails:e}=t;return(0,E.tZ)(I.aV,{children:(0,E.tZ)(I.Gm,{height:"100%",flexDirection:"column",padding:"20px 16px",children:(0,oR.dc)(e.familyData)?(0,E.tZ)(aN,{userDetails:e}):(0,E.tZ)(aM,{userDetails:e})})})}function aU(t){let{userDetails:e,onClick:n}=t;return e?(0,E.BX)(td.Z,{position:"relative",children:[(0,E.tZ)(aF,{}),(0,E.tZ)(aB,{userDetails:e}),(0,E.tZ)(aH,{onClick:n})]}):(0,E.tZ)(iz.Z,{animation:"wave",variant:"rectangular",height:152,sx:{borderRadius:"8px"}})}function aF(){return(0,E.tZ)("img",{style:{aspectRatio:"2/1"},width:"100%",src:"/images/subscription-card-background/1x.png",srcSet:"/images/subscription-card-background/2x.png 2x, /images/subscription-card-background/3x.png 3x"})}function aH(t){let{onClick:e}=t;return(0,E.tZ)(I.aV,{display:"flex",children:(0,E.tZ)(I.A0,{onClick:e,justifyContent:"flex-end",sx:{cursor:"pointer"},children:(0,E.tZ)(eC.Z,{})})})}function aX(t){let{collectionSummaries:e,sidebarView:n,closeSidebar:i}=t;return(0,E.BX)(aK,{open:n,onClose:i,children:[(0,E.tZ)(aG,{closeSidebar:i}),(0,E.tZ)(K.Z,{}),(0,E.tZ)(aW,{sidebarView:n}),(0,E.BX)(tu.Z,{spacing:.5,mb:3,children:[(0,E.tZ)(aY,{closeSidebar:i,collectionSummaries:e}),(0,E.tZ)(az,{closeSidebar:i}),(0,E.tZ)(K.Z,{}),(0,E.tZ)(aj,{}),(0,E.tZ)(K.Z,{}),(0,E.tZ)(aQ,{}),(0,E.tZ)(K.Z,{}),(0,E.tZ)(aq,{})]})]})}let aK=(0,D.ZP)(ef.c)(t=>{let{theme:e}=t;return{"& .MuiPaper-root":{padding:e.spacing(1.5)}}});aK.defaultProps={anchor:"left"};let aG=t=>{let{closeSidebar:e}=t;return(0,E.BX)(I.Gm,{mt:.5,mb:1,pl:1.5,children:[(0,E.tZ)(iv.W,{}),(0,E.tZ)(tY.Z,{"aria-label":"close",onClick:e,color:"secondary",children:(0,E.tZ)(tc.Z,{fontSize:"small"})})]})},aW=t=>{let{sidebarView:e}=t,n=(0,F.useContext)(lM),[i,o]=(0,X.T)(O.Pd.USER_DETAILS,void 0),[a,r]=(0,F.useState)(!1),l=()=>r(!0);(0,F.useEffect)(()=>{e&&(async()=>{let t=await (0,iQ.C7)();o(t),(0,O.a_)(O.Pd.SUBSCRIPTION,t.subscription),(0,O.a_)(O.Pd.FAMILY_DATA,t.familyData),(0,O.a_)(O.Pd.USER,{...(0,O.Yu)(O.Pd.USER),email:t.email})})()},[e]);let c=(0,F.useMemo)(()=>i&&(0,oR.uD)(i.familyData)&&!(0,oR.re)(i.familyData),[i]);return(0,E.BX)(E.HY,{children:[(0,E.BX)(td.Z,{px:.5,mt:2,pb:1.5,mb:1,children:[(0,E.tZ)(N.Z,{px:1,pb:1,color:"text.muted",children:i?i.email:(0,E.tZ)(iz.Z,{animation:"wave"})}),(0,E.tZ)(aU,{userDetails:i,onClick:()=>{c?l():i&&oF(i.subscription)&&oX(i.subscription)?oO.Z.redirectToCustomerPortal():n.showPlanSelectorModal()}}),(0,E.tZ)(aV,{userDetails:i})]}),c&&(0,E.tZ)(ai,{userDetails:i,open:a,onClose:()=>r(!1)})]})},aV=t=>{let e,{userDetails:n}=t,{showPlanSelectorModal:i}=(0,F.useContext)(lM),o=(0,F.useMemo)(()=>!(!n||(0,oR.uD)(n.familyData)&&!(0,oR.re)(n.familyData)||oD(n.subscription)&&!oB(n.subscription)),[n]),a=(0,F.useMemo)(()=>t=>{t.stopPropagation(),n&&(oN(n.subscription)?oH(n)&&i():oF(n.subscription)&&oX(n.subscription)?oO.Z.redirectToCustomerPortal():i())},[n]);if(!o)return(0,E.tZ)(E.HY,{});if(!oM(n.bonusData)){if(oN(n.subscription)){var r,l;ok(n.subscription)?e=(0,E.tZ)(tb.cC,{i18nKey:"FREE_SUBSCRIPTION_INFO",values:{date:null===(r=n.subscription)||void 0===r?void 0:r.expiryTime}}):oB(n.subscription)&&(e=(0,B.t)("RENEWAL_CANCELLED_SUBSCRIPTION_INFO",{date:null===(l=n.subscription)||void 0===l?void 0:l.expiryTime}))}else e=(0,E.tZ)(tb.cC,{i18nKey:"SUBSCRIPTION_EXPIRED_MESSAGE",components:{a:(0,E.tZ)(nJ.Z,{onClick:a})}})}return(!e&&oH(n)&&(e=(0,E.tZ)(tb.cC,{i18nKey:"STORAGE_QUOTA_EXCEEDED_SUBSCRIPTION_INFO",components:{a:(0,E.tZ)(nJ.Z,{onClick:a})}})),e)?(0,E.tZ)(td.Z,{px:1,pt:.5,children:(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",onClick:a&&a,sx:{cursor:a&&"pointer"},children:e})}):(0,E.tZ)(E.HY,{})},aY=t=>{var e,n,i;let{closeSidebar:o,collectionSummaries:a}=t,r=(0,F.useContext)(lM),[l,c]=(0,F.useState)();return(0,F.useEffect)(()=>{(async()=>{let t=await (0,t_.hT)();t?c(t.id):c(tm.Ei)})()},[]),(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(iG.Z,{}),onClick:()=>{r.setActiveCollectionID(l),o()},variant:"captioned",label:(0,B.t)("UNCATEGORIZED"),subText:null===(e=a.get(l))||void 0===e?void 0:e.fileCount.toString()}),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(tw.Z,{}),onClick:()=>{r.setActiveCollectionID(tm.TS),o()},variant:"captioned",label:(0,B.t)("ARCHIVE_SECTION_NAME"),subText:null===(n=a.get(tm.TS))||void 0===n?void 0:n.fileCount.toString()}),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(iY.Z,{}),onClick:()=>{r.openHiddenSection(()=>{o()})},variant:"captioned",label:(0,B.t)("HIDDEN"),subIcon:(0,E.tZ)(iV.Z,{})}),(0,E.tZ)(eA.v,{startIcon:(0,E.tZ)(iW.Z,{}),onClick:()=>{r.setActiveCollectionID(tm.jn),o()},variant:"captioned",label:(0,B.t)("TRASH"),subText:null===(i=a.get(tm.jn))||void 0===i?void 0:i.fileCount.toString()})]})},az=t=>{let{closeSidebar:e}=t,n=(0,oe.useRouter)(),i=(0,F.useContext)(U.AppContext),{setDialogMessage:o,startLoading:a,watchFolderView:r,setWatchFolderView:l,themeColor:c,setThemeColor:s}=i,[d,u]=(0,F.useState)(!1),[p,h]=(0,F.useState)(!1),[Z,f]=(0,F.useState)(!1),g=async()=>{e();try{if(!await iN()){let t=await (0,x.yr)(),e=await ng(),n=await e7.Z.getInstance(),i=await nZ(e,await n.fromHex(t));await ik(e,i.encryptedData,i.nonce)}let t=await (0,iQ.SI)();window.open("".concat((0,nv.KS)()).concat(y.gp.ACCOUNT_HANDOFF,"?package=").concat(iD.SL.photos,"&token=").concat(t))}catch(t){v.ZP.error("failed to redirect to accounts page",t)}};return(0,E.BX)(E.HY,{children:[nF()()&&(0,E.tZ)(eA.v,{onClick:()=>{nF()()?l(!0):o((0,nX.nf)())},variant:"secondary",label:(0,B.t)("WATCH_FOLDERS")}),(0,E.tZ)(eA.v,{variant:"secondary",onClick:()=>u(!0),label:(0,B.t)("RECOVERY_KEY")}),aJ()&&(0,E.tZ)(eA.v,{onClick:()=>{s(c===iB.l.DARK?iB.l.LIGHT:iB.l.DARK)},variant:"secondary",label:(0,B.t)("CHOSE_THEME"),endIcon:(0,E.tZ)(iK,{themeColor:c,setThemeColor:s})}),(0,E.tZ)(eA.v,{variant:"secondary",onClick:()=>h(!0),label:(0,B.t)("TWO_FACTOR")}),aJ()&&(0,E.tZ)(eA.v,{variant:"secondary",onClick:g,label:(0,B.t)("PASSKEYS")}),(0,E.tZ)(eA.v,{variant:"secondary",onClick:()=>{e(),n.push(y.Wu.CHANGE_PASSWORD)},label:(0,B.t)("CHANGE_PASSWORD")}),(0,E.tZ)(eA.v,{variant:"secondary",onClick:()=>{e(),n.push(y.Wu.CHANGE_EMAIL)},label:(0,B.t)("CHANGE_EMAIL")}),(0,E.tZ)(eA.v,{variant:"secondary",onClick:()=>n.push(y.Wu.DEDUPLICATE),label:(0,B.t)("DEDUPLICATE_FILES")}),(0,E.tZ)(eA.v,{variant:"secondary",onClick:()=>f(!0),label:(0,B.t)("PREFERENCES")}),(0,E.tZ)(iM.Z,{isMobile:i.isMobile,show:d,onHide:()=>u(!1),somethingWentWrong:()=>o({title:(0,B.t)("ERROR"),content:(0,B.t)("RECOVER_KEY_GENERATION_FAILED"),close:{variant:"critical"}})}),(0,E.tZ)(ol,{show:p,onHide:()=>h(!1),closeSidebar:e,setLoading:a}),nF()()&&(0,E.tZ)(om,{open:r,onClose:()=>l(!1)}),(0,E.tZ)(am,{open:Z,onClose:()=>f(!1),onRootClose:e})]})},aj=()=>{let{setDialogMessage:t}=(0,F.useContext)(U.AppContext),{openExportModal:e}=(0,F.useContext)(lM);return(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{onClick:()=>(0,iq.nG)("https://github.com/ente-io/ente/discussions",!0),label:(0,B.t)("REQUEST_FEATURE"),variant:"secondary"}),(0,E.tZ)(eA.v,{onClick:()=>(0,iq.nG)("mailto:support@ente.io",!0),labelComponent:(0,E.tZ)(o_.F,{href:"mailto:support@ente.io",children:(0,E.tZ)(N.Z,{fontWeight:"bold",children:(0,B.t)("SUPPORT")})}),variant:"secondary"}),(0,E.tZ)(eA.v,{onClick:function(){nF()()?e():t((0,nX.nf)())},label:(0,B.t)("EXPORT"),endIcon:nH.ZP.isExportInProgress()&&(0,E.tZ)(w.Z,{size:"20px"}),variant:"secondary"})]})},aQ=()=>{let{setDialogMessage:t,logout:e}=(0,F.useContext)(U.AppContext),[n,i]=(0,F.useState)(!1);return(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{onClick:()=>{t({title:(0,B.t)("LOGOUT_MESSAGE"),proceed:{text:(0,B.t)("LOGOUT"),action:e,variant:"critical"},close:{text:(0,B.t)("CANCEL")}})},color:"critical",label:(0,B.t)("LOGOUT"),variant:"secondary"}),(0,E.tZ)(eA.v,{onClick:()=>i(!0),color:"critical",variant:"secondary",label:(0,B.t)("DELETE_ACCOUNT")}),(0,E.tZ)(i8,{open:n,onClose:()=>i(!1)})]})},aq=()=>{let t=(0,F.useContext)(U.AppContext),[e,n]=(0,F.useState)(),i=globalThis.electron;(0,F.useEffect)(()=>{null==i||i.appVersion().then(t=>n(t))});let o=()=>{v.ZP.info("Downloading logs"),i?i.openLogDirectory():(0,P.KG)("debug_logs_".concat(Date.now(),".txt"),(0,iP.Is)())};return(0,E.BX)(E.HY,{children:[(0,E.tZ)(eA.v,{onClick:()=>t.setDialogMessage({title:(0,B.t)("DOWNLOAD_LOGS"),content:(0,E.tZ)(tb.cC,{i18nKey:"DOWNLOAD_LOGS_MESSAGE"}),proceed:{text:(0,B.t)("DOWNLOAD"),variant:"accent",action:o},close:{text:(0,B.t)("CANCEL")}}),variant:"mini",label:(0,B.t)("DOWNLOAD_UPLOAD_LOGS")}),e&&(0,E.tZ)(N.Z,{py:"14px",px:"16px",color:"text.muted",variant:"mini",children:e}),aJ()&&(0,E.tZ)(eA.v,{variant:"secondary",onClick:o5,label:"Test Upload"})]})},aJ=()=>{var t;let e=null===(t=(0,O.Yu)(O.Pd.USER))||void 0===t?void 0:t.email;return!!e&&e.endsWith("@ente.io")};var a$=n(8854),a0=n(4367),a1=n(42603);function a2(t){let{openSidebar:e}=t;return(0,E.tZ)(tY.Z,{onClick:e,sx:{pl:0},children:(0,E.tZ)(a1.Z,{})})}var a5=n(59409),a4=n(28504),a3=n(31563),a9=n(65847);function a6(){let t=(0,A._)(["\n    padding: 0 24px;\n    @media (max-width: ","px) {\n        padding: 0 4px;\n    }\n"]);return a6=function(){return t},t}function a8(){let t=(0,A._)(["\n    display: flex;\n    cursor: pointer;\n    align-items: center;\n    justify-content: flex-end;\n    @media (min-width: 625px) {\n        display: none;\n    }\n"]);return a8=function(){return t},t}function a7(){let t=(0,A._)(["\n            @media (max-width: 624px) {\n                display: none;\n            }\n        "]);return a7=function(){return t},t}function rt(){let t=(0,A._)(["\n    background: ",";\n    max-width: 484px;\n    margin: auto;\n    ","\n"]);return rt=function(){return t},t}let re=(0,D.ZP)(I.A0)(a6(),a9.C3*a9.yc),rn=(0,D.ZP)(I.G5)(a8()),ri=(0,D.ZP)(I.Tn,{shouldForwardProp:t=>"isOpen"!=t})(rt(),t=>{let{theme:e}=t;return e.colors.background.base},t=>!t.isOpen&&(0,ea.iv)(a7()));function ro(t){let{show:e,showSearchInput:n}=t;return e?(0,E.tZ)(rn,{children:(0,E.tZ)(I.G5,{justifyContent:"flex-end",ml:1.5,children:(0,E.tZ)(tY.Z,{onClick:n,children:(0,E.tZ)(a3.Z,{})})})}):(0,E.tZ)(E.HY,{})}var ra=n(63923),rr=n(64990),rl=n(67548),rc=n(74473);(g||(g={})).LOCATION_TAG="location",(s=m||(m={})).DATE="DATE",s.LOCATION="LOCATION",s.COLLECTION="COLLECTION",s.FILE_NAME="FILE_NAME",s.PERSON="PERSON",s.INDEX_STATUS="INDEX_STATUS",s.FILE_CAPTION="FILE_CAPTION",s.FILE_TYPE="FILE_TYPE",s.CLIP="CLIP",s.CITY="CITY";var rs=n(77033),rd=n(10986);class ru{async getInstance(){return this.comlinkWorkerInstance||(this.comlinkWorker||(this.comlinkWorker=rp()),this.comlinkWorkerInstance=await this.comlinkWorker.remote),this.comlinkWorkerInstance}}let rp=()=>{if((0,rs.ly)())return new rd.d("ente-search-worker",new Worker(n.tu(new URL(n.p+n.u(1724),n.b))))};var rh=new ru,rZ=n(72679),rf=n(89610);let rg=t=>{let e=new Map;return t.forEach(t=>{let n=e.get(t.id);(!n||n.updatedAt<t.updatedAt)&&e.set(t.id,t)}),Array.from(e.values())},rm=(0,nv.O3)(),rA={[g.LOCATION_TAG]:"location_tags"},rE={[g.LOCATION_TAG]:"location_tags_key"},rC={[g.LOCATION_TAG]:"location_tags_time"},rv=async t=>await rf.Z.getItem(rA[t])||[],rI=async t=>{var e;return null!==(e=await rf.Z.getItem(rC[t]))&&void 0!==e?e:0},rw=async t=>await rf.Z.getItem(rE[t])||null,ry=async t=>{try{let e=await rw(t);if(e)return e;let n=(0,L.LP)();if(!n)return;let i=(await nC.Z.get("".concat(rm,"/user-entity/key"),{type:t},{"X-Auth-Token":n})).data,o=await e7.Z.getInstance(),a=await (0,iJ.G)(),{encryptedKey:r,header:l,...c}=i,s={data:await o.decryptB64(r,l,a),...c};return rf.Z.setItem(rE[t],s),s}catch(t){throw v.ZP.error("Get entity key failed",t),t}},rx=async t=>{try{return await rT(t),await rv(t)}catch(t){throw v.ZP.error("Sync entities failed",t),t}},rS=async()=>{try{await rT(g.LOCATION_TAG)}catch(t){throw v.ZP.error("Sync entities failed",t),t}},rT=async t=>{try{let n,i=await rv(t);v.ZP.info("Syncing ".concat(t," entities localEntitiesCount: ").concat(i.length));let o=await rI(t);v.ZP.info("Syncing ".concat(t," entities syncTime: ").concat(o));do{var e;if(n=await rb(t,o),!(null===(e=n.diff)||void 0===e?void 0:e.length))return;let a=await ry(t),r=await Promise.all(n.diff.map(async t=>{if(t.isDeleted)return t;let{encryptedData:e,header:n,...i}=t,o=await e7.Z.getInstance(),r=await o.decryptMetadata(e,n,a.data);return{...i,data:r}})),l=(i=rg([...i,...r])).filter(t=>!t.isDeleted);n.diff.length&&(o=n.diff.slice(-1)[0].updatedAt),await rf.Z.setItem(rA[t],l),await rf.Z.setItem(rC[t],o),v.ZP.info("Syncing ".concat(t," entities syncedEntitiesCount: ").concat(l.length))}while(500===n.diff.length)}catch(t){v.ZP.error("Sync entity failed",t)}},rb=async(t,e)=>{try{let n=(0,L.LP)();if(!n)return;return(await nC.Z.get("".concat(rm,"/user-entity/entity/diff"),{sinceTime:e,type:t,limit:500},{"X-Auth-Token":n})).data}catch(t){throw v.ZP.error("Get entity diff failed",t),t}};var r_=n(90879);class rO{async loadCities(){try{if(this.citiesPromise)return;this.citiesPromise=fetch("https://static.ente.io/world_cities.json").then(t=>t.json().then(t=>{this.cities=t.data})),await this.citiesPromise}catch(t){v.ZP.error("LocationSearchService loadCities failed",t),this.citiesPromise=null}}async searchCities(t){try{return this.citiesPromise||this.loadCities(),await this.citiesPromise,this.cities.filter(e=>e.city.toLowerCase().startsWith(t.toLowerCase()))}catch(t){throw v.ZP.error("LocationSearchService searchCities failed",t),t}}constructor(){this.cities=[]}}var rL=new rO;let rR=new Set(["0","1","2","3","4","5","6","7","8","9"]),rP=async()=>[...await (0,ar.ul)()?[await rM()]:[],...await rN(await rk())].filter(t=>!!t),rD=(t,e)=>async n=>{try{var i,o,a,r;if(!(null==(n=n.trim().toLowerCase())?void 0:n.length))return[];let l=[await rU(n),...(i=n,[{label:(0,B.t)("IMAGE"),value:ir.Gk.IMAGE,type:m.FILE_TYPE},{label:(0,B.t)("VIDEO"),value:ir.Gk.VIDEO,type:m.FILE_TYPE},{label:(0,B.t)("LIVE_PHOTO"),value:ir.Gk.LIVE_PHOTO,type:m.FILE_TYPE}].filter(t=>t.label.toLowerCase().includes(i))),...(o=n,[{label:(0,B.t)("CHRISTMAS"),value:{month:11,date:25},type:m.DATE},{label:(0,B.t)("CHRISTMAS_EVE"),value:{month:11,date:24},type:m.DATE},{label:(0,B.t)("NEW_YEAR"),value:{month:0,date:1},type:m.DATE},{label:(0,B.t)("NEW_YEAR_EVE"),value:{month:11,date:31},type:m.DATE}].filter(t=>t.label.toLowerCase().includes(o))),...function(t){if(4===t.length)try{let e=parseInt(t);if(e>=1970&&e<=new Date().getFullYear())return[{label:t,value:{year:e},type:m.DATE}]}catch(t){v.ZP.error("getYearSuggestion failed",t)}return[]}(n),...(a=n,(function(t){let e=rc.sG(t),n=rc.sG("".concat(t," 1"));if(null!==e){let n=[{month:e.getMonth()},{date:e.getDate(),month:e.getMonth()}],i=!1;return(t.split("").forEach(t=>{rR.has(t)&&(i=!0)}),i)?n.reverse():n}return n?[{month:n.getMonth()}]:[]})(a).map(t=>({type:m.DATE,value:t,label:function(t){var e,n,i;let o={};return t.date&&(o.day="numeric"),(t.month||0===t.month)&&(o.month="long"),t.year&&(o.year="numeric"),new Intl.DateTimeFormat("en-IN",o).format(new Date(null!==(e=t.year)&&void 0!==e?e:1,null!==(n=t.month)&&void 0!==n?n:1,null!==(i=t.date)&&void 0!==i?i:1))}(t)}))),...(r=n,e.filter(t=>t.name.toLowerCase().includes(r)).map(t=>({type:m.COLLECTION,value:t.id,label:t.name}))),function(t,e){let n=e.filter(e=>e.id.toString().includes(t)||e.metadata.title.toLowerCase().includes(t));return{type:m.FILE_NAME,value:n.map(t=>t.id),label:t}}(n,t),function(t,e){let n=e.filter(e=>{var n;return e.pubMagicMetadata&&(null===(n=e.pubMagicMetadata.data.caption)||void 0===n?void 0:n.toLowerCase().includes(t))});return{type:m.FILE_CAPTION,value:n.map(t=>t.id),label:t}}(n,t),...await rB(n)].filter(t=>!!t);return rN(l)}catch(t){return v.ZP.error("getAutoCompleteSuggestions failed",t),[]}};async function rN(t){let e=await rh.getInstance(),n=[];for(let i of t){let t=function(t){switch(t.type){case m.DATE:return{date:t.value};case m.LOCATION:return{location:t.value};case m.CITY:return{city:t.value};case m.COLLECTION:return{collection:t.value};case m.FILE_NAME:case m.FILE_CAPTION:return{files:t.value};case m.PERSON:return{person:t.value};case m.FILE_TYPE:return{fileType:t.value};case m.CLIP:return{clip:t.value}}}(i),o=(0,is.V_)(await e.search(t));(null==t?void 0:t.clip)&&o.sort((e,n)=>{let i=t.clip.get(e.id);return t.clip.get(n.id)-i}),o.length&&n.push({...i,fileCount:o.length,previewFiles:o.slice(0,3)})}return n}async function rk(){try{return(await rX(200)).map(t=>({label:t.name,type:m.PERSON,value:t,hide:!0}))}catch(t){return v.ZP.error("getAllPeopleSuggestion failed",t),[]}}async function rM(){try{let t;let e=r_.ZP.isSyncing,n=await (0,ar.v3)(e);switch(n.phase){case"scheduled":t=(0,B.t)("INDEXING_SCHEDULED");break;case"indexing":t=(0,B.t)("ANALYZING_PHOTOS",{indexStatus:n});break;case"clustering":t=(0,B.t)("INDEXING_PEOPLE",{indexStatus:n});break;case"done":t=(0,B.t)("INDEXING_DONE",{indexStatus:n})}return{label:t,type:m.INDEX_STATUS,value:n,hide:!0}}catch(t){v.ZP.error("getIndexStatusSuggestion failed",t)}}async function rB(t){let e=(await rF(t)).map(t=>({type:m.LOCATION,value:t.data,label:t.data.name})),n=new Set(e.map(t=>t.label));return[...e,...(await rL.searchCities(t)).filter(t=>!n.has(t.city)).map(t=>({type:m.CITY,value:t,label:t.city}))]}async function rU(t){if(!au.s.isPlatformSupported())return null;let e=await rH(t);if(e)return{type:m.CLIP,value:e,label:t}}async function rF(t){let e=(await rx(g.LOCATION_TAG)).filter(e=>e.data.name.toLowerCase().includes(t));return e.length>0&&v.ZP.info("Found ".concat(e.length," location tags for search phrase")),e}let rH=async t=>{let e=await au.s.getTextEmbeddingIfAvailable(t);if(!e)return;let n=await (0,rZ.yb)();return new Map((await Promise.all(n.map(async t=>[t.fileID,await (0,au.Z)(t.embedding,e)]))).filter(t=>{let[,e]=t;return e>=.23}))};async function rX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=[];return(e=null!=e?e:[]).sort((t,e)=>e.files.length-t.files.length).slice(0,t)}let rK={container:t=>({...t,flex:1}),control:(t,e)=>{let{isFocused:n}=e;return{...t,backgroundColor:"rgba(255, 255, 255, 0.1)",borderColor:n?"#1dba54":"transparent",boxShadow:"none",":hover":{borderColor:"#1dba54",cursor:"text"}}},input:t=>({...t,color:"#fff"}),menu:t=>({...t,marginTop:"1px",backgroundColor:"#1b1b1b"}),option:(t,e)=>{let{isFocused:n}=e;return{...t,padding:0,backgroundColor:"transparent !important","& :hover":{cursor:"pointer"},"& .main":{backgroundColor:n&&"#202020"},"&:last-child .MuiDivider-root":{display:"none"}}},dropdownIndicator:t=>({...t,display:"none"}),indicatorSeparator:t=>({...t,display:"none"}),clearIndicator:t=>({...t,display:"none"}),singleValue:t=>({...t,backgroundColor:"transparent",color:"#d1d1d1",marginLeft:"36px"}),placeholder:t=>({...t,color:"rgba(255, 255, 255, 0.7)",wordSpacing:"2px",whiteSpace:"nowrap",marginLeft:"40px"})};var rG=n(99790);function rW(){let t=(0,A._)(["\n    font-size: 20px;\n    color: #ddd;\n    display: inline;\n    padding: 0px 12px;\n"]);return rW=function(){return t},t}function rV(){let t=(0,A._)(["\n    font-size: 12px;\n    display: inline;\n    padding: 0px 12px;\n"]);return rV=function(){return t},t}let{Menu:rY}=rr.c,rz=(0,D.ZP)("span")(rW()),rj=(0,D.ZP)("span")(rV());var rQ=t=>{let e=(0,F.useContext)(U.AppContext),n=t.selectProps.options.filter(t=>t.type===m.PERSON),i=n.map(t=>t.value),o=t.selectProps.options.filter(t=>t.type===m.INDEX_STATUS)[0],a=null==o?void 0:o.value;return(0,E.BX)(rY,{...t,children:[(0,E.BX)(td.Z,{my:1,children:[(e.mlSearchEnabled&&a||i&&i.length>0)&&(0,E.tZ)(td.Z,{children:(0,E.tZ)(rz,{children:(0,B.t)("PEOPLE")})}),e.mlSearchEnabled&&a&&(0,E.tZ)(td.Z,{children:(0,E.tZ)(rj,{children:o.label})}),i&&i.length>0&&(0,E.tZ)(I.X2,{children:(0,E.tZ)(rG.sG,{people:i,maxRows:2,onSelect:(e,i)=>{t.selectRef.current.blur(),t.setValue(n[i])}})})]}),t.children]})};let{Option:rq}=rr.c,rJ=t=>(0,E.tZ)(rq,{...t,children:(0,E.tZ)(r$,{data:t.data})}),r$=t=>{let{data:e}=t;return!e.hide&&(0,E.BX)(E.HY,{children:[(0,E.BX)(td.Z,{className:"main",px:2,py:1,children:[(0,E.tZ)(N.Z,{variant:"mini",mb:1,children:(0,B.t)("SEARCH_TYPE.".concat(e.type))}),(0,E.BX)(I.Gm,{children:[(0,E.BX)(td.Z,{mr:1,children:[(0,E.tZ)(I.lN,{children:(0,E.tZ)(N.Z,{fontWeight:"bold",children:e.label})}),(0,E.tZ)(N.Z,{color:"text.muted",children:(0,B.t)("photos_count",{count:e.fileCount})})]}),(0,E.tZ)(tu.Z,{direction:"row",spacing:1,children:e.previewFiles.map(t=>(0,E.tZ)(te,{coverFile:t,onClick:()=>null,collectionTile:tn.gW},t.id))})]})]}),(0,E.tZ)(K.Z,{sx:{mx:2,my:1}})]})};var r0=n(81452),r1=n(46772),r2=n(29164),r5=n(91405),r4=n(33495);let{ValueContainer:r3}=rr.c,r9=t=>{switch(t){case m.DATE:return(0,E.tZ)(r0.Z,{});case m.LOCATION:case m.CITY:return(0,E.tZ)(r5.Z,{});case m.COLLECTION:return(0,E.tZ)(r1.Z,{});case m.FILE_NAME:return(0,E.tZ)(r2.Z,{});default:return(0,E.tZ)(r4.Z,{})}},r6=t=>{var e;return(0,E.tZ)(r3,{...t,children:(0,E.BX)(I.A0,{children:[(0,E.tZ)(td.Z,{className:"icon",mr:1.5,color:"stroke.muted",children:r9(null===(e=t.getValue()[0])||void 0===e?void 0:e.type)}),t.children]})})},r8=(0,q.Z)((t,e,n,i)=>({Option:t,ValueContainer:e,Menu:n,Input:i})),r7=t=>(0,E.tZ)(rr.c.Input,{...t,isHidden:!1});function lt(t){let e=(0,F.useRef)(null),[n,i]=(0,F.useState)(null),o=(0,F.useContext)(U.AppContext),[a,r]=(0,F.useState)([]),[l,c]=(0,F.useState)("");async function s(){r(await rP())}(0,F.useEffect)(()=>{h(n)},[n]),(0,F.useEffect)(()=>{s();let t=setInterval(()=>s(),2e3);return()=>clearInterval(t)},[]);let d=()=>{t.isOpen&&(o.startLoading(),t.updateSearch(null,null),setTimeout(()=>{o.finishLoading()},10),t.setIsOpen(!1),i(null),c(""))},u=(0,F.useCallback)((0,ra.Z)(rD(t.files,t.collections),250),[t.files,t.collections]),p=()=>{var t;null===(t=e.current)||void 0===t||t.blur()},h=e=>{let n;if(e){switch(e.type){case m.DATE:n={date:e.value},t.setIsOpen(!0);break;case m.LOCATION:n={location:e.value},t.setIsOpen(!0);break;case m.CITY:n={city:e.value},t.setIsOpen(!0);break;case m.COLLECTION:n={collection:e.value},i(null),c("");break;case m.FILE_NAME:case m.FILE_CAPTION:n={files:e.value};break;case m.PERSON:n={person:e.value};break;case m.FILE_TYPE:n={fileType:e.value};break;case m.CLIP:n={clip:e.value}}t.updateSearch(n,{optionName:e.label,fileCount:e.fileCount})}},Z=r8(rJ,r6,(0,F.useCallback)(t=>(0,E.tZ)(rQ,{...t,setValue:i,selectRef:e}),[i,e]),r7);return(0,E.BX)(ri,{isOpen:t.isOpen,children:[(0,E.tZ)(rl.ZP,{ref:e,value:n,components:Z,placeholder:(0,E.tZ)("span",{children:(0,B.t)("SEARCH_HINT")}),loadOptions:u,onChange:t=>{i(t),c(null==t?void 0:t.label),p()},onFocus:()=>{s()},isClearable:!0,inputValue:l,onInputChange:(t,e)=>{"input-change"===e.action&&c(t)},escapeClearsValue:!0,styles:rK,defaultOptions:o.mlSearchEnabled?a:null,noOptionsMessage:()=>null}),t.isOpen&&(0,E.tZ)(tY.Z,{onClick:()=>d(),sx:{ml:1},children:(0,E.tZ)(tc.Z,{})})]})}function le(t){let{setIsInSearchMode:e,isInSearchMode:n,...i}=t;return(0,E.BX)(re,{children:[(0,E.tZ)(lt,{...i,isOpen:n,setIsOpen:e}),(0,E.tZ)(ro,{show:!n,showSearchInput:()=>e(!0)})]})}var ln=n(54825);function li(t){let{openSidebar:e,openUploader:n,isInSearchMode:i,isInHiddenSection:o,collections:a,files:r,updateSearch:l,setIsInSearchMode:c,exitHiddenSection:s}=t,d=F.useContext(U.AppContext);return(0,E.tZ)(a5.Z,{sx:{background:"transparent",position:"absolute"},isMobile:d.isMobile,children:o?(0,E.BX)(I.cD,{gap:"24px",sx:{width:"100%",background:t=>t.palette.background.default},children:[(0,E.tZ)(tY.Z,{onClick:s,children:(0,E.tZ)(a4.Z,{})}),(0,E.tZ)(I.A0,{children:(0,E.tZ)(N.Z,{children:(0,B.t)("HIDDEN")})})]}):(0,E.BX)(E.HY,{children:[!i&&(0,E.tZ)(a2,{openSidebar:e}),(0,E.tZ)(le,{isInSearchMode:i,setIsInSearchMode:c,collections:a,files:r,updateSearch:l}),!i&&(0,E.tZ)(ln.Z,{openUploader:n})]})})}function lo(){var t;return null===(t=(0,O.Yu)(O.Pd.USER_DETAILS))||void 0===t?void 0:t.value}var la=t=>{let{children:e,...n}=t;return(0,E.tZ)(eD.Z,{size:"large",endIcon:(0,E.tZ)(eC.Z,{}),...n,children:(0,E.tZ)(I.G5,{children:e})})};function lr(t){let{subscription:e,bonusData:n,closeModal:i,setLoading:o}=t,a=(0,F.useContext)(U.AppContext);return(0,E.BX)(tu.Z,{spacing:1,children:[oF(e)&&(0,E.tZ)(ll,{subscription:e,bonusData:n,closeModal:i,setLoading:o}),(0,E.tZ)(la,{color:"secondary",onClick:()=>oz(a.setDialogMessage,o),children:(0,B.t)("MANAGE_FAMILY_PORTAL")})]})}function ll(t){let{subscription:e,bonusData:n,setLoading:i,closeModal:o}=t,a=(0,F.useContext)(U.AppContext),r=oY.bind(null,a.setDialogMessage,i);return(0,E.BX)(E.HY,{children:[oB(e)?(0,E.tZ)(la,{color:"secondary",onClick:()=>a.setDialogMessage({title:(0,B.t)("REACTIVATE_SUBSCRIPTION"),content:(0,B.t)("REACTIVATE_SUBSCRIPTION_MESSAGE",{date:e.expiryTime}),proceed:{text:(0,B.t)("REACTIVATE_SUBSCRIPTION"),action:oV.bind(null,a.setDialogMessage,o,i),variant:"accent"},close:{text:(0,B.t)("CANCEL")}}),children:(0,B.t)("REACTIVATE_SUBSCRIPTION")}):(0,E.tZ)(la,{color:"secondary",onClick:()=>a.setDialogMessage({title:(0,B.t)("CANCEL_SUBSCRIPTION"),content:oM(n)?(0,E.tZ)(tb.cC,{i18nKey:"CANCEL_SUBSCRIPTION_WITH_ADDON_MESSAGE"}):(0,E.tZ)(tb.cC,{i18nKey:"CANCEL_SUBSCRIPTION_MESSAGE"}),proceed:{text:(0,B.t)("CANCEL_SUBSCRIPTION"),action:oW.bind(null,a.setDialogMessage,o,i),variant:"critical"},close:{text:(0,B.t)("NEVERMIND")}}),children:(0,B.t)("CANCEL_SUBSCRIPTION")}),(0,E.tZ)(la,{color:"secondary",onClick:r,children:(0,B.t)("MANAGEMENT_PORTAL")})]})}let lc=(0,D.ZP)(iX.Z)(t=>{let{theme:e}=t;return{textTransform:"none",padding:"12px 16px",borderRadius:"4px",backgroundColor:e.colors.fill.faint,border:"1px solid transparent",color:e.colors.text.faint,"&.Mui-selected":{backgroundColor:e.colors.accent.A500,color:e.colors.text.base},"&.Mui-selected:hover":{backgroundColor:e.colors.accent.A500,color:e.colors.text.base},width:"97.433px"}});function ls(t){let{planPeriod:e,togglePeriod:n}=t;return(0,E.BX)(iH.Z,{value:e,exclusive:!0,onChange:(t,i)=>{null!==i&&i!==e&&n()},color:"primary",children:[(0,E.tZ)(lc,{value:a9.xt.MONTH,children:(0,B.t)("MONTHLY")}),(0,E.tZ)(lc,{value:a9.xt.YEAR,children:(0,B.t)("YEARLY")})]})}var ld=n(56476);let lu=(0,D.ZP)(td.Z)(t=>{let{theme:e}=t;return{borderRadius:e.shape.borderRadius,padding:"2px 4px",backgroundColor:e.colors.black.muted,backdropFilter:"blur(".concat(e.colors.blur.muted,")"),color:e.colors.white.base,textTransform:"uppercase",...e.typography.tiny}});function lp(){let t=(0,A._)(["\n    align-items: flex-start;\n"]);return lp=function(){return t},t}let lh=(0,D.ZP)(I.A0)(()=>({background:"linear-gradient(268.22deg, rgba(256, 256, 256, 0.08) -3.72%, rgba(256, 256, 256, 0) 85.73%)"})),lZ=(0,D.ZP)(I.G5)(lp()),lf=(0,D.ZP)(t=>(0,E.tZ)(eD.Z,{disabled:!0,endIcon:(0,E.tZ)(tZ.Z,{}),...t}))(t=>{let{theme:e}=t;return{"&.Mui-disabled":{backgroundColor:"transparent",color:e.colors.text.base}}}),lg=(0,D.ZP)(t=>(0,E.tZ)(eD.Z,{color:"accent",...t,endIcon:(0,E.tZ)(ld.Z,{})}))(()=>({".MuiButton-endIcon":{transition:"transform .2s ease-in-out"},"&:hover .MuiButton-endIcon":{transform:"translateX(4px)"}}));function lm(t){let{plan:e,subscription:n,onPlanSelect:i,disabled:o,popular:a}=t;return(0,E.BX)(lh,{children:[(0,E.BX)(lZ,{children:[(0,E.tZ)(N.Z,{variant:"h1",fontWeight:"bold",children:(0,aC.e8)(e.storage)}),(0,E.BX)(I.A0,{flexWrap:"wrap",gap:1,children:[(0,E.tZ)(N.Z,{variant:"h3",color:"text.muted",children:(0,B.t)("storage_unit.gb")}),a&&!oD(n)&&(0,E.tZ)(lu,{children:(0,B.t)("POPULAR")})]})]}),(0,E.tZ)(td.Z,{width:"136px",children:(0,E.tZ)(o?lf:lg,{sx:{justifyContent:"flex-end",borderTopLeftRadius:0,borderBottomLeftRadius:0},size:"large",onClick:()=>{oU(e,n)||i(e)},children:(0,E.BX)(td.Z,{textAlign:"right",children:[(0,E.BX)(N.Z,{fontWeight:"bold",variant:"large",children:[e.price," "]})," ",(0,E.tZ)(N.Z,{color:"text.muted",variant:"small",children:"/ ".concat(e.period===a9.xt.MONTH?(0,B.t)("MONTH_SHORT"):(0,B.t)("YEAR"))})]})})})]})}var lA=t=>{var e;let{plansResponse:n,planPeriod:i,subscription:o,bonusData:a,onPlanSelect:r,closeModal:l}=t,{freePlan:c,plans:s}=null!=n?n:{};return(0,E.BX)(tu.Z,{spacing:2,children:[null==s?void 0:null===(e=s.filter(t=>t.period===i))||void 0===e?void 0:e.map(t=>(0,E.tZ)(lm,{disabled:oU(t,o),popular:oK(t),plan:t,subscription:o,onPlanSelect:r},t.stripeID)),!oD(o)&&!oM(a)&&c&&(0,E.tZ)(lE,{storage:c.storage,closeModal:l})]})};let lE=t=>{let{closeModal:e,storage:n}=t;return(0,E.BX)(lC,{onClick:e,children:[(0,E.BX)(td.Z,{children:[(0,E.BX)(N.Z,{children:[" ",(0,B.t)("FREE_PLAN_OPTION_LABEL")]}),(0,E.tZ)(N.Z,{variant:"small",color:"text.muted",children:(0,B.t)("free_plan_description",{storage:(0,aC.nS)(n)})})]}),(0,E.tZ)(tY.Z,{className:"endIcon",children:(0,E.tZ)(ld.Z,{})})]})},lC=(0,D.ZP)(I.Gm)(t=>{let{theme:e}=t;return{gap:e.spacing(1.5),padding:e.spacing(1.5,1),cursor:"pointer","&:hover .endIcon":{backgroundColor:"rgba(255,255,255,0.08)"}}}),lv=(0,D.ZP)(I.Gm)(t=>{let{theme:e}=t;return{padding:e.spacing(1,0),cursor:"pointer","&:hover .endIcon":{backgroundColor:"rgba(255,255,255,0.08)"}}});function lI(t){let{bonusData:e,closeModal:n}=t;return(0,E.tZ)(E.HY,{children:e.storageBonuses.map(t=>t.type.startsWith("ADD_ON")?(0,E.tZ)(lv,{onClick:n,children:(0,E.tZ)(td.Z,{children:(0,E.tZ)(N.Z,{color:"text.muted",children:(0,E.tZ)(tb.cC,{i18nKey:"ADD_ON_AVAILABLE_TILL",values:{storage:(0,aC.nS)(t.storage),date:t.validTill}})})})},t.id):null)})}var lw=function(t){let e=(0,F.useMemo)(()=>(0,O.Yu)(O.Pd.SUBSCRIPTION),[]),[n,i]=(0,F.useState)(),[o,a]=(0,F.useState)((null==e?void 0:e.period)||a9.xt.MONTH),r=(0,F.useContext)(lM),l=(0,F.useContext)(U.AppContext),c=(0,F.useMemo)(()=>{let t=lo();return t?t.bonusData:null},[]),s=(0,F.useMemo)(()=>{let t=lo();return t?(0,oR.uD)(t.familyData)?(0,oR.mw)(t.familyData):t.usage:0},[]);function d(){l.closeMessageDialog(),r.showPlanSelectorModal()}async function u(n){if(!oD(e)||oB(e))try{t.setLoading(!0),await oO.Z.buySubscription(n.stripeID)}catch(e){t.setLoading(!1),l.setDialogMessage({title:(0,B.t)("ERROR"),content:(0,B.t)("SUBSCRIPTION_PURCHASE_FAILED"),close:{variant:"critical"}})}else oF(e)?l.setDialogMessage({title:(0,B.t)("update_subscription_title"),content:(0,B.t)("UPDATE_SUBSCRIPTION_MESSAGE"),proceed:{text:(0,B.t)("UPDATE_SUBSCRIPTION"),action:oG.bind(null,n,l.setDialogMessage,t.setLoading,t.closeModal),variant:"accent"},close:{text:(0,B.t)("CANCEL")}}):oD(e)&&e.paymentProvider.length>0&&("appstore"===e.paymentProvider||"playstore"===e.paymentProvider)?l.setDialogMessage({title:(0,B.t)("CANCEL_SUBSCRIPTION_ON_MOBILE"),content:(0,B.t)("CANCEL_SUBSCRIPTION_ON_MOBILE_MESSAGE"),close:{variant:"secondary"}}):l.setDialogMessage({title:(0,B.t)("MANAGE_PLAN"),content:(0,E.tZ)(tb.cC,{i18nKey:"MAIL_TO_MANAGE_SUBSCRIPTION",components:{a:(0,E.tZ)(ny.Z,{href:"mailto:".concat(ij.Xy)})},values:{emailID:ij.Xy}}),close:{variant:"secondary"}})}(0,F.useEffect)(()=>{(async()=>{try{t.setLoading(!0);let n=await oO.Z.getPlans(),{plans:o}=n;if(oN(e)){let t=0===o.filter(t=>oU(t,e)).length;e&&!ok(e)&&t&&o.push({id:e.productID,storage:e.storage,price:e.price,period:e.period,stripeID:e.productID,iosID:e.productID,androidID:e.productID})}i(n)}catch(e){v.ZP.error("plan selector modal open failed",e),t.closeModal(),l.setDialogMessage({title:(0,B.t)("OPEN_PLAN_SELECTOR_MODAL_FAILED"),content:(0,B.t)("UNKNOWN_ERROR"),close:{text:(0,B.t)("CLOSE"),variant:"secondary"},proceed:{text:(0,B.t)("REOPEN_PLAN_SELECTOR_MODAL"),variant:"accent",action:d}})}finally{t.setLoading(!1)}})()},[]);let{closeModal:p,setLoading:h}=t,Z={subscription:e,bonusData:c,closeModal:p,planPeriod:o,togglePeriod:()=>{a(t=>t===a9.xt.MONTH?a9.xt.YEAR:a9.xt.MONTH)},setLoading:h},f=(0,E.tZ)(lA,{plansResponse:n,planPeriod:o,onPlanSelect:u,subscription:e,bonusData:c,closeModal:p});return(0,E.tZ)(E.HY,{children:(0,E.tZ)(tu.Z,{spacing:3,p:1.5,children:oD(e)?(0,E.tZ)(lx,{...Z,usage:s,children:f}):(0,E.tZ)(ly,{...Z,children:f})})})};function ly(t){let{children:e,subscription:n,bonusData:i,closeModal:o,setLoading:a,planPeriod:r,togglePeriod:l}=t;return(0,E.BX)(E.HY,{children:[(0,E.tZ)(N.Z,{variant:"h3",fontWeight:"bold",children:(0,B.t)("CHOOSE_PLAN")}),(0,E.tZ)(td.Z,{children:(0,E.BX)(tu.Z,{spacing:3,children:[(0,E.BX)(td.Z,{children:[(0,E.tZ)(ls,{planPeriod:r,togglePeriod:l}),(0,E.tZ)(N.Z,{variant:"small",mt:.5,color:"text.muted",children:(0,B.t)("TWO_MONTHS_FREE")})]}),e,oM(i)&&(0,E.tZ)(lI,{bonusData:i,closeModal:o}),oM(i)&&(0,E.tZ)(lr,{subscription:n,bonusData:i,closeModal:o,setLoading:a})]})})]})}function lx(t){let{children:e,subscription:n,bonusData:i,closeModal:o,usage:a,planPeriod:r,togglePeriod:l,setLoading:c}=t;return(0,E.BX)(E.HY,{children:[(0,E.tZ)(td.Z,{pl:1.5,py:.5,children:(0,E.BX)(I.Gm,{children:[(0,E.BX)(td.Z,{children:[(0,E.tZ)(N.Z,{variant:"h3",fontWeight:"bold",children:(0,B.t)("SUBSCRIPTION")}),(0,E.BX)(N.Z,{variant:"small",color:"text.muted",children:[(0,aC.e8)(n.storage,2)," ",(0,B.t)("storage_unit.gb")]})]}),(0,E.tZ)(tY.Z,{onClick:o,color:"secondary",children:(0,E.tZ)(tc.Z,{})})]})}),(0,E.tZ)(td.Z,{px:1.5,children:(0,E.tZ)(N.Z,{color:"text.muted",fontWeight:"bold",children:(0,E.tZ)(tb.cC,{i18nKey:"CURRENT_USAGE",values:{usage:"".concat((0,aC.e8)(a,2)," ").concat((0,B.t)("storage_unit.gb"))}})})}),(0,E.BX)(td.Z,{children:[(0,E.BX)(tu.Z,{spacing:3,border:t=>"1px solid ".concat(t.palette.divider),p:1.5,borderRadius:t=>"".concat(t.shape.borderRadius,"px"),children:[(0,E.BX)(td.Z,{children:[(0,E.tZ)(ls,{planPeriod:r,togglePeriod:l}),(0,E.tZ)(N.Z,{variant:"small",mt:.5,color:"text.muted",children:(0,B.t)("TWO_MONTHS_FREE")})]}),e]}),(0,E.BX)(td.Z,{py:1,px:1.5,children:[(0,E.tZ)(N.Z,{color:"text.muted",children:oB(n)?(0,B.t)("RENEWAL_CANCELLED_SUBSCRIPTION_STATUS",{date:n.expiryTime}):(0,B.t)("RENEWAL_ACTIVE_SUBSCRIPTION_STATUS",{date:n.expiryTime})}),oM(i)&&(0,E.tZ)(lI,{bonusData:i,closeModal:o})]})]}),(0,E.tZ)(lr,{subscription:n,bonusData:i,closeModal:o,setLoading:c})]})}var lS=function(t){let e=(0,F.useContext)(U.AppContext);return t.modalView?(0,E.tZ)(G.Z,{fullScreen:e.isMobile,open:t.modalView,onClose:t.closeModal,PaperProps:{sx:t=>({width:"391px",p:1,[t.breakpoints.down(360)]:{p:0}})},children:(0,E.tZ)(lw,{closeModal:t.closeModal,setLoading:t.setLoading})}):(0,E.tZ)(E.HY,{})},lT=n(42399),lb=n(14118),l_=n(6163),lO=n(76475),lL=n(66337),lR=t=>{let{showCreateCollectionModal:e,setCollectionSelectorAttributes:n,handleCollectionOps:i,handleFileOps:o,selectedCollection:a,count:r,ownCount:l,clearSelection:c,activeCollectionID:s,isFavoriteCollection:d,isUncategorizedCollection:u,isIncomingSharedCollection:p,isInSearchMode:h,isInHiddenSection:Z}=t,{setDialogMessage:f,isMobile:g}=(0,F.useContext)(U.AppContext),m=()=>n({callback:i(tR.W6.ADD),showNextModal:e(tR.W6.ADD),intent:nL.r.add,fromCollection:h?void 0:s}),A=()=>f((0,nX.BN)(o(is.j_.TRASH))),C=()=>{n({callback:i(tR.W6.MOVE),showNextModal:e(tR.W6.MOVE),intent:nL.r.move,fromCollection:h?void 0:s})};return(0,E.BX)(lT.X,{isMobile:g,children:[(0,E.BX)(I.G5,{children:[(0,E.tZ)(tY.Z,{onClick:c,children:(0,E.tZ)(tc.Z,{})}),(0,E.BX)(td.Z,{ml:1.5,children:[(0,nY.u)(r)," ",(0,B.t)("SELECTED")," ",l!==r&&"(".concat((0,nY.u)(l)," ").concat((0,B.t)("YOURS"),")")]})]}),(0,E.tZ)(tu.Z,{spacing:2,direction:"row",mr:2,children:h?(0,E.BX)(E.HY,{children:[(0,E.tZ)(tV.Z,{title:(0,B.t)("FIX_CREATION_TIME"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.FIX_TIME),children:(0,E.tZ)(lb.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DOWNLOAD"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.DOWNLOAD),children:(0,E.tZ)(lO.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("ADD"),children:(0,E.tZ)(tY.Z,{onClick:m,children:(0,E.tZ)(eE.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("ARCHIVE"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.ARCHIVE),children:(0,E.tZ)(tw.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("HIDE"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.HIDE),children:(0,E.tZ)(tU.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DELETE"),children:(0,E.tZ)(tY.Z,{onClick:A,children:(0,E.tZ)(l_.Z,{})})})]}):s===tm.jn?(0,E.BX)(E.HY,{children:[(0,E.tZ)(tV.Z,{title:(0,B.t)("RESTORE"),children:(0,E.tZ)(tY.Z,{onClick:()=>n({callback:i(tR.W6.RESTORE),showNextModal:e(tR.W6.RESTORE),intent:nL.r.restore}),children:(0,E.tZ)(lL.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DELETE_PERMANENTLY"),children:(0,E.tZ)(tY.Z,{onClick:()=>f({title:(0,B.t)("DELETE_FILES_TITLE"),content:(0,B.t)("DELETE_FILES_MESSAGE"),proceed:{action:o(is.j_.DELETE_PERMANENTLY),text:(0,B.t)("DELETE"),variant:"critical"},close:{text:(0,B.t)("CANCEL")}}),children:(0,E.tZ)(l_.Z,{})})})]}):u?(0,E.BX)(E.HY,{children:[(0,E.tZ)(tV.Z,{title:(0,B.t)("DOWNLOAD"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.DOWNLOAD),children:(0,E.tZ)(lO.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("MOVE"),children:(0,E.tZ)(tY.Z,{onClick:C,children:(0,E.tZ)(ld.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DELETE"),children:(0,E.tZ)(tY.Z,{onClick:A,children:(0,E.tZ)(l_.Z,{})})})]}):p?(0,E.tZ)(tV.Z,{title:(0,B.t)("DOWNLOAD"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.DOWNLOAD),children:(0,E.tZ)(lO.Z,{})})}):Z?(0,E.BX)(E.HY,{children:[(0,E.tZ)(tV.Z,{title:(0,B.t)("UNHIDE"),children:(0,E.tZ)(tY.Z,{onClick:()=>{n({callback:i(tR.W6.UNHIDE),showNextModal:e(tR.W6.UNHIDE),intent:nL.r.unhide})},children:(0,E.tZ)(tF.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DOWNLOAD"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.DOWNLOAD),children:(0,E.tZ)(lO.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DELETE"),children:(0,E.tZ)(tY.Z,{onClick:A,children:(0,E.tZ)(l_.Z,{})})})]}):(0,E.BX)(E.HY,{children:[(0,E.tZ)(tV.Z,{title:(0,B.t)("FIX_CREATION_TIME"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.FIX_TIME),children:(0,E.tZ)(lb.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DOWNLOAD"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.DOWNLOAD),children:(0,E.tZ)(lO.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("ADD"),children:(0,E.tZ)(tY.Z,{onClick:m,children:(0,E.tZ)(eE.Z,{})})}),s===tm.TS&&(0,E.tZ)(tV.Z,{title:(0,B.t)("UNARCHIVE"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.UNARCHIVE),children:(0,E.tZ)(tB.Z,{})})}),s===tm.Ug&&(0,E.tZ)(tV.Z,{title:(0,B.t)("ARCHIVE"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.ARCHIVE),children:(0,E.tZ)(tw.Z,{})})}),s!==tm.Ug&&s!==tm.TS&&!d&&(0,E.BX)(E.HY,{children:[(0,E.tZ)(tV.Z,{title:(0,B.t)("MOVE"),children:(0,E.tZ)(tY.Z,{onClick:C,children:(0,E.tZ)(ld.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("REMOVE"),children:(0,E.tZ)(tY.Z,{onClick:()=>{l===r?f({title:(0,B.t)("REMOVE_FROM_COLLECTION"),content:(0,B.t)("CONFIRM_SELF_REMOVE_MESSAGE"),proceed:{action:()=>i(tR.W6.REMOVE)(a),text:(0,B.t)("YES_REMOVE"),variant:"primary"},close:{text:(0,B.t)("CANCEL")}}):f({title:(0,B.t)("REMOVE_FROM_COLLECTION"),content:(0,B.t)("CONFIRM_SELF_AND_OTHER_REMOVE_MESSAGE"),proceed:{action:()=>i(tR.W6.REMOVE)(a),text:(0,B.t)("YES_REMOVE"),variant:"critical"},close:{text:(0,B.t)("CANCEL")}})},children:(0,E.tZ)(e5.Z,{})})})]}),(0,E.tZ)(tV.Z,{title:(0,B.t)("HIDE"),children:(0,E.tZ)(tY.Z,{onClick:o(is.j_.HIDE),children:(0,E.tZ)(tU.Z,{})})}),(0,E.tZ)(tV.Z,{title:(0,B.t)("DELETE"),children:(0,E.tZ)(tY.Z,{onClick:A,children:(0,E.tZ)(l_.Z,{})})})]})})]})},lP=n(75031);function lD(){let t=(0,A._)(["\n    flex: 1;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n    flex-direction: column;\n"]);return lD=function(){return t},t}let lN=(0,D.ZP)("div")(lD()),lk={showPlanSelectorModal:()=>null,setActiveCollectionID:()=>null,syncWithRemote:()=>null,setBlockingLoad:()=>null,setIsInSearchMode:()=>null,photoListHeader:null,openExportModal:()=>null,authenticateUser:()=>null,user:null,userIDToEmailMap:null,emailList:null,openHiddenSection:()=>null,isClipSearchResult:null,selectedFile:null,setSelectedFiles:()=>null},lM=(0,F.createContext)(lk);function lB(){var t,e,n,i;let o=(0,oe.useRouter)(),[a,r]=(0,F.useState)(null),[l,c]=(0,F.useState)(null),[s,d]=(0,F.useState)(null),[u,p]=(0,F.useState)(null),[h,Z]=(0,F.useState)(),[f,g]=(0,F.useState)(null),[m,A]=(0,F.useState)(null),[D,k]=(0,F.useState)(null),[M,X]=(0,F.useState)(),[K,G]=(0,F.useState)(!1),[W,V]=(0,F.useState)(!1),[Y,z]=(0,F.useState)({ownCount:0,count:0,collectionID:0}),[j,Q]=(0,F.useState)(!1),[q,J]=(0,F.useState)(!1),[$,te]=(0,F.useState)(null),[tn,ti]=(0,F.useState)(!1),[to,ta]=(0,F.useState)(null),[tr,tl]=(0,F.useState)(!1),[tc,ts]=(0,F.useState)(null),[td,tu]=(0,F.useState)(!1),[tp,th]=(0,F.useState)(!1),{getRootProps:tZ,getInputProps:tf,acceptedFiles:tg}=(0,lP.uI)({noClick:!0,noKeyboard:!0,disabled:td}),{getInputProps:tA,openSelector:tE,selectedFiles:tC}=(0,T.e)({directory:!1}),{getInputProps:tv,openSelector:tI,selectedFiles:tw}=(0,T.e)({directory:!0}),{getInputProps:ty,openSelector:tx,selectedFiles:tS}=(0,T.e)({directory:!1,accept:".zip"}),[tT,tb]=(0,F.useState)(!1),[tL,tD]=(0,F.useState)(null),tN=(0,F.useRef)(!0),tk=(0,F.useRef)(),tM=(0,F.useRef)(),[tB,tU]=(0,F.useState)(new Set),[tF,tH]=(0,F.useState)(new Set),{startLoading:tX,finishLoading:tK,setDialogMessage:tG,logout:tW,...tV}=(0,F.useContext)(U.AppContext),[tY,tz]=(0,F.useState)(),[tj,tQ]=(0,F.useState)(),[tq,tJ]=(0,F.useState)(null),[t$,t0]=(0,F.useState)(null),[t1,t2]=(0,F.useState)(void 0),[t5,t4]=(0,F.useState)(new Set),[t3,t9]=(0,F.useState)(!1),[t6,t8]=(0,F.useState)(null),[t7,et]=(0,F.useState)(),[ee,en]=(0,F.useState)(!1),[ei,eo]=(0,F.useState)(nL.M.normalUpload),[ea,er]=(0,F.useState)(!1),[el,ec]=(0,F.useState)(null),[es,ed]=(0,F.useState)(!1),[eu,ep]=(0,F.useState)(!1),eh=(0,F.useRef)(),eZ=t=>{eh.current=t,ep(!0)},[ef,eg]=(0,F.useState)(!1),[em,eA]=(0,F.useState)([]),[eE,eC]=(0,F.useState)(!1),ev=async()=>{try{return await (0,x.yr)(),!0}catch(t){return tW(),!1}};(0,F.useEffect)(()=>{tV.showNavBar(!0);let t=(0,R.km)(R.Qm.ENCRYPTION_KEY),e=(0,L.LP)();if(!t||!e){_.Z.set(_.i.REDIRECT_URL,y.Wu.GALLERY),o.push(y.Wu.ROOT);return}(0,iq.pt)("/images/subscription-card-background");let n=globalThis.electron;return(async()=>{if(!await ev())return;await tt.Z.init(e),eL(),t2(tm.Ug),G((0,L.aF)()),V(!0),(0,L.fo)()&&Q(!0),(0,L.Qj)(!1);let t=(0,O.Yu)(O.Pd.USER),i=(0,oR.nU)(),o=(0,is.hE)((0,is.SA)(await (0,oQ.dm)("normal"))),a=(0,is.hE)((0,is.SA)(await (0,oQ.dm)("hidden"))),l=await (0,t_.Iz)(),{normalCollections:s,hiddenCollections:u}=await (0,tR.Zf)(l),h=await (0,tO.hM)();r(t),c(i),g(o),k(h),A(a),d(s),p(u),await eO(!0),G(!1),(0,L.n_)(!1),V(!1),rL.loadCities(),tk.current=setInterval(()=>{eO(!1,!0)},a9.DA),n&&n.onMainWindowFocus(()=>eO(!1,!0))})(),()=>{clearInterval(tk.current),n&&(n.onMainWindowFocus(void 0),au.s.removeOnFileUploadListener())}},[]),function(t,e){let n=(0,F.useRef)(!1),i=(0,F.useRef)(null);(0,F.useEffect)(()=>{let o=async e=>{if(n.current){i.current=e;return}n.current=!0;let a=t(e);if((0,P.tI)(a)&&await a,n.current=!1,i.current){let t=i.current;i.current=null,setTimeout(()=>o(t),0)}};o(e)},e)}(async t=>{let[e]=t,n=await rh.getInstance();await n.setFiles(e)},[f]),(0,F.useEffect)(()=>{a&&f&&s&&m&&D&&eR(a,s,u,f,D,m)},[s,u,f,m,D,a]),(0,F.useEffect)(()=>{s&&a&&tJ((0,t_.GH)(a,s))},[s]),(0,F.useEffect)(()=>{a&&s&&t0((0,t_.xg)(a,s,l))},[a,s,l]),(0,F.useEffect)(()=>{$&&ti(!0)},[$]),(0,F.useEffect)(()=>{to&&tl(!0)},[to]),(0,F.useEffect)(()=>{t6&&t9(!0)},[t6]),(0,F.useEffect)(()=>{if(void 0===t1||!o.isReady)return;let t="";t1!==tm.Ug&&(t="?collection=".concat(t1));let e="/gallery".concat(t);o.push(e,void 0,{shallow:!0})},[t1,o.isReady]),(0,F.useEffect)(()=>{let t=(0,R.km)(R.Qm.ENCRYPTION_KEY);o.isReady&&t&&oj(tG,o,J)},[o.isReady]),(0,F.useEffect)(()=>{tT&&tL&&ec({height:104,item:(0,E.tZ)(iR,{searchResultSummary:tL}),itemType:ns.Z.HEADER})},[tT,tL]);let eI=(0,F.useMemo)(()=>s&&u?[...s,...u].find(t=>t.id===t1):null,[s,t1]),ew=(0,b.Z)(async()=>{var t,e,n;if(!f||!a||!D||!m||!t7)return;if(t1===tm.jn&&!tT)return(0,is.V_)([...D,...f.filter(t=>null==tB?void 0:tB.has(t.id))]);let i=await rh.getInstance(),o=[];return(o=tT?(0,is.V_)(await i.search(tc)):(0,is.V_)((ef?m:f).filter(t=>!((null==tB?void 0:tB.has(t.id))||!ef&&(null==tF?void 0:tF.has(t.id)))&&(t7.has(t.collectionID)?t1===t.collectionID:!!(t1===tm.zA&&h.has(t.collectionID))||((0,tP.m_)(t)?t1===tm.TS||t1===t.collectionID:t1===tm.Ug?!t5.has(t.id):t1===t.collectionID)))),null==tc?void 0:tc.clip)?o.sort((t,e)=>tc.clip.get(e.id)-tc.clip.get(t.id)):null!==(n=null==eI?void 0:null===(e=eI.pubMagicMetadata)||void 0===e?void 0:null===(t=e.data)||void 0===t?void 0:t.asc)&&void 0!==n&&n?(0,is.hE)(o,!0):o},[f,D,m,tB,tF,t5,tc,t1,t7]),ey=t=>{if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||ea||ee||tn||tr||t3||j||es||eu||tp||!(null==ew?void 0:ew.length)||!a)return;t.preventDefault();let e={ownCount:0,count:0,collectionID:t1};ew.forEach(t=>{t.ownerID===a.id&&e.ownCount++,e.count++,e[t.id]=!0}),z(e)},ex=()=>{(null==Y?void 0:Y.count)&&z({ownCount:0,count:0,collectionID:0})},eS=(0,F.useRef)({selectAll:ey,clearSelection:ex});(0,F.useEffect)(()=>{eS.current={selectAll:ey,clearSelection:ex}},[ey,ex]);let eT=(0,b.Z)(()=>(0,is.W2)(f),[f]),eb=(0,F.useMemo)(()=>s&&u?(0,tR.Ew)([...s,...u]):new Map,[s,u]),e_=()=>{tG((0,nX.gZ)(tW))},eO=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(navigator.onLine){if(tN.current&&!t){tM.current={force:t,silent:e};return}tN.current=!0;try{let t=(0,L.LP)();if(!t)return;if(!await (0,iQ.D3)(t))throw Error(S.sH.SESSION_EXPIRED);e||tX();let n=await (0,t_.sU)(),{normalCollections:i,hiddenCollections:o}=await (0,tR.Zf)(n);d(i),p(o),await (0,oQ.Z0)("normal",i,g),await (0,oQ.Z0)("hidden",o,A),await (0,tO.Rr)(n,k),await rS(),await (0,iQ.Hs)(),(0,C.as)(),globalThis.electron&&await (0,rZ.RB)(),au.s.isPlatformSupported()&&au.s.scheduleImageEmbeddingExtraction()}catch(t){switch(t.message){case S.sH.SESSION_EXPIRED:e_();break;case S.sH.KEY_MISSING:(0,R.z5)(),o.push(y.Wu.CREDENTIALS);break;default:v.ZP.error("syncWithRemote failed",t)}}finally{tU(new Set),tH(new Set),e||tK()}if(tN.current=!1,tM.current){let{force:t,silent:e}=tM.current;setTimeout(()=>eO(t,e),0),tM.current=null}}},eL=()=>{let t=t=>{switch(t.key){case"Escape":eS.current.clearSelection();break;case"a":(t.ctrlKey||t.metaKey)&&eS.current.selectAll(t)}};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},eR=async(t,e,n,i,o,a)=>{X(await (0,t_.QI)(i));let r=(0,tR.IA)(e);et(r),Z((0,tR.Yo)(n)),t4(new Set(a.map(t=>t.id)));let l=(0,t_.kQ)(t,e,i),c=(0,t_.c1)(i,o,r),s=(0,t_.kQ)(t,n,a),d=(0,t_.Lv)(a,n);s.set(tm.zA,d),tz(lU(l,c)),tQ(s)};if(!tY||!ew)return(0,E.tZ)("div",{});let eP=(t,e,n)=>{var i;let o=null!==(i=null==em?void 0:em.length)&&void 0!==i?i:0,a=t=>{eA(e=>{let n=null==e?void 0:e.find(t=>t.id===o),i="function"==typeof t?t(n):{...n,...t};return n?e.map(t=>t.id===o?i:t):[...e,i]})};return a({id:o,folderName:t,collectionID:e,isHidden:n,canceller:null,total:0,success:0,failed:0,downloadDirPath:null}),a},eD=t=>async e=>{tX();try{ti(!1);let n=(0,is.Rb)(Y,ew),i=t===tR.W6.REMOVE?n:n.filter(t=>t.ownerID===a.id);i.length>0&&await (0,tR.n5)(t,e,i,Y.collectionID),(null==Y?void 0:Y.ownCount)===(null==ew?void 0:ew.length)&&(t===tR.W6.REMOVE||t===tR.W6.RESTORE||t===tR.W6.MOVE?t2(tm.Ug):t===tR.W6.UNHIDE&&ek()),ex(),await eO(!1,!0)}catch(e){v.ZP.error("collection ops (".concat(t,") failed"),e),tG({title:(0,B.t)("ERROR"),close:{variant:"critical"},content:(0,B.t)("UNKNOWN_ERROR")})}finally{tK()}},eN=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nL.M.normalUpload;iy.Z.shouldAllowNewUpload()&&(en(!0),eo(t))},ek=()=>{eg(!1),t2(tm.Ug)};return(0,E.tZ)(lM.Provider,{value:{...lk,showPlanSelectorModal:()=>Q(!0),setActiveCollectionID:t2,syncWithRemote:eO,setBlockingLoad:J,setIsInSearchMode:tb,photoListHeader:el,openExportModal:()=>{ed(!0)},authenticateUser:eZ,userIDToEmailMap:tq,user:a,emailList:t$,openHiddenSection:t=>{eZ(()=>{eg(!0),t2(tm.zA),null==t||t()})},isClipSearchResult:eE,selectedFile:Y,setSelectedFiles:z},children:(0,E.BX)(iC.Z,{getDragAndDropRootProps:tZ,children:[(0,E.tZ)(a0.l,{getDragAndDropInputProps:tf,getFileSelectorInputProps:tA,getFolderSelectorInputProps:tv,getZipFileSelectorInputProps:ty}),q&&(0,E.tZ)(iO.f,{children:(0,E.tZ)(w.Z,{})}),K&&(0,E.tZ)(I.Tn,{children:(0,E.tZ)(N.Z,{color:"text.muted",variant:"small",children:(0,B.t)("INITIAL_LOAD_DELAY_WARNING")})}),(0,E.tZ)(lS,{modalView:j,closeModal:()=>Q(!1),setLoading:J}),(0,E.tZ)(n_,{show:tr,onHide:tl.bind(null,!1),attributes:to}),(0,E.tZ)(nk,{open:tn,onClose:()=>{ti(!1)},collectionSummaries:tY,attributes:$,collections:s}),(0,E.tZ)(nd.yu,{attributesList:em,setAttributesList:eA}),(0,E.tZ)(iZ,{isOpen:t3,hide:()=>t9(!1),show:()=>t9(!0),attributes:t6}),(0,E.tZ)(li,{openSidebar:()=>er(!0),isFirstFetch:W,setIsInSearchMode:tb,isInHiddenSection:ef,openUploader:eN,isInSearchMode:tT,collections:s,files:f,updateSearch:(t,e)=>{(null==t?void 0:t.collection)?t2(null==t?void 0:t.collection):ts(t),eC(!!(null==t?void 0:t.clip)),(null==t?void 0:t.collection)?tb(!1):(tb(!!t),tD(e))},exitHiddenSection:ek}),(0,E.tZ)(nb,{activeCollection:eI,isInSearchMode:tT,isInHiddenSection:ef,activeCollectionID:t1,setActiveCollectionID:t2,collectionSummaries:tY,hiddenCollectionSummaries:tj,setCollectionNamerAttributes:ta,setPhotoListHeader:ec,setFilesDownloadProgressAttributesCreator:eP,filesDownloadProgressAttributesList:em}),(0,E.tZ)(a$.Z,{activeCollection:eI,syncWithRemote:eO,showCollectionSelector:ti.bind(null,!0),closeUploadTypeSelector:en.bind(null,!1),setCollectionSelectorAttributes:te,closeCollectionSelector:ti.bind(null,!1),setLoading:J,setCollectionNamerAttributes:ta,setShouldDisableDropzone:tu,setFiles:g,setCollections:d,isFirstUpload:!(0,tR.Hl)(tY),dragAndDropFiles:tg,openFileSelector:tE,fileSelectorFiles:tC,openFolderSelector:tI,folderSelectorFiles:tw,openZipFileSelector:tx,fileSelectorZipFiles:tS,uploadTypeSelectorIntent:ei,uploadTypeSelectorView:ee,showSessionExpiredMessage:e_}),(0,E.tZ)(aX,{collectionSummaries:tY,sidebarView:ea,closeSidebar:()=>er(!1)}),tT||K||(null==f?void 0:f.length)||(null==m?void 0:m.length)||t1!==tm.Ug?(0,E.tZ)(iL.Z,{page:y.Wu.GALLERY,files:ew,syncWithRemote:eO,favItemIds:M,setSelected:z,selected:Y,tempDeletedFileIds:tB,setTempDeletedFileIds:tU,setIsPhotoSwipeOpen:th,activeCollectionID:t1,enableDownload:!0,fileToCollectionsMap:eT,collectionNameMap:eb,showAppDownloadBanner:f.length<30&&!tT,isInHiddenSection:ef,setFilesDownloadProgressAttributesCreator:eP}):(0,E.tZ)(i_,{openUploader:eN}),Y.count>0&&Y.collectionID===t1&&(0,E.tZ)(lR,{handleCollectionOps:eD,handleFileOps:t=>async()=>{tX();try{let e=(0,is.Rb)(Y,t===is.j_.HIDE?f:ew),n=t===is.j_.DOWNLOAD?e:e.filter(t=>t.ownerID===a.id);n.length>0&&await (0,is.QG)(t,n,tU,tH,t8,eP),(null==Y?void 0:Y.ownCount)===(null==ew?void 0:ew.length)&&t!==is.j_.ARCHIVE&&t!==is.j_.DOWNLOAD&&t!==is.j_.FIX_TIME&&t2(tm.Ug),ex(),await eO(!1,!0)}catch(e){v.ZP.error("file ops (".concat(t,") failed"),e),tG({title:(0,B.t)("ERROR"),close:{variant:"critical"},content:(0,B.t)("UNKNOWN_ERROR")})}finally{tK()}},showCreateCollectionModal:t=>{let e=async e=>{try{tX();let n=await (0,t_.mp)(e);await eD(t)(n)}catch(e){v.ZP.error("create and collection ops (".concat(t,") failed"),e),tG({title:(0,B.t)("ERROR"),close:{variant:"critical"},content:(0,B.t)("UNKNOWN_ERROR")})}finally{tK()}};return()=>ta({title:(0,B.t)("CREATE_COLLECTION"),buttonText:(0,B.t)("CREATE"),autoFilledName:"",callback:e})},setCollectionSelectorAttributes:te,count:Y.count,ownCount:Y.ownCount,clearSelection:ex,activeCollectionID:t1,selectedCollection:(0,tR.IX)(Y.collectionID,s),isFavoriteCollection:(null===(t=tY.get(t1))||void 0===t?void 0:t.type)===tm.j.favorites,isUncategorizedCollection:(null===(e=tY.get(t1))||void 0===e?void 0:e.type)===tm.j.uncategorized,isIncomingSharedCollection:(null===(n=tY.get(t1))||void 0===n?void 0:n.type)===tm.j.incomingShareCollaborator||(null===(i=tY.get(t1))||void 0===i?void 0:i.type)===tm.j.incomingShareViewer,isInSearchMode:tT,isInHiddenSection:ef}),(0,E.tZ)(n3,{show:es,onHide:()=>{ed(!1)},collectionNameMap:eb}),(0,E.tZ)(H,{open:eu,onClose:()=>ep(!1),onAuthenticate:eh.current})]})})}let lU=(t,e)=>{let n=new Map(t);return e.forEach((t,e)=>{n.set(e,t)}),n}},22404:function(t,e,n){"use strict";n.d(e,{Z:function(){return g}});var i,o,a=n(96045),r=n(73873),l=n(95525),c=n(10005),s=n(94522);let d=()=>"".concat((0,l.w8)(),"/desktop-redirect");var u=n(72751),p=n.n(u),h=n(59372);let Z=(0,l.O3)();(i=o||(o={})).Buy="buy",i.Update="update";class f{async getPlans(){let t=(0,s.LP)();try{return(t?await r.Z.get("".concat(Z,"/billing/user-plans"),null,{"X-Auth-Token":(0,s.LP)()}):await r.Z.get("".concat(Z,"/billing/plans/v2"))).data}catch(t){a.ZP.error("failed to get plans",t)}}async syncSubscription(){try{let{subscription:t}=(await r.Z.get("".concat(Z,"/billing/subscription"),null,{"X-Auth-Token":(0,s.LP)()})).data;(0,c.a_)(c.Pd.SUBSCRIPTION,t)}catch(t){a.ZP.error("failed to get user's subscription details",t)}}async buySubscription(t){try{let e=await (0,h.WO)();await this.redirectToPayments(e,t,"buy")}catch(t){throw a.ZP.error("unable to buy subscription",t),t}}async updateSubscription(t){try{let e=await (0,h.WO)();await this.redirectToPayments(e,t,"update")}catch(t){throw a.ZP.error("subscription update failed",t),t}}async cancelSubscription(){try{let{subscription:t}=(await r.Z.post("".concat(Z,"/billing/stripe/cancel-subscription"),null,null,{"X-Auth-Token":(0,s.LP)()})).data;(0,c.a_)(c.Pd.SUBSCRIPTION,t)}catch(t){throw a.ZP.error("subscription cancel failed",t),t}}async activateSubscription(){try{let{subscription:t}=(await r.Z.post("".concat(Z,"/billing/stripe/activate-subscription"),null,null,{"X-Auth-Token":(0,s.LP)()})).data;(0,c.a_)(c.Pd.SUBSCRIPTION,t)}catch(t){throw a.ZP.error("failed to activate subscription",t),t}}async verifySubscription(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let e=(0,s.LP)();if(!e)return;let{subscription:n}=(await r.Z.post("".concat(Z,"/billing/verify-subscription"),{paymentProvider:"stripe",productID:null,verificationData:t},null,{"X-Auth-Token":e})).data;return(0,c.a_)(c.Pd.SUBSCRIPTION,n),n}catch(t){throw a.ZP.error("Error while verifying subscription",t),t}}async leaveFamily(){if((0,s.LP)())try{await r.Z.delete("".concat(Z,"/family/leave"),null,null,{"X-Auth-Token":(0,s.LP)()}),(0,c.NU)(c.Pd.FAMILY_DATA)}catch(t){throw a.ZP.error("/family/leave failed",t),t}}async redirectToPayments(t,e,n){try{let i=this.getRedirectURL();window.location.href="".concat((0,l.w8)(),"?productID=").concat(e,"&paymentToken=").concat(t,"&action=").concat(n,"&redirectURL=").concat(i)}catch(t){throw a.ZP.error("unable to get payments url",t),t}}async redirectToCustomerPortal(){try{let t=this.getRedirectURL(),e=await r.Z.get("".concat(Z,"/billing/stripe/customer-portal"),{redirectURL:t},{"X-Auth-Token":(0,s.LP)()});window.location.href=e.data.url}catch(t){throw a.ZP.error("unable to get customer portal url",t),t}}getRedirectURL(){return p()()?d():"".concat(window.location.origin,"/gallery")}}var g=new f},26930:function(t,e,n){"use strict";n.d(e,{CE:function(){return C},DH:function(){return M},Kc:function(){return w},SP:function(){return A},Uo:function(){return D},Wk:function(){return k},e4:function(){return E},ed:function(){return I},mF:function(){return R},py:function(){return S},to:function(){return y},w4:function(){return N},yB:function(){return Z}});var i=n(96045),o=n(88659),a=n(18786),r=n(73873),l=n(95525),c=n(89610),s=n(79541);let d=(0,l.O3)(),u="public-collection-files",p="public-collections",h="public-referral-code",Z=t=>"".concat(t),f=t=>"public-".concat(t,"-time"),g=t=>"public-".concat(t,"-passkey"),m=t=>"public-".concat(t,"-uploaderName"),A=async t=>await c.Z.getItem(m(t)),E=async(t,e)=>await c.Z.setItem(m(t),e),C=async t=>((await c.Z.getItem(u)||[]).find(e=>e.collectionUID===t)||{collectionUID:null,files:[]}).files,v=async(t,e)=>{let n=await c.Z.getItem(u)||[];await c.Z.setItem(u,_([{collectionUID:t,files:e},...n]))},I=async t=>await c.Z.getItem(g(t))||"",w=async(t,e)=>await c.Z.setItem(g(t),e),y=async t=>(await c.Z.getItem(p)||[]).find(e=>e.key===t)||null,x=async t=>{var e;let n=null!==(e=await c.Z.getItem(p))&&void 0!==e?e:[];await c.Z.setItem(p,b([t,...n]))},S=async()=>await c.Z.getItem(h),T=async t=>{t||c.Z.removeItem(h),await c.Z.setItem(h,t)},b=t=>{let e=new Set([]);return t.filter(t=>!e.has(t.key)&&(e.add(t.key),!0))},_=t=>{let e=new Set([]);return t.filter(t=>{let{collectionUID:n}=t;return!e.has(n)&&(e.add(n),!0)})},O=async t=>{var e;return null!==(e=await c.Z.getItem(f(t)))&&void 0!==e?e:0},L=async(t,e)=>await c.Z.setItem(f(t),e),R=async(t,e,n,o)=>{try{var r,l;let c=[],d=null!==(l=null==n?void 0:null===(r=n.pubMagicMetadata)||void 0===r?void 0:r.data.asc)&&void 0!==l&&l,u=Z(t),p=await C(u);c=[...c,...p];try{if(!t)return(0,s.hE)(c,d);let i=await O(u);if(n.updationTime===i)return(0,s.hE)(c,d);let a=await P(t,e,n,i,c,o);c=[...c,...a];let r=new Map;for(let[t,e]of(c.forEach(t=>{let e="".concat(t.collectionID,"-").concat(t.id);(!r.has(e)||r.get(e).updationTime<t.updationTime)&&r.set(e,t)}),c=[],r))e.isDeleted||c.push(e);await v(u,c),await L(u,n.updationTime),o([...(0,s.hE)((0,s.SA)(c),d)])}catch(e){let t=(0,a.a3)(e);if(i.ZP.error("failed to sync shared collection files",e),t.message===a.sH.TOKEN_EXPIRED)throw e}return[...(0,s.hE)((0,s.SA)(c),d)]}catch(t){throw i.ZP.error("failed to get local  or sync shared collection files",t),t}},P=async(t,e,n,o,a,l)=>{try{var c,u;let i;let p=[],h=o,Z=null!==(u=null==n?void 0:null===(c=n.pubMagicMetadata)||void 0===c?void 0:c.data.asc)&&void 0!==u&&u;do{if(!t)break;i=await r.Z.get("".concat(d,"/public-collection/diff"),{sinceTime:h},{"Cache-Control":"no-cache","X-Auth-Access-Token":t,...e&&{"X-Auth-Access-Token-JWT":e}}),p=[...p,...await Promise.all(i.data.diff.map(async t=>t.isDeleted?t:await (0,s.np)(t,n.key)))],i.data.diff.length&&(h=i.data.diff.slice(-1)[0].updationTime),l((0,s.hE)((0,s.SA)([...a||[],...p].filter(t=>!t.isDeleted)),Z))}while(i.data.hasMore);return p}catch(t){throw i.ZP.error("Get public  files failed",t),t}},D=async(t,e)=>{try{var n,a;let i;if(!t)return;let l=await r.Z.get("".concat(d,"/public-collection/info"),null,{"Cache-Control":"no-cache","X-Auth-Access-Token":t}),c=l.data.collection,s=null!==(a=l.data.referralCode)&&void 0!==a?a:"",u=await o.Z.getInstance(),p=c.name=c.name||await u.decryptToUTF8(c.encryptedName,c.nameDecryptionNonce,e);(null===(n=c.pubMagicMetadata)||void 0===n?void 0:n.data)&&(i={...c.pubMagicMetadata,data:await u.decryptMetadata(c.pubMagicMetadata.data,c.pubMagicMetadata.header,e)});let h={...c,name:p,key:e,pubMagicMetadata:i};return await x(h),await T(s),[h,s]}catch(t){throw i.ZP.error("failed to get public collection",t),t}},N=async(t,e)=>{try{return(await r.Z.post("".concat(d,"/public-collection/verify-password"),{passHash:e},null,{"Cache-Control":"no-cache","X-Auth-Access-Token":t})).data.jwtToken}catch(t){throw i.ZP.error("failed to verify public collection password",t),t}},k=async(t,e)=>{let n=await c.Z.getItem(p)||[];await c.Z.setItem(p,n.filter(t=>t.key!==e)),await M(t)},M=async t=>{var e;await c.Z.removeItem(g(t)),await c.Z.removeItem(f(t));let n=null!==(e=await c.Z.getItem(u))&&void 0!==e?e:[];await c.Z.setItem(u,n.filter(e=>e.collectionUID!==t))}},16748:function(t,e,n){"use strict";n.d(e,{F:function(){return a},S:function(){return c}});var i=n(96045),o=n(28988);let a=t=>{try{let e;if((t=t.trim()).startsWith("IMG-")||t.startsWith("VID-"))e=l(t.split("-")[1]);else if(t.startsWith("Screenshot_"))e=l(t.replaceAll("Screenshot_",""));else if(t.startsWith("signal-")){let n=t.split("-"),i="".concat(n[1]).concat(n[2]).concat(n[3],"-").concat(n[4]);e=l(i)}return e||(e=c(t)),(0,o.B)(e)}catch(e){i.ZP.error("Could not extract date from file name ".concat(t),e);return}},r=new Date().getFullYear();function l(t){return s(d({year:t.slice(0,4),month:t.slice(4,6),day:t.slice(6,8),hour:t.slice(9,11),minute:t.slice(11,13),second:t.slice(13,15)}))}function c(t){var e,n;let i=function(t){var e;let[n,i,o,a,r,l]=null!==(e=t.match(/\d+/g))&&void 0!==e?e:[];return{year:n,month:i,day:o,hour:a,minute:r,second:l}}(t);return(null===(e=i.year)||void 0===e?void 0:e.length)===8&&(null===(n=i.month)||void 0===n?void 0:n.length)===6?l(i.year+"-"+i.month):s(d(i))}function s(t){var e,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{minYear:1990,maxYear:r+1},o=u(t);return(p(t)&&((e=o).getHours()!==t.hour||e.getMinutes()!==t.minute||e.getSeconds()!==t.second)&&(o=u({...t,hour:0,minute:0,second:0})),(n=o).getFullYear()!==t.year||n.getMonth()!==t.month||n.getDate()!==t.day||o.getFullYear()<i.minYear||o.getFullYear()>i.maxYear)?null:o}function d(t){return{year:Number(t.year),month:Number(t.month)-1,day:Number(t.day),hour:Number(t.hour),minute:Number(t.minute),second:Number(t.second)}}function u(t){let{year:e,month:n,day:i,hour:o,minute:a,second:r}=t;return p(t)?new Date(e,n,i,o,a,r):new Date(e,n,i)}function p(t){let{hour:e,minute:n,second:i}=t;return!isNaN(e)&&!isNaN(n)&&!isNaN(i)}},66965:function(t,e,n){"use strict";n.d(e,{Gz:function(){return c},Ob:function(){return d},RJ:function(){return s},gq:function(){return m},jN:function(){return h},qg:function(){return u}});var i=n(82155),o=n(54032),a=n(96045),r=n(6114),l=n(10277);let c=46,s=(t,e)=>{let n=e.slice(0,-5),i=n.match(/\(\d+\)$/);if(i){n=n.slice(0,-1*i[0].length);let[e,a]=(0,o.YA)(n);return"".concat(t,"-").concat(e).concat(i[0],".").concat(a)}return"".concat(t,"-").concat(n)},d=(t,e)=>"".concat(t,"-").concat(e.slice(0,c)),u=(t,e)=>"".concat(t,"-").concat(function(t){let e=null,[n,i]=(0,o.YA)(t);return e=n.endsWith(p)?n.slice(0,-1*p.length):n,i&&(e+="."+i),e}(e)),p="-edited",h=async t=>{try{return g(await Z(t))}catch(t){a.ZP.error("Failed to parse takeout metadata JSON",t);return}},Z=async t=>{if(t instanceof File)return await t.text();if("string"==typeof t)return await (0,i.M)().fs.readTextFile(t);if(!Array.isArray(t))return await t.file.text();{let{response:e}=await (0,l.o4)((0,i.M)(),t);return await e.text()}},f={creationTime:null,modificationTime:null,...r.SN},g=t=>{let e=JSON.parse(t);if(!e)return;let n={...f};e.photoTakenTime&&e.photoTakenTime.timestamp?n.creationTime=1e6*e.photoTakenTime.timestamp:e.creationTime&&e.creationTime.timestamp&&(n.creationTime=1e6*e.creationTime.timestamp),e.modificationTime&&e.modificationTime.timestamp&&(n.modificationTime=1e6*e.modificationTime.timestamp);let i={...r.SN};return e.geoData&&(0!==e.geoData.latitude||0!==e.geoData.longitude)?i=e.geoData:e.geoDataExif&&(0!==e.geoDataExif.latitude||0!==e.geoDataExif.longitude)&&(i=e.geoDataExif),null!==i&&(n.latitude=i.latitude,n.longitude=i.longitude),n},m=(t,e,n)=>{let i=u(e,t),o=n.get(i);return!o&&i.length>c&&(i=d(e,t),o=n.get(i)),o}},40994:function(t,e,n){"use strict";n.d(e,{Z:function(){return tH}});var i=n(58178),o=n(42917),a=n(82155),r=n(54032),l=n(96045),c=n(17973),s=n(11200),d=n(88659),u=n(18786),p=n(44439),h=n(6114),Z=n(72751),f=n.n(Z),g=n(26930),m=n(59372),A=n(96741),E=n(79541),C=n(82797),v=n(66965),I=n(49264),w=n(5083),y=n(5155),x=n(33009),S=n(25869),T=n(71583),b=n(10277),_=n(4129),O=n(55151),L=n(16748),R=n(73873),P=n(95525),D=n(94522);let N=(0,P.O3)(),k=(0,P.N3)();class M{async uploadFile(t){try{let e=(0,D.LP)();if(!e)return;return(await F(()=>R.Z.post("".concat(N,"/files"),t,null,{"X-Auth-Token":e}),u.a0)).data}catch(t){throw l.ZP.error("upload Files Failed",t),t}}async fetchUploadURLs(t,e){try{if(!this.uploadURLFetchInProgress)try{let n=(0,D.LP)();if(!n)return;for(let i of(this.uploadURLFetchInProgress=R.Z.get("".concat(N,"/files/upload-urls"),{count:Math.min(50,2*t)},{"X-Auth-Token":n}),(await this.uploadURLFetchInProgress).data.urls))e.push(i)}finally{this.uploadURLFetchInProgress=null}return this.uploadURLFetchInProgress}catch(t){throw l.ZP.error("fetch upload-url failed ",t),t}}async fetchMultipartUploadURLs(t){try{let e=(0,D.LP)();if(!e)return;return(await R.Z.get("".concat(N,"/files/multipart-upload-urls"),{count:t},{"X-Auth-Token":e})).data.urls}catch(t){throw l.ZP.error("fetch multipart-upload-url failed",t),t}}async putFile(t,e,n){try{return await F(()=>R.Z.put(t.url,e,null,null,n),u.a0),t.objectKey}catch(t){throw t.message!==u.sH.UPLOAD_CANCELLED&&l.ZP.error("putFile to dataStore failed ",t),t}}async putFileV2(t,e,n){try{return await F(()=>R.Z.put("".concat(k,"/file-upload"),e,null,{"UPLOAD-URL":t.url},n)),t.objectKey}catch(t){throw t.message!==u.sH.UPLOAD_CANCELLED&&l.ZP.error("putFile to dataStore failed ",t),t}}async putFilePart(t,e,n){try{return(await F(async()=>{var i;let o=await R.Z.put(t,e,null,null,n);if(!(null==o?void 0:null===(i=o.headers)||void 0===i?void 0:i.etag)){let t=Error(u.sH.ETAG_MISSING);throw l.ZP.error("putFile in parts failed",t),t}return o},u.a0)).headers.etag}catch(t){throw t.message!==u.sH.UPLOAD_CANCELLED&&l.ZP.error("put filePart failed",t),t}}async putFilePartV2(t,e,n){try{return(await F(async()=>{var i;let o=await R.Z.put("".concat(k,"/multipart-upload"),e,null,{"UPLOAD-URL":t},n);if(!(null==o?void 0:null===(i=o.data)||void 0===i?void 0:i.etag)){let t=Error(u.sH.ETAG_MISSING);throw l.ZP.error("putFile in parts failed",t),t}return o})).data.etag}catch(t){throw t.message!==u.sH.UPLOAD_CANCELLED&&l.ZP.error("put filePart failed",t),t}}async completeMultipartUpload(t,e){try{await F(()=>R.Z.post(t,e,null,{"content-type":"text/xml"}))}catch(t){throw l.ZP.error("put file in parts failed",t),t}}async completeMultipartUploadV2(t,e){try{await F(()=>R.Z.post("".concat(k,"/multipart-complete"),e,null,{"content-type":"text/xml","UPLOAD-URL":t}))}catch(t){throw l.ZP.error("put file in parts failed",t),t}}constructor(){this.uploadURLFetchInProgress=null}}var B=new M;let U=[2e3,5e3,1e4];async function F(t,e){let n=async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{return await t()}catch(o){if(e&&e(o),i<U.length)return await (0,s.D)(U[i]),await n(t,i+1);throw o}};return await n(t)}let H=(0,P.O3)();class X{async uploadFile(t,e,n){try{if(!e)throw Error(u.sH.TOKEN_MISSING);return(await F(()=>R.Z.post("".concat(H,"/public-collection/file"),t,null,{"X-Auth-Access-Token":e,...n&&{"X-Auth-Access-Token-JWT":n}}),u.a0)).data}catch(t){throw l.ZP.error("upload public File Failed",t),t}}async fetchUploadURLs(t,e,n,i){try{if(!this.uploadURLFetchInProgress)try{if(!n)throw Error(u.sH.TOKEN_MISSING);for(let o of(this.uploadURLFetchInProgress=R.Z.get("".concat(H,"/public-collection/upload-urls"),{count:Math.min(50,2*t)},{"X-Auth-Access-Token":n,...i&&{"X-Auth-Access-Token-JWT":i}}),(await this.uploadURLFetchInProgress).data.urls))e.push(o)}finally{this.uploadURLFetchInProgress=null}return this.uploadURLFetchInProgress}catch(t){throw l.ZP.error("fetch public upload-url failed ",t),t}}async fetchMultipartUploadURLs(t,e,n){try{if(!e)throw Error(u.sH.TOKEN_MISSING);return(await R.Z.get("".concat(H,"/public-collection/multipart-upload-urls"),{count:t},{"X-Auth-Access-Token":e,...n&&{"X-Auth-Access-Token-JWT":n}})).data.urls}catch(t){throw l.ZP.error("fetch public multipart-upload-url failed",t),t}}constructor(){this.uploadURLFetchInProgress=null}}var K=new X;let G=(t,e,n)=>{if(0==t||0==e)return{width:0,height:0};let i=Math.min(n/t,n/e),o={width:Math.round(t*i),height:Math.round(e*i)};return 0==o.width||0==o.height?{width:0,height:0}:o};var W=n(77060),V=n(68334);let Y=async(t,e)=>e.fileType===i.Gk.IMAGE?await z(t,e):await J(t),z=async(t,e)=>{let{extension:n}=e;return("heic"==n||"heif"==n)&&(l.ZP.debug(()=>"Pre-converting HEIC to JPEG for thumbnail generation"),t=await (0,W.x)(t)),j(t)},j=async t=>{let e=document.createElement("canvas"),n=(0,c.z)(e.getContext("2d")),i=URL.createObjectURL(t);return await (0,s.F)(new Promise((t,o)=>{let a=new Image;a.setAttribute("src",i),a.onload=()=>{try{URL.revokeObjectURL(i);let{width:o,height:r}=G(a.width,a.height,720);e.width=o,e.height=r,n.drawImage(a,0,0,o,r),t(void 0)}catch(t){o(t)}}}),3e4),await Q(e)},Q=async t=>{let e;let n=Number.MAX_SAFE_INTEGER,i=.7;do e&&(n=e.size),e=await new Promise(e=>{t.toBlob(t=>e(t),"image/jpeg",i)}),i-=.1;while(i>=.5&&e&&e.size>102400&&q(e.size,n)>=10);return new Uint8Array(await (0,c.z)(e).arrayBuffer())},q=(t,e)=>(e-t)*100/e,J=async t=>{try{return await S.Py(t)}catch(e){return l.ZP.error("Failed to generate video thumbnail using the wasm FFmpeg web worker, will fallback to canvas",e),$(t)}},$=async t=>{let e=document.createElement("canvas"),n=(0,c.z)(e.getContext("2d")),i=URL.createObjectURL(t);return await (0,s.F)(new Promise((t,o)=>{let a=document.createElement("video");a.preload="metadata",a.src=i,a.addEventListener("loadeddata",()=>{try{URL.revokeObjectURL(i);let{width:o,height:r}=G(a.videoWidth,a.videoHeight,720);e.width=o,e.height=r,n.drawImage(a,0,0,o,r),t(void 0)}catch(t){o(t)}})}),3e4),await Q(e)},tt=async(t,e,n)=>n.fileType===i.Gk.IMAGE?await t.generateImageThumbnail((0,V.K)(e),720,102400):S.NA(t,e),te=()=>Uint8Array.from(atob(tn),t=>t.charCodeAt(0)),tn="/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCACWASwDAREAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD/AD/6ACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgD/9k=";class ti{init(t){this.publicUploadProps=t}async setFileCount(t){this.pendingUploadCount=t,await this.preFetchUploadURLs()}reducePendingUploadCount(){this.pendingUploadCount--}async getUploadURL(){return 0===this.uploadURLs.length&&this.pendingUploadCount&&await this.fetchUploadURLs(),this.uploadURLs.pop()}async preFetchUploadURLs(){try{await this.fetchUploadURLs()}catch(t){l.ZP.error("prefetch uploadURL failed",t),(0,u.a0)(t)}}async uploadFile(t){return this.publicUploadProps.accessedThroughSharedURL?K.uploadFile(t,this.publicUploadProps.token,this.publicUploadProps.passwordToken):B.uploadFile(t)}async fetchUploadURLs(){this.publicUploadProps.accessedThroughSharedURL?await K.fetchUploadURLs(this.pendingUploadCount,this.uploadURLs,this.publicUploadProps.token,this.publicUploadProps.passwordToken):await B.fetchUploadURLs(this.pendingUploadCount,this.uploadURLs)}async fetchMultipartUploadURLs(t){return this.publicUploadProps.accessedThroughSharedURL?await K.fetchMultipartUploadURLs(t,this.publicUploadProps.token,this.publicUploadProps.passwordToken):await B.fetchMultipartUploadURLs(t)}constructor(){this.uploadURLs=[],this.pendingUploadCount=0,this.publicUploadProps=void 0}}let to=new ti,ta=t=>t instanceof File?t.name:"string"==typeof t?(0,r.EZ)(t):Array.isArray(t)?(0,r.EZ)(t[1]):t.file.name,tr=async(t,e,n,i,o,a,r,c)=>{let{collection:s,localID:d,fileName:p,...Z}=t;l.ZP.info("Uploading ".concat(p));try{let{fileTypeInfo:t,fileSize:l,lastModifiedMs:u}=await tc(Z);if(l>=4294967296)return{uploadResult:h.Le.TOO_LARGE};r();let{metadata:p,publicMagicMetadata:f}=await tp(Z,t,u,s.id,i,o),g=n.filter(t=>tE(t.metadata,p)),m=(null==g?void 0:g.length)>0?g[0]:void 0;if(m){let t=g.find(t=>t.collectionID==s.id);if(t)return{uploadResult:h.Le.ALREADY_UPLOADED,uploadedFile:t};{let t=Object.assign({},m);return t.collectionID=s.id,await (0,y.xo)(s,[t]),{uploadResult:h.Le.ADDED_SYMLINK,uploadedFile:t}}}r();let{fileStreamOrData:A,thumbnail:E,hasStaticThumbnail:C}=await tI(t,Z);C&&(p.hasStaticThumbnail=!0);let v=await tb({...f,uploaderName:e});r();let I=await t_({localID:d,fileStreamOrData:A,thumbnail:E,metadata:p,pubMagicMetadata:v},s.key,o);r();let w=await tR(I.file,c,a,r),x=await to.uploadFile({collectionID:s.id,encryptedKey:I.fileKey.encryptedData,keyDecryptionNonce:I.fileKey.nonce,...w});return{uploadResult:p.hasStaticThumbnail?h.Le.UPLOADED_WITH_STATIC_THUMBNAIL:h.Le.UPLOADED,uploadedFile:x}}catch(t){switch(t.message==u.sH.UPLOAD_CANCELLED?l.ZP.info("Upload for ".concat(p," cancelled")):t.message==u.sH.UNSUPPORTED_FILE_FORMAT?l.ZP.info("Not uploading ".concat(p,": unsupported file format")):l.ZP.error("Upload failed for ".concat(p),t),(0,u.a0)(t).message){case u.sH.ETAG_MISSING:return{uploadResult:h.Le.BLOCKED};case u.sH.UNSUPPORTED_FILE_FORMAT:return{uploadResult:h.Le.UNSUPPORTED};case u.sH.FILE_TOO_LARGE:return{uploadResult:h.Le.LARGER_THAN_AVAILABLE_STORAGE};default:return{uploadResult:h.Le.FAILED}}}},tl=async t=>{let e,n,i,o,r;if("string"==typeof t||Array.isArray(t)){let{response:n,size:r,lastModifiedMs:l}=await (0,b.o4)((0,a.M)(),t);e=n.body,i=r,o=l}else e=(n=t instanceof File?t:t.file).stream(),i=n.size,o=n.lastModified;let l=Math.ceil(i/4194304),c=new TransformStream({async transform(t,e){let n;for(r?((n=new Uint8Array(r.length+t.length)).set(r),n.set(t,r.length),r=void 0):n=t;n.length>=4194304;)e.enqueue(n.slice(0,4194304)),n=n.slice(4194304);n.length&&(r=n)},flush(t){r&&t.enqueue(r)}});return{stream:e.pipeThrough(c),chunkCount:l,fileSize:i,lastModifiedMs:o,file:n}},tc=async t=>{let{isLivePhoto:e,livePhotoAssets:n,uploadItem:i}=t;return e?ts(n):td(i)},ts=async t=>{let{image:e,video:n}=t,o=await td(e),a=await td(n);return{fileTypeInfo:{fileType:i.Gk.LIVE_PHOTO,extension:"".concat(o.fileTypeInfo.extension,"+").concat(a.fileTypeInfo.extension),imageType:o.fileTypeInfo.extension,videoType:a.fileTypeInfo.extension},fileSize:o.fileSize+a.fileSize,lastModifiedMs:o.lastModifiedMs}},td=async t=>{let{stream:e,fileSize:n,lastModifiedMs:i}=await tl(t);return{fileTypeInfo:await (0,O.b)(async()=>{let t=e.getReader(),n=(0,c.z)((await t.read()).value);return await t.cancel(),n},ta(t)),fileSize:n,lastModifiedMs:i}},tu=async t=>new Uint8Array(await new Response(t).arrayBuffer()),tp=async(t,e,n,i,o,a)=>{let{isLivePhoto:r,uploadItem:l,livePhotoAssets:c}=t;return r?await th(c,e,n,i,o,a):await tZ(l,e,n,i,o,a)},th=async(t,e,n,o,a,r)=>{let l={fileType:i.Gk.IMAGE,extension:e.imageType},{metadata:c,publicMagicMetadata:s}=await tZ(t.image,l,n,o,a,r),d=await tA(t.video,r);return{metadata:{...c,title:ta(t.image),fileType:i.Gk.LIVE_PHOTO,imageHash:c.hash,videoHash:d,hash:void 0},publicMagicMetadata:s}},tZ=async(t,e,n,o,a,r)=>{var l,c,s,d;let u;let p=ta(t),{fileType:h}=e;if(h===i.Gk.IMAGE)u=null!==(l=await tg(t,e,n))&&void 0!==l?l:tf;else if(h===i.Gk.VIDEO)u=null!==(c=await tm(t))&&void 0!==c?c:tf;else throw Error("Unexpected file type ".concat(h," for ").concat(t));let Z=await tA(t,r),f=1e3*n,g=null!==(d=null!==(s=u.creationTime)&&void 0!==s?s:(0,L.F)(p))&&void 0!==d?d:f,m={title:p,creationTime:g,modificationTime:f,latitude:u.location.latitude,longitude:u.location.longitude,fileType:h,hash:Z},A={w:u.width,h:u.height},E=(0,v.gq)(p,o,a);if(E)for(let[t,e]of Object.entries(E))e&&(m[t]=e);return{metadata:m,publicMagicMetadata:A}},tf={location:{...h.SN},creationTime:null,width:null,height:null};async function tg(t,e,n){let i;if("string"==typeof t||Array.isArray(t)){let{response:e}=await (0,b.o4)((0,a.M)(),t),o="string"==typeof t?t:t[1];i=new File([await e.arrayBuffer()],(0,r.EZ)(o),{lastModified:n})}else i=t instanceof File?t:t.file;try{return await (0,x.Z)(i,e)}catch(e){l.ZP.error("Failed to extract image metadata for ".concat(t),e);return}}let tm=async t=>{try{return await S.gq(t)}catch(e){l.ZP.error("Failed to extract video metadata for ".concat(t),e);return}},tA=async(t,e)=>{let{stream:n,chunkCount:i}=await tl(t),o=await e.initChunkHashing(),a=n.getReader();for(let t=0;t<i;t++){let{done:t,value:n}=await a.read();if(t)throw Error("Less chunks than expected");await e.hashFileChunk(o,Uint8Array.from(n))}let{done:r}=await a.read();if(!r)throw Error("More chunks than expected");return await e.completeChunkHashing(o)},tE=(t,e)=>(0,I.L)(t)&&(0,I.L)(e)?tC(t,e):tv(t,e),tC=(t,e)=>t.fileType===e.fileType&&t.title===e.title&&(t.fileType===i.Gk.LIVE_PHOTO?t.imageHash===e.imageHash&&t.videoHash===e.videoHash:t.hash===e.hash),tv=(t,e)=>t.fileType==e.fileType&&t.title==e.title&&1e6>Math.abs(t.creationTime-e.creationTime)&&1e6>Math.abs(t.modificationTime-e.modificationTime),tI=async(t,e)=>{let{isLivePhoto:n,uploadItem:i,livePhotoAssets:o}=e;return n?await tw(o,t):await ty(i,t)},tw=async(t,e)=>{let{fileStreamOrData:n,thumbnail:a,hasStaticThumbnail:r}=await tT(t.image,{extension:e.imageType,fileType:i.Gk.IMAGE},await tl(t.image)),l=await tl(t.video),c=async t=>{let e=async t=>{let{file:e,stream:n}=t;return e||await tu(n)};return t instanceof Uint8Array?t:e(t)};return{fileStreamOrData:await (0,o.k_)({imageFileName:ta(t.image),imageFileOrData:await c(n),videoFileName:ta(t.video),videoFileOrData:await c(l)}),thumbnail:a,hasStaticThumbnail:r}},ty=async(t,e)=>{let n=await tl(t);return tT(t,e,n)};class tx{constructor(){this.isNativeImageThumbnailGenerationNotAvailable=!1}}let tS=new tx,tT=async(t,e,n)=>{let o,a;let r=!1,c=globalThis.electron,s=e.fileType==i.Gk.IMAGE&&tS.isNativeImageThumbnailGenerationNotAvailable;if(c&&!s&&!(t instanceof File))try{a=await tt(c,t,e)}catch(t){t.message.endsWith(w.S.NotAvailable)?tS.isNativeImageThumbnailGenerationNotAvailable=!0:l.ZP.error("Native thumbnail generation failed",t)}if(!a){let r;if(t instanceof File)r=t;else if(e.fileType==i.Gk.IMAGE){let t=await tu(n.stream);r=new Blob([t]),o=t}else l.ZP.warn("Not using browser based thumbnail generation fallback for video at path ".concat(t));try{r&&(a=await Y(r,e))}catch(t){l.ZP.error("Web thumbnail creation failed",t)}}return a||(a=te(),r=!0),{fileStreamOrData:null!=o?o:n,thumbnail:a,hasStaticThumbnail:r}},tb=async t=>{var e;return(null===(e=Object.values((0,T.Yr)(t)))||void 0===e?void 0:e.length)===0?null:await (0,T.FA)(t)},t_=async(t,e,n)=>{let i;let{key:o,file:a}=await tO(t.fileStreamOrData,n),{file:r}=await n.encryptThumbnail(t.thumbnail,o),{file:l}=await n.encryptMetadata(t.metadata,o);if(t.pubMagicMetadata){let{file:e}=await n.encryptMetadata(t.pubMagicMetadata.data,o);i={version:t.pubMagicMetadata.version,count:t.pubMagicMetadata.count,data:e.encryptedData,header:e.decryptionHeader}}let c=await n.encryptToB64(o,e);return{file:{file:a,thumbnail:r,metadata:l,pubMagicMetadata:i,localID:t.localID},fileKey:c}},tO=async(t,e)=>t instanceof Uint8Array?await e.encryptFile(t):await tL(t,e),tL=async(t,e)=>{let{stream:n,chunkCount:i}=t,o=n.getReader(),{key:a,decryptionHeader:r,pushState:l}=await e.initChunkEncryption(),c={pullCount:1};return{key:a,file:{decryptionHeader:r,encryptedData:{stream:new ReadableStream({async pull(t){let{value:n}=await o.read(),a=await e.encryptFileChunk(n,l,c.pullCount===i);t.enqueue(a),c.pullCount===i&&t.close(),c.pullCount++}}),chunkCount:i}}}},tR=async(t,e,n,i)=>{try{let o=null,a=t.file.encryptedData;if(a instanceof Uint8Array||!(a.chunkCount>=5)){let i=a instanceof Uint8Array?a:await tu(a.stream),r=e(t.localID),l=await to.getUploadURL();o=n?await B.putFile(l,i,r):await B.putFileV2(l,i,r)}else o=await tP(t.localID,a,e,n,i);let r=await to.getUploadURL(),l=null;return l=n?await B.putFile(r,t.thumbnail.encryptedData,null):await B.putFileV2(r,t.thumbnail.encryptedData,null),{file:{decryptionHeader:t.file.decryptionHeader,objectKey:o},thumbnail:{decryptionHeader:t.thumbnail.decryptionHeader,objectKey:l},metadata:t.metadata,pubMagicMetadata:t.pubMagicMetadata}}catch(t){throw t.message!==u.sH.UPLOAD_CANCELLED&&l.ZP.error("Error when uploading to bucket",t),t}};async function tP(t,e,n,i,o){let a=Math.ceil(e.chunkCount/5),r=await to.fetchMultipartUploadURLs(a),{stream:l}=e,c=l.getReader(),s=(0,h.Pu)()/a,d=[];for(let[e,a]of r.partURLs.entries()){o();let r=await tD(c),l=n(t,s,e),u=null;u=i?await B.putFilePart(a,r,l):await B.putFilePartV2(a,r,l),d.push({PartNumber:e+1,ETag:u})}let{done:u}=await c.read();if(!u)throw Error("More chunks than expected");let p=r.completeURL,Z=_.js2xml({CompleteMultipartUpload:{Part:d}},{compact:!0,ignoreComment:!0,spaces:4});return i?await B.completeMultipartUpload(p,Z):await B.completeMultipartUploadV2(p,Z),r.objectKey}async function tD(t){let e=[];for(let n=0;n<5;n++){let{done:n,value:i}=await t.read();if(n)break;for(let t=0;t<i.length;t++)e.push(i[t])}return Uint8Array.from(e)}class tN{reset(){this.shouldUploadBeCancelled.value=!1}requestUploadCancelation(){this.shouldUploadBeCancelled.value=!0}isUploadCancelationRequested(){return this.shouldUploadBeCancelled.value}constructor(){this.shouldUploadBeCancelled={value:!1}}}let tk=new tN;class tM{init(t){this.progressUpdater=t,this.progressUpdater.setUploadStage(this.uploadStage),this.progressUpdater.setUploadFilenames(this.filenames),this.progressUpdater.setHasLivePhotos(this.hasLivePhoto),this.progressUpdater.setUploadProgressView(this.uploadProgressView),this.progressUpdater.setUploadCounter({finished:this.filesUploadedCount,total:this.totalFilesCount}),this.progressUpdater.setInProgressUploads(tB(this.inProgressUploads)),this.progressUpdater.setFinishedUploads(tU(this.finishedUploads))}reset(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.setTotalFileCount(t),this.filesUploadedCount=0,this.inProgressUploads=new Map,this.finishedUploads=new Map,this.updateProgressBarUI()}setTotalFileCount(t){this.totalFilesCount=t,t>0?this.perFileProgress=100/this.totalFilesCount:this.perFileProgress=0}setFileProgress(t,e){this.inProgressUploads.set(t,e),this.updateProgressBarUI()}setUploadStage(t){this.uploadStage=t,this.progressUpdater.setUploadStage(t)}setFiles(t){let e=new Map(t.map(t=>[t.localID,t.fileName]));this.filenames=e,this.progressUpdater.setUploadFilenames(e)}setHasLivePhoto(t){this.hasLivePhoto=t,this.progressUpdater.setHasLivePhotos(t)}setUploadProgressView(t){this.uploadProgressView=t,this.progressUpdater.setUploadProgressView(t)}increaseFileUploaded(){this.filesUploadedCount++,this.updateProgressBarUI()}moveFileToResultList(t,e){this.finishedUploads.set(t,e),this.inProgressUploads.delete(t),this.updateProgressBarUI()}hasFilesInResultList(){return this.finishedUploads.size>0}updateProgressBarUI(){let{setPercentComplete:t,setUploadCounter:e,setInProgressUploads:n,setFinishedUploads:i}=this.progressUpdater;e({finished:this.filesUploadedCount,total:this.totalFilesCount});let o=this.perFileProgress*(this.finishedUploads.size||this.filesUploadedCount);if(this.inProgressUploads)for(let[t,e]of this.inProgressUploads)e<0||(o+=this.perFileProgress*e/100);t(o),n(tB(this.inProgressUploads)),i(tU(this.finishedUploads))}trackUploadProgress(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,h.Pu)(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={exec:()=>{}},o=()=>i.exec(u.sH.REQUEST_TIMEOUT),a=()=>i.exec(u.sH.UPLOAD_CANCELLED),r=null,l=()=>{r&&clearTimeout(r),r=setTimeout(o,3e4)};return{cancel:i,onUploadProgress:i=>{this.inProgressUploads.set(t,Math.min(Math.round(e*n+e*i.loaded/i.total),98)),this.updateProgressBarUI(),i.loaded===i.total?clearTimeout(r):l(),tk.isUploadCancelationRequested()&&a()}}}constructor(){this.uploadStage=h.ps.START,this.filenames=new Map,this.hasLivePhoto=!1,this.uploadProgressView=!1,this.inProgressUploads=new Map,this.finishedUploads=new Map}}function tB(t){return[...t.entries()].map(t=>{let[e,n]=t;return{localFileID:e,progress:n}})}let tU=t=>{let e=new Map;for(let[n,i]of t)e.has(i)||e.set(i,[]),e.get(i).push(n);return e};class tF{async init(t,e,n,i){this.uiService.init(t);let o=await (0,m.ST)();o&&(i=o),this.isCFUploadProxyDisabled=i,to.init(n),this.setFiles=e,this.publicUploadProps=n}isUploadRunning(){return this.uploadInProgress}resetState(){this.itemsToBeUploaded=[],this.failedItems=[],this.parsedMetadataJSONMap=new Map,this.uploaderName=null}prepareForNewUpload(){this.resetState(),this.uiService.reset(),tk.reset(),this.uiService.setUploadStage(h.ps.START)}showUploadProgressDialog(){this.uiService.setUploadProgressView(!0)}async uploadItems(t,e,n){if(this.uploadInProgress)throw Error("Cannot run multiple uploads at once");l.ZP.info("Uploading ".concat(t.length," files")),this.uploadInProgress=!0,this.uploaderName=n;try{await this.updateExistingFilesAndCollections(e);let n=t.map(tX);this.uiService.setFiles(n);let[i,o]=tK(n);if(i.length&&(this.uiService.setUploadStage(h.ps.READING_GOOGLE_METADATA_FILES),await this.parseMetadataJSONFiles(i)),o.length){let t=await tW(o);this.abortIfCancelled(),this.uiService.setFiles(t),this.uiService.setHasLivePhoto(o.length!=t.length),await this.uploadMediaItems(t)}}catch(t){if(t.message!=u.sH.UPLOAD_CANCELLED)throw l.ZP.error("Upload failed",t),t}finally{var i,o;this.uiService.setUploadStage(h.ps.FINISH),null===(i=globalThis.electron)||void 0===i||i.clearPendingUploads();for(let t=0;t<4;t++)null===(o=this.cryptoWorkers[t])||void 0===o||o.terminate();this.uploadInProgress=!1}return this.uiService.hasFilesInResultList()}async updateExistingFilesAndCollections(t){this.publicUploadProps.accessedThroughSharedURL?this.existingFiles=await (0,g.CE)((0,g.yB)(this.publicUploadProps.token)):this.existingFiles=(0,E.Zt)(await (0,C.dm)()),this.collections=new Map(t.map(t=>[t.id,t]))}async parseMetadataJSONFiles(t){for(let{uploadItem:e,fileName:n,collectionID:i}of(this.uiService.reset(t.length),t)){this.abortIfCancelled(),l.ZP.info("Parsing metadata JSON ".concat(n));let t=await (0,v.jN)((0,c.z)(e));t&&(this.parsedMetadataJSONMap.set((0,v.RJ)(i,n),t),this.uiService.increaseFileUploaded())}}async uploadMediaItems(t){this.itemsToBeUploaded=[...this.itemsToBeUploaded,...t],this.uiService.reset(t.length),await to.setFileCount(t.length),this.uiService.setUploadStage(h.ps.UPLOADING);let e=[];for(let t=0;t<4&&this.itemsToBeUploaded.length>0;t++){this.cryptoWorkers[t]=(0,d.P)();let n=await this.cryptoWorkers[t].remote;e.push(this.uploadNextItemInQueue(n))}await Promise.all(e)}async uploadNextItemInQueue(t){let e=this.uiService;for(;this.itemsToBeUploaded.length>0;){this.abortIfCancelled();let n=this.itemsToBeUploaded.pop(),{localID:i,collectionID:o}=n,a=this.collections.get(o),r={...n,collection:a};e.setFileProgress(i,0),await (0,s.D)(0);let{uploadResult:l,uploadedFile:c}=await tr(r,this.uploaderName,this.existingFiles,this.parsedMetadataJSONMap,t,this.isCFUploadProxyDisabled,()=>{this.abortIfCancelled()},(t,n,i)=>e.trackUploadProgress(t,n,i)),d=await this.postUploadTask(r,l,c);this.uiService.moveFileToResultList(i,d),this.uiService.increaseFileUploaded(),to.reducePendingUploadCount()}}async postUploadTask(t,e,n){l.ZP.info("Uploaded ".concat(t.fileName," with result ").concat(e));try{let o;let a=globalThis.electron;switch(a&&await tG(a,t),e){case h.Le.FAILED:case h.Le.BLOCKED:this.failedItems.push(t);break;case h.Le.ALREADY_UPLOADED:o=n;break;case h.Le.ADDED_SYMLINK:o=n,e=h.Le.UPLOADED;break;case h.Le.UPLOADED:case h.Le.UPLOADED_WITH_STATIC_THUMBNAIL:o=await (0,E.np)(n,t.collection.key);break;case h.Le.UNSUPPORTED:case h.Le.TOO_LARGE:break;default:throw Error("Invalid Upload Result ".concat(e))}if([h.Le.ADDED_SYMLINK,h.Le.UPLOADED,h.Le.UPLOADED_WITH_STATIC_THUMBNAIL].includes(e)){try{var i;let e;let n=null!==(i=t.uploadItem)&&void 0!==i?i:t.livePhotoAssets.image;n&&(n instanceof File?e=n:"string"==typeof n||Array.isArray(n)||(e=n.file)),p.Y.emit(p.z.FILE_UPLOADED,{enteFile:o,localFile:e})}catch(t){l.ZP.warn("Ignoring error in fileUploaded handlers",t)}this.updateExistingFiles(o)}return await this.watchFolderCallback(e,t,n),e}catch(t){return l.ZP.error("failed to do post file upload action",t),h.Le.FAILED}}async watchFolderCallback(t,e,n){f()()&&A.Z.isUploadRunning()&&await A.Z.onFileUpload(t,e,n)}cancelRunningUpload(){l.ZP.info("User cancelled running upload"),this.uiService.setUploadStage(h.ps.CANCELLING),tk.requestUploadCancelation()}getFailedItemsWithCollections(){return{items:this.failedItems,collections:[...this.collections.values()]}}getUploaderName(){return this.uploaderName}updateExistingFiles(t){if(!t)throw Error("decrypted file can't be undefined");this.existingFiles.push(t),this.updateUIFiles(t)}updateUIFiles(t){this.setFiles(e=>(0,E.hE)([...e,t]))}constructor(){this.cryptoWorkers=[,,,,],this.isCFUploadProxyDisabled=!1,this.abortIfCancelled=()=>{if(tk.isUploadCancelationRequested())throw Error(u.sH.UPLOAD_CANCELLED)},this.shouldAllowNewUpload=()=>!this.uploadInProgress||A.Z.isUploadRunning(),this.uiService=new tM}}var tH=new tF;let tX=t=>({localID:(0,c.z)(t.localID),collectionID:(0,c.z)(t.collectionID),fileName:(0,c.z)(t.isLivePhoto?ta(t.livePhotoAssets.image):ta(t.uploadItem)),isLivePhoto:t.isLivePhoto,uploadItem:t.uploadItem,livePhotoAssets:t.livePhotoAssets}),tK=t=>t.reduce((t,e)=>{let[n,i]=t;return"json"==(0,r.qN)(e.fileName)?n.push(e):i.push(e),[n,i]},[[],[]]),tG=async(t,e)=>{if(e.isLivePhoto){let[n,i]=[e.livePhotoAssets.image,e.livePhotoAssets.video];if(Array.isArray(n)&&Array.isArray(i))t.markUploadedZipItems([n,i]);else if("string"==typeof n&&"string"==typeof i)t.markUploadedFiles([n,i]);else if(n&&"object"==typeof n&&"path"in n&&i&&"object"==typeof i&&"path"in i)t.markUploadedFiles([n.path,i.path]);else throw Error("Attempting to mark upload completion of unexpected desktop upload items")}else{let n=(0,c.z)(e.uploadItem);if(Array.isArray(n))t.markUploadedZipItems([n]);else if("string"==typeof n)t.markUploadedFiles([n]);else if(n&&"object"==typeof n&&"path"in n)t.markUploadedFiles([n.path]);else throw Error("Attempting to mark upload completion of unexpected desktop upload items")}},tW=async t=>{let e=[];t.sort((t,e)=>(0,r.YA)(t.fileName)[0].localeCompare((0,r.YA)(e.fileName)[0])).sort((t,e)=>t.collectionID-e.collectionID);let n=0;for(;n<t.length-1;){let a=t[n],r=t[n+1],l=(0,o.Ji)(a.fileName),c=(0,o.Ji)(r.fileName),s={fileName:a.fileName,fileType:l,collectionID:a.collectionID,uploadItem:a.uploadItem},d={fileName:r.fileName,fileType:c,collectionID:r.collectionID,uploadItem:r.uploadItem};if(await tV(s,d)){let[t,o]=l==i.Gk.IMAGE?[a,r]:[r,a];e.push({localID:a.localID,collectionID:a.collectionID,fileName:t.fileName,isLivePhoto:!0,livePhotoAssets:{image:t.uploadItem,video:o.uploadItem}}),n+=2}else e.push({...a,isLivePhoto:!1}),n+=1}return n===t.length-1&&e.push({...t[n],isLivePhoto:!1}),e},tV=async(t,e)=>{let n,o;if(t.collectionID!=e.collectionID)return!1;let[a,c]=(0,r.YA)(t.fileName),[s,d]=(0,r.YA)(e.fileName);if(t.fileType==i.Gk.IMAGE&&e.fileType==i.Gk.VIDEO)n=tY(a,d?".".concat(d):void 0),o=tY(s);else{if(t.fileType!=i.Gk.VIDEO||e.fileType!=i.Gk.IMAGE)return!1;n=tY(a),o=tY(s,c?".".concat(c):void 0)}if(n!=o)return!1;let u=await tz(t.uploadItem),p=await tz(e.uploadItem);return!(u>20971520)&&!(p>20971520)||(l.ZP.info("Not classifying files with too large sizes (".concat(u," and ").concat(p," bytes) as a live photo")),!1)},tY=(t,e)=>{let n;let i="_HVEC";return t.endsWith("_3")?n="_3":t.endsWith(i)||t.endsWith(i.toLowerCase())?n=i:e&&(t.endsWith(e)||t.endsWith(e.toLowerCase()))&&(n=e),n?t.slice(0,-1*n.length):t},tz=async t=>t instanceof File?t.size:"string"==typeof t||Array.isArray(t)?(0,a.M)().pathOrZipItemSize(t):t.file.size},96741:function(t,e,n){"use strict";var i=n(82155),o=n(54032),a=n(96045),r=n(17973),l=n(6114),c=n(36386),s=n.n(c),d=n(40994),u=n(79541),p=n(5155),h=n(82797);class Z{init(t,e){this.upload=t,this.requestSyncWithRemote=e,this.registerListeners(),this.syncWithDisk()}isUploadRunning(){return this.uploadRunning}isSyncPaused(){return this.isPaused}pauseRunningSync(){this.isPaused=!0,d.Z.cancelRunningUpload()}resumePausedSync(){this.isPaused=!1,this.syncWithDisk()}async getWatches(){return await (0,i.M)().watch.get()}isSyncingFolder(t){var e;return(null===(e=this.activeWatch)||void 0===e?void 0:e.folderPath)==t}async addWatch(t,e){let n=await (0,i.M)().watch.add(t,e);return this.syncWithDisk(),n}async removeWatch(t){return await (0,i.M)().watch.remove(t)}async syncWithDisk(){try{let t=await this.getWatches();if(!t)return;this.eventQueue=[];let e=await g(t);a.ZP.info("Folder watch deduced ".concat(e.length," events")),this.eventQueue=this.eventQueue.concat(e),this.debouncedRunNextEvent()}catch(t){a.ZP.error("Ignoring error while syncing watched folders",t)}}pushEvent(t){this.eventQueue.push(t),a.ZP.info("Folder watch event",t),this.debouncedRunNextEvent()}registerListeners(){let t=(0,i.M)().watch;t.onAddFile((t,e)=>{this.pushEvent({action:"upload",collectionName:v(t,e),folderPath:e.folderPath,filePath:t})}),t.onRemoveFile((t,e)=>{this.pushEvent({action:"trash",collectionName:v(t,e),folderPath:e.folderPath,filePath:t})}),t.onRemoveDir((t,e)=>{t==e.folderPath&&(a.ZP.info("Received file system delete event for a watched folder at ".concat(t)),this.deletedFolderPaths.push(t))})}async runNextEvent(){if(0==this.eventQueue.length||this.activeWatch||this.isPaused)return;let t=t=>{a.ZP.info("Ignoring event since ".concat(t)),this.debouncedRunNextEvent()},e=this.dequeueClubbedEvent();a.ZP.info("Processing ".concat(e.action," event for folder watch ").concat(e.folderPath," (collectionName ").concat(e.collectionName,", ").concat(e.filePaths.length," files)"));let n=(await this.getWatches()).find(t=>t.folderPath==e.folderPath);if(!n){t("no folder watch for found for ".concat(e.folderPath));return}if("upload"===e.action){let i=m(e.filePaths,n);if(0==i.length){t("none of the files need uploading");return}this.activeWatch=n,this.uploadRunning=!0;let o=e.collectionName;a.ZP.info("Folder watch requested upload of ".concat(i.length," files to collection ").concat(o)),this.upload(o,i)}else{if(this.pruneFileEventsFromDeletedFolderPaths()){t("event was from a deleted folder path");return}let[o,a]=n.syncedFiles.reduce((t,i)=>{let[o,a]=t,{path:r}=i;return(e.filePaths.includes(r)?a:o).push(n),[o,a]},[[],[]]);this.activeWatch=n,await this.moveToTrash(o),await (0,i.M)().watch.updateSyncedFiles(a,n.folderPath),this.activeWatch=void 0,this.debouncedRunNextEvent()}}dequeueClubbedEvent(){let t=this.eventQueue.shift();if(!t)return;let e=[t.filePath];for(;this.eventQueue.length>0&&t.action===this.eventQueue[0].action&&t.folderPath===this.eventQueue[0].folderPath&&t.collectionName===this.eventQueue[0].collectionName;)e.push(this.eventQueue[0].filePath),this.eventQueue.shift();return{...t,filePaths:e}}async onFileUpload(t,e,n){[l.Le.ADDED_SYMLINK,l.Le.UPLOADED,l.Le.UPLOADED_WITH_STATIC_THUMBNAIL,l.Le.ALREADY_UPLOADED].includes(t)?e.isLivePhoto?(this.uploadedFileForPath.set((0,r.Z)(e.livePhotoAssets.image),n),this.uploadedFileForPath.set((0,r.Z)(e.livePhotoAssets.video),n)):this.uploadedFileForPath.set((0,r.Z)(e.uploadItem),n):[l.Le.UNSUPPORTED,l.Le.TOO_LARGE].includes(t)&&(e.isLivePhoto?(this.unUploadableFilePaths.add((0,r.Z)(e.livePhotoAssets.image)),this.unUploadableFilePaths.add((0,r.Z)(e.livePhotoAssets.video))):this.unUploadableFilePaths.add((0,r.Z)(e.uploadItem)))}async allFileUploadsDone(t,e){let n=(0,i.M)(),o=this.activeWatch;a.ZP.debug(()=>JSON.stringify({f:"watch/allFileUploadsDone",uploadItemsWithCollection:t,collections:e,watch:o}));let{syncedFiles:r,ignoredFiles:l}=this.deduceSyncedAndIgnored(t);r.length>0&&await n.watch.updateSyncedFiles(o.syncedFiles.concat(r),o.folderPath),l.length>0&&await n.watch.updateIgnoredFiles(o.ignoredFiles.concat(l),o.folderPath),this.activeWatch=void 0,this.uploadRunning=!1,this.debouncedRunNextEvent()}deduceSyncedAndIgnored(t){let e=[],n=[],i=(t,n)=>{e.push({path:n,uploadedFileID:t.id,collectionID:t.collectionID}),this.uploadedFileForPath.delete(n)},o=t=>{a.ZP.debug(()=>"Permanently ignoring file at ".concat(t)),n.push(t),this.unUploadableFilePaths.delete(t)};for(let e of t)if(e.isLivePhoto){let t=(0,r.Z)(e.livePhotoAssets.image),n=(0,r.Z)(e.livePhotoAssets.video),a=this.uploadedFileForPath.get(t),l=this.uploadedFileForPath.get(n);a&&l?(i(a,t),i(l,n)):this.unUploadableFilePaths.has(t)&&this.unUploadableFilePaths.has(n)&&(o(t),o(n))}else{let t=(0,r.Z)(e.uploadItem),n=this.uploadedFileForPath.get(t);n?i(n,t):this.unUploadableFilePaths.has(t)&&o(t)}return{syncedFiles:e,ignoredFiles:n}}pruneFileEventsFromDeletedFolderPaths(){let t=this.deletedFolderPaths.shift();return!!t&&(this.eventQueue=this.eventQueue.filter(e=>!e.filePath.startsWith(t)),!0)}async moveToTrash(t){let e=new Map;for(let n of t)e.set(n.uploadedFileID,n);let n=(await (0,h.dm)()).filter(t=>{let n=e.get(t.id);return!!n&&n.collectionID==t.collectionID});for(let[t,e]of(0,u.qF)(n).entries())await (0,p.uQ)(t,e);this.requestSyncWithRemote()}constructor(){this.eventQueue=[],this.deletedFolderPaths=[],this.uploadRunning=!1,this.isPaused=!1,this.uploadedFileForPath=new Map,this.unUploadableFilePaths=new Set,this.debouncedRunNextEvent=s()(()=>this.runNextEvent(),1e3)}}let f=new Z;e.Z=f;let g=async t=>{let e=(0,i.M)(),n=[];for(let i of t){let t=i.folderPath,o=await e.watch.findFiles(t);for(let e of m(o,i))n.push({action:"upload",folderPath:t,collectionName:v(e,i),filePath:e});for(let e of E(o,i))n.push({action:"trash",folderPath:t,collectionName:v(e,i),filePath:e})}return n},m=(t,e)=>t.filter(t=>!A(t)).filter(t=>!C(t,e)),A=t=>(0,o.EZ)(t).startsWith("."),E=(t,e)=>e.syncedFiles.map(t=>t.path).filter(e=>!t.includes(e)),C=(t,e)=>e.ignoredFiles.includes(t)||e.syncedFiles.find(e=>e.path===t),v=(t,e)=>"root"==e.collectionMapping?(0,o.EZ)(e.folderPath):I(t),I=t=>(0,o.EZ)((0,o.XX)(t))},67335:function(t,e,n){"use strict";var i,o,a,r;n.d(e,{M:function(){return i},r:function(){return o}}),(a=i||(i={}))[a.normalUpload=0]="normalUpload",a[a.import=1]="import",a[a.collectPhotos=2]="collectPhotos",(r=o||(o={}))[r.upload=0]="upload",r[r.add=1]="add",r[r.move=2]="move",r[r.restore=3]="restore",r[r.unhide=4]="unhide"},62798:function(t,e,n){"use strict";var i,o;n.d(e,{OS:function(){return i},X:function(){return r},f:function(){return a}}),(o=i||(i={})).WP="wp",o.ANDROID="android",o.IOS="ios",o.UNKNOWN="unknown",o.WINDOWS="windows",o.MAC="mac",o.LINUX="linux";let a=()=>{let t="";return(void 0!==window.navigator&&(t=navigator.userAgent||navigator.vendor||window.opera),/windows phone/i.test(t))?"wp":/android/i.test(t)?"android":/(iPad|iPhone|iPod)/g.test(t)&&!window.MSStream?"ios":t.includes("Windows")?"windows":t.includes("Macintosh")?"mac":t.includes("Linux")?"linux":"unknown"},r=()=>{var t;let e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4)))&&(e=!0),e}},68372:function(t,e,n){"use strict";n.d(e,{u:function(){return a}});var i=n(24991);let o=new Intl.NumberFormat(i.ZP.language);function a(t){return o.format(t)}},92508:function(t,e,n){"use strict";n.d(e,{Kz:function(){return a},Po:function(){return s},Rw:function(){return c},al:function(){return l},r:function(){return r}});var i=n(58178),o=n(96045);async function a(t,e){t.paused&&(t.style.opacity=1,e.style.opacity=0,t.load(),t.play().catch(()=>{r(t,e)}))}async function r(t,e){t.paused||(t.pause(),t.style.opacity=0,e.style.opacity=1)}function l(t,e){t.w=window.innerWidth,t.h=window.innerHeight,t.msrc=e,t.isSourceLoaded=!1,t.conversionFailed=!1,t.isConverted=!1,t.metadata.fileType===i.Gk.IMAGE?t.src=e:t.html="\n            <div class = 'pswp-item-container'>\n                <img src=\"".concat(e,'"/>\n            </div>\n            ')}async function c(t,e,n){let{url:a,isRenderable:r,isOriginal:l}=e;if(t.w=window.innerWidth,t.h=window.innerHeight,t.isSourceLoaded=t.metadata.fileType!==i.Gk.LIVE_PHOTO||"livePhoto"===e.type,t.isConverted=!l,t.conversionFailed=!r,t.srcURLs=e,!r){t.isSourceLoaded=!0;return}if(t.metadata.fileType===i.Gk.VIDEO)t.html="\n                <video controls ".concat(!n&&'controlsList="nodownload"',' onContextMenu="return false;">\n                    <source src="').concat(a,'" />\n                    Your browser does not support the video tag.\n                </video>\n                ');else if(t.metadata.fileType===i.Gk.LIVE_PHOTO){if("normal"===e.type)t.html="\n                <div class = 'pswp-item-container'>\n                    <img id = \"live-photo-image-".concat(t.id,'" src="').concat(a,'" onContextMenu="return false;"/>\n                </div>\n                ');else{let{image:e,video:n}=a;t.html="\n            <div class = 'pswp-item-container'>\n                <img id = \"live-photo-image-".concat(t.id,'" src="').concat(e,'" onContextMenu="return false;"/>\n                <video id = "live-photo-video-').concat(t.id,'" loop muted onContextMenu="return false;">\n                    <source src="').concat(n,'" />\n                    Your browser does not support the video tag.\n                </video>\n            </div>\n            ')}}else t.metadata.fileType===i.Gk.IMAGE||o.ZP.error("unknown file type - ".concat(t.metadata.fileType)),t.src=a}let s=(t,e,n)=>(i,o,a)=>r=>{void 0!==a&&(r?n(a):n(void 0)),t(t=>{t.collectionID!==e&&(t={ownCount:0,count:0,collectionID:0});let n=e=>t[i]===r?e:r?e+1:e-1;return{...t,[i]:r,collectionID:e,...o?{ownCount:n(t.ownCount),count:n(t.count)}:{count:n(t.count)}}})}},48751:function(t,e,n){"use strict";n.d(e,{H:function(){return i}});let i=(0,n(2784).createContext)({token:null,passwordToken:null,referralCode:null,accessedThroughSharedURL:!1,photoListHeader:null,photoListFooter:null})},80427:function(t,e,n){"use strict";n.d(e,{O5:function(){return r},e8:function(){return a},nS:function(){return l}});var i=n(24991);let o=["b","kb","mb","gb","tb"],a=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(t/1073741824).toFixed(e)};function r(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(t<=0)return"0 ".concat((0,i.t)("storage_unit.mb"));let n=Math.min(Math.floor(Math.log(t)/Math.log(1024)),o.length-1),a=o[n];return"".concat((t/Math.pow(1024,n)).toFixed(e)," ").concat((0,i.t)("storage_unit.".concat(a)))}let l=(t,e)=>{if(t<=0)return"0 ".concat((0,i.t)("storage_unit.mb"));let n=Math.min(Math.floor(Math.log(t)/Math.log(1024)),o.length-1),a=t/Math.pow(1024,n),r=o[n];return a>100&&n<o.length-2&&(a/=1024,r=o[n+1]),a=Number(a.toFixed(1)),t>=10737418240&&(a=(null==e?void 0:e.round)?Math.ceil(a):Math.round(a)),"".concat(a," ").concat((0,i.t)("storage_unit.".concat(r)))}},49264:function(t,e,n){"use strict";n.d(e,{L:function(){return i}});let i=t=>!!t.hash||!!t.imageHash&&!!t.videoHash},89330:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});var i=n(52903),o=n(93710),a=n(33500),r=n(46772),l=n(73906),c=n(24991);function s(t){let{onClick:e}=t;return(0,i.tZ)(o.Z,{triggerButtonProps:{sx:{ml:1}},ariaControls:"export-option",triggerButtonIcon:(0,i.tZ)(l.Z,{}),children:(0,i.tZ)(a.x,{onClick:e,startIcon:(0,i.tZ)(r.Z,{}),children:(0,c.t)("CHANGE_FOLDER")})})}},65438:function(t,e,n){"use strict";n.d(e,{Z:function(){return d}});var i=n(52903),o=n(80162),a=n(711),r=n(2672),l=n(85801),c=n(24991),s=n(2784);function d(t){let{code:e,color:n,size:d}=t,[u,p]=(0,s.useState)(!1);return(0,i.tZ)(r.Z,{arrow:!0,open:u,title:(0,c.t)("COPIED"),PopperProps:{sx:{zIndex:2e3}},children:(0,i.tZ)(l.Z,{onClick:()=>{navigator.clipboard.writeText(e),p(!0),setTimeout(()=>p(!1),1e3)},color:n,children:u?(0,i.tZ)(a.Z,{fontSize:null!=d?d:"small"}):(0,i.tZ)(o.Z,{fontSize:null!=d?d:"small"})})})}},73659:function(t,e,n){"use strict";n.d(e,{Z:function(){return g}});var i=n(52903),o=n(89449),a=n(46470);n(2784);var r=n(65438),l=n(73235),c=n(65992),s=n(24862);function d(){let t=(0,l._)(["\n    position: relative;\n    background: ",";\n    border-radius: ","px;\n    min-height: 80px;\n"]);return d=function(){return t},t}function u(){let t=(0,l._)(["\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    margin-top: ",";\n"]);return u=function(){return t},t}function p(){let t=(0,l._)(["\n    padding: 16px 36px 16px 16px;\n    border-radius: ","px;\n"]);return p=function(){return t},t}let h=(0,c.ZP)(o.Tn)(d(),t=>{let{theme:e}=t;return e.colors.accent.A700},t=>{let{theme:e}=t;return e.shape.borderRadius}),Z=(0,c.ZP)(s.Z)(u(),t=>{let{theme:e}=t;return e.spacing(1)}),f=(0,c.ZP)("div")(p(),t=>{let{theme:e}=t;return e.shape.borderRadius});function g(t){let{code:e,wordBreak:n,...l}=t;return e?(0,i.BX)(h,{...l,children:[(0,i.tZ)(f,{children:(0,i.tZ)(o.lN,{style:{wordBreak:n},children:e})}),(0,i.tZ)(Z,{children:(0,i.tZ)(r.Z,{code:e})})]}):(0,i.tZ)(h,{children:(0,i.tZ)(a.Z,{})})}},83422:function(t,e,n){"use strict";var i=n(52903),o=n(26436),a=n(38203),r=n(35469),l=n(85801);n(2784),e.Z=t=>{let{showPassword:e,handleClickShowPassword:n,handleMouseDownPassword:c}=t;return(0,i.tZ)(r.Z,{position:"end",children:(0,i.tZ)(l.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:n,onMouseDown:c,edge:"end",children:e?(0,i.tZ)(a.Z,{}):(0,i.tZ)(o.Z,{})})})}},95770:function(t,e,n){"use strict";var i=n(52903),o=n(23119);n(2784),e.Z=t=>{let{children:e,sx:n,color:a,...r}=t;return(0,i.tZ)(o.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(a,".main"),textDecoration:"underline ",textDecorationColor:"".concat(a,".main")},...n},...r,children:e})}},48588:function(t,e,n){"use strict";n.d(e,{v:function(){return Z}});var i=n(52903),o=n(89449),a=n(62197);let r=t=>"critical"===t?"critical.main":"text.faint",l=t=>(0,i.BX)(o.zr,{gap:"4px",children:[(0,i.BX)(a.Z,{children:[" ",t.mainText]}),(0,i.tZ)(a.Z,{variant:"small",color:r(t.color),children:"•"}),t.subText?(0,i.tZ)(a.Z,{variant:"small",color:r(t.color),children:t.subText}):(0,i.tZ)(a.Z,{variant:"small",color:r(t.color),children:t.subIcon})]});var c=n(89330),s=n(65992),d=n(38738);let u=(0,s.ZP)(t=>(0,i.tZ)(d.Z,{focusVisibleClassName:".Mui-focusVisible",disableRipple:!0,...t}))(t=>{let{theme:e}=t;return{width:40,height:24,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:"dark"===e.palette.mode?"#2ECA45":"#65C466",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:"light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:"light"===e.palette.mode?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:20,height:20},"& .MuiSwitch-track":{borderRadius:11,backgroundColor:"light"===e.palette.mode?"#E9E9EA":e.colors.fill.muted,opacity:1,transition:e.transitions.create(["background-color"],{duration:500})}}});var p=n(425),h=n(24862);function Z(t){let{onClick:e,color:n="primary",startIcon:r,endIcon:s,label:d,subText:Z,subIcon:f,checked:g,variant:m="primary",fontWeight:A="bold",labelComponent:E,disabled:C=!1}=t,v=()=>{("path"===m||"toggle"===m)&&e()},I=null!=d?d:"";return(0,i.tZ)(p.Z,{disabled:C,onClick:()=>{"path"!==m&&"toggle"!==m&&e()},sx:{width:"100%",color:t=>"captioned"!==m?t.palette[n].main:"inherit",backgroundColor:t=>"secondary"!==m&&"mini"!==m?t.colors.fill.faint:"inherit","&:hover":{backgroundColor:t=>t.colors.fill.faintPressed},"& .MuiSvgIcon-root":{fontSize:"20px"},p:0,borderRadius:"4px"},children:(0,i.BX)(o.Gm,{sx:{pl:"16px",pr:"12px"},children:[(0,i.BX)(o.zr,{sx:{py:"14px"},gap:"10px",children:[r&&r,(0,i.tZ)(h.Z,{px:"2px",children:E||("captioned"===m?(0,i.tZ)(l,{color:n,mainText:I,subText:Z,subIcon:f}):"mini"===m?(0,i.tZ)(a.Z,{variant:"mini",color:"text.muted",children:I}):(0,i.tZ)(a.Z,{fontWeight:A,children:I}))})]}),(0,i.BX)(o.zr,{gap:"4px",children:[s&&s,"toggle"===m&&(0,i.tZ)(u,{checked:g,onClick:v}),"path"===m&&(0,i.tZ)(c.Z,{onClick:v})]})]})})}n(2784)},42399:function(t,e,n){"use strict";n.d(e,{X:function(){return l}});var i=n(73235),o=n(65992),a=n(59409);function r(){let t=(0,i._)(["\n    position: fixed;\n    z-index: 12;\n"]);return r=function(){return t},t}let l=(0,o.ZP)(a.Z)(r())},90635:function(t,e,n){"use strict";n.d(e,{j:function(){return i}});let i=(0,n(2784).createContext)({close:()=>{}})},93710:function(t,e,n){"use strict";n.d(e,{Z:function(){return p},l:function(){return u}});var i=n(73235),o=n(52903),a=n(65992),r=n(85801),l=n(19986),c=n(2784),s=n(90635);function d(){let t=(0,i._)(["\n    & .MuiPaper-root {\n        margin: 16px auto;\n        box-shadow:\n            0px 0px 6px rgba(0, 0, 0, 0.16),\n            0px 3px 6px rgba(0, 0, 0, 0.12);\n    }\n    & .MuiList-root {\n        padding: 0;\n        border: none;\n    }\n"]);return d=function(){return t},t}let u=(0,a.ZP)(l.Z)(d());function p(t){let{children:e,ariaControls:n,triggerButtonIcon:i,triggerButtonProps:a,menuPaperProps:l}=t,[d,p]=(0,c.useState)(null),h=()=>p(null);return(0,o.BX)(s.j.Provider,{value:{close:h},children:[(0,o.tZ)(r.Z,{onClick:t=>p(t.currentTarget),"aria-controls":d?n:void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,...a,children:i}),(0,o.tZ)(u,{id:n,anchorEl:d,open:!!d,onClose:h,MenuListProps:{disablePadding:!0,"aria-labelledby":n},PaperProps:l,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e})]})}},33500:function(t,e,n){"use strict";n.d(e,{x:function(){return d}});var i=n(52903),o=n(89449),a=n(425),r=n(24862),l=n(62197),c=n(2784),s=n(90635);function d(t){let{onClick:e,color:n="primary",startIcon:d,endIcon:u,keepOpenAfterClick:p,children:h}=t,Z=(0,c.useContext)(s.j);return(0,i.BX)(a.Z,{onClick:()=>{e(),p||Z.close()},sx:{minWidth:220,color:t=>t.palette[n].main,padding:1.5,"& .MuiSvgIcon-root":{fontSize:"20px"}},children:[(0,i.BX)(o.G5,{children:[d&&(0,i.tZ)(r.Z,{sx:{padding:0,marginRight:1.5},children:d}),(0,i.tZ)(l.Z,{fontWeight:"bold",children:h})]}),u&&(0,i.tZ)(r.Z,{sx:{padding:0,marginLeft:1},children:u})]})}},30920:function(t,e,n){"use strict";var i=n(52903),o=n(17973),a=n(73659),r=n(11460),l=n(2299),c=n(86345),s=n(69089),d=n(6060),u=n(62197),p=n(5971),h=n(8204),Z=n(65992),f=n(24862),g=n(36832),m=n(24991),A=n(2784);g.setDefaultWordlist("english"),e.Z=function(t){let{somethingWentWrong:e,isMobile:n,...Z}=t,[f,C]=(0,A.useState)(null);return(0,A.useEffect)(()=>{Z.show&&(async()=>{try{let t=await (0,l.yr)();C(g.entropyToMnemonic(t))}catch(t){e(),Z.onHide()}})()},[Z.show]),(0,i.BX)(s.Z,{fullScreen:n,open:Z.show,onClose:Z.onHide,maxWidth:"xs",children:[(0,i.tZ)(r.Z,{onClose:Z.onHide,children:(0,m.t)("RECOVERY_KEY")}),(0,i.BX)(d.Z,{children:[(0,i.tZ)(u.Z,{mb:3,children:(0,m.t)("RECOVERY_KEY_DESCRIPTION")}),(0,i.BX)(E,{children:[(0,i.tZ)(a.Z,{code:f}),(0,i.tZ)(u.Z,{m:2,children:(0,m.t)("KEY_NOT_STORED_DISCLAIMER")})]})]}),(0,i.BX)(p.Z,{children:[(0,i.tZ)(h.Z,{color:"secondary",size:"large",onClick:Z.onHide,children:(0,m.t)("SAVE_LATER")}),(0,i.tZ)(h.Z,{color:"accent",size:"large",onClick:function(){(0,c.KG)("ente-recovery-key.txt",(0,o.z)(f)),Z.onHide()},children:(0,m.t)("SAVE")})]})]})};let E=(0,Z.ZP)(f.Z)(t=>{let{theme:e}=t;return{border:"1px dashed ".concat(e.palette.grey.A400),borderRadius:e.spacing(1)}})},69669:function(t,e,n){"use strict";n.d(e,{Z:function(){return Z}});var i=n(52903),o=n(89449),a=n(83422),r=n(80982),l=n(8204),c=n(51464),s=n(63602),d=n(24991),u=n(2784),p=n(48601),h=n(47290);function Z(t){var e;let{submitButtonProps:n}=t,{sx:Z,...f}=null!=n?n:{},[g,m]=(0,u.useState)(!1),[A,E]=(0,u.useState)(!1),C=async(e,n)=>{let{setFieldError:i,resetForm:o}=n;m(!0),await t.callback(e.inputValue,t=>i("inputValue",t),o),m(!1)},v=()=>{E(!A)},I=t=>{t.preventDefault()},w=(0,u.useMemo)(()=>{switch(t.fieldType){case"text":case"password":return p.Ry().shape({inputValue:p.Z_().required((0,d.t)("REQUIRED"))});case"email":return p.Ry().shape({inputValue:p.Z_().email((0,d.t)("EMAIL_ERROR")).required((0,d.t)("REQUIRED"))})}},[t.fieldType]);return(0,i.tZ)(s.J9,{initialValues:{inputValue:null!==(e=t.initialValue)&&void 0!==e?e:""},onSubmit:C,validationSchema:w,validateOnChange:!1,validateOnBlur:!1,children:e=>{let{values:n,errors:s,handleChange:u,handleSubmit:p}=e;return(0,i.BX)("form",{noValidate:!0,onSubmit:p,children:[t.hiddenPreInput,(0,i.tZ)(c.Z,{hiddenLabel:t.hiddenLabel,variant:"filled",fullWidth:!0,type:A?"text":t.fieldType,id:t.fieldType,name:t.fieldType,...t.hiddenLabel?{placeholder:t.placeholder}:t.realPlaceholder?{placeholder:t.realPlaceholder,label:t.realLabel}:{label:t.placeholder},value:n.inputValue,onChange:u("inputValue"),error:!!s.inputValue,helperText:s.inputValue,disabled:g,autoFocus:!t.disableAutoFocus,autoComplete:t.autoComplete,InputProps:{autoComplete:t.disableAutoComplete||"password"===t.fieldType?"off":"on",endAdornment:"password"===t.fieldType&&(0,i.tZ)(a.Z,{showPassword:A,handleClickShowPassword:v,handleMouseDownPassword:I})}}),(0,i.tZ)(r.Z,{sx:{position:"relative",top:s.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:t.caption}),t.hiddenPostInput,(0,i.BX)(o.A0,{justifyContent:"flex-end",flexWrap:t.blockButton?"wrap-reverse":"nowrap",children:[t.secondaryButtonAction&&(0,i.tZ)(l.Z,{onClick:t.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:t.blockButton?.5:2,mb:t.blockButton?0:4,mr:t.blockButton?0:1,...Z}},...f,children:(0,d.t)("CANCEL")}),(0,i.tZ)(h.Z,{sx:{"&&&":{mt:2,...Z}},buttonText:t.buttonText,loading:g,...f})]})]})}})}},47290:function(t,e,n){"use strict";var i=n(52903),o=n(711),a=n(8204),r=n(72841);n(2784),e.Z=t=>{let{loading:e,buttonText:n,disabled:l,success:c,sx:s,...d}=t;return(0,i.tZ)(a.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:l||e||c,sx:{my:4,...e?{"&.Mui-disabled":{backgroundColor:t=>t.colors.accent.A500,color:t=>t.colors.text.base}}:{},...s},...d,children:e?(0,i.tZ)(r.Z,{size:20}):c?(0,i.tZ)(o.Z,{sx:{fontSize:20}}):n})}},2185:function(t,e,n){"use strict";n.d(e,{Z:function(){return d}});var i=n(52903),o=n(96045),a=n(17952),r=n(24991),l=n(69669),c=n(88659),s=n(18786);function d(t){let{user:e,keyAttributes:n,srpAttributes:d,callback:u,buttonText:p,submitButtonProps:h,getKeyAttributes:Z}=t,f=async(t,e)=>{try{let e;let i=await c.Z.getInstance();try{if(d)e=await i.deriveKey(t,d.kekSalt,d.opsLimit,d.memLimit);else if(n)e=await i.deriveKey(t,n.kekSalt,n.opsLimit,n.memLimit);else throw Error("Both SRP and key attributes are missing")}catch(t){throw o.ZP.error("failed to derive key",t),Error(s.sH.WEAK_DEVICE)}if(n||"function"!=typeof Z||(n=await Z(e)),!n)throw Error("couldn't get key attributes");try{let o=await i.decryptB64(n.encryptedKey,n.keyDecryptionNonce,e);u(o,e,n,t)}catch(t){throw o.ZP.error("user entered a wrong password",t),Error(s.sH.INCORRECT_PASSWORD)}}catch(t){if(t instanceof Error){if(t.message===s.sH.TWO_FACTOR_ENABLED)return;switch(o.ZP.error("failed to verify passphrase",t),t.message){case s.sH.WEAK_DEVICE:e((0,r.t)("WEAK_DEVICE"));break;case s.sH.INCORRECT_PASSWORD:e((0,r.t)("INCORRECT_PASSPHRASE"));break;default:e("".concat((0,r.t)("UNKNOWN_ERROR")," ").concat(t.message))}}}};return(0,i.tZ)(l.Z,{callback:f,placeholder:(0,r.t)("password"),buttonText:p,submitButtonProps:h,hiddenPreInput:(0,i.tZ)(a.Z,{sx:{display:"none"},id:"email",name:"email",autoComplete:"username",type:"email",value:null==e?void 0:e.email}),autoComplete:"current-password",fieldType:"password"})}},72176:function(t,e,n){"use strict";n.d(e,{FN:function(){return i},Xy:function(){return o},f1:function(){return a}});let i="https://ente.io",o="support@ente.io",a="account-deletion@ente.io"},2299:function(t,e,n){"use strict";n.d(e,{CP:function(){return h},OT:function(){return Z},PN:function(){return d},iv:function(){return u},uA:function(){return p},yr:function(){return f}});var i=n(96045),o=n(92660),a=n(10005),r=n(94522),l=n(24450),c=n(35042),s=n(88659);async function d(t,e){let n=await s.Z.getInstance(),i=(0,a.Yu)(a.Pd.USER),o=null,{encryptedToken:r}=i;if(r&&r.length>0){let l=await n.decryptB64(t.encryptedSecretKey,t.secretKeyDecryptionNonce,e),c=await n.boxSealOpen(r,t.publicKey,l),s=await n.fromB64(c);o=await n.toB64URLSafe(s),(0,a.a_)(a.Pd.USER,{...i,token:o,encryptedToken:null})}}async function u(t,e,n){let i=await s.Z.getInstance(),o=await i.generateSaltToDeriveKey(),r=await i.deriveInteractiveKey(t,o),l=await i.encryptToB64(n,r.key),c=Object.assign(e,{kekSalt:o,encryptedKey:l.encryptedData,keyDecryptionNonce:l.nonce,opsLimit:r.opsLimit,memLimit:r.memLimit});return(0,a.a_)(a.Pd.KEY_ATTRIBUTES,c),c}let p=async t=>{let e=await s.Z.getInstance(),n=await e.generateSubKey(t,32,1,"loginctx"),i=await e.fromB64(n);return await e.toB64(i.slice(0,16))},h=async(t,e,n)=>{let i=await s.Z.getInstance(),o=await i.generateKeyAndEncryptToB64(e);(0,l.Dt)(t,o);let a=globalThis.electron;a&&!n&&t===l.Qm.ENCRYPTION_KEY&&a.saveEncryptionKey(e)};async function Z(t){let e=await s.Z.getInstance(),n=await f(),i=await e.fromHex(n);return await e.encryptToB64(t,i)}let f=async()=>{try{let t;let e=await s.Z.getInstance(),{recoveryKeyEncryptedWithMasterKey:n,recoveryKeyDecryptionNonce:i}=(0,a.Yu)(a.Pd.KEY_ATTRIBUTES),o=await (0,c.G)();return t=n?await e.decryptB64(n,i,o):await g(),t=await e.toHex(t)}catch(t){throw console.log(t),i.ZP.error("getRecoveryKey failed",t),t}};async function g(){let t=await (0,c.G)(),e=(0,a.Yu)(a.Pd.KEY_ATTRIBUTES),n=await s.Z.getInstance(),i=await n.generateEncryptionKey(),l=await n.encryptToB64(t,i),d=await n.encryptToB64(i,t),u={masterKeyEncryptedWithRecoveryKey:l.encryptedData,masterKeyDecryptionNonce:l.nonce,recoveryKeyEncryptedWithMasterKey:d.encryptedData,recoveryKeyDecryptionNonce:d.nonce};await (0,o.Jl)((0,r.LP)(),u);let p=Object.assign(e,u);return(0,a.a_)(a.Pd.KEY_ATTRIBUTES,p),i}},30713:function(t,e,n){"use strict";n.d(e,{e:function(){return o}});var i=n(2784);let o=t=>{let{directory:e,accept:n}=t,[o,a]=(0,i.useState)([]),r=(0,i.useRef)(),l=(0,i.useCallback)(()=>{r.current&&(r.current.value=null,r.current.click())},[]),c=t=>{var e;let n=null===(e=t.target)||void 0===e?void 0:e.files;n&&a([...n])},s=e?{directory:"",webkitdirectory:""}:{};return{getInputProps:(0,i.useCallback)(()=>({type:"file",multiple:!0,style:{display:"none"},...s,ref:r,onChange:c,...n?{accept:n}:{}}),[s,n,c]),openSelector:l,selectedFiles:o}}},29010:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var i=n(2784);function o(t,e){let[n,o]=(0,i.useState)(null),a=(0,i.useRef)(!1),r=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{let e=async()=>{if(a.current){r.current=!0;return}a.current=!0;let n=t();n&&"function"==typeof n.then?o(await n):o(n),a.current=!1,r.current&&(r.current=!1,setTimeout(e,0))};e()},e),n}},68236:function(){}}]);