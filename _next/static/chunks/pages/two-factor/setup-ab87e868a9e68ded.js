(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6203],{84856:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/two-factor/setup",function(){return n(59171)}])},59171:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return P}});var r,a,c=n(52903),i=n(96045),o=n(17973),u=n(92660),l=n(14583),s=n(73659),d=n(62197),Z=n(24991),p=n(95770);function h(t){var e;let{twoFactorSecret:n,changeToQRMode:r}=t;return(0,c.BX)(c.HY,{children:[(0,c.tZ)(d.Z,{children:(0,Z.t)("TWO_FACTOR_MANUAL_CODE_INSTRUCTION")}),(0,c.tZ)(s.Z,{code:null!==(e=null==n?void 0:n.secretCode)&&void 0!==e?e:"",my:2}),(0,c.tZ)(p.Z,{onClick:r,children:(0,Z.t)("SCAN_QR_CODE")})]})}var y=n(46470),f=n(89449),w=n(65992);let T=(0,w.ZP)("img")(t=>{let{theme:e}=t;return"\n    height: 200px;\n    width: 200px;\n    margin: ".concat(e.spacing(2),";\n")}),E=(0,w.ZP)(f.wx)(t=>{let{theme:e}=t;return"\n    width:200px;\n    aspect-ratio:1;\n    border: 1px solid ".concat(e.palette.grey.A200,";\n    margin: ").concat(e.spacing(2),";\n    ")});function _(t){let{twoFactorSecret:e,changeToManualMode:n}=t;return(0,c.BX)(c.HY,{children:[(0,c.tZ)(d.Z,{children:(0,Z.t)("TWO_FACTOR_QR_INSTRUCTION")}),e?(0,c.tZ)(T,{src:"data:image/png;base64,".concat(null==e?void 0:e.qrCode)}):(0,c.tZ)(E,{children:(0,c.tZ)(y.Z,{})}),(0,c.tZ)(p.Z,{onClick:n,children:(0,Z.t)("ENTER_CODE_MANUALLY")})]})}var g=n(2784);function m(t){let{twoFactorSecret:e}=t,[n,r]=(0,g.useState)(a.QR_CODE);return(0,c.tZ)(f.wx,{sx:{mb:3},children:n===a.QR_CODE?(0,c.tZ)(_,{twoFactorSecret:e,changeToManualMode:()=>r(a.MANUAL_CODE)}):(0,c.tZ)(h,{twoFactorSecret:e,changeToQRMode:()=>r(a.QR_CODE)})})}var x=n(2299),v=n(10005),C=n(7671),b=n(24862),O=n(92096),R=n(5632),S=n(66569);(r=a||(a={}))[r.QR_CODE=0]="QR_CODE",r[r.MANUAL_CODE=1]="MANUAL_CODE";var A=t=>{let{appContext:e}=t,{appName:n}=e,[r,a]=(0,g.useState)(),s=(0,R.useRouter)();(0,g.useEffect)(()=>{r||(async()=>{try{let t=await (0,u.ks)();a(t)}catch(t){i.ZP.error("failed to get two factor setup code",t)}})()},[]);let h=async(t,e)=>{let a=await (0,x.OT)((0,o.z)(r).secretCode);await (0,u.er)(t,a),await e(),(0,v.a_)(v.Pd.USER,{...(0,v.Yu)(v.Pd.USER),isTwoFactorEnabled:!0}),s.push((0,S.P)(n))};return(0,c.tZ)(f.wx,{children:(0,c.tZ)(O.Z,{children:(0,c.tZ)(C.Z,{children:(0,c.BX)(f.wx,{sx:{p:3},children:[(0,c.tZ)(b.Z,{mb:4,children:(0,c.tZ)(d.Z,{variant:"h2",children:(0,Z.t)("TWO_FACTOR")})}),(0,c.tZ)(m,{twoFactorSecret:r}),(0,c.tZ)(l.Z,{onSubmit:h,buttonText:(0,Z.t)("ENABLE")}),(0,c.tZ)(p.Z,{sx:{mt:2},onClick:s.back,children:(0,Z.t)("GO_BACK")})]})})})})},N=n(77024),P=()=>(0,c.tZ)(A,{appContext:(0,N.useAppContext)()})},14583:function(t,e,n){"use strict";n.d(e,{Z:function(){return h}});var r=n(52903),a=n(11200),c=n(62197),i=n(2784),o=t=>(0,r.tZ)(c.Z,{variant:"mini",sx:{color:t=>t.colors.danger.A700},...t,children:t.children}),u=n(89449),l=n(47290),s=n(24862),d=n(63602),Z=n(24991),p=n(44607);function h(t){let[e,n]=(0,i.useState)(!1),h=(0,i.useRef)(null),[y,f]=(0,i.useState)(!1),w=async()=>{n(!1),f(!0),await (0,a.D)(1e3)},T=async(e,r)=>{let{otp:a}=e,{setFieldError:c,resetForm:i}=r;try{n(!0),await t.onSubmit(a,w)}catch(e){i();for(let t=0;t<6;t++){var o;null===(o=h.current)||void 0===o||o.focusPrevInput()}let t=e instanceof Error?e.message:"";c("otp","".concat((0,Z.t)("UNKNOWN_ERROR")," ").concat(t))}n(!1)},E=(t,e)=>n=>{t(n),6===n.length&&e(n)};return(0,r.tZ)(d.J9,{initialValues:{otp:""},validateOnChange:!1,validateOnBlur:!1,onSubmit:T,children:n=>{let{values:a,errors:i,handleChange:d,handleSubmit:f,submitForm:w}=n;return(0,r.tZ)(u.wx,{children:(0,r.BX)("form",{noValidate:!0,onSubmit:f,children:[(0,r.tZ)(c.Z,{mb:2,variant:"small",color:"text.muted",children:(0,Z.t)("ENTER_TWO_FACTOR_OTP")}),(0,r.BX)(s.Z,{my:2,children:[(0,r.tZ)(p.Z,{ref:h,shouldAutoFocus:!0,value:a.otp,onChange:E(d("otp"),w),numInputs:6,separator:"-",isInputNum:!0,className:"otp-input"}),i.otp&&(0,r.tZ)(u.Tn,{sx:{mt:1},children:(0,r.tZ)(o,{children:(0,Z.t)("INCORRECT_CODE")})})]}),(0,r.tZ)(l.Z,{buttonText:t.buttonText,loading:e,success:y,disabled:a.otp.length<6})]})})}})}},66569:function(t,e,n){"use strict";n.d(e,{P:function(){return a}});var r=n(65342);let a=t=>{switch(t){case"accounts":return r.gp.PASSKEYS;case"auth":return r.bW.AUTH;case"photos":return r.Wu.GALLERY}}},65438:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});var r=n(52903),a=n(80162),c=n(711),i=n(2672),o=n(85801),u=n(24991),l=n(2784);function s(t){let{code:e,color:n,size:s}=t,[d,Z]=(0,l.useState)(!1);return(0,r.tZ)(i.Z,{arrow:!0,open:d,title:(0,u.t)("COPIED"),PopperProps:{sx:{zIndex:2e3}},children:(0,r.tZ)(o.Z,{onClick:()=>{navigator.clipboard.writeText(e),Z(!0),setTimeout(()=>Z(!1),1e3)},color:n,children:d?(0,r.tZ)(c.Z,{fontSize:null!=s?s:"small"}):(0,r.tZ)(a.Z,{fontSize:null!=s?s:"small"})})})}},73659:function(t,e,n){"use strict";n.d(e,{Z:function(){return f}});var r=n(52903),a=n(89449),c=n(46470);n(2784);var i=n(65438),o=n(73235),u=n(65992),l=n(24862);function s(){let t=(0,o._)(["\n    position: relative;\n    background: ",";\n    border-radius: ","px;\n    min-height: 80px;\n"]);return s=function(){return t},t}function d(){let t=(0,o._)(["\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    margin-top: ",";\n"]);return d=function(){return t},t}function Z(){let t=(0,o._)(["\n    padding: 16px 36px 16px 16px;\n    border-radius: ","px;\n"]);return Z=function(){return t},t}let p=(0,u.ZP)(a.Tn)(s(),t=>{let{theme:e}=t;return e.colors.accent.A700},t=>{let{theme:e}=t;return e.shape.borderRadius}),h=(0,u.ZP)(l.Z)(d(),t=>{let{theme:e}=t;return e.spacing(1)}),y=(0,u.ZP)("div")(Z(),t=>{let{theme:e}=t;return e.shape.borderRadius});function f(t){let{code:e,wordBreak:n,...o}=t;return e?(0,r.BX)(p,{...o,children:[(0,r.tZ)(y,{children:(0,r.tZ)(a.lN,{style:{wordBreak:n},children:e})}),(0,r.tZ)(h,{children:(0,r.tZ)(i.Z,{code:e})})]}):(0,r.tZ)(p,{children:(0,r.tZ)(c.Z,{})})}},95770:function(t,e,n){"use strict";var r=n(52903),a=n(23119);n(2784),e.Z=t=>{let{children:e,sx:n,color:c,...i}=t;return(0,r.tZ)(a.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(c,".main"),textDecoration:"underline ",textDecorationColor:"".concat(c,".main")},...n},...i,children:e})}},47290:function(t,e,n){"use strict";var r=n(52903),a=n(711),c=n(8204),i=n(72841);n(2784),e.Z=t=>{let{loading:e,buttonText:n,disabled:o,success:u,sx:l,...s}=t;return(0,r.tZ)(c.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:o||e||u,sx:{my:4,...e?{"&.Mui-disabled":{backgroundColor:t=>t.colors.accent.A500,color:t=>t.colors.text.base}}:{},...l},...s,children:e?(0,r.tZ)(i.Z,{size:20}):u?(0,r.tZ)(a.Z,{sx:{fontSize:20}}):n})}},2299:function(t,e,n){"use strict";n.d(e,{CP:function(){return p},OT:function(){return h},PN:function(){return s},iv:function(){return d},uA:function(){return Z},yr:function(){return y}});var r=n(96045),a=n(92660),c=n(10005),i=n(94522),o=n(24450),u=n(35042),l=n(88659);async function s(t,e){let n=await l.Z.getInstance(),r=(0,c.Yu)(c.Pd.USER),a=null,{encryptedToken:i}=r;if(i&&i.length>0){let o=await n.decryptB64(t.encryptedSecretKey,t.secretKeyDecryptionNonce,e),u=await n.boxSealOpen(i,t.publicKey,o),l=await n.fromB64(u);a=await n.toB64URLSafe(l),(0,c.a_)(c.Pd.USER,{...r,token:a,encryptedToken:null})}}async function d(t,e,n){let r=await l.Z.getInstance(),a=await r.generateSaltToDeriveKey(),i=await r.deriveInteractiveKey(t,a),o=await r.encryptToB64(n,i.key),u=Object.assign(e,{kekSalt:a,encryptedKey:o.encryptedData,keyDecryptionNonce:o.nonce,opsLimit:i.opsLimit,memLimit:i.memLimit});return(0,c.a_)(c.Pd.KEY_ATTRIBUTES,u),u}let Z=async t=>{let e=await l.Z.getInstance(),n=await e.generateSubKey(t,32,1,"loginctx"),r=await e.fromB64(n);return await e.toB64(r.slice(0,16))},p=async(t,e,n)=>{let r=await l.Z.getInstance(),a=await r.generateKeyAndEncryptToB64(e);(0,o.Dt)(t,a);let c=globalThis.electron;c&&!n&&t===o.Qm.ENCRYPTION_KEY&&c.saveEncryptionKey(e)};async function h(t){let e=await l.Z.getInstance(),n=await y(),r=await e.fromHex(n);return await e.encryptToB64(t,r)}let y=async()=>{try{let t;let e=await l.Z.getInstance(),{recoveryKeyEncryptedWithMasterKey:n,recoveryKeyDecryptionNonce:r}=(0,c.Yu)(c.Pd.KEY_ATTRIBUTES),a=await (0,u.G)();return t=n?await e.decryptB64(n,r,a):await f(),t=await e.toHex(t)}catch(t){throw console.log(t),r.ZP.error("getRecoveryKey failed",t),t}};async function f(){let t=await (0,u.G)(),e=(0,c.Yu)(c.Pd.KEY_ATTRIBUTES),n=await l.Z.getInstance(),r=await n.generateEncryptionKey(),o=await n.encryptToB64(t,r),s=await n.encryptToB64(r,t),d={masterKeyEncryptedWithRecoveryKey:o.encryptedData,masterKeyDecryptionNonce:o.nonce,recoveryKeyEncryptedWithMasterKey:s.encryptedData,recoveryKeyDecryptionNonce:s.nonce};await (0,a.Jl)((0,i.LP)(),d);let Z=Object.assign(e,d);return(0,c.a_)(c.Pd.KEY_ATTRIBUTES,Z),r}}},function(t){t.O(0,[3602,2672,8397,2888,9774,179],function(){return t(t.s=84856)}),_N_E=t.O()}]);