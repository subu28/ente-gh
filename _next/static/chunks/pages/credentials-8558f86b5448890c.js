(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2749],{78553:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/credentials",function(){return r(16913)}])},16913:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return U}});var n=r(52903),a=r(73235),i=r(77033),o=r(96045),c=r(17973),s=r(89449),u=r(46470),l=r(42898),d=r(16950),p=r(95770),f=r(2185),y=r(88659),E=r(2299),w=r(18786),R=r(95525),h=r(66546),Z=r(10005),P=r(94522),S=r(24450),T=r(62197),m=r(65992),_=r(24991),g=r(5632),A=r(2784),b=r(88769),C=r(50918),O=r(66569),v=r(34291);function I(){let t=(0,a._)(["\n    margin-block-end: 4rem;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n"]);return I=function(){return t},t}function N(){let t=(0,a._)(["\n    margin-block-start: 1rem;\n"]);return N=function(){return t},t}var K=t=>{var e;let{appContext:r}=t,{appName:a,logout:T}=r,[m,I]=(0,A.useState)(),[N,K]=(0,A.useState)(),[B,Y]=(0,A.useState)(),x=(0,g.useRouter)();(0,A.useEffect)(()=>{(async()=>{let t=(0,Z.Yu)(Z.Pd.USER);if(!(null==t?void 0:t.email)){x.push(C.q.ROOT);return}Y(t);let e=(0,S.km)(S.Qm.ENCRYPTION_KEY),r=globalThis.electron;if(!e&&r){try{e=await r.encryptionKey()}catch(t){o.ZP.error("Failed to get encryption key from electron",t)}e&&await (0,E.CP)(S.Qm.ENCRYPTION_KEY,e,!0)}let n=(0,P.LP)();if(e&&n){x.push((0,O.P)(a));return}let i=(0,S.km)(S.Qm.KEY_ENCRYPTION_KEY),c=(0,Z.Yu)(Z.Pd.KEY_ATTRIBUTES);if(i&&c){(0,S.ud)(S.Qm.KEY_ENCRYPTION_KEY);let t=await y.Z.getInstance(),e=await t.decryptB64(i.encryptedData,i.nonce,i.key);L(await t.decryptB64(c.encryptedKey,c.keyDecryptionNonce,e),e,c);return}if(c){if(!(null==t?void 0:t.token)&&!(null==t?void 0:t.encryptedToken)||c&&!c.memLimit){(0,Z.Nk)(),x.push(C.q.ROOT);return}K(c);return}let s=(0,Z.Yu)(Z.Pd.SRP_ATTRIBUTES);s?I(s):x.push(C.q.ROOT)})(),r.showNavBar(!0)},[]);let U=async t=>{try{let e=await y.Z.getInstance(),{keyAttributes:r,encryptedToken:n,token:a,id:i,twoFactorSessionID:o,passkeySessionID:s}=await (0,v.pL)((0,c.z)(m),t);if((0,P.Qj)(!0),s){let r=await e.generateKeyAndEncryptToB64(t);(0,S.Dt)(S.Qm.KEY_ENCRYPTION_KEY,r);let n=(0,Z.Yu)(Z.Pd.USER);(0,Z.a_)(Z.Pd.USER,{...n,passkeySessionID:s,isTwoFactorEnabled:!0,isTwoFactorPasskeysEnabled:!0}),h.Z.set(h.i.REDIRECT_URL,C.q.ROOT),window.location.href="".concat((0,R.KS)(),"/passkeys/flow?passkeySessionID=").concat(s,"&redirect=").concat(window.location.origin,"/passkeys/finish");return}if(o){let r=await e.generateKeyAndEncryptToB64(t);(0,S.Dt)(S.Qm.KEY_ENCRYPTION_KEY,r);let n=(0,Z.Yu)(Z.Pd.USER);throw(0,Z.a_)(Z.Pd.USER,{...n,twoFactorSessionID:o,isTwoFactorEnabled:!0}),x.push(C.q.TWO_FACTOR_VERIFY),Error(w.sH.TWO_FACTOR_ENABLED)}{let t=(0,Z.Yu)(Z.Pd.USER);return(0,Z.a_)(Z.Pd.USER,{...t,token:a,encryptedToken:n,id:i,isTwoFactorEnabled:!1}),r&&(0,Z.a_)(Z.Pd.KEY_ATTRIBUTES,r),r}}catch(t){throw t instanceof Error&&t.message!=w.sH.TWO_FACTOR_ENABLED&&o.ZP.error("getKeyAttributes failed",t),t}},L=async(t,e,r,n)=>{try{(0,P.aF)()&&n&&await (0,E.iv)(n,r,t),await (0,E.CP)(S.Qm.ENCRYPTION_KEY,t),await (0,E.PN)(r,t);try{let t=(0,Z.Yu)(Z.Pd.SRP_ATTRIBUTES);if(!t&&B&&(t=await (0,b.O3)(B.email))&&(0,Z.a_)(Z.Pd.SRP_ATTRIBUTES,t),o.ZP.debug(()=>"userSRPSetupPending ".concat(!t)),!t){let t=await (0,E.uA)(e),r=await (0,v.a4)(t);await (0,v.Bs)(r)}}catch(t){o.ZP.error("migrate to srp failed",t)}let i=h.Z.get(h.i.REDIRECT_URL);h.Z.delete(h.i.REDIRECT_URL),x.push(null!=i?i:(0,O.P)(a))}catch(t){o.ZP.error("useMasterPassword failed",t)}};return N||m?(0,n.tZ)(s.wx,{children:(0,n.BX)(l.Z,{style:{minWidth:"320px"},children:[(0,n.tZ)(k,{children:null!==(e=null==B?void 0:B.email)&&void 0!==e?e:""}),(0,n.tZ)(f.Z,{buttonText:(0,_.t)("VERIFY_PASSPHRASE"),callback:L,user:B,keyAttributes:N,getKeyAttributes:U,srpAttributes:m}),(0,n.BX)(d.Z,{style:{justifyContent:"space-between"},children:[(0,n.tZ)(p.Z,{onClick:()=>x.push(C.q.RECOVER),children:(0,_.t)("FORGOT_PASSWORD")}),(0,n.tZ)(p.Z,{onClick:T,children:(0,_.t)("CHANGE_EMAIL")})]}),i.lE&&(0,n.tZ)(D,{})]})}):(0,n.tZ)(s.wx,{children:(0,n.tZ)(u.Z,{})})};let k=t=>{let{children:e}=t;return(0,n.BX)(B,{children:[(0,n.tZ)(T.Z,{variant:"h2",children:(0,_.t)("password")}),(0,n.tZ)(T.Z,{color:"text.faint",children:e})]})},B=(0,m.ZP)("div")(I()),D=()=>{let t=new URL((0,R.Nu)()).host;return(0,n.tZ)(Y,{children:(0,n.tZ)(T.Z,{variant:"small",color:"text.faint",children:t})})},Y=(0,m.ZP)("div")(N());var x=r(77024),U=()=>(0,n.tZ)(K,{appContext:(0,x.useAppContext)()})},88769:function(t,e,r){"use strict";r.d(e,{$Q:function(){return y},IG:function(){return p},O3:function(){return u},XD:function(){return d},gd:function(){return f},zx:function(){return l}});var n=r(96045),a=r(73873),i=r(95525),o=r(18786),c=r(80613);let s=(0,i.O3)(),u=async t=>{try{return(await a.Z.get("".concat(s,"/users/srp/attributes"),{email:t})).data.attributes}catch(t){return n.ZP.error("failed to get SRP attributes",t),null}},l=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/setup"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw n.ZP.error("failed to post SRP attributes",t),t}},d=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/complete"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw n.ZP.error("failed to complete SRP setup",t),t}},p=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/create-session"),{srpUserID:t,srpA:e})).data}catch(t){throw n.ZP.error("createSRPSession failed",t),t}},f=async(t,e,r)=>{try{return(await a.Z.post("".concat(s,"/users/srp/verify-session"),{sessionID:t,srpUserID:e,srpM1:r},void 0)).data}catch(t){if(n.ZP.error("verifySRPSession failed",t),t instanceof o.MS&&t.httpStatusCode===c.WE.Unauthorized)throw Error(o.sH.INCORRECT_PASSWORD);throw t}},y=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/update"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw n.ZP.error("updateSRPAndKeys failed",t),t}}},76228:function(t,e,r){"use strict";var n,a;r.d(e,{Y:function(){return n}}),(a=n||(n={})).WEAK="WEAK",a.MODERATE="MODERATE",a.STRONG="STRONG"},50918:function(t,e,r){"use strict";var n,a;r.d(e,{q:function(){return n}}),(a=n||(n={})).ROOT="/",a.CHANGE_EMAIL="/change-email",a.CHANGE_PASSWORD="/change-password",a.CREDENTIALS="/credentials",a.GENERATE="/generate",a.LOGIN="/login",a.RECOVER="/recover",a.SIGNUP="/signup",a.TWO_FACTOR_SETUP="/two-factor/setup",a.TWO_FACTOR_VERIFY="/two-factor/verify",a.TWO_FACTOR_RECOVER="/two-factor/recover",a.VERIFY="/verify",a.SHARED_ALBUMS="/shared-albums"},66569:function(t,e,r){"use strict";r.d(e,{P:function(){return a}});var n=r(65342);let a=t=>{switch(t){case"accounts":return n.gp.PASSKEYS;case"auth":return n.bW.AUTH;case"photos":return n.Wu.GALLERY}}},34291:function(t,e,r){"use strict";r.d(e,{Bs:function(){return y},a4:function(){return E},pL:function(){return w},u1:function(){return R}});var n=r(96045),a=r(88659),i=r(2299),o=r(66546),c=r(94522),s=r(50232),u=r(6364),l=r(88769),d=r(49521),p=r(79644).Buffer;let f=s.SRP.params["4096"],y=async t=>{let{srpSalt:e,srpUserID:r,srpVerifier:a,loginSubKey:i}=t;try{if(o.Z.get(o.i.SRP_CONFIGURE_IN_PROGRESS))throw Error("SRP configure already in progress");o.Z.set(o.i.SRP_CONFIGURE_IN_PROGRESS,!0);let t=await R(e,r,i),s=(0,d.HC)(t.computeA());n.ZP.debug(()=>"srp a: ".concat(s));let u=(0,c.LP)(),{setupID:p,srpB:f}=await (0,l.zx)(u,{srpA:s,srpUserID:r,srpSalt:e,srpVerifier:a});t.setB((0,d.GS)(f));let y=(0,d.HC)(t.computeM1()),{srpM2:E}=await (0,l.XD)(u,{srpM1:y,setupID:p});t.checkM2((0,d.GS)(E))}catch(t){throw n.ZP.error("Failed to configure SRP",t),t}finally{o.Z.set(o.i.SRP_CONFIGURE_IN_PROGRESS,!1)}},E=async t=>{let e=await a.Z.getInstance(),r=await e.generateSaltToDeriveKey(),i=(0,u.Z)(),o=s.SRP.computeVerifier(f,(0,d.GS)(r),p.from(i),(0,d.GS)(t)),c={srpUserID:i,srpSalt:r,srpVerifier:(0,d.HC)(o),loginSubKey:t};return n.ZP.debug(()=>"SRP setup attributes generated: ".concat(JSON.stringify(c))),c},w=async(t,e)=>{try{let r=await (0,i.uA)(e),a=await R(t.srpSalt,t.srpUserID,r),o=a.computeA(),{srpB:c,sessionID:s}=await (0,l.IG)(t.srpUserID,(0,d.HC)(o));a.setB((0,d.GS)(c));let u=a.computeM1();n.ZP.debug(()=>"srp m1: ".concat((0,d.HC)(u)));let{srpM2:p,...f}=await (0,l.gd)(s,t.srpUserID,(0,d.HC)(u));return n.ZP.debug(()=>"srp verify session successful,srpM2: ".concat(p)),a.checkM2((0,d.GS)(p)),n.ZP.debug(()=>"srp server verify successful"),f}catch(t){throw n.ZP.error("srp verify failed",t),t}},R=async(t,e,r)=>new Promise((n,a)=>{s.SRP.genKey(function(i,o){try{if(i&&a(i),!o)throw Error("secret1 gen failed");let c=new s.SrpClient(f,(0,d.GS)(t),p.from(e),(0,d.GS)(r),o,!1);n(c)}catch(t){a(t)}})})},49521:function(t,e,r){"use strict";r.d(e,{DZ:function(){return l},GS:function(){return s},HC:function(){return c},rp:function(){return u}});var n=r(76228),a=r(16152),i=r.n(a),o=r(79644).Buffer;let c=t=>t.toString("base64"),s=t=>o.from(t,"base64");function u(t){if(!t)return n.Y.WEAK;let e=i()(t);return e.score<2?n.Y.WEAK:e.score<3?n.Y.MODERATE:n.Y.STRONG}let l=t=>u(t)===n.Y.WEAK},16950:function(t,e,r){"use strict";var n=r(52903),a=r(89449),i=r(56961);r(2784),e.Z=t=>{let{sx:e,style:r,...o}=t;return(0,n.BX)(n.HY,{children:[(0,n.tZ)(i.Z,{}),(0,n.tZ)(a.wx,{style:{flexDirection:"row",...r},sx:{mt:3,...e},...o,children:o.children})]})}},42898:function(t,e,r){"use strict";var n=r(65992),a=r(17377);let i=(0,n.ZP)(a.Z)(t=>{let{theme:e}=t;return{padding:e.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});e.Z=i},83422:function(t,e,r){"use strict";var n=r(52903),a=r(26436),i=r(38203),o=r(35469),c=r(85801);r(2784),e.Z=t=>{let{showPassword:e,handleClickShowPassword:r,handleMouseDownPassword:s}=t;return(0,n.tZ)(o.Z,{position:"end",children:(0,n.tZ)(c.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:r,onMouseDown:s,edge:"end",children:e?(0,n.tZ)(i.Z,{}):(0,n.tZ)(a.Z,{})})})}},95770:function(t,e,r){"use strict";var n=r(52903),a=r(23119);r(2784),e.Z=t=>{let{children:e,sx:r,color:i,...o}=t;return(0,n.tZ)(a.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(i,".main"),textDecoration:"underline ",textDecorationColor:"".concat(i,".main")},...r},...o,children:e})}},69669:function(t,e,r){"use strict";r.d(e,{Z:function(){return y}});var n=r(52903),a=r(89449),i=r(83422),o=r(80982),c=r(8204),s=r(51464),u=r(63602),l=r(24991),d=r(2784),p=r(48601),f=r(47290);function y(t){var e;let{submitButtonProps:r}=t,{sx:y,...E}=null!=r?r:{},[w,R]=(0,d.useState)(!1),[h,Z]=(0,d.useState)(!1),P=async(e,r)=>{let{setFieldError:n,resetForm:a}=r;R(!0),await t.callback(e.inputValue,t=>n("inputValue",t),a),R(!1)},S=()=>{Z(!h)},T=t=>{t.preventDefault()},m=(0,d.useMemo)(()=>{switch(t.fieldType){case"text":case"password":return p.Ry().shape({inputValue:p.Z_().required((0,l.t)("REQUIRED"))});case"email":return p.Ry().shape({inputValue:p.Z_().email((0,l.t)("EMAIL_ERROR")).required((0,l.t)("REQUIRED"))})}},[t.fieldType]);return(0,n.tZ)(u.J9,{initialValues:{inputValue:null!==(e=t.initialValue)&&void 0!==e?e:""},onSubmit:P,validationSchema:m,validateOnChange:!1,validateOnBlur:!1,children:e=>{let{values:r,errors:u,handleChange:d,handleSubmit:p}=e;return(0,n.BX)("form",{noValidate:!0,onSubmit:p,children:[t.hiddenPreInput,(0,n.tZ)(s.Z,{hiddenLabel:t.hiddenLabel,variant:"filled",fullWidth:!0,type:h?"text":t.fieldType,id:t.fieldType,name:t.fieldType,...t.hiddenLabel?{placeholder:t.placeholder}:t.realPlaceholder?{placeholder:t.realPlaceholder,label:t.realLabel}:{label:t.placeholder},value:r.inputValue,onChange:d("inputValue"),error:!!u.inputValue,helperText:u.inputValue,disabled:w,autoFocus:!t.disableAutoFocus,autoComplete:t.autoComplete,InputProps:{autoComplete:t.disableAutoComplete||"password"===t.fieldType?"off":"on",endAdornment:"password"===t.fieldType&&(0,n.tZ)(i.Z,{showPassword:h,handleClickShowPassword:S,handleMouseDownPassword:T})}}),(0,n.tZ)(o.Z,{sx:{position:"relative",top:u.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:t.caption}),t.hiddenPostInput,(0,n.BX)(a.A0,{justifyContent:"flex-end",flexWrap:t.blockButton?"wrap-reverse":"nowrap",children:[t.secondaryButtonAction&&(0,n.tZ)(c.Z,{onClick:t.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:t.blockButton?.5:2,mb:t.blockButton?0:4,mr:t.blockButton?0:1,...y}},...E,children:(0,l.t)("CANCEL")}),(0,n.tZ)(f.Z,{sx:{"&&&":{mt:2,...y}},buttonText:t.buttonText,loading:w,...E})]})]})}})}},47290:function(t,e,r){"use strict";var n=r(52903),a=r(711),i=r(8204),o=r(72841);r(2784),e.Z=t=>{let{loading:e,buttonText:r,disabled:c,success:s,sx:u,...l}=t;return(0,n.tZ)(i.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:c||e||s,sx:{my:4,...e?{"&.Mui-disabled":{backgroundColor:t=>t.colors.accent.A500,color:t=>t.colors.text.base}}:{},...u},...l,children:e?(0,n.tZ)(o.Z,{size:20}):s?(0,n.tZ)(a.Z,{sx:{fontSize:20}}):r})}},2185:function(t,e,r){"use strict";r.d(e,{Z:function(){return l}});var n=r(52903),a=r(96045),i=r(17952),o=r(24991),c=r(69669),s=r(88659),u=r(18786);function l(t){let{user:e,keyAttributes:r,srpAttributes:l,callback:d,buttonText:p,submitButtonProps:f,getKeyAttributes:y}=t,E=async(t,e)=>{try{let e;let n=await s.Z.getInstance();try{if(l)e=await n.deriveKey(t,l.kekSalt,l.opsLimit,l.memLimit);else if(r)e=await n.deriveKey(t,r.kekSalt,r.opsLimit,r.memLimit);else throw Error("Both SRP and key attributes are missing")}catch(t){throw a.ZP.error("failed to derive key",t),Error(u.sH.WEAK_DEVICE)}if(r||"function"!=typeof y||(r=await y(e)),!r)throw Error("couldn't get key attributes");try{let a=await n.decryptB64(r.encryptedKey,r.keyDecryptionNonce,e);d(a,e,r,t)}catch(t){throw a.ZP.error("user entered a wrong password",t),Error(u.sH.INCORRECT_PASSWORD)}}catch(t){if(t instanceof Error){if(t.message===u.sH.TWO_FACTOR_ENABLED)return;switch(a.ZP.error("failed to verify passphrase",t),t.message){case u.sH.WEAK_DEVICE:e((0,o.t)("WEAK_DEVICE"));break;case u.sH.INCORRECT_PASSWORD:e((0,o.t)("INCORRECT_PASSPHRASE"));break;default:e("".concat((0,o.t)("UNKNOWN_ERROR")," ").concat(t.message))}}}};return(0,n.tZ)(c.Z,{callback:E,placeholder:(0,o.t)("password"),buttonText:p,submitButtonProps:f,hiddenPreInput:(0,n.tZ)(i.Z,{sx:{display:"none"},id:"email",name:"email",autoComplete:"username",type:"email",value:null==e?void 0:e.email}),autoComplete:"current-password",fieldType:"password"})}},2299:function(t,e,r){"use strict";r.d(e,{CP:function(){return f},OT:function(){return y},PN:function(){return l},iv:function(){return d},uA:function(){return p},yr:function(){return E}});var n=r(96045),a=r(92660),i=r(10005),o=r(94522),c=r(24450),s=r(35042),u=r(88659);async function l(t,e){let r=await u.Z.getInstance(),n=(0,i.Yu)(i.Pd.USER),a=null,{encryptedToken:o}=n;if(o&&o.length>0){let c=await r.decryptB64(t.encryptedSecretKey,t.secretKeyDecryptionNonce,e),s=await r.boxSealOpen(o,t.publicKey,c),u=await r.fromB64(s);a=await r.toB64URLSafe(u),(0,i.a_)(i.Pd.USER,{...n,token:a,encryptedToken:null})}}async function d(t,e,r){let n=await u.Z.getInstance(),a=await n.generateSaltToDeriveKey(),o=await n.deriveInteractiveKey(t,a),c=await n.encryptToB64(r,o.key),s=Object.assign(e,{kekSalt:a,encryptedKey:c.encryptedData,keyDecryptionNonce:c.nonce,opsLimit:o.opsLimit,memLimit:o.memLimit});return(0,i.a_)(i.Pd.KEY_ATTRIBUTES,s),s}let p=async t=>{let e=await u.Z.getInstance(),r=await e.generateSubKey(t,32,1,"loginctx"),n=await e.fromB64(r);return await e.toB64(n.slice(0,16))},f=async(t,e,r)=>{let n=await u.Z.getInstance(),a=await n.generateKeyAndEncryptToB64(e);(0,c.Dt)(t,a);let i=globalThis.electron;i&&!r&&t===c.Qm.ENCRYPTION_KEY&&i.saveEncryptionKey(e)};async function y(t){let e=await u.Z.getInstance(),r=await E(),n=await e.fromHex(r);return await e.encryptToB64(t,n)}let E=async()=>{try{let t;let e=await u.Z.getInstance(),{recoveryKeyEncryptedWithMasterKey:r,recoveryKeyDecryptionNonce:n}=(0,i.Yu)(i.Pd.KEY_ATTRIBUTES),a=await (0,s.G)();return t=r?await e.decryptB64(r,n,a):await w(),t=await e.toHex(t)}catch(t){throw console.log(t),n.ZP.error("getRecoveryKey failed",t),t}};async function w(){let t=await (0,s.G)(),e=(0,i.Yu)(i.Pd.KEY_ATTRIBUTES),r=await u.Z.getInstance(),n=await r.generateEncryptionKey(),c=await r.encryptToB64(t,n),l=await r.encryptToB64(n,t),d={masterKeyEncryptedWithRecoveryKey:c.encryptedData,masterKeyDecryptionNonce:c.nonce,recoveryKeyEncryptedWithMasterKey:l.encryptedData,recoveryKeyDecryptionNonce:l.nonce};await (0,a.Jl)((0,o.LP)(),d);let p=Object.assign(e,d);return(0,i.a_)(i.Pd.KEY_ATTRIBUTES,p),n}}},function(t){t.O(0,[8934,1981,3602,4100,7518,3988,3432,3313,2888,9774,179],function(){return t(t.s=78553)}),_N_E=t.O()}]);