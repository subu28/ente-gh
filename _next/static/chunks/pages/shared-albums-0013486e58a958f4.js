(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7440],{21207:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shared-albums",function(){return n(98554)}])},98554:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ei}});var l=n(52903),r=n(96045),i=n(89449),o=n(46470),a=n(42898),c=n(77754),u=n(93710),s=n(33500),d=n(69669),h=n(65342),C=n(72176),Z=n(88659),p=n(18786),w=n(30713),f=n(63190),v=n(59109),E=n(73906),g=n(62197),R=n(17022),S=n.n(R),m=n(82816),_=n(83101),L=n(28171),O=n(24222),y=n(95347),T=n(12492),b=n(93850),D=n(54825),N=n(8854),x=n(4367),P=n(59409),I=n(24862),H=n(24991),U=n(77024),A=n(2784),M=n(96820);function k(e){let{showUploadButton:t,openUploader:n}=e,{isMobile:r}=(0,A.useContext)(U.AppContext);return(0,l.BX)(P.Z,{isMobile:r,children:[(0,l.tZ)(i.G5,{children:(0,l.tZ)(B,{})}),t?(0,l.tZ)(D.Z,{openUploader:n,icon:(0,l.tZ)(f.Z,{}),text:(0,H.t)("ADD_PHOTOS")}):(0,l.tZ)(M.Z,{})]})}let B=()=>(0,l.tZ)("a",{href:"https://ente.io",children:(0,l.tZ)(I.Z,{sx:e=>({":hover":{cursor:"pointer",svg:{fill:e.colors.text.faint}}}),children:(0,l.tZ)(X,{})})}),X=()=>(0,l.tZ)("svg",{width:"50",height:"26",viewBox:"0 0 43 13",fill:"#fff",xmlns:"http://www.w3.org/2000/svg",children:(0,l.tZ)("path",{d:"M6.102 12.144C4.998 12.144 4.026 11.928 3.186 11.496C2.358 11.064 1.716 10.476 1.26 9.732C0.804 8.976 0.576 8.118 0.576 7.158C0.576 6.186 0.798 5.328 1.242 4.584C1.698 3.828 2.316 3.24 3.096 2.82C3.876 2.388 4.758 2.172 5.742 2.172C6.69 2.172 7.542 2.376 8.298 2.784C9.066 3.18 9.672 3.756 10.116 4.512C10.56 5.256 10.782 6.15 10.782 7.194C10.782 7.302 10.776 7.428 10.764 7.572C10.752 7.704 10.74 7.83 10.728 7.95H2.862V6.312H9.252L8.172 6.798C8.172 6.294 8.07 5.856 7.866 5.484C7.662 5.112 7.38 4.824 7.02 4.62C6.66 4.404 6.24 4.296 5.76 4.296C5.28 4.296 4.854 4.404 4.482 4.62C4.122 4.824 3.84 5.118 3.636 5.502C3.432 5.874 3.33 6.318 3.33 6.834V7.266C3.33 7.794 3.444 8.262 3.672 8.67C3.912 9.066 4.242 9.372 4.662 9.588C5.094 9.792 5.598 9.894 6.174 9.894C6.69 9.894 7.14 9.816 7.524 9.66C7.92 9.504 8.28 9.27 8.604 8.958L10.098 10.578C9.654 11.082 9.096 11.472 8.424 11.748C7.752 12.012 6.978 12.144 6.102 12.144ZM18.5375 2.172C19.3055 2.172 19.9895 2.328 20.5895 2.64C21.2015 2.94 21.6815 3.408 22.0295 4.044C22.3775 4.668 22.5515 5.472 22.5515 6.456V12H19.7435V6.888C19.7435 6.108 19.5695 5.532 19.2215 5.16C18.8855 4.788 18.4055 4.602 17.7815 4.602C17.3375 4.602 16.9355 4.698 16.5755 4.89C16.2275 5.07 15.9515 5.352 15.7475 5.736C15.5555 6.12 15.4595 6.612 15.4595 7.212V12H12.6515V2.316H15.3335V4.998L14.8295 4.188C15.1775 3.54 15.6755 3.042 16.3235 2.694C16.9715 2.346 17.7095 2.172 18.5375 2.172ZM29.0568 12.144C27.9168 12.144 27.0288 11.856 26.3928 11.28C25.7568 10.692 25.4388 9.822 25.4388 8.67V0.174H28.2468V8.634C28.2468 9.042 28.3548 9.36 28.5708 9.588C28.7868 9.804 29.0808 9.912 29.4528 9.912C29.8968 9.912 30.2748 9.792 30.5868 9.552L31.3428 11.532C31.0548 11.736 30.7068 11.892 30.2988 12C29.9028 12.096 29.4888 12.144 29.0568 12.144ZM23.9448 4.692V2.532H30.6588V4.692H23.9448ZM37.4262 12.144C36.3222 12.144 35.3502 11.928 34.5102 11.496C33.6822 11.064 33.0402 10.476 32.5842 9.732C32.1282 8.976 31.9002 8.118 31.9002 7.158C31.9002 6.186 32.1222 5.328 32.5662 4.584C33.0222 3.828 33.6402 3.24 34.4202 2.82C35.2002 2.388 36.0822 2.172 37.0662 2.172C38.0142 2.172 38.8662 2.376 39.6222 2.784C40.3902 3.18 40.9962 3.756 41.4402 4.512C41.8842 5.256 42.1062 6.15 42.1062 7.194C42.1062 7.302 42.1002 7.428 42.0882 7.572C42.0762 7.704 42.0642 7.83 42.0522 7.95H34.1862V6.312H40.5762L39.4962 6.798C39.4962 6.294 39.3942 5.856 39.1902 5.484C38.9862 5.112 38.7042 4.824 38.3442 4.62C37.9842 4.404 37.5642 4.296 37.0842 4.296C36.6042 4.296 36.1782 4.404 35.8062 4.62C35.4462 4.824 35.1642 5.118 34.9602 5.502C34.7562 5.874 34.6542 6.318 34.6542 6.834V7.266C34.6542 7.794 34.7682 8.262 34.9962 8.67C35.2362 9.066 35.5662 9.372 35.9862 9.588C36.4182 9.792 36.9222 9.894 37.4982 9.894C38.0142 9.894 38.4642 9.816 38.8482 9.66C39.2442 9.504 39.6042 9.27 39.9282 8.958L41.4222 10.578C40.9782 11.082 40.4202 11.472 39.7482 11.748C39.0762 12.012 38.3022 12.144 37.4262 12.144Z"})});var V=n(42399),K=n(92679),W=n(76475),F=n(85801),G=n(41311),Q=n(2672),Y=n(68372),z=e=>{let{downloadFilesHelper:t,count:n,clearSelection:r}=e,{isMobile:o}=(0,A.useContext)(U.AppContext);return(0,l.BX)(V.X,{isMobile:o,children:[(0,l.BX)(i.G5,{children:[(0,l.tZ)(F.Z,{onClick:r,children:(0,l.tZ)(K.Z,{})}),(0,l.BX)(I.Z,{ml:1.5,children:[(0,Y.u)(n)," ",(0,H.t)("SELECTED")," "]})]}),(0,l.tZ)(G.Z,{spacing:2,direction:"row",mr:2,children:(0,l.tZ)(Q.Z,{title:(0,H.t)("DOWNLOAD"),children:(0,l.tZ)(F.Z,{onClick:t,children:(0,l.tZ)(W.Z,{})})})})]})},J=n(22216),j=n(5632),q=n(75031),$=n(47371),ee=n(26930),et=n(67335),en=n(16414),el=n(79541),er=n(48751);function ei(){var e,t;let n=(0,A.useRef)(null),R=(0,A.useRef)(null),P=(0,A.useRef)(null),I=(0,A.useRef)(null),M=(0,A.useRef)(""),[B,X]=(0,A.useState)(null),[V,K]=(0,A.useState)(null),[W,F]=(0,A.useState)(null),G=(0,A.useContext)(U.AppContext),[Q,Y]=(0,A.useState)(!0),ei=(0,j.useRouter)(),[eo,ea]=(0,A.useState)(!1),[ec,eu]=(0,A.useState)(null),[es,ed]=(0,A.useState)(null),[eh,eC]=(0,A.useState)(!1),[eZ,ep]=(0,A.useState)(!1),[ew,ef]=(0,A.useState)(!1),[ev,eE]=(0,A.useState)({ownCount:0,count:0,collectionID:0}),{getRootProps:eg,getInputProps:eR,acceptedFiles:eS}=(0,q.uI)({noClick:!0,noKeyboard:!0,disabled:ew}),{getInputProps:em,openSelector:e_,selectedFiles:eL}=(0,w.e)({directory:!1}),{getInputProps:eO,openSelector:ey,selectedFiles:eT}=(0,w.e)({directory:!0}),[eb,eD]=(0,A.useState)([]),eN=(e,t,n)=>{var l;let r=null!==(l=null==eb?void 0:eb.length)&&void 0!==l?l:0,i=e=>{eD(t=>{let n=null==t?void 0:t.find(e=>e.id===r),l="function"==typeof e?e(n):{...n,...e};return n?t.map(e=>e.id===r?l:e):[...t,l]})};return i({id:r,folderName:e,collectionID:t,isHidden:n,canceller:null,total:0,success:0,failed:0,downloadDirPath:null}),i},ex=()=>{eC(!0)};(0,A.useEffect)(()=>{let e=new URL(window.location.href);e.pathname!==h.Wu.ROOT&&ei.replace({pathname:h.Wu.SHARED_ALBUMS,search:e.search,hash:e.hash},{pathname:h.Wu.ROOT,search:e.search,hash:e.hash},{shallow:!0}),(async()=>{let e=!1;try{let o=await Z.Z.getInstance();await $.Z.init(),I.current=window.location.href;let a=new URL(I.current),c=a.searchParams.get("t"),u=a.hash.slice(1);if(c||u||(window.location.href=C.FN,e=!0),!c||!u)return;let s=u.length<50?await o.toB64(S().decode(u)):await o.fromHex(u);n.current=c,$.Z.updateToken(n.current),P.current=s,I.current=window.location.href;let d=await (0,ee.to)(P.current);if(d){var t,l,r,i;M.current=await (0,ee.py)();let e=null!==(i=null==d?void 0:null===(t=d.pubMagicMetadata)||void 0===t?void 0:t.data.asc)&&void 0!==i&&i;K(d);let o=null==d?void 0:null===(r=d.publicURLs)||void 0===r?void 0:null===(l=r[0])||void 0===l?void 0:l.passwordEnabled;ea(o);let a=(0,ee.yB)(n.current),c=await (0,ee.CE)(a),u=(0,el.hE)((0,el.SA)(c),e);X(u),R.current=await (0,ee.ed)(a),$.Z.updateToken(n.current,R.current)}await eH()}finally{e||Y(!1)}})()},[]);let eP=(0,A.useMemo)(()=>{var e,t,n;return null===(n=null==V?void 0:null===(t=V.publicURLs)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.enableDownload)||void 0===n||n},[V]),eI=async()=>{try{if(!eP)return;let e=eN(V.name,V.id,(0,en._K)(V));await (0,en.Jx)(V.name,B,e)}catch(e){r.ZP.error("failed to downloads shared album all files",e)}};(0,A.useEffect)(()=>{V&&B&&eu({item:(0,l.tZ)(_.VZ,{children:(0,l.BX)(i.Gm,{children:[(0,l.tZ)(m.a,{name:V.name,fileCount:B.length}),eP?(0,l.tZ)(u.Z,{ariaControls:"collection-options",triggerButtonIcon:(0,l.tZ)(E.Z,{}),children:(0,l.tZ)(s.x,{startIcon:(0,l.tZ)(v.Z,{}),onClick:eI,children:(0,H.t)("DOWNLOAD_COLLECTION")})}):(0,l.tZ)("div",{})]})}),itemType:b.Z.HEADER,height:68})},[V,B]),(0,A.useEffect)(()=>{var e,t;(null==V?void 0:null===(t=V.publicURLs)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.enableCollect)?ed({item:(0,l.tZ)(i.Tn,{sx:{marginTop:"56px"},children:(0,l.tZ)(D.Z,{disableShrink:!0,openUploader:ex,text:(0,H.t)("ADD_MORE_PHOTOS"),color:"accent",icon:(0,l.tZ)(f.Z,{})})}),itemType:b.Z.FOOTER,height:104}):ed(null)},[V]);let eH=async()=>{let e=(0,ee.yB)(n.current);try{var t,l;G.startLoading(),Y(!0);let[r,i]=await (0,ee.Uo)(n.current,P.current);M.current=i,K(r);let o=null==r?void 0:null===(l=r.publicURLs)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.passwordEnabled;if(ea(o),F(null),!o&&R.current&&(R.current=null,(0,ee.Kc)(e,null)),!o||o&&R.current)try{await (0,ee.mF)(n.current,R.current,r,X)}catch(e){(0,p.a3)(e).message===p.sH.TOKEN_EXPIRED&&(R.current=null)}o&&!R.current&&await (0,ee.DH)(e)}catch(n){let t=(0,p.a3)(n);t.message===p.sH.TOKEN_EXPIRED||t.message===p.sH.TOO_MANY_REQUESTS?(F(t.message===p.sH.TOO_MANY_REQUESTS?(0,H.t)("LINK_TOO_MANY_REQUESTS"):(0,H.t)("LINK_EXPIRED_MESSAGE")),(0,ee.Wk)(e,P.current),K(null),X(null)):r.ZP.error("failed to sync public album with remote",n)}finally{G.finishLoading(),Y(!1)}},eU=async(e,t)=>{try{let l=await Z.Z.getInstance(),i=null;try{let t=V.publicURLs[0];i=await l.deriveKey(e,t.nonce,t.opsLimit,t.memLimit)}catch(e){r.ZP.error("failed to derive key for verifyLinkPassword",e),t("".concat((0,H.t)("UNKNOWN_ERROR")," ").concat(e.message));return}let o=(0,ee.yB)(n.current);try{let e=await (0,ee.w4)(n.current,i);R.current=e,$.Z.updateToken(n.current,R.current),await (0,ee.Kc)(o,e)}catch(e){if((0,p.a3)(e).message===p.sH.TOKEN_EXPIRED){t((0,H.t)("INCORRECT_PASSPHRASE"));return}throw e}await eH(),G.finishLoading()}catch(e){r.ZP.error("failed to verifyLinkPassword",e),t("".concat((0,H.t)("UNKNOWN_ERROR")," ").concat(e.message))}};if(Q){if(!B)return(0,l.tZ)(i.wx,{children:(0,l.tZ)(o.Z,{})})}else{if(W)return(0,l.tZ)(i.wx,{children:W});if(eo&&!R.current)return(0,l.tZ)(i.wx,{children:(0,l.BX)(a.Z,{children:[(0,l.tZ)(c.Z,{children:(0,H.t)("password")}),(0,l.tZ)(g.Z,{color:"text.muted",mb:2,variant:"small",children:(0,H.t)("link_password_description")}),(0,l.tZ)(d.Z,{callback:eU,placeholder:(0,H.t)("password"),buttonText:(0,H.t)("unlock"),fieldType:"password"})]})});if(!B)return(0,l.tZ)(i.wx,{children:(0,H.t)("NOT_FOUND")})}let eA=()=>{(null==ev?void 0:ev.count)&&eE({ownCount:0,count:0,collectionID:0})},eM=async()=>{try{let e=(0,el.Rb)(ev,B),t=eN("".concat(e.length," ").concat((0,H.t)("FILES")));await (0,el.ng)(e,t),eA()}catch(e){r.ZP.error("failed to download selected files",e)}};return(0,l.tZ)(er.H.Provider,{value:{token:n.current,referralCode:M.current,passwordToken:R.current,accessedThroughSharedURL:!0,photoListHeader:ec,photoListFooter:es},children:(0,l.BX)(O.Z,{getDragAndDropRootProps:eg,children:[(0,l.tZ)(x.l,{getDragAndDropInputProps:eR,getFileSelectorInputProps:em,getFolderSelectorInputProps:eO}),(0,l.tZ)(k,{showUploadButton:null==V?void 0:null===(t=V.publicURLs)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.enableCollect,openUploader:ex}),(0,l.tZ)(T.Z,{page:h.Wu.SHARED_ALBUMS,files:B,syncWithRemote:eH,setSelected:eE,selected:ev,activeCollectionID:J.Ug,enableDownload:eP,fileToCollectionsMap:null,collectionNameMap:null,setFilesDownloadProgressAttributesCreator:eN}),eZ&&(0,l.tZ)(y.f,{children:(0,l.tZ)(o.Z,{})}),(0,l.tZ)(N.Z,{syncWithRemote:eH,uploadCollection:V,setLoading:ep,setShouldDisableDropzone:ef,setFiles:X,uploadTypeSelectorView:eh,closeUploadTypeSelector:()=>{eC(!1)},showSessionExpiredMessage:()=>G.setDialogMessage({title:(0,H.t)("LINK_EXPIRED"),content:(0,H.t)("LINK_EXPIRED_MESSAGE"),nonClosable:!0,proceed:{text:(0,H.t)("LOGIN"),action:()=>ei.push(h.Wu.ROOT),variant:"accent"}}),uploadTypeSelectorIntent:et.M.collectPhotos,dragAndDropFiles:eS,openFileSelector:e_,fileSelectorFiles:eL,openFolderSelector:ey,folderSelectorFiles:eT}),(0,l.tZ)(L.yu,{attributesList:eb,setAttributesList:eD}),ev.count>0&&(0,l.tZ)(z,{downloadFilesHelper:eM,clearSelection:eA,count:ev.count})]})})}},77754:function(e,t,n){"use strict";var l=n(52903),r=n(62197);n(2784),t.Z=e=>{let{sx:t,...n}=e;return(0,l.tZ)(r.Z,{variant:"h2",sx:{mb:8,...t},...n,children:n.children})}},42898:function(e,t,n){"use strict";var l=n(65992),r=n(17377);let i=(0,l.ZP)(r.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});t.Z=i}},function(e){e.O(0,[8934,9524,3164,3602,4100,7518,3988,2672,6832,7332,3310,7491,3116,2888,9774,179],function(){return e(e.s=21207)}),_N_E=e.O()}]);