(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5125],{32774:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/change-password",function(){return r(21147)}])},21147:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return g}});var n=r(52903),a=r(17973),i=r(88769),o=r(901),c=r(50918),s=r(34291),u=r(49521),l=r(89449),d=r(42898),p=r(16950),f=r(77754),y=r(95770),S=r(88659),w=r(2299),E=r(66546),Z=r(10005),R=r(24450),h=r(35042),m=r(24991),P=r(5632),A=r(2784),T=r(66569),v=t=>{var e,r,v;let{appContext:_}=t,{appName:g}=_,[O,C]=(0,A.useState)(),[b,N]=(0,A.useState)(),I=(0,P.useRouter)();(0,A.useEffect)(()=>{let t=(0,Z.Yu)(Z.Pd.USER);N(t),(null==t?void 0:t.token)?C(t.token):(E.Z.set(E.i.REDIRECT_URL,c.q.CHANGE_PASSWORD),I.push(c.q.ROOT))},[]);let D=async(t,e)=>{let r;let n=await S.Z.getInstance(),o=await (0,h.G)(),c=(0,Z.Yu)(Z.Pd.KEY_ATTRIBUTES),l=await n.generateSaltToDeriveKey();try{r=await n.deriveSensitiveKey(t,l)}catch(t){e("confirm",(0,m.t)("PASSWORD_GENERATION_FAILED"));return}let d=await n.encryptToB64(o,r.key),p={kekSalt:l,encryptedKey:d.encryptedData,keyDecryptionNonce:d.nonce,opsLimit:r.opsLimit,memLimit:r.memLimit},f=await (0,w.uA)(r.key),{srpUserID:y,srpSalt:E,srpVerifier:P}=await (0,s.a4)(f),A=await (0,s.u1)(E,y,f),T=(0,u.HC)(A.computeA()),{setupID:v,srpB:_}=await (0,i.zx)((0,a.z)(O),{srpUserID:y,srpSalt:E,srpVerifier:P,srpA:T});A.setB((0,u.GS)(_));let g=(0,u.HC)(A.computeM1());await (0,i.$Q)((0,a.z)(O),{setupID:v,srpM1:g,updatedKeyAttr:p});let C=Object.assign(c,p);await (0,w.iv)(t,C,o),await (0,w.CP)(R.Qm.ENCRYPTION_KEY,o),K()},K=()=>{(0,Z.a_)(Z.Pd.SHOW_BACK_BUTTON,{value:!0}),I.push((0,T.P)(g))};return(0,n.tZ)(l.wx,{children:(0,n.BX)(d.Z,{children:[(0,n.tZ)(f.Z,{children:(0,m.t)("CHANGE_PASSWORD")}),(0,n.tZ)(o.Z,{userEmail:null!==(r=null==b?void 0:b.email)&&void 0!==r?r:"",callback:D,buttonText:(0,m.t)("CHANGE_PASSWORD")}),(null===(v=null===(e=(0,Z.Yu)(Z.Pd.SHOW_BACK_BUTTON))||void 0===e?void 0:e.value)||void 0===v||v)&&(0,n.tZ)(p.Z,{children:(0,n.tZ)(y.Z,{onClick:I.back,children:(0,m.t)("GO_BACK")})})]})})},_=r(77024),g=()=>(0,n.tZ)(v,{appContext:(0,_.useAppContext)()})},88769:function(t,e,r){"use strict";r.d(e,{$Q:function(){return y},IG:function(){return p},O3:function(){return u},XD:function(){return d},gd:function(){return f},zx:function(){return l}});var n=r(96045),a=r(73873),i=r(95525),o=r(18786),c=r(80613);let s=(0,i.O3)(),u=async t=>{try{return(await a.Z.get("".concat(s,"/users/srp/attributes"),{email:t})).data.attributes}catch(t){return n.ZP.error("failed to get SRP attributes",t),null}},l=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/setup"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw n.ZP.error("failed to post SRP attributes",t),t}},d=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/complete"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw n.ZP.error("failed to complete SRP setup",t),t}},p=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/create-session"),{srpUserID:t,srpA:e})).data}catch(t){throw n.ZP.error("createSRPSession failed",t),t}},f=async(t,e,r)=>{try{return(await a.Z.post("".concat(s,"/users/srp/verify-session"),{sessionID:t,srpUserID:e,srpM1:r},void 0)).data}catch(t){if(n.ZP.error("verifySRPSession failed",t),t instanceof o.MS&&t.httpStatusCode===c.WE.Unauthorized)throw Error(o.sH.INCORRECT_PASSWORD);throw t}},y=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/update"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw n.ZP.error("updateSRPAndKeys failed",t),t}}},54196:function(t,e,r){"use strict";r.d(e,{L:function(){return l}});var n=r(52903),a=r(76228),i=r(49521),o=r(89449),c=r(62197),s=r(24991),u=r(2784);let l=t=>{let{password:e}=t,r=(0,u.useMemo)(()=>(0,i.rp)(e),[e]);return(0,n.tZ)(o.A0,{mt:"8px",mb:"4px",children:(0,n.tZ)(c.Z,{variant:"small",sx:t=>({color:r===a.Y.WEAK?t.colors.danger.A700:r===a.Y.MODERATE?t.colors.warning.A500:t.colors.accent.A500}),textAlign:"left",flex:1,children:e?(0,s.t)("PASSPHRASE_STRENGTH",{context:r}):""})})}},901:function(t,e,r){"use strict";var n=r(52903),a=r(49521),i=r(83422),o=r(47290),c=r(62197),s=r(17952),u=r(51464),l=r(24862),d=r(63602),p=r(24991),f=r(2784),y=r(98614),S=r(48601),w=r(54196);e.Z=function(t){let[e,r]=(0,f.useState)(!1),[E,Z]=(0,f.useState)(!1),R=()=>{Z(!E)},h=t=>{t.preventDefault()},m=async(e,n)=>{let{setFieldError:a}=n;r(!0);try{let{passphrase:r,confirm:n}=e;r===n?await t.callback(r,a):a("confirm",(0,p.t)("PASSPHRASE_MATCH_ERROR"))}catch(e){let t=e instanceof Error?e.message:"";a("confirm","".concat((0,p.t)("UNKNOWN_ERROR")," ").concat(t))}finally{r(!1)}};return(0,n.tZ)(d.J9,{initialValues:{passphrase:"",confirm:""},validationSchema:S.Ry().shape({passphrase:S.Z_().required((0,p.t)("REQUIRED")),confirm:S.Z_().required((0,p.t)("REQUIRED"))}),validateOnChange:!1,validateOnBlur:!1,onSubmit:m,children:r=>{let{values:d,errors:f,handleChange:S,handleSubmit:Z}=r;return(0,n.BX)("form",{noValidate:!0,onSubmit:Z,children:[(0,n.tZ)(c.Z,{mb:2,color:"text.muted",variant:"small",children:(0,p.t)("ENTER_ENC_PASSPHRASE")}),(0,n.tZ)(s.Z,{sx:{display:"none"},name:"email",id:"email",autoComplete:"username",type:"email",value:t.userEmail}),(0,n.tZ)(u.Z,{fullWidth:!0,name:"password",id:"password",autoComplete:"new-password",type:E?"text":"password",label:(0,p.t)("PASSPHRASE_HINT"),value:d.passphrase,onChange:S("passphrase"),error:!!f.passphrase,helperText:f.passphrase,autoFocus:!0,disabled:e,InputProps:{endAdornment:(0,n.tZ)(i.Z,{showPassword:E,handleClickShowPassword:R,handleMouseDownPassword:h})}}),(0,n.tZ)(u.Z,{fullWidth:!0,name:"confirm-password",id:"confirm-password",autoComplete:"new-password",type:"password",label:(0,p.t)("CONFIRM_PASSPHRASE"),value:d.confirm,onChange:S("confirm"),disabled:e,error:!!f.confirm,helperText:f.confirm}),(0,n.tZ)(w.L,{password:d.passphrase}),(0,n.tZ)(c.Z,{my:2,variant:"small",children:(0,n.tZ)(y.cC,{i18nKey:"PASSPHRASE_DISCLAIMER"})}),(0,n.BX)(l.Z,{my:4,children:[(0,n.tZ)(o.Z,{sx:{my:0},loading:e,buttonText:t.buttonText,disabled:(0,a.DZ)(d.passphrase)}),e&&(0,n.tZ)(c.Z,{textAlign:"center",mt:1,color:"text.muted",variant:"small",children:(0,p.t)("KEY_GENERATION_IN_PROGRESS_MESSAGE")})]})]})}})}},76228:function(t,e,r){"use strict";var n,a;r.d(e,{Y:function(){return n}}),(a=n||(n={})).WEAK="WEAK",a.MODERATE="MODERATE",a.STRONG="STRONG"},50918:function(t,e,r){"use strict";var n,a;r.d(e,{q:function(){return n}}),(a=n||(n={})).ROOT="/",a.CHANGE_EMAIL="/change-email",a.CHANGE_PASSWORD="/change-password",a.CREDENTIALS="/credentials",a.GENERATE="/generate",a.LOGIN="/login",a.RECOVER="/recover",a.SIGNUP="/signup",a.TWO_FACTOR_SETUP="/two-factor/setup",a.TWO_FACTOR_VERIFY="/two-factor/verify",a.TWO_FACTOR_RECOVER="/two-factor/recover",a.VERIFY="/verify",a.SHARED_ALBUMS="/shared-albums"},66569:function(t,e,r){"use strict";r.d(e,{P:function(){return a}});var n=r(65342);let a=t=>{switch(t){case"accounts":return n.gp.PASSKEYS;case"auth":return n.bW.AUTH;case"photos":return n.Wu.GALLERY}}},34291:function(t,e,r){"use strict";r.d(e,{Bs:function(){return y},a4:function(){return S},pL:function(){return w},u1:function(){return E}});var n=r(96045),a=r(88659),i=r(2299),o=r(66546),c=r(94522),s=r(50232),u=r(6364),l=r(88769),d=r(49521),p=r(79644).Buffer;let f=s.SRP.params["4096"],y=async t=>{let{srpSalt:e,srpUserID:r,srpVerifier:a,loginSubKey:i}=t;try{if(o.Z.get(o.i.SRP_CONFIGURE_IN_PROGRESS))throw Error("SRP configure already in progress");o.Z.set(o.i.SRP_CONFIGURE_IN_PROGRESS,!0);let t=await E(e,r,i),s=(0,d.HC)(t.computeA());n.ZP.debug(()=>"srp a: ".concat(s));let u=(0,c.LP)(),{setupID:p,srpB:f}=await (0,l.zx)(u,{srpA:s,srpUserID:r,srpSalt:e,srpVerifier:a});t.setB((0,d.GS)(f));let y=(0,d.HC)(t.computeM1()),{srpM2:S}=await (0,l.XD)(u,{srpM1:y,setupID:p});t.checkM2((0,d.GS)(S))}catch(t){throw n.ZP.error("Failed to configure SRP",t),t}finally{o.Z.set(o.i.SRP_CONFIGURE_IN_PROGRESS,!1)}},S=async t=>{let e=await a.Z.getInstance(),r=await e.generateSaltToDeriveKey(),i=(0,u.Z)(),o=s.SRP.computeVerifier(f,(0,d.GS)(r),p.from(i),(0,d.GS)(t)),c={srpUserID:i,srpSalt:r,srpVerifier:(0,d.HC)(o),loginSubKey:t};return n.ZP.debug(()=>"SRP setup attributes generated: ".concat(JSON.stringify(c))),c},w=async(t,e)=>{try{let r=await (0,i.uA)(e),a=await E(t.srpSalt,t.srpUserID,r),o=a.computeA(),{srpB:c,sessionID:s}=await (0,l.IG)(t.srpUserID,(0,d.HC)(o));a.setB((0,d.GS)(c));let u=a.computeM1();n.ZP.debug(()=>"srp m1: ".concat((0,d.HC)(u)));let{srpM2:p,...f}=await (0,l.gd)(s,t.srpUserID,(0,d.HC)(u));return n.ZP.debug(()=>"srp verify session successful,srpM2: ".concat(p)),a.checkM2((0,d.GS)(p)),n.ZP.debug(()=>"srp server verify successful"),f}catch(t){throw n.ZP.error("srp verify failed",t),t}},E=async(t,e,r)=>new Promise((n,a)=>{s.SRP.genKey(function(i,o){try{if(i&&a(i),!o)throw Error("secret1 gen failed");let c=new s.SrpClient(f,(0,d.GS)(t),p.from(e),(0,d.GS)(r),o,!1);n(c)}catch(t){a(t)}})})},49521:function(t,e,r){"use strict";r.d(e,{DZ:function(){return l},GS:function(){return s},HC:function(){return c},rp:function(){return u}});var n=r(76228),a=r(16152),i=r.n(a),o=r(79644).Buffer;let c=t=>t.toString("base64"),s=t=>o.from(t,"base64");function u(t){if(!t)return n.Y.WEAK;let e=i()(t);return e.score<2?n.Y.WEAK:e.score<3?n.Y.MODERATE:n.Y.STRONG}let l=t=>u(t)===n.Y.WEAK},16950:function(t,e,r){"use strict";var n=r(52903),a=r(89449),i=r(56961);r(2784),e.Z=t=>{let{sx:e,style:r,...o}=t;return(0,n.BX)(n.HY,{children:[(0,n.tZ)(i.Z,{}),(0,n.tZ)(a.wx,{style:{flexDirection:"row",...r},sx:{mt:3,...e},...o,children:o.children})]})}},77754:function(t,e,r){"use strict";var n=r(52903),a=r(62197);r(2784),e.Z=t=>{let{sx:e,...r}=t;return(0,n.tZ)(a.Z,{variant:"h2",sx:{mb:8,...e},...r,children:r.children})}},42898:function(t,e,r){"use strict";var n=r(65992),a=r(17377);let i=(0,n.ZP)(a.Z)(t=>{let{theme:e}=t;return{padding:e.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});e.Z=i},83422:function(t,e,r){"use strict";var n=r(52903),a=r(26436),i=r(38203),o=r(35469),c=r(85801);r(2784),e.Z=t=>{let{showPassword:e,handleClickShowPassword:r,handleMouseDownPassword:s}=t;return(0,n.tZ)(o.Z,{position:"end",children:(0,n.tZ)(c.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:r,onMouseDown:s,edge:"end",children:e?(0,n.tZ)(i.Z,{}):(0,n.tZ)(a.Z,{})})})}},95770:function(t,e,r){"use strict";var n=r(52903),a=r(23119);r(2784),e.Z=t=>{let{children:e,sx:r,color:i,...o}=t;return(0,n.tZ)(a.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(i,".main"),textDecoration:"underline ",textDecorationColor:"".concat(i,".main")},...r},...o,children:e})}},47290:function(t,e,r){"use strict";var n=r(52903),a=r(711),i=r(8204),o=r(72841);r(2784),e.Z=t=>{let{loading:e,buttonText:r,disabled:c,success:s,sx:u,...l}=t;return(0,n.tZ)(i.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:c||e||s,sx:{my:4,...e?{"&.Mui-disabled":{backgroundColor:t=>t.colors.accent.A500,color:t=>t.colors.text.base}}:{},...u},...l,children:e?(0,n.tZ)(o.Z,{size:20}):s?(0,n.tZ)(a.Z,{sx:{fontSize:20}}):r})}},2299:function(t,e,r){"use strict";r.d(e,{CP:function(){return f},OT:function(){return y},PN:function(){return l},iv:function(){return d},uA:function(){return p},yr:function(){return S}});var n=r(96045),a=r(92660),i=r(10005),o=r(94522),c=r(24450),s=r(35042),u=r(88659);async function l(t,e){let r=await u.Z.getInstance(),n=(0,i.Yu)(i.Pd.USER),a=null,{encryptedToken:o}=n;if(o&&o.length>0){let c=await r.decryptB64(t.encryptedSecretKey,t.secretKeyDecryptionNonce,e),s=await r.boxSealOpen(o,t.publicKey,c),u=await r.fromB64(s);a=await r.toB64URLSafe(u),(0,i.a_)(i.Pd.USER,{...n,token:a,encryptedToken:null})}}async function d(t,e,r){let n=await u.Z.getInstance(),a=await n.generateSaltToDeriveKey(),o=await n.deriveInteractiveKey(t,a),c=await n.encryptToB64(r,o.key),s=Object.assign(e,{kekSalt:a,encryptedKey:c.encryptedData,keyDecryptionNonce:c.nonce,opsLimit:o.opsLimit,memLimit:o.memLimit});return(0,i.a_)(i.Pd.KEY_ATTRIBUTES,s),s}let p=async t=>{let e=await u.Z.getInstance(),r=await e.generateSubKey(t,32,1,"loginctx"),n=await e.fromB64(r);return await e.toB64(n.slice(0,16))},f=async(t,e,r)=>{let n=await u.Z.getInstance(),a=await n.generateKeyAndEncryptToB64(e);(0,c.Dt)(t,a);let i=globalThis.electron;i&&!r&&t===c.Qm.ENCRYPTION_KEY&&i.saveEncryptionKey(e)};async function y(t){let e=await u.Z.getInstance(),r=await S(),n=await e.fromHex(r);return await e.encryptToB64(t,n)}let S=async()=>{try{let t;let e=await u.Z.getInstance(),{recoveryKeyEncryptedWithMasterKey:r,recoveryKeyDecryptionNonce:n}=(0,i.Yu)(i.Pd.KEY_ATTRIBUTES),a=await (0,s.G)();return t=r?await e.decryptB64(r,n,a):await w(),t=await e.toHex(t)}catch(t){throw console.log(t),n.ZP.error("getRecoveryKey failed",t),t}};async function w(){let t=await (0,s.G)(),e=(0,i.Yu)(i.Pd.KEY_ATTRIBUTES),r=await u.Z.getInstance(),n=await r.generateEncryptionKey(),c=await r.encryptToB64(t,n),l=await r.encryptToB64(n,t),d={masterKeyEncryptedWithRecoveryKey:c.encryptedData,masterKeyDecryptionNonce:c.nonce,recoveryKeyEncryptedWithMasterKey:l.encryptedData,recoveryKeyDecryptionNonce:l.nonce};await (0,a.Jl)((0,o.LP)(),d);let p=Object.assign(e,d);return(0,i.a_)(i.Pd.KEY_ATTRIBUTES,p),n}}},function(t){t.O(0,[8934,1981,3602,4100,7518,3988,3432,3313,2888,9774,179],function(){return t(t.s=32774)}),_N_E=t.O()}]);