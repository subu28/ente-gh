(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4143],{58362:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify",function(){return n(56134)}])},56134:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return O}});var r=n(52903),a=n(17973),i=n(89449),o=n(46470),c=n(42898),s=n(16950),u=n(77754),l=n(95770),d=n(69669),p=n(18786),f=n(95525),E=n(66546),y=n(89610),h=n(10005),w=n(94522),R=n(24450),S=n(24862),T=n(62197),Z=n(80613),P=n(24991),_=n(5632),I=n(2784),m=n(98614),A=n(92660),b=n(50918),g=n(34291),v=t=>{let{appContext:e}=t,{appName:n,logout:v}=e,[C,O]=(0,I.useState)(""),[N,B]=(0,I.useState)(0),x=(0,_.useRouter)();(0,I.useEffect)(()=>{(async()=>{let t=(0,h.Yu)(h.Pd.USER),e=(0,h.Yu)(h.Pd.KEY_ATTRIBUTES);(null==t?void 0:t.email)?(null==e?void 0:e.encryptedKey)&&(t.token||t.encryptedToken)?x.push(b.q.CREDENTIALS):O(t.email):x.push(b.q.ROOT)})(),e.showNavBar(!0)},[]);let D=async(t,e)=>{try{let e=(0,w.vE)(),{keyAttributes:n,encryptedToken:r,token:i,id:o,twoFactorSessionID:c,passkeySessionID:s}=(await (0,A._O)(C,t,e)).data;if(s){let t=(0,h.Yu)(h.Pd.USER);(0,h.a_)(h.Pd.USER,{...t,passkeySessionID:s,isTwoFactorEnabled:!0,isTwoFactorPasskeysEnabled:!0}),(0,w.Qj)(!0),window.location.href="".concat((0,f.KS)(),"/passkeys/flow?passkeySessionID=").concat(s,"&redirect=").concat(window.location.origin,"/passkeys/finish"),x.push(b.q.CREDENTIALS)}else if(c)(0,h.a_)(h.Pd.USER,{email:C,twoFactorSessionID:c,isTwoFactorEnabled:!0}),(0,w.Qj)(!0),x.push(b.q.TWO_FACTOR_VERIFY);else{if((0,h.a_)(h.Pd.USER,{email:C,token:i,encryptedToken:r,id:o,isTwoFactorEnabled:!1}),n)(0,h.a_)(h.Pd.KEY_ATTRIBUTES,n),(0,h.a_)(h.Pd.ORIGINAL_KEY_ATTRIBUTES,n);else if((0,h.Yu)(h.Pd.ORIGINAL_KEY_ATTRIBUTES)&&await (0,A.p6)((0,a.z)(i),(0,h.Yu)(h.Pd.ORIGINAL_KEY_ATTRIBUTES)),(0,h.Yu)(h.Pd.SRP_SETUP_ATTRIBUTES)){let t=(0,h.Yu)(h.Pd.SRP_SETUP_ATTRIBUTES);await (0,g.Bs)(t)}y.Z.clear(),(0,w.Qj)(!0);let t=E.Z.get(E.i.REDIRECT_URL);E.Z.delete(E.i.REDIRECT_URL),(null==n?void 0:n.encryptedKey)?((0,R.z5)(),x.push(null!=t?t:b.q.CREDENTIALS)):x.push(null!=t?t:b.q.GENERATE)}}catch(t){t instanceof p.MS?(null==t?void 0:t.httpStatusCode)===Z.WE.Unauthorized?e((0,P.t)("INVALID_CODE")):(null==t?void 0:t.httpStatusCode)===Z.WE.Gone&&e((0,P.t)("EXPIRED_CODE")):e("".concat((0,P.t)("UNKNOWN_ERROR")," ").concat(JSON.stringify(t)))}},K=async()=>{B(1),await (0,A.Tb)(n,C),B(2),setTimeout(()=>B(0),3e3)};return C?(0,r.tZ)(i.wx,{children:(0,r.BX)(c.Z,{children:[(0,r.tZ)(u.Z,{sx:{mb:14,wordBreak:"break-word"},children:(0,r.tZ)(m.cC,{i18nKey:"EMAIL_SENT",components:{a:(0,r.tZ)(S.Z,{color:"text.muted",component:"span"})},values:{email:C}})}),(0,r.tZ)(T.Z,{color:"text.muted",mb:2,variant:"small",children:(0,P.t)("CHECK_INBOX")}),(0,r.tZ)(d.Z,{fieldType:"text",autoComplete:"one-time-code",placeholder:(0,P.t)("ENTER_OTT"),buttonText:(0,P.t)("VERIFY"),callback:D}),(0,r.BX)(s.Z,{style:{justifyContent:"space-between"},children:[0===N&&(0,r.tZ)(l.Z,{onClick:K,children:(0,P.t)("RESEND_MAIL")}),1===N&&(0,r.tZ)("span",{children:(0,P.t)("SENDING")}),2===N&&(0,r.tZ)("span",{children:(0,P.t)("SENT")}),(0,r.tZ)(l.Z,{onClick:v,children:(0,P.t)("CHANGE_EMAIL")})]})]})}):(0,r.tZ)(i.wx,{children:(0,r.tZ)(o.Z,{})})},C=n(77024),O=()=>(0,r.tZ)(v,{appContext:(0,C.useAppContext)()})},88769:function(t,e,n){"use strict";n.d(e,{$Q:function(){return E},IG:function(){return p},O3:function(){return u},XD:function(){return d},gd:function(){return f},zx:function(){return l}});var r=n(96045),a=n(73873),i=n(95525),o=n(18786),c=n(80613);let s=(0,i.O3)(),u=async t=>{try{return(await a.Z.get("".concat(s,"/users/srp/attributes"),{email:t})).data.attributes}catch(t){return r.ZP.error("failed to get SRP attributes",t),null}},l=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/setup"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw r.ZP.error("failed to post SRP attributes",t),t}},d=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/complete"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw r.ZP.error("failed to complete SRP setup",t),t}},p=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/create-session"),{srpUserID:t,srpA:e})).data}catch(t){throw r.ZP.error("createSRPSession failed",t),t}},f=async(t,e,n)=>{try{return(await a.Z.post("".concat(s,"/users/srp/verify-session"),{sessionID:t,srpUserID:e,srpM1:n},void 0)).data}catch(t){if(r.ZP.error("verifySRPSession failed",t),t instanceof o.MS&&t.httpStatusCode===c.WE.Unauthorized)throw Error(o.sH.INCORRECT_PASSWORD);throw t}},E=async(t,e)=>{try{return(await a.Z.post("".concat(s,"/users/srp/update"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw r.ZP.error("updateSRPAndKeys failed",t),t}}},76228:function(t,e,n){"use strict";var r,a;n.d(e,{Y:function(){return r}}),(a=r||(r={})).WEAK="WEAK",a.MODERATE="MODERATE",a.STRONG="STRONG"},50918:function(t,e,n){"use strict";var r,a;n.d(e,{q:function(){return r}}),(a=r||(r={})).ROOT="/",a.CHANGE_EMAIL="/change-email",a.CHANGE_PASSWORD="/change-password",a.CREDENTIALS="/credentials",a.GENERATE="/generate",a.LOGIN="/login",a.RECOVER="/recover",a.SIGNUP="/signup",a.TWO_FACTOR_SETUP="/two-factor/setup",a.TWO_FACTOR_VERIFY="/two-factor/verify",a.TWO_FACTOR_RECOVER="/two-factor/recover",a.VERIFY="/verify",a.SHARED_ALBUMS="/shared-albums"},34291:function(t,e,n){"use strict";n.d(e,{Bs:function(){return E},a4:function(){return y},pL:function(){return h},u1:function(){return w}});var r=n(96045),a=n(88659),i=n(2299),o=n(66546),c=n(94522),s=n(50232),u=n(6364),l=n(88769),d=n(49521),p=n(79644).Buffer;let f=s.SRP.params["4096"],E=async t=>{let{srpSalt:e,srpUserID:n,srpVerifier:a,loginSubKey:i}=t;try{if(o.Z.get(o.i.SRP_CONFIGURE_IN_PROGRESS))throw Error("SRP configure already in progress");o.Z.set(o.i.SRP_CONFIGURE_IN_PROGRESS,!0);let t=await w(e,n,i),s=(0,d.HC)(t.computeA());r.ZP.debug(()=>"srp a: ".concat(s));let u=(0,c.LP)(),{setupID:p,srpB:f}=await (0,l.zx)(u,{srpA:s,srpUserID:n,srpSalt:e,srpVerifier:a});t.setB((0,d.GS)(f));let E=(0,d.HC)(t.computeM1()),{srpM2:y}=await (0,l.XD)(u,{srpM1:E,setupID:p});t.checkM2((0,d.GS)(y))}catch(t){throw r.ZP.error("Failed to configure SRP",t),t}finally{o.Z.set(o.i.SRP_CONFIGURE_IN_PROGRESS,!1)}},y=async t=>{let e=await a.Z.getInstance(),n=await e.generateSaltToDeriveKey(),i=(0,u.Z)(),o=s.SRP.computeVerifier(f,(0,d.GS)(n),p.from(i),(0,d.GS)(t)),c={srpUserID:i,srpSalt:n,srpVerifier:(0,d.HC)(o),loginSubKey:t};return r.ZP.debug(()=>"SRP setup attributes generated: ".concat(JSON.stringify(c))),c},h=async(t,e)=>{try{let n=await (0,i.uA)(e),a=await w(t.srpSalt,t.srpUserID,n),o=a.computeA(),{srpB:c,sessionID:s}=await (0,l.IG)(t.srpUserID,(0,d.HC)(o));a.setB((0,d.GS)(c));let u=a.computeM1();r.ZP.debug(()=>"srp m1: ".concat((0,d.HC)(u)));let{srpM2:p,...f}=await (0,l.gd)(s,t.srpUserID,(0,d.HC)(u));return r.ZP.debug(()=>"srp verify session successful,srpM2: ".concat(p)),a.checkM2((0,d.GS)(p)),r.ZP.debug(()=>"srp server verify successful"),f}catch(t){throw r.ZP.error("srp verify failed",t),t}},w=async(t,e,n)=>new Promise((r,a)=>{s.SRP.genKey(function(i,o){try{if(i&&a(i),!o)throw Error("secret1 gen failed");let c=new s.SrpClient(f,(0,d.GS)(t),p.from(e),(0,d.GS)(n),o,!1);r(c)}catch(t){a(t)}})})},49521:function(t,e,n){"use strict";n.d(e,{DZ:function(){return l},GS:function(){return s},HC:function(){return c},rp:function(){return u}});var r=n(76228),a=n(16152),i=n.n(a),o=n(79644).Buffer;let c=t=>t.toString("base64"),s=t=>o.from(t,"base64");function u(t){if(!t)return r.Y.WEAK;let e=i()(t);return e.score<2?r.Y.WEAK:e.score<3?r.Y.MODERATE:r.Y.STRONG}let l=t=>u(t)===r.Y.WEAK},16950:function(t,e,n){"use strict";var r=n(52903),a=n(89449),i=n(56961);n(2784),e.Z=t=>{let{sx:e,style:n,...o}=t;return(0,r.BX)(r.HY,{children:[(0,r.tZ)(i.Z,{}),(0,r.tZ)(a.wx,{style:{flexDirection:"row",...n},sx:{mt:3,...e},...o,children:o.children})]})}},77754:function(t,e,n){"use strict";var r=n(52903),a=n(62197);n(2784),e.Z=t=>{let{sx:e,...n}=t;return(0,r.tZ)(a.Z,{variant:"h2",sx:{mb:8,...e},...n,children:n.children})}},42898:function(t,e,n){"use strict";var r=n(65992),a=n(17377);let i=(0,r.ZP)(a.Z)(t=>{let{theme:e}=t;return{padding:e.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});e.Z=i},83422:function(t,e,n){"use strict";var r=n(52903),a=n(26436),i=n(38203),o=n(35469),c=n(85801);n(2784),e.Z=t=>{let{showPassword:e,handleClickShowPassword:n,handleMouseDownPassword:s}=t;return(0,r.tZ)(o.Z,{position:"end",children:(0,r.tZ)(c.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:n,onMouseDown:s,edge:"end",children:e?(0,r.tZ)(i.Z,{}):(0,r.tZ)(a.Z,{})})})}},95770:function(t,e,n){"use strict";var r=n(52903),a=n(23119);n(2784),e.Z=t=>{let{children:e,sx:n,color:i,...o}=t;return(0,r.tZ)(a.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(i,".main"),textDecoration:"underline ",textDecorationColor:"".concat(i,".main")},...n},...o,children:e})}},69669:function(t,e,n){"use strict";n.d(e,{Z:function(){return E}});var r=n(52903),a=n(89449),i=n(83422),o=n(80982),c=n(8204),s=n(51464),u=n(63602),l=n(24991),d=n(2784),p=n(48601),f=n(47290);function E(t){var e;let{submitButtonProps:n}=t,{sx:E,...y}=null!=n?n:{},[h,w]=(0,d.useState)(!1),[R,S]=(0,d.useState)(!1),T=async(e,n)=>{let{setFieldError:r,resetForm:a}=n;w(!0),await t.callback(e.inputValue,t=>r("inputValue",t),a),w(!1)},Z=()=>{S(!R)},P=t=>{t.preventDefault()},_=(0,d.useMemo)(()=>{switch(t.fieldType){case"text":case"password":return p.Ry().shape({inputValue:p.Z_().required((0,l.t)("REQUIRED"))});case"email":return p.Ry().shape({inputValue:p.Z_().email((0,l.t)("EMAIL_ERROR")).required((0,l.t)("REQUIRED"))})}},[t.fieldType]);return(0,r.tZ)(u.J9,{initialValues:{inputValue:null!==(e=t.initialValue)&&void 0!==e?e:""},onSubmit:T,validationSchema:_,validateOnChange:!1,validateOnBlur:!1,children:e=>{let{values:n,errors:u,handleChange:d,handleSubmit:p}=e;return(0,r.BX)("form",{noValidate:!0,onSubmit:p,children:[t.hiddenPreInput,(0,r.tZ)(s.Z,{hiddenLabel:t.hiddenLabel,variant:"filled",fullWidth:!0,type:R?"text":t.fieldType,id:t.fieldType,name:t.fieldType,...t.hiddenLabel?{placeholder:t.placeholder}:t.realPlaceholder?{placeholder:t.realPlaceholder,label:t.realLabel}:{label:t.placeholder},value:n.inputValue,onChange:d("inputValue"),error:!!u.inputValue,helperText:u.inputValue,disabled:h,autoFocus:!t.disableAutoFocus,autoComplete:t.autoComplete,InputProps:{autoComplete:t.disableAutoComplete||"password"===t.fieldType?"off":"on",endAdornment:"password"===t.fieldType&&(0,r.tZ)(i.Z,{showPassword:R,handleClickShowPassword:Z,handleMouseDownPassword:P})}}),(0,r.tZ)(o.Z,{sx:{position:"relative",top:u.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:t.caption}),t.hiddenPostInput,(0,r.BX)(a.A0,{justifyContent:"flex-end",flexWrap:t.blockButton?"wrap-reverse":"nowrap",children:[t.secondaryButtonAction&&(0,r.tZ)(c.Z,{onClick:t.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:t.blockButton?.5:2,mb:t.blockButton?0:4,mr:t.blockButton?0:1,...E}},...y,children:(0,l.t)("CANCEL")}),(0,r.tZ)(f.Z,{sx:{"&&&":{mt:2,...E}},buttonText:t.buttonText,loading:h,...y})]})]})}})}},47290:function(t,e,n){"use strict";var r=n(52903),a=n(711),i=n(8204),o=n(72841);n(2784),e.Z=t=>{let{loading:e,buttonText:n,disabled:c,success:s,sx:u,...l}=t;return(0,r.tZ)(i.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:c||e||s,sx:{my:4,...e?{"&.Mui-disabled":{backgroundColor:t=>t.colors.accent.A500,color:t=>t.colors.text.base}}:{},...u},...l,children:e?(0,r.tZ)(o.Z,{size:20}):s?(0,r.tZ)(a.Z,{sx:{fontSize:20}}):n})}},2299:function(t,e,n){"use strict";n.d(e,{CP:function(){return f},OT:function(){return E},PN:function(){return l},iv:function(){return d},uA:function(){return p},yr:function(){return y}});var r=n(96045),a=n(92660),i=n(10005),o=n(94522),c=n(24450),s=n(35042),u=n(88659);async function l(t,e){let n=await u.Z.getInstance(),r=(0,i.Yu)(i.Pd.USER),a=null,{encryptedToken:o}=r;if(o&&o.length>0){let c=await n.decryptB64(t.encryptedSecretKey,t.secretKeyDecryptionNonce,e),s=await n.boxSealOpen(o,t.publicKey,c),u=await n.fromB64(s);a=await n.toB64URLSafe(u),(0,i.a_)(i.Pd.USER,{...r,token:a,encryptedToken:null})}}async function d(t,e,n){let r=await u.Z.getInstance(),a=await r.generateSaltToDeriveKey(),o=await r.deriveInteractiveKey(t,a),c=await r.encryptToB64(n,o.key),s=Object.assign(e,{kekSalt:a,encryptedKey:c.encryptedData,keyDecryptionNonce:c.nonce,opsLimit:o.opsLimit,memLimit:o.memLimit});return(0,i.a_)(i.Pd.KEY_ATTRIBUTES,s),s}let p=async t=>{let e=await u.Z.getInstance(),n=await e.generateSubKey(t,32,1,"loginctx"),r=await e.fromB64(n);return await e.toB64(r.slice(0,16))},f=async(t,e,n)=>{let r=await u.Z.getInstance(),a=await r.generateKeyAndEncryptToB64(e);(0,c.Dt)(t,a);let i=globalThis.electron;i&&!n&&t===c.Qm.ENCRYPTION_KEY&&i.saveEncryptionKey(e)};async function E(t){let e=await u.Z.getInstance(),n=await y(),r=await e.fromHex(n);return await e.encryptToB64(t,r)}let y=async()=>{try{let t;let e=await u.Z.getInstance(),{recoveryKeyEncryptedWithMasterKey:n,recoveryKeyDecryptionNonce:r}=(0,i.Yu)(i.Pd.KEY_ATTRIBUTES),a=await (0,s.G)();return t=n?await e.decryptB64(n,r,a):await h(),t=await e.toHex(t)}catch(t){throw console.log(t),r.ZP.error("getRecoveryKey failed",t),t}};async function h(){let t=await (0,s.G)(),e=(0,i.Yu)(i.Pd.KEY_ATTRIBUTES),n=await u.Z.getInstance(),r=await n.generateEncryptionKey(),c=await n.encryptToB64(t,r),l=await n.encryptToB64(r,t),d={masterKeyEncryptedWithRecoveryKey:c.encryptedData,masterKeyDecryptionNonce:c.nonce,recoveryKeyEncryptedWithMasterKey:l.encryptedData,recoveryKeyDecryptionNonce:l.nonce};await (0,a.Jl)((0,o.LP)(),d);let p=Object.assign(e,d);return(0,i.a_)(i.Pd.KEY_ATTRIBUTES,p),r}}},function(t){t.O(0,[8934,1981,3602,4100,7518,3988,3432,3313,2888,9774,179],function(){return t(t.s=58362)}),_N_E=t.O()}]);