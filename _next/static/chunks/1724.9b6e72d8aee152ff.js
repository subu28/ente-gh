!function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),a=Symbol("Comlink.thrown"),n=e=>"object"==typeof e&&null!==e||"function"==typeof e,o=new Map([["proxy",{canHandle:t=>n(t)&&t[e],serialize(e){let{port1:t,port2:r}=new MessageChannel;return s(e,t),[r,[r]]},deserialize:e=>(e.start(),f(e,[],void 0))}],["throw",{canHandle:e=>n(e)&&a in e,serialize:({value:e})=>[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]],deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function s(t,r=globalThis,n=["*"]){r.addEventListener("message",function o(c){let u;if(!c||!c.data)return;if(!function(e,t){for(let r of e)if(t===r||"*"===r||r instanceof RegExp&&r.test(t))return!0;return!1}(n,c.origin)){console.warn(`Invalid origin '${c.origin}' for comlink proxy`);return}let{id:d,type:g,path:f}=Object.assign({path:[]},c.data),h=(c.data.argumentList||[]).map(y);try{var v,E;let r=f.slice(0,-1).reduce((e,t)=>e[t],t),i=f.reduce((e,t)=>e[t],t);switch(g){case"GET":u=i;break;case"SET":r[f.slice(-1)[0]]=y(c.data.value),u=!0;break;case"APPLY":u=i.apply(r,h);break;case"CONSTRUCT":v=new i(...h),u=Object.assign(v,{[e]:!0});break;case"ENDPOINT":{let{port1:e,port2:r}=new MessageChannel;s(t,r),E=[e],m.set(e,E),u=e}break;case"RELEASE":u=void 0;break;default:return}}catch(e){u={value:e,[a]:0}}Promise.resolve(u).catch(e=>({value:e,[a]:0})).then(e=>{let[a,n]=p(e);r.postMessage(Object.assign(Object.assign({},a),{id:d}),n),"RELEASE"===g&&(r.removeEventListener("message",o),l(r),i in t&&"function"==typeof t[i]&&t[i]())}).catch(e=>{let[t,i]=p({value:TypeError("Unserializable return value"),[a]:0});r.postMessage(Object.assign(Object.assign({},t),{id:d}),i)})}),r.start&&r.start()}function l(e){"MessagePort"===e.constructor.name&&e.close()}function c(e){if(e)throw Error("Proxy has been released and is not useable")}function u(e){return v(e,{type:"RELEASE"}).then(()=>{l(e)})}let d=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(d.get(e)||0)-1;d.set(e,t),0===t&&u(e)});function f(e,i=[],a=function(){}){let n=!1,o=new Proxy(a,{get(t,a){if(c(n),a===r)return()=>{g&&g.unregister(o),u(e),n=!0};if("then"===a){if(0===i.length)return{then:()=>o};let t=v(e,{type:"GET",path:i.map(e=>e.toString())}).then(y);return t.then.bind(t)}return f(e,[...i,a])},set(t,r,a){c(n);let[o,s]=p(a);return v(e,{type:"SET",path:[...i,r].map(e=>e.toString()),value:o},s).then(y)},apply(r,a,o){c(n);let s=i[i.length-1];if(s===t)return v(e,{type:"ENDPOINT"}).then(y);if("bind"===s)return f(e,i.slice(0,-1));let[l,u]=h(o);return v(e,{type:"APPLY",path:i.map(e=>e.toString()),argumentList:l},u).then(y)},construct(t,r){c(n);let[a,o]=h(r);return v(e,{type:"CONSTRUCT",path:i.map(e=>e.toString()),argumentList:a},o).then(y)}});return function(e,t){let r=(d.get(t)||0)+1;d.set(t,r),g&&g.register(e,t,e)}(o,e),o}function h(e){var t;let r=e.map(p);return[r.map(e=>e[0]),(t=r.map(e=>e[1]),Array.prototype.concat.apply([],t))]}let m=new WeakMap;function p(e){for(let[t,r]of o)if(r.canHandle(e)){let[i,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:i},a]}return[{type:"RAW",value:e},m.get(e)||[]]}function y(e){switch(e.type){case"HANDLER":return o.get(e.name).deserialize(e.value);case"RAW":return e.value}}function v(e,t,r){return new Promise(i=>{let a=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",function t(r){r.data&&r.data.id&&r.data.id===a&&(e.removeEventListener("message",t),i(r.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),r)})}let E=()=>"function"==typeof importScripts,b="logs",w=e=>{let t={logLine:e,timestamp:Date.now()};try{let e=S();e.length>1e3&&e.slice(e.length-1e3),e.push(t),localStorage.setItem(b,JSON.stringify({logs:e}))}catch(e){console.error("Failed to persist log",e),e instanceof Error&&"QuotaExceededError"===e.name&&localStorage.removeItem(b)}},S=()=>{let e=localStorage.getItem("logs");if(!e)return[];let t=JSON.parse(e);return t&&"object"==typeof t&&"logs"in t&&Array.isArray(t.logs)?t.logs:(console.error("Unexpected log entries obtained from local storage",t),[])},T=f(globalThis,[],void 0),k=e=>{let t=globalThis.electron;t?t.logToDisk(e):E()?P(e):w(e)},P=e=>{T.logToDisk(e).catch(t=>{console.error("Failed to log a message from worker",t,"\nThe message was",e)})},C=(e,t)=>{let r;return t?(r=t instanceof Error?["".concat(t.name,": ").concat(t.message),t.stack].filter(e=>e).join("\n"):String(t),"".concat(e,": ").concat(r)):e};var L={error:(e,t)=>{let r="[error] ".concat(C(e,t));console.error(r),k(r)},warn:(e,t)=>{let r="[warn] ".concat(C(e,t));console.error(r),k(r)},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=t.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" ");k("[info] ".concat(i))},debug:e=>{}};class O{async loadCities(){try{if(this.citiesPromise)return;this.citiesPromise=fetch("https://static.ente.io/world_cities.json").then(e=>e.json().then(e=>{this.cities=e.data})),await this.citiesPromise}catch(e){L.error("LocationSearchService loadCities failed",e),this.citiesPromise=null}}async searchCities(e){try{return this.citiesPromise||this.loadCities(),await this.citiesPromise,this.cities.filter(t=>t.city.toLowerCase().startsWith(e.toLowerCase()))}catch(e){throw L.error("LocationSearchService searchCities failed",e),e}}constructor(){this.cities=[]}}function j(e,t,r){let i=1/Math.cos(Math.PI/180*e.latitude)*r/111.16,a=r/111.16,n=e.latitude-t.latitude,o=e.longitude-t.longitude;return n*n/(i*i)+o*o/(a*a)<=1}new O;let A=e=>t=>{let r=!0;return(e.month||0===e.month)&&(r=e.month===t.getMonth()),r&&e.date&&(r=e.date===t.getDate()),r&&e.year&&(r=e.year===t.getFullYear()),r};class M{setFiles(e){this.files=e}search(e){return this.files.filter(t=>{var r,i,a;return(null==e?void 0:e.collection)?e.collection===t.collectionID:(null==e?void 0:e.date)?A(e.date)(new Date(t.metadata.creationTime/1e3)):(null==e?void 0:e.location)?j({latitude:t.metadata.latitude,longitude:t.metadata.longitude},(r=e.location).centerPoint,r.radius):(null==e?void 0:e.city)?(i={latitude:t.metadata.latitude,longitude:t.metadata.longitude},j({latitude:(a=e.city).lat,longitude:a.lng},i,10)):(null==e?void 0:e.files)?-1!==e.files.indexOf(t.id):(null==e?void 0:e.person)?-1!==e.person.files.indexOf(t.id):void 0!==(null==e?void 0:e.fileType)?e.fileType===t.metadata.fileType:void 0!==(null==e?void 0:e.clip)&&e.clip.has(t.id)})}constructor(){this.files=[]}}s(M,self)}(),_N_E={};